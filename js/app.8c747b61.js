(self.webpackChunk=self.webpackChunk||[]).push([[143],{9524:()=>{window.Timeout=function(){function t(){}return t.clear=function(t){return clearTimeout(t)},t.set=function(t,e){return setTimeout(e,t)},t}()},6218:(t,e,r)=>{var i,n=r(9755);i=document.getElementsByClassName("js-fixed-element"),n(document).on("shown.bs.modal",".modal",(function(t){return n(t.target).find(".modal-af").focus()})),n(document).on("hidden.bs.modal",".modal",(function(){return n(".modal-backdrop").remove(),n("body, .js-fixed-element").css({paddingRight:""})})),n(document).on("show.bs.modal",".modal",(function(){var t,e,r,s,o,a,l,u;for(Timeout.set(10,(function(){return n(".modal-backdrop").trigger("bsTransitionEnd")})),t=[],r=s=0,a=i.length;s<a;r=++s)e=i[r],t[r]=e.getBoundingClientRect(),t[r].skip="fixed"!==getComputedStyle(e).position;for(u=[],r=o=0,l=i.length;o<l;r=++o)e=i[r],t[r].skip||(e.style.left=t[r].left+"px",u.push(e.style.width=t[r].width+"px"));return u})),n(document).on("shown.bs.modal",".modal",(function(){var t,e,r,s,o,a,l,u,c;for(l=n("body").css("padding-right"),c=[],e=r=0,o=i.length;r<o;e=++r)t=i[e],c[e]="fixed"!==getComputedStyle(t).position;for(u=[],e=s=0,a=i.length;s<a;e=++s)t=i[e],c[e]||(t.style.paddingRight=l,t.style.left="",u.push(t.style.width=""));return u}))},4725:(t,e,r)=>{var i,n=r(9755);i=function(t,e,r){var i,s,o,a,l,u;return null==r&&(r=""),o=(i=n(t.target).parents("form").find("[name=body], .js-bbcode-body")).val(),l=(s=i[0]).selectionStart,a=s.selectionEnd,(u=[o.substring(0,l),o.substring(l,a),o.substring(a)])[0]=u[0]+e,u[2]=r+u[2],l===a?(i.val(u[0]+u[2]),s.selectionStart=u[0].length,s.selectionEnd=s.selectionStart):(i.val(u[0]+u[1]+u[2]),s.selectionStart=l,s.selectionEnd=u[0].length+u[1].length+r.length),i.trigger("bbcode:inserted").trigger("input").focus()},[["bold","[b]","[/b]"],["heading","[heading]","[/heading]"],["image","[img]","[/img]"],["imagemap","[imagemap]\nhttps://example.com/image.jpg\n0 10 10 50 https://example.com example\n","[/imagemap]"],["italic","[i]","[/i]"],["link","[url]","[/url]"],["list","[list]\n[*]","[/list]"],["list-numbered","[list=1]\n[*]","[/list]"],["strikethrough","[s]","[/s]"],["underline","[u]","[/u]"],["spoilerbox","[box=]","[/box]"]].forEach((function(t){var e,r,s;return e=t[0],s=t[1],r=t[2],n(document).on("click",".js-bbcode-btn--"+e,(function(t){return i(t,s,r)}))})),n(document).on("turbolinks:load",(function(){return n(".js-bbcode-btn--size").val("")})),n(document).on("change",".js-bbcode-btn--size",(function(t){var e,r;return e=n(t.target),r=parseInt(e.val(),10),e.val(""),i(t,"[size="+r+"]","[/size]")}))},2712:(t,e,r)=>{var i,n=r(9755);i=n({}),n.subscribe=i.on.bind(i),n.unsubscribe=i.off.bind(i),n.publish=i.trigger.bind(i)},4910:(t,e,r)=>{var i=r(9755);i(document).on("click",".js-spoilerbox__link",(function(t){return t.preventDefault(),i(t.target).closest(".js-spoilerbox").toggleClass("js-spoilerbox--open"),i.publish("sync-height:force")}))},2353:()=>{},4200:(t,e,r)=>{"use strict";var i=r(9755);r(1545),r(7915),r(3795),r(9186),r(7440),r(6400),r(6227),r(2526),r(1355);function n(t,e){return"pt-br"===e&&(e="pt"),this._origGetPluralForm(t,e)}var s,o=r(9705),a=r.n(o),l=r(8949),u=r(381),c=r(2918),h=r.n(c),d=r(3599),p=r(9014);window.$=i,window.jQuery=i,null!==(s=window.LangMessages)&&void 0!==s||(window.LangMessages={}),window.Lang=function(t){return t._origGetPluralForm=t._getPluralForm,t._getPluralForm=n,t}(new(a())({fallback:window.fallbackLocale,locale:window.currentLocale,messages:window.LangMessages})),window.moment=u,window.popup=d.g,window.reloadPage=p.sl,window.Turbolinks=h(),window._styles={header:{height:90,heightMobile:50,heightSticky:50}},(0,l.jQ)({computedRequiresReaction:!0});r(2712),r(9524),r(4910);var m=r(5119),f=r(1270);function g(t){const e=window.newBody;if(null==e)return;const r=e.querySelector(".js-store-add-to-cart");null!=r&&(r.disabled=!t)}var v,b,y,w=r(9755),k=r(6486);y=function(){return g(!1),w("#username-check-price").text("")},v=function(){var t,e;return t=w("#username-check-status"),e=w(".js-username-change-input").val(),w.post((0,m.B)("users.check-username-availability"),{username:e}).done((function(e){if(e.username===w(".js-username-change-input").val())return e.available?(g(!0),w("#username-check-price").text(e.costString),w("#username-form-price").val(e.cost)):y(),t.html(e.message),t.toggleClass("green-dark",e.available),t.toggleClass("pink-dark",!e.available)})).fail((function(t,e){return w(".js-username-change-input").trigger("ajax:error",[t,e]).one("click",v)}))},b=k.debounce(v,300),w(document).on("input",".js-username-change-input",(function(t){var e,r,i;return r=t.currentTarget,e=w("#username-check-status"),i=r.value,e.removeClass("green-dark"),e.removeClass("pink-dark"),y(),0===i.length?e.text((0,f.dW)("store.username_change.check")):(e.text((0,f.dW)("store.username_change.checking",{username:i})),b())})),w(document).on("turbolinks:load",(function(){if(0!==w(".js-username-change-input").length)return y()}));r(4725);var j=r(9703),_=r(9711),x=r(9755),E=r(6486);x(document).on("ajax:before",(function(){return(0,_.Uq)(),x(document).one("ajax:complete.ujsHideLoadingOverlay",_.Lt)})),x(document).on("ajax:success",(function(t,e){var r,i;return i=function(){if(!E.isEmpty(null!=e?e.message:void 0))return(0,d.g)(e.message,"success")},"1"===t.target.getAttribute("data-reload-on-success")?(r="1"===t.target.getAttribute("data-reload-reset-scroll"),x(document).one("turbolinks:load",i),(0,p.sl)(!r)):i()})),x(document).on("ajax:error",(function(t,e){if("1"!==t.target.dataset.skipAjaxErrorPopup&&401!==e.status)return(0,j.qQ)(e)}));r(6218);var P=r(3775),C=r(9755);C(document).on("keypress",".js-auto-submit",(function(t){if(13===t.which)return t.preventDefault(),C(t.target).trigger("change")})),C(document).on("change",".js-auto-submit",(function(t){var e;if((e=C(t.target)).val()!==e.data("last-submitted-value"))return e.data("last-submitted-value",e.val()),e.parents("form").submit()})),C(document).on("keypress",".content-editable-submit",(function(t){if(13===t.which)return t.preventDefault(),C(t.target).trigger("blur")})),C(document).on("blur",".content-editable-submit",(function(t){var e,r,i;if((r=C(t.target)).html()!==r.data("last-submitted-value"))return r.data("last-submitted-value",r.html()),e=r.parents("form"),(i=C(document.createElement("input"))).attr("type","hidden"),i.attr("name",r.attr("data-name")),i.attr("value",r.html()),e.append(i),e.submit(),i.remove()})),C(document).on("turbolinks:load",(function(){return C(".content-editable-submit").each((function(t,e){var r;return(r=C(e)).data("last-submitted-value",r.html())}))})),C(document).on("click","#popup-container, #overlay",(function(t){var e;return C("#overlay").fadeOut(),(e=C(t.target).closest(".popup-active")).fadeOut(null,(function(){return e.remove()}))})),C(document).on("click",".clickable-row",(function(t){var e,r,i;if(i=t.target,!(0,P.ri)(i))return(r=t.currentTarget).classList.contains("clickable-row-link")?r.click():null!=(e=r.getElementsByClassName("clickable-row-link")[0])?e.click():void 0})),C(document).on("keydown",".js-quick-submit",(function(t){if((t.ctrlKey||t.metaKey)&&"Enter"===t.key)return t.preventDefault(),C(t.target).closest("form").submit()})),C(document).on("ajax:beforeSend",(function(t){var e,r,i,n,s,o;if((r=t.target)._submitting)return!1;for(r._submitting=!0,r._ujsSubmitDisabled=[],o=[],i=0,n=(s=r.querySelectorAll(".js-ujs-submit-disable")).length;i<n;i++)(e=s[i]).disabled||("1"===e.dataset.blurOnSubmitDisable&&e.blur(),e.disabled=!0,o.push(r._ujsSubmitDisabled.push(e)));return o})),C(document).on("ajax:complete",(function(t){var e,r,i;for((r=t.target)._submitting=!1,i=[];e=r._ujsSubmitDisabled.pop();)i.push(e.disabled=!1);return i}));var S=r(5076),T=r(9755),O=r(2918);T(document).on("click",'a[href^="#"]',(function(t){var e,r,i,n;if("collapse"!==(r=t.currentTarget).dataset.toggle&&(e=r.href,""!==(n=decodeURIComponent(e.slice(e.indexOf("#")+1)))&&null!=(i=document.getElementById(n))))return t.preventDefault(),O.controller.advanceHistory(e),i.scrollIntoView()})),O.HttpRequest.prototype.requestLoaded=function(){return this.endRequest((t=this,function(){var e,r;return 200<=(e=t.xhr.status)&&e<300||401===(r=t.xhr.status)||403===r||404===r||500===r?t.delegate.requestCompletedWithResponse(t.xhr.responseText,t.xhr.getResponseHeader("Turbolinks-Location")):(t.failed=!0,t.delegate.requestFailedWithStatusCode(t.xhr.status,t.xhr.responseText))}));var t},O.Controller.prototype.advanceHistory=function(t){var e,r;if(t!==(0,p.JJ)().href)return r=this.view.getSnapshot(),e=this.lastRenderedLocation,this.cache.put(e,r.clone()),this.lastRenderedLocation=O.Location.wrap(t),this.pushHistoryWithLocationAndRestorationIdentifier(t,O.uuid())},O.Controller.prototype.replaceHistory=function(t){if(t!==(0,p.JJ)().href)return this.lastRenderedLocation=O.Location.wrap(t),null!=window.newUrl?Timeout.set(0,(function(){return history.replaceState(history.state,"",t)})):history.replaceState(history.state,"",t)},O.Snapshot.prototype.hasAnchor=function(){return!0},O.Controller.prototype.locationIsVisitable=function(t){return t.isPrefixedBy(this.view.getRootLocation())&&null===t.getPath().match(/^\/(api|osu|p|ss|web)\//)&&(0,S.FP)(t)};var M=r(5078),L=r(9755),N=function(t,e){return function(){return t.apply(e,arguments)}};const D=function(){function t(){this.rollback=N(this.rollback,this),this.overlayStart=N(this.overlayStart,this),this.overlayLeave=N(this.overlayLeave,this),this.overlayHover=N(this.overlayHover,this),this.overlayEnter=N(this.overlayEnter,this),this.overlayEnd=N(this.overlayEnd,this),this.initialize=N(this.initialize,this),L(document).on("turbolinks:load",this.initialize),L(document).on("turbolinks:before-cache",this.rollback),L.subscribe("dragenterGlobal",this.overlayStart),L.subscribe("dragendGlobal",this.overlayEnd),L(document).on("dragenter",".js-account-edit-avatar",this.overlayEnter),L(document).on("dragover",".js-account-edit-avatar",this.overlayHover),this.main=document.getElementsByClassName("js-account-edit-avatar")}return t.prototype.$button=function(){return L(".js-account-edit-avatar__button")},t.prototype.initialize=function(){var t;if(null!=this.main[0])return this.isAvailable=!0,this.$main=L(this.main),this.$button().fileupload({url:(0,m.B)("account.avatar"),dataType:"json",dropZone:this.$main,submit:(t=this,function(){return t.main[0].classList.add("js-account-edit-avatar--saving"),L.publish("dragendGlobal")}),done:function(t,e){return L.publish("user:update",e.result)},fail:j.Jn,complete:function(t){return function(){return t.main[0].classList.remove("js-account-edit-avatar--saving")}}(this)})},t.prototype.overlayEnd=function(){if(this.isAvailable)return this.main[0].classList.remove("js-account-edit-avatar--start")},t.prototype.overlayEnter=function(){return null!=this.dragging?this.dragging:this.dragging=!0},t.prototype.overlayHover=function(){if(this.dragging)return this.main[0].classList.add("js-account-edit-avatar--hover"),Timeout.clear(this.overlayLeaveTimeout),this.overlayLeaveTimeout=Timeout.set(100,this.overlayLeave)},t.prototype.overlayLeave=function(){return this.dragging=null,this.main[0].classList.remove("js-account-edit-avatar--hover")},t.prototype.overlayStart=function(){if(this.isAvailable)return this.main[0].classList.add("js-account-edit-avatar--start")},t.prototype.rollback=function(){if(this.isAvailable)return this.isAvailable=!1,this.$button().fileupload("destroy")},t}();var B=r(9755),R=r(6486),I=function(t,e){return function(){return t.apply(e,arguments)}};const q=function(){function t(){this.update=I(this.update,this),this.abortUpdate=I(this.abortUpdate,this),this.saving=I(this.saving,this),this.saved=I(this.saved,this),this.clearState=I(this.clearState,this),this.ajaxSaved=I(this.ajaxSaved,this),this.ajaxSaving=I(this.ajaxSaving,this),this.ajaxError=I(this.ajaxError,this),this.initializeUpdate=I(this.initializeUpdate,this),B(document).on("input change",".js-account-edit",this.initializeUpdate),B(document).on("ajax:error",".js-account-edit",this.ajaxError),B(document).on("ajax:send",".js-account-edit",this.ajaxSaving),B(document).on("ajax:success",".js-account-edit",this.ajaxSaved),B(document).on("ajax:success",".js-user-preferences-update",this.ajaxUserPreferencesUpdate)}return t.prototype.initializeUpdate=function(t){var e;if("1"===(e=t.currentTarget).dataset.accountEditAutoSubmit)return this.abortUpdate(e),this.saving(e),null==e.debouncedUpdate&&(e.debouncedUpdate=R.debounce(this.update,1e3)),e.debouncedUpdate(e)},t.prototype.ajaxError=function(t){return this.clearState(t.currentTarget)},t.prototype.ajaxSaving=function(t){return this.saving(t.currentTarget)},t.prototype.ajaxSaved=function(t){return this.saved(t.currentTarget)},t.prototype.ajaxUserPreferencesUpdate=function(t,e){return B.publish("user:update",e)},t.prototype.clearState=function(t){return t.dataset.accountEditState=""},t.prototype.getValue=function(t){var e,r,i,n,s,o,a,l,u,c;if("array"===t.dataset.accountEditType)for(a=null,c=[""],r=0,s=(l=t.querySelectorAll("input")).length;r<s;r++)(e=l[r]).checked&&c.push(e.value);else if("radio"===t.dataset.accountEditType){for(a=t.dataset.lastValue,n=0,o=(u=t.querySelectorAll('input[type="radio"]')).length;n<o;n++)if((e=u[n]).checked){c=e.value;break}}else a=t.dataset.lastValue,c="checkbox"===(i=t.querySelector(".js-account-edit__input")).type?i.checked:i.value;return{value:c,prevValue:a}},t.prototype.getMultiValue=function(t){var e,r,i,n,s;for(r={},i=0,n=(s=t.querySelectorAll(".js-account-edit__input")).length;i<n;i++)r[(e=s[i]).name]=e.checked;return r},t.prototype.saved=function(t){return t.dataset.accountEditState="saved",t.savedTimeout=Timeout.set(3e3,(e=this,function(){return e.clearState(t)}));var e},t.prototype.saving=function(t){return t.dataset.accountEditState="saving"},t.prototype.abortUpdate=function(t){var e;return Timeout.clear(t.savedTimeout),null!=(e=t.updating)&&e.abort(),this.clearState(t)},t.prototype.update=function(t){var e,r,i,n,s,o,a,l,u,c,h;if("multi"===t.dataset.accountEditType)e=this.getMultiValue(t);else{if((c=(o=this.getValue(t)).value)===(s=o.prevValue))return this.clearState(t);i=t.querySelector(".js-account-edit__input"),r=null!=(a=t.dataset.field)?a:i.name,t.dataset.lastValue=c,(n={})[""+r]=c,e=n}return u=null!=(l=t.dataset.url)?l:(0,m.B)("account.update"),t.updating=B.ajax(u,{method:"PUT",data:e}).done((h=this,function(e){return h.saved(t),B(t).trigger("ajax:success",e)})).fail(function(e){return function(r,i){if("abort"!==i)return t.lastValue=s,e.clearState(t),B(t).trigger("ajax:error",[r,i])}}(this))},t}();var A=r(3924),z=r(9755),U=function(t,e){return function(){return t.apply(e,arguments)}};const W=function(){function t(){this.hidePreview=U(this.hidePreview,this),this.showPreview=U(this.showPreview,this),this.fetchPreview=U(this.fetchPreview,this),z(document).on("click",".js-bbcode-preview--show",this.fetchPreview),z(document).on("click",".js-bbcode-preview--hide",this.hidePreview)}return t.prototype.fetchPreview=function(t){var e,r,i,n,s;if(n=t.target,r=z(n).parents(".js-bbcode-preview--form"),i=r.find(".js-bbcode-preview--preview"),e=r.find(".js-bbcode-preview--body"),s=e.val(),e.attr("data-last-text"),"preview"!==r.attr("data-state")&&(0,A.W)(s)){var o;if(s!==e.attr("data-last-text"))return r.attr("data-state","loading-preview"),z.ajax({url:(0,m.B)("bbcode-preview"),method:"POST",data:{text:s}}).done((o=this,function(r){return e.attr("data-last-text",s),i.html(r),o.showPreview(t)})).fail((0,j.hd)(n));this.showPreview(t)}},t.prototype.showPreview=function(t){return z(t.target).parents(".js-bbcode-preview--form").attr("data-state","preview"),z.publish("sync-height:force")},t.prototype.hidePreview=function(t){var e;return(e=z(t.target).parents(".js-bbcode-preview--form")).attr("data-state","write"),z.publish("sync-height:force"),e.find(".js-bbcode-preview--body").focus()},t}();var F=r(9755),V=function(t,e){return function(){return t.apply(e,arguments)}};const Z=function(){function t(t){var e;this.slideDown=V(this.slideDown,this),this.close=V(this.close,this),this.open=V(this.open,this),this.onClick=V(this.onClick,this),this.el=t,this.packTag=t.dataset.packTag,this.packBody=this.el.querySelector(".js-accordion__item-body"),this.expander=this.el.querySelector(".js-accordion__item-header"),this.busy=!1,this.isCurrent=this.el.classList.contains("js-accordion__item--expanded"),F(".js-accordion").on("beatmappack:clicked",this.onClick),F(this.expander).on("click",(e=this,function(t){return t.preventDefault(),F(e.el).trigger("beatmappack:clicked",e.packTag)}))}return t.initialize=function(){var e,r,i,n,s;for(s=[],r=0,i=(n=document.querySelectorAll(".js-beatmap-pack")).length;r<i;r++)e=n[r],s.push(new t(e));return s},t.prototype.onClick=function(t,e){return t.stopPropagation(),this.isCurrent||this.packTag!==e?this.close():this.open()},t.prototype.open=function(){var t,e;if(this.isCurrent=!0,!this.busy)return this.nextFrame((e=this,function(){return F(e.el).addClass("js-accordion__item--expanded")})),(null!=(t=this.packBody.innerHTML)?t.length:void 0)?this.isCurrent?this.slideDown():void 0:(this.busy=!0,this.getBeatmapPackItem(this.packTag).done(function(t){return function(e){return t.nextFrame((function(){if(t.packBody.innerHTML=e,t.isCurrent)return t.slideDown()}))}}(this)).fail(j.qQ).always(function(t){return function(){return t.busy=!1}}(this)))},t.prototype.close=function(){var t;if(this.isCurrent)return this.isCurrent=!1,this.nextFrame((t=this,function(){return t.packBody.style.height="0",F(t.el).removeClass("js-accordion__item--expanded")}))},t.prototype.getBeatmapPackItem=function(t){return F.get((0,m.B)("packs.show",{pack:t,format:"raw"}))},t.prototype.slideDown=function(){var t,e;return this.packBody.style.height="",t=this.packBody.getBoundingClientRect(),this.packBody.style.height="0",this.nextFrame((e=this,function(){return e.packBody.style.height=t.height+"px"}))},t.prototype.nextFrame=function(t){return window.requestAnimationFrame(t)},t}();var H=r(9162),$=r(8278),J=r(7543),G=r(6486),X=r(381),K=function(t,e){return function(){return t.apply(e,arguments)}},Q={}.hasOwnProperty;const Y=function(){function t(t){var e;this.resize=K(this.resize,this),this.positionTooltip=K(this.positionTooltip,this),this.moveTooltip=K(this.moveTooltip,this),this.hideTooltip=K(this.hideTooltip,this),this.showTooltip=K(this.showTooltip,this),this.options={scales:{x:J.scaleTime(),y:J.scaleLinear(),class:J.scaleOrdinal()}},this.area=J.select(t),this.area.classed("changelog-chart",!0),this.svg=this.area.append("svg"),this.svgWrapper=this.svg.append("g"),this.areaFunction=J.area().curve(J.curveMonotoneX).x((e=this,function(t){return e.options.scales.x(t.data.date)})).y1(function(t){return function(e){return t.options.scales.y(e[1])}}(this)).y0(function(t){return function(e,r){return t.options.scales.y(e[0])}}(this)),this.hoverArea=this.svg.append("rect").classed("changelog-chart__hover-area",!0).on("mouseout",this.hideTooltip).on("mousemove",this.moveTooltip),this.tooltipArea=this.area.append("div").classed("changelog-chart__tooltip-area",!0),this.tooltipContainer=this.tooltipArea.append("div").classed("changelog-chart__tooltip-container",!0).attr("data-visibility","hidden"),this.tooltipContainer.append("div").classed("changelog-chart__tooltip-line",!0),this.tooltip=this.tooltipContainer.append("div").classed("changelog-chart__tooltip",!0),this.tooltipName=this.tooltip.append("div"),this.tooltipUserCount=this.tooltip.append("div").classed("changelog-chart__text changelog-chart__text--user-count",!0),this.tooltipDate=this.tooltip.append("div").classed("changelog-chart__text changelog-chart__text--date",!0),this.tooltipContainer.append("div").classed("changelog-chart__tooltip-line",!0),this.tooltipLine=this.tooltipContainer.selectAll(".changelog-chart__tooltip-line")}return t.prototype.loadData=function(){var t,e,r,i;return this.config=(0,$.Mo)("json-chart-config"),t=(r=this.normalizeData(this.config.build_history)).data,e=r.hasData,i=J.stack().keys(this.config.order).value((function(t,e){return null!=t[e]?t[e].normalized:0})),this.data=i(t),this.hasData=null!=this.config.build_history&&this.config.build_history.length>0&&e,this.resize()},t.prototype.setDimensions=function(){var t;return t=this.area.node().getBoundingClientRect(),this.width=t.width,this.height=t.height},t.prototype.setSvgSize=function(){return this.svg.attr("width",this.width).attr("height",this.height)},t.prototype.setHoverAreaSize=function(){return this.hoverArea.attr("width",this.width).attr("height",this.height)},t.prototype.setScalesRange=function(){var t,e,r;return this.options.scales.x.range([0,this.width]).domain([null!=(t=G.first(this.data[0]))?t.data.date:void 0,null!=(e=G.last(this.data[0]))?e.data.date:void 0]),this.options.scales.y.range([0,this.height]).domain([0,1]),this.options.scales.class.range(G.map(this.config.order,(r=this,function(t,e){return null!=r.config.stream_name?r.config.stream_name+"-build-"+e%7:G.kebabCase(t)}))).domain(this.config.order)},t.prototype.drawLines=function(){return this.svgWrapper.selectAll("g").data(this.data).enter().append("path").attr("class",(t=this,function(e){return"changelog-chart__area changelog-chart__area--"+t.options.scales.class(e.key)})).attr("d",this.areaFunction);var t},t.prototype.showTooltip=function(){return(0,H.Ji)(this.tooltipContainer.node())},t.prototype.hideTooltip=function(){return(0,H.U6)(this.tooltipContainer.node())},t.prototype.moveTooltip=function(t){var e;return e=J.pointer(t),this.x=this.options.scales.x.invert(e[0]),this.y=e[1]/this.height,this.showTooltip(),Timeout.clear(this._autoHideTooltip),this._autoHideTooltip=Timeout.set(3e3,this.hideTooltip),this.positionTooltip()},t.prototype.positionTooltip=function(){var t,e,r,i,n,s,o,a,l,u,c,h,d,p,m;if(p=this.x,m=this.y,null!=p&&null!=(l=J.bisector((function(t){return t.data.date})).left(this.data[0],p))){for(n=s=0,a=(u=this.data).length;s<a;n=++s)if(m<=(i=u[n])[l][1]&&null!=i[l].data[i.key]){r=n,e=i.key,o=this.options.scales.class(e);break}return t=this.options.scales.x(p),this.tooltipName.attr("class","changelog-chart__text changelog-chart__text--name changelog-chart__text--"+o).text(e),this.tooltipUserCount.text((0,P.uf)(this.data[r][l].data[e].user_count)),this.tooltipDate.text(this.data[r][l].data.date_formatted),h=(d=t-(c=this.tooltip.node().getBoundingClientRect().width)/2)<0?0:d+c>this.width?this.width-c:d,this.tooltip.style("transform","translateX("+h+"px)"),this.tooltipLine.style("transform","translateX("+t+"px)")}},t.prototype.resize=function(){if(this.area.classed("hidden",!this.hasData),this.hasData)return this.setDimensions(),this.setScalesRange(),this.setSvgSize(),this.setHoverAreaSize(),this.drawLines(),this.positionTooltip()},t.prototype.normalizeData=function(t){var e,r,i,n,s,o,a,l,u;return s=null,r=null,{data:function(){var c,h,d,p;for(a in p=[],d=G.groupBy(t,"created_at"))if(Q.call(d,a)){for(u=d[a],0===(o=G.sumBy(u,"user_count"))?(null!=s&&(e=G.find(u,{label:s})),null==e&&(e=G.last(u),s=e.label),e.user_count=1,o=1):null==r&&(r=!0),i=X(u[0].created_at),n={created_at:a,date:i.toDate(),date_formatted:i.format("YYYY/MM/DD")},c=0,h=u.length;c<h;c++)(l=u[c]).normalized=l.user_count/o,n[l.label]=l;p.push(n)}return p}(),hasData:r}},t}();var tt=r(9755),et=function(t,e){return function(){return t.apply(e,arguments)}};const rt=function(){function t(){this.resize=et(this.resize,this),this.initialize=et(this.initialize,this),tt(window).on("resize",this.resize),tt(document).on("turbolinks:load",this.initialize)}return t.prototype.container=document.getElementsByClassName("js-changelog-chart"),t.prototype.initialize=function(){if(null!=this.container[0])return this.container[0]._chart=new Y(this.container[0]),this.container[0]._chart.loadData()},t.prototype.resize=function(){var t;return null!=(t=this.container[0])?t._chart.resize():void 0},t}();var it=r(9755);const nt=function(){function t(){var t,e;this.validate=(t=this.validate,e=this,function(){return t.apply(e,arguments)}),it(document).on("change",".js-checkbox-validation",this.validate)}return t.prototype.validate=function(t){var e,r,i,n,s,o,a,l;if(null==(e=t.currentTarget)._checkboxValidationCache&&(e._checkboxValidationCache=JSON.parse(t.currentTarget.dataset.checkboxValidation)),a=t.target.name,null!=(n=t.currentTarget._checkboxValidationCache[a])){for(r=t.currentTarget.querySelectorAll("[name='"+a+"']"),l=t.currentTarget.getElementsByClassName("js-checkbox-validation--submit")[0],i=0,s=0,o=r.length;s<o;s++)r[s].checked&&(i+=1);return l.disabled=i<n.min||i>n.max}},t}();var st=r(7543),ot=r(6486),at=r(9755),lt=function(t,e){return function(){return t.apply(e,arguments)}};const ut=function(){function t(t,e){var r,i,n,s;this.options=null!=e?e:{},this.lookupIndexFromX=lt(this.lookupIndexFromX,this),this.hoverRefresh=lt(this.hoverRefresh,this),this.hoverEnd=lt(this.hoverEnd,this),this.resize=lt(this.resize,this),this.recalc=lt(this.recalc,this),this.reveal=lt(this.reveal,this),this.drawLine=lt(this.drawLine,this),this.setWrapperSize=lt(this.setWrapperSize,this),this.setSvgSize=lt(this.setSvgSize,this),this.setLineSize=lt(this.setLineSize,this),this.setScalesRange=lt(this.setScalesRange,this),this.setHoverAreaSize=lt(this.setHoverAreaSize,this),this.setDimensions=lt(this.setDimensions,this),this.loadData=lt(this.loadData,this),this.hide=lt(this.hide,this),null==(r=this.options).scales&&(r.scales={}),null==(i=this.options.scales).x&&(i.x=st.scaleLinear()),null==(n=this.options.scales).y&&(n.y=st.scaleLinear()),this.margins={top:25,right:20,bottom:10,left:0},this.area=st.select(t),this.area.selectAll(".fancy-graph").remove(),this.svg=this.area.append("svg").classed("fancy-graph",!0),this.svgWrapper=this.svg.append("g"),this.svgLine=this.svgWrapper.append("path").classed("fancy-graph__line",!0).attr("opacity",0),this.line=st.line().curve(st.curveMonotoneX),this.svgEndCircle=this.svgWrapper.append("circle").classed("fancy-graph__circle",!0).attr("r",2).attr("opacity",0),this.svgHoverArea=this.svg.append("rect").classed("fancy-graph__hover-area",!0).on("mouseout",this.hoverEnd).on("mousemove",this.hoverRefresh).on("drag",this.hoverRefresh),this.svgHoverMark=this.svgWrapper.append("circle").classed("fancy-graph__circle",!0).attr("data-visibility","hidden").attr("r",2),s=(0,$.Um)(t.dataset.src),this.loadData(s)}return t.prototype.hide=function(){return this.svgEndCircle.attr("opacity",0),this.svgLine.attr("opacity",0)},t.prototype.loadData=function(t){if(!ot.isEqual(t,this.data))return this.data=null!=t?t:[],this.svgLine.datum(this.data),this.reveal()},t.prototype.setDimensions=function(){var t;return t=this.area.node().getBoundingClientRect(),this.width=t.width-(this.margins.left+this.margins.right),this.height=t.height-(this.margins.top+this.margins.bottom)},t.prototype.setHoverAreaSize=function(){return this.svgHoverArea.attr("width",this.width+(this.margins.left+this.margins.right)).attr("height",this.height+(this.margins.top+this.margins.bottom))},t.prototype.setScalesRange=function(){var t,e,r,i;return this.options.scales.x.range([0,this.width]).domain(null!=(t=null!=(e=this.options.domains)?e.x:void 0)?t:st.extent(this.data,(function(t){return t.x}))),this.options.scales.y.range([this.height,0]).domain(null!=(r=null!=(i=this.options.domains)?i.y:void 0)?r:st.extent(this.data,(function(t){return t.y})))},t.prototype.setLineSize=function(){var t,e;if(this.line.x((e=this,function(t){return e.options.scales.x(t.x)})).y(function(t){return function(e){return t.options.scales.y(e.y)}}(this)),null!=(t=ot.last(this.data)))return this.svgEndCircle.attr("transform","translate("+this.options.scales.x(t.x)+", "+this.options.scales.y(t.y)+")")},t.prototype.setSvgSize=function(){return this.svg.attr("width",this.width+(this.margins.left+this.margins.right)).attr("height",this.height+(this.margins.top+this.margins.bottom))},t.prototype.setWrapperSize=function(){return this.svgWrapper.attr("transform","translate("+this.margins.left+", "+this.margins.top+")")},t.prototype.drawLine=function(){return this.svgLine.attr("stroke-dasharray",0).attr("d",this.line)},t.prototype.reveal=function(){var t;return null==this.data[0]?this.hide():(this.recalc(),this.svgLine.attr("d",this.line),t=this.svgLine.node().getTotalLength(),this.svgEndCircle.attr("opacity",0),this.svgLine.attr("stroke-dasharray",t).attr("stroke-dashoffset",t).transition().delay(400).duration(1e3).ease(st.easeSinOut).attr("stroke-dashoffset",0).attr("opacity",1),this.svgEndCircle.transition().delay(1300).duration(300).ease(st.easeSinOut).attr("opacity",1))},t.prototype.recalc=function(){return this.setDimensions(),this.setScalesRange(),this.setSvgSize(),this.setWrapperSize(),this.setLineSize(),this.setHoverAreaSize()},t.prototype.resize=function(){return this.recalc(),this.drawLine()},t.prototype.hoverEnd=function(){return(0,H.U6)(this.svgHoverMark.node()),at.publish("fancy-chart:hover-"+this.options.hoverId+":end")},t.prototype.hoverRefresh=function(t){var e,r,i,n,s;if(null!=this.options.hoverId&&(null!=this.data[0]&&(n=this.options.scales.x.invert(st.pointer(t)[0]-this.margins.left),null!=(i=this.lookupIndexFromX(n)))))return(0,H.Ji)(this.svgHoverMark.node()),Timeout.clear(this._hoverTimeout),this._hoverTimeout=Timeout.set(3e3,this.hoverEnd),r=0===i?this.data[0]:i>=this.data.length?ot.last(this.data):n-this.data[i-1].x<=this.data[i].x-n?this.data[i-1]:this.data[i],e=["x","y"].map((s=this,function(t){return s.options.scales[t](r[t])})),this.svgHoverMark.attr("transform","translate("+e.join(", ")+")"),at.publish("fancy-chart:hover-"+this.options.hoverId+":refresh",{data:r})},t.prototype.lookupIndexFromX=function(t){return st.bisector((function(t){return t.x})).left(this.data,t)},t}();var ct=r(9755),ht=function(t,e){return function(){return t.apply(e,arguments)}};const dt=function(){function t(){this.resize=ht(this.resize,this),this.initialize=ht(this.initialize,this),ct(window).on("resize",this.resize),ct(document).on("turbolinks:load",this.initialize)}return t.prototype.container=document.getElementsByClassName("js-fancy-graph"),t.prototype.initialize=function(){var t;if(null!=this.container[0])return null!=(t=this.container[0])._chart?t._chart:t._chart=new ut(this.container[0])},t.prototype.resize=function(){var t;if(null!=this.container[0])return null!=(t=this.container[0]._chart)?t.resize():void 0},t}();var pt=r(9755);const mt=function(){function t(){pt(document).on("ajax:success",".js-form-clear",this.clear)}return t.prototype.clear=function(t){return t.currentTarget.reset()},t}();var ft=r(9755),gt=r(6486),vt=function(t,e){return function(){return t.apply(e,arguments)}};const bt=function(){function t(t){this.formError=t,this.onInput=vt(this.onInput,this),this.boot=vt(this.boot,this),ft(document).on("input",".js-form-confirmation",this.onInput)}return t.prototype.boot=function(t){var e,r,i;if(null==t.formConfirmation)return r={},gt.endsWith(t.name,"_confirmation")||gt.endsWith(t.name,"_confirmation]")?(i=t.name.replace(/_confirmation(]?)$/,"$1"),r.confirmation=t,r.main=ft(t).closest("form").find("[name='"+i+"']")[0]):(e=t.name.replace(/(]?)$/,"_confirmation$1"),r.main=t,r.confirmation=ft(t).closest("form").find("[name='"+e+"']")[0]),r.main.formConfirmation=r,r.confirmation.formConfirmation=r},t.prototype.onInput=function(t){var e,r,i,n;return e=t.currentTarget,this.boot(e),n=(r=e.formConfirmation).main.value,i=r.confirmation.value,0===n.length||0===i.length||n===i?this.formError.setOneError(r.confirmation,[]):this.formError.setOneError(r.confirmation,[(0,f.dW)("model_validation.wrong_confirmation")])},t}();var yt=r(9755),wt=function(t,e){return function(){return t.apply(e,arguments)}};const kt=function(){function t(){this.setOneError=wt(this.setOneError,this),this.setError=wt(this.setError,this),this.showError=wt(this.showError,this),this.clearError=wt(this.clearError,this),yt(document).on("ajax:error",".js-form-error",this.showError),yt(document).on("ajax:success",".js-form-error",this.clearError)}return t.prototype.clearError=function(t){return this.setError(t.target)},t.prototype.showError=function(t,e){var r,i;return null==(r=null!=(i=e.responseJSON)?i.form_error:void 0)?(0,j.qQ)(e):this.setError(t.target,(0,$.lv)(r))},t.prototype.setError=function(t,e){return yt(t).find("[name]").each((r=this,function(t,i){return r.setOneError(i,null!=e?e.get(i.name):void 0)}));var r},t.prototype.setOneError=function(t,e){var r;return null==e&&(e=[]),r=e.length>0?"error":"",yt(t).closest("label, .js-form-error--field").attr("data-form-error-state",r).find(".js-form-error--error").text(e.join(" "))},t}();var jt=r(9755),_t=function(t,e){return function(){return t.apply(e,arguments)}};const xt=function(){function t(){this.sync=_t(this.sync,this),this.onChange=_t(this.onChange,this),addEventListener("turbolinks:load",this.sync),jt(document).on("change",".js-form-toggle--input",this.onChange)}return t.prototype.onChange=function(t){return this.toggle(t.currentTarget)},t.prototype.sync=function(){var t,e,r,i,n;for(n=[],t=0,i=(r=document.getElementsByClassName("js-form-toggle--input")).length;t<i;t++)e=r[t],n.push(this.toggle(e));return n},t.prototype.toggle=function(t){var e,r;return r=t.dataset.formToggleId,e=t.checked?"Down":"Up",jt(".js-form-toggle--form[data-form-toggle-id='"+r+"']").stop()["slide"+e]()},t}();var Et,Pt,Ct=r(3857),St=r(2918),Tt=r(6486),Ot=r(9755),Mt=function(t,e){return function(){return t.apply(e,arguments)}};Pt=function(t){return St.controller.replaceHistory(t)},Et=Tt.debounce(Pt,250);const Lt=function(){function t(){this.jumpToSubmit=Mt(this.jumpToSubmit,this),this.showMore=Mt(this.showMore,this),this.postUrlClick=Mt(this.postUrlClick,this),this.initialScrollTo=Mt(this.initialScrollTo,this),this.toggleDeleted=Mt(this.toggleDeleted,this),this.scrollTo=Mt(this.scrollTo,this),this.keyboardNavigation=Mt(this.keyboardNavigation,this),this.jumpTo=Mt(this.jumpTo,this),this.refreshCounter=Mt(this.refreshCounter,this),this.refreshLoadMoreLinks=Mt(this.refreshLoadMoreLinks,this),this.lastPostLoaded=Mt(this.lastPostLoaded,this),this.startingPostLoaded=Mt(this.startingPostLoaded,this),this.endPost=Mt(this.endPost,this),this.setCounter=Mt(this.setCounter,this),this.showDeleted=Mt(this.showDeleted,this),this.setTotalPosts=Mt(this.setTotalPosts,this),this.totalPosts=Mt(this.totalPosts,this),this.postPosition=Mt(this.postPosition,this),this.boot=Mt(this.boot,this),this._totalPostsDiv=document.getElementsByClassName("js-forum__total-count"),this._deletedPostsDiv=document.getElementsByClassName("js-forum__deleted-count"),this._postsCounter=document.getElementsByClassName("js-forum__posts-counter"),this._postsProgress=document.getElementsByClassName("js-forum__posts-progress"),this.posts=document.getElementsByClassName("js-forum-post"),this.loadMoreLinks=document.getElementsByClassName("js-forum-posts-show-more"),this.throttledBoot=Tt.throttle(this.boot,100),this.refreshCounterPaused=!0,this.maxPosts=250,Ot(document).on("turbolinks:load",this.throttledBoot),Ot(window).on("scroll",this.refreshCounter),Ot(document).on("click",".js-forum-posts-show-more",this.showMore),Ot(document).on("click",".js-post-url",this.postUrlClick),Ot(document).on("submit",".js-forum-posts-jump-to",this.jumpToSubmit),Ot(document).on("keyup",this.keyboardNavigation),Ot(document).on("click",".js-forum-topic-moderate--toggle-deleted",this.toggleDeleted),Ot(document).on("turbolinks:before-cache",Et.cancel)}return t.prototype.boot=function(){return this.refreshCounterPaused=!0,this.refreshLoadMoreLinks(),this.initialScrollTo()},t.prototype.userCanModerate=function(){return"1"===this.topicMeta().userCanModerate},t.prototype.postPosition=function(t){return parseInt(t.getAttribute("data-post-position"),10)},t.prototype.firstPostId=function(){return parseInt(this.topicMeta().firstPostId,10)},t.prototype.postId=function(t){return parseInt(t.getAttribute("data-post-id"),10)},t.prototype.topicMeta=function(){var t;return null!=(t=newBody.querySelector(".js-forum--topic-meta"))?t.dataset:void 0},t.prototype.totalPosts=function(){return 0===this._totalPostsDiv.length?null:parseInt(this._totalPostsDiv[0].dataset.total,10)},t.prototype.setTotalPosts=function(t){return Ot(this._totalPostsDiv).text((0,P.uf)(t)).attr("data-total",t)},t.prototype.showDeleted=function(){var t;if(null!=(t=document.querySelector(".js-forum-topic-moderate--toggle-deleted")))return"1"===t.dataset.showDeleted},t.prototype.deletedPosts=function(){return 0===this._deletedPostsDiv.length?null:parseInt(this._deletedPostsDiv[0].dataset.total,10)},t.prototype.setDeletedPosts=function(t){return Ot(this._deletedPostsDiv).text((0,P.uf)(t)).attr("data-total",t)},t.prototype.setCounter=function(t){return this.currentPostPosition=this.postPosition(t),this.currentPostPosition>this.totalPosts()&&this.setTotalPosts(this.currentPostPosition),Et(this.postUrlN(this.currentPostPosition)),this._postsCounter[0].textContent=(0,P.uf)(this.currentPostPosition),this._postsProgress[0].style.width=100*this.currentPostPosition/this.totalPosts()+"%"},t.prototype.endPost=function(){return this.posts[this.posts.length-1]},t.prototype.startingPostLoaded=function(){var t,e;return(e="1"===(t=document.querySelector(".js-forum__posts-show-more--previous")).dataset.noMore)||(e=this.postId(this.posts[0])<=this.firstPostId())&&(t.dataset.noMore="1"),e},t.prototype.lastPostLoaded=function(){var t,e;return(t="1"===(e=document.querySelector(".js-forum__posts-show-more--next")).dataset.noMore)||(t=this.postPosition(this.endPost())>=this.totalPosts())&&(e.dataset.noMore="1"),t},t.prototype.refreshLoadMoreLinks=function(){var t,e;if(this.loadMoreLinks.length)return e=this.startingPostLoaded(),Ot(".js-header--main").toggleClass("hidden",!e),Ot(".js-header--alt").toggleClass("hidden",e),t=this.lastPostLoaded(),Ot(".js-forum__posts-show-more--next").toggleClass("hidden",t),this.userCanModerate()||Ot(".js-post-delete-toggle").hide(),t?Ot(this.endPost()).find(".js-post-delete-toggle").css({display:""}):void 0},t.prototype.refreshCounter=function(){var t,e,r,i,n,s,o;if(!this.refreshCounterPaused&&0!==this._postsCounter.length){if(t=null,(0,P.Mu)())t=this.posts[this.posts.length-1];else for(o=M.Z.stickyHeader.scrollOffsetValue,e=0,r=(s=this.posts).length;e<r&&(n=(i=s[e]).getBoundingClientRect().top,Math.floor(n-o)<=0);e++)t=i;return null==t&&(t=this.posts[0]),this.setCounter(t)}},t.prototype.jumpTo=function(t){var e;return t=parseInt(t,10),!!isFinite(t)&&(t=Math.max(t,1),t=Math.min(t,this.totalPosts()),e=Ot(".js-forum-post[data-post-position='"+t+"']"),this._postsCounter[0].textContent=(0,P.uf)(t),e.length?this.scrollTo(e.attr("data-post-id")):St.visit(this.postUrlN(t)),!0)},t.prototype.keyboardNavigation=function(t){var e;if(!(0,P.cK)(t.target)&&null==t.target.closest("[role=dialog]")&&!(0,Ct._)()&&0!==this._postsCounter.length){t.preventDefault(),e=function(){switch(t.which){case 37:return this.currentPostPosition-1;case 39:return this.currentPostPosition+1}}.call(this);try{return this.jumpTo(e)}catch(r){}}},t.prototype.scrollTo=function(t){var e,r,i;if(e=document.querySelector(".js-forum-post[data-post-id='"+t+"']"))return this.refreshCounterPaused=!0,r=1===this.postPosition(e)?0:Ot(e).offset().top,Ot.publish("sync-height:force"),0!==r&&(r=M.Z.stickyHeader.scrollOffset(r)),window.scrollTo(window.pageXOffset,r),this.highlightPost(e),this.setCounter(e),i=this,setTimeout((function(){return i.refreshCounterPaused=!1}),0)},t.prototype.highlightPost=function(t){return Ot(".js-forum-post--highlighted").removeClass("js-forum-post--highlighted"),Ot(t).addClass("js-forum-post--highlighted")},t.prototype.toggleDeleted=function(){var t,e,r;return e=osuCore.userPreferences.set("forum_posts_show_deleted",!this.showDeleted()),r=this,t=function(){return St.visit(r.postUrlN(r.currentPostPosition))},null!=e?e.done(t):t()},t.prototype.initialScrollTo=function(){var t;if(null!=(t=this.topicMeta()))return history.scrollRestoration="manual",Ot(document).one("turbolinks:before-cache",(function(){return history.scrollRestoration="auto"})),""===(0,p.JJ)().hash&&(0,A.W)(t.postJumpTo)?(this.scrollTo(parseInt(t.postJumpTo,10)),t.postJumpTo=""):(this.refreshCounterPaused=!1,this.refreshCounter())},t.prototype.postUrlClick=function(t){var e;return t.preventDefault(),e=Ot(t.target).closest(".js-forum-post").attr("data-post-id"),this.scrollTo(e)},t.prototype.postUrlN=function(t){return(0,p.JJ)().pathname+"?n="+t},t.prototype.showMore=function(t){var e,r,i,n;if(t.preventDefault(),!(e=t.currentTarget).classList.contains("js-disabled"))return e.classList.add("js-disabled"),r=e.dataset.mode,i="previous"===r?this.posts[0]:this.endPost(),Ot.get(e.href).done((n=this,function(t){var s,o,a,l,u,c,h,d,p,m,f,g;if(null==t)return e.dataset.noMore="1",void n.refreshLoadMoreLinks();if(e.href=t.next_url,d=(h=i).getBoundingClientRect().top,"previous"===r?(e.insertAdjacentHTML("afterend",t.content),f=n.maxPosts,m=n.posts.length):(e.insertAdjacentHTML("beforebegin",t.content),f=0,m=n.posts.length-n.maxPosts),f<m)for(l=n.posts[0].parentNode,o=0,a=(c=Tt.slice(n.posts,f,m)).length;o<a;o++)u=c[o],l.removeChild(u);return n.refreshLoadMoreLinks(),g=window.pageXOffset,s=h.getBoundingClientRect().top,p=window.pageYOffset+s-d,window.scrollTo(g,p),e.dataset.failed="0"})).always((function(){return e.classList.remove("js-disabled")})).fail((function(t){return e.dataset.failed="1",(0,j.qQ)(t)}))},t.prototype.jumpToSubmit=function(t){if(t.preventDefault(),(0,_.Lt)(),this.jumpTo(Ot(t.target).find('[name="n"]').val()))return Ot.publish("forum:topic:jumpTo")},t}();var Nt=r(6486),Dt=r(9755),Bt=function(t,e){return function(){return t.apply(e,arguments)}};const Rt=function(){function t(){this.previousClick=Bt(this.previousClick,this),this.onScroll=Bt(this.onScroll,this),this.onLoad=Bt(this.onLoad,this),this.nextClick=Bt(this.nextClick,this),this._triggerDistance=1200,this.throttledOnScroll=Nt.throttle(this.onScroll,1e3),Dt(document).on("turbolinks:load",this.onLoad)}return t.prototype.commonClick=function(t){if("1"!==t.dataset.noMore&&"1"!==t.dataset.failed&&0!==t.getBoundingClientRect().height)return t.click()},t.prototype.nextClick=function(){if(null!=this.nextLink&&!(this.nextLink.getBoundingClientRect().top>document.documentElement.clientHeight+this._triggerDistance))return this.commonClick(this.nextLink)},t.prototype.onLoad=function(){if(window.removeEventListener("scroll",this.throttledOnScroll),this.nextLink=document.querySelector(".js-forum__posts-show-more--next"),this.previousLink=document.querySelector(".js-forum__posts-show-more--previous"),null!=this.nextLink&&null!=this.previousLink)return this.throttledOnScroll(),window.addEventListener("scroll",this.throttledOnScroll)},t.prototype.onScroll=function(){return this.previousClick(),this.nextClick()},t.prototype.previousClick=function(){if(null!=this.previousLink&&!(this.previousLink.getBoundingClientRect().top<-this._triggerDistance))return this.commonClick(this.previousLink)},t}();var It=r(3336),qt=r(9755),At=function(t,e){return function(){return t.apply(e,arguments)}};const zt=function(){function t(){var t;this.refresh=At(this.refresh,this),this.remove=At(this.remove,this),this.updateOptions=At(this.updateOptions,this),this.update=At(this.update,this),this.setOverlay=At(this.setOverlay,this),this.initFileupload=At(this.initFileupload,this),this.isModalOpen=At(this.isModalOpen,this),this.hasCoverEditor=At(this.hasCoverEditor,this),this.hasCover=At(this.hasCover,this),this.checkModal=At(this.checkModal,this),this.$uploadButton=At(this.$uploadButton,this),this.header=document.getElementsByClassName("js-forum-cover--header"),this.uploadButton=document.getElementsByClassName("js-forum-cover--upload-button"),this.removeButton=document.getElementsByClassName("js-forum-cover--remove-button"),this.overlay=document.getElementsByClassName("js-forum-cover--overlay"),this.loading=document.getElementsByClassName("js-forum-cover--loading"),this.modal=document.getElementsByClassName("js-forum-cover--modal"),qt.subscribe("click-menu:current",this.checkModal),qt(document).on("click",".js-forum-cover--remove-button",this.remove),qt.subscribe("dragenterGlobal",(t=this,function(){return t.setOverlay("active")})),qt.subscribe("dragendGlobal",function(t){return function(){return t.setOverlay("hidden")}}(this)),qt(document).on("dragenter",".js-forum-cover--overlay",function(t){return function(){return t.setOverlay("hover")}}(this)),qt(document).on("dragleave",".js-forum-cover--overlay",function(t){return function(){return t.setOverlay("active")}}(this)),qt(document).on("turbolinks:load",this.refresh)}return t.prototype.$uploadButton=function(){return qt(this.uploadButton[0])},t.prototype.checkModal=function(t,e){if("forum-cover-edit"===e.target)return this.initFileupload()},t.prototype.hasCover=function(){return"post"!==this.uploadButton[0].dataset.customMethod},t.prototype.hasCoverEditor=function(){return this.uploadButton.length>0},t.prototype.isModalOpen=function(t){var e;return!!this.hasCoverEditor()&&"hidden"!==(null!=(e=this.modal[0])?e.dataset.visibility:void 0)},t.prototype.initFileupload=function(){var t,e;if(this.isModalOpen()&&!this.uploadButton[0]._initialized)return this.uploadButton[0]._initialized=!0,t=qt(".js-forum-cover--modal"),this.$uploadButton().fileupload({method:"POST",paramName:"cover_file",dataType:"json",dropZone:t,submit:(e=this,function(){return e.uploadButton[0].dataset.state="loading"}),done:function(t){return function(e,r){return t.update(r.result)}}(this),fail:j.Jn,complete:function(t){return function(e,r){return t.uploadButton[0].dataset.state=""}}(this)}),this.updateOptions()},t.prototype.setOverlay=function(t){if(this.hasCoverEditor()&&t!==this.overlay[0].getAttribute("data-state"))return this.overlay[0].setAttribute("data-state",t)},t.prototype.update=function(t){return qt(".js-forum-cover--input").val(t.id),this.uploadButton[0].dataset.url=t.url,this.uploadButton[0].dataset.customMethod=t.method,this.uploadButton[0].dataset.fileUrl=t.fileUrl||"",this.updateOptions(),this.refresh()},t.prototype.updateOptions=function(){if(this.uploadButton[0]._initialized)return this.$uploadButton().fileupload("option",{url:this.uploadButton[0].dataset.url,formData:{_method:this.uploadButton[0].dataset.customMethod}})},t.prototype.remove=function(t){var e;if((t.preventDefault(),this.hasCover())&&confirm(t.currentTarget.dataset.destroyConfirm))return this.removeButton[0].dataset.state="loading",qt.ajax({url:this.uploadButton[0].dataset.url,method:"delete"}).done((e=this,function(t){return e.update(t)})).always(function(t){return function(){return t.removeButton[0].dataset.state=""}}(this))},t.prototype.refresh=function(){var t,e;if(this.hasCoverEditor())return t=this.uploadButton[0].dataset.fileUrl||this.uploadButton[0].dataset.defaultFileUrl,qt(this.header).css({backgroundImage:null!=(e=(0,It.eF)(t))?e:""}),this.removeButton[0].disabled=!this.hasCover(),this.initFileupload()},t}();var Ut=r(9755),Wt=function(t,e){return function(){return t.apply(e,arguments)}};const Ft=function(){function t(t){this.forum=t,this.setPostPosition=Wt(this.setPostPosition,this),this.reset=Wt(this.reset,this),this.jump=Wt(this.jump,this),this.click=Wt(this.click,this),this.move=Wt(this.move,this),this.hideTooltip=Wt(this.hideTooltip,this),this.tooltip=document.getElementsByClassName("js-forum-posts-seek--tooltip"),this.tooltipNumber=document.getElementsByClassName("js-forum-posts-seek-tooltip-number"),this.seekbar=document.getElementsByClassName("js-forum__posts-seek"),Ut(document).on("mousemove",".js-forum__posts-seek",this.move),Ut(document).on("mouseleave",".js-forum__posts-seek",this.hideTooltip),Ut(document).on("click",".js-forum__posts-seek",this.click),Ut(document).on("click",".js-forum-posts-seek--jump",this.jump),addEventListener("turbolinks:before-cache",this.reset)}return t.prototype.hideTooltip=function(){if(0!==this.tooltip.length)return(0,H.U6)(this.tooltip[0])},t.prototype.move=function(t){return t.preventDefault(),t.stopPropagation(),this.setPostPosition(t.clientX),(0,H.Ji)(this.tooltip[0]),Timeout.clear(this._autohide),this._autohide=Timeout.set(1e3,this.hideTooltip)},t.prototype.click=function(){return this.forum.jumpTo(this.postPosition)},t.prototype.jump=function(t){var e,r,i,n,s,o,a,l;return t.preventDefault(),r=this.forum.currentPostPosition,l=this.forum.totalPosts(),e=Ut(t.currentTarget),n=e.attr("data-jump-target"),a=function(){switch(n){case"first":return 1;case"last":return l;case"previous":return i=r-10,o=this.forum.postPosition(this.forum.posts[0]),Math.max(i,o);case"next":return i=r+10,s=this.forum.postPosition(this.forum.endPost()),Math.min(i,s)}}.call(this),e.blur(),this.forum.jumpTo(a)},t.prototype.reset=function(){return Timeout.clear(this._autohide),this.hideTooltip()},t.prototype.setPostPosition=function(t){var e,r,i;return e=t/this.seekbar[0].offsetWidth,i=this.forum.totalPosts(),r=Math.ceil(e*this.forum.totalPosts()),r=Math.min(r,i),this.postPosition=Math.max(r,1),this.tooltip[0].style.transform="translateX("+t+"px)",this.tooltipNumber[0].textContent=this.postPosition},t}();var Vt=r(9755),Zt=function(t,e){return function(){return t.apply(e,arguments)}};const Ht=function(){function t(t){this.forum=t,this.start=Zt(this.start,this),this.keyup=Zt(this.keyup,this),this.end=Zt(this.end,this),Vt(document).on("click",".js-forum-topic-post-jump--cover",this.start),Vt(document).on("blur",".js-forum-topic-post-jump--input",this.end),Vt(document).on("keyup",".js-forum-topic-post-jump--input",this.keyup),Vt.subscribe("forum:topic:jumpTo",this.end)}return t.prototype.end=function(){return Vt(".js-forum-topic-post-jump--container").removeClass("js-forum-topic-post-jump--container-focus"),Vt(".js-forum-topic-post-jump--cover").show(),Vt(".js-forum-topic-post-jump--counter").show(),Vt(".js-forum-topic-post-jump--input").hide()},t.prototype.keyup=function(t){var e,r,i;if("Escape"!==t.key){if(r=(i=(e=t.currentTarget).value).replace(/\D/g,""),i!==r)return e.value=r}else Vt(t.currentTarget).blur()},t.prototype.start=function(){var t;return Vt(".js-forum-topic-post-jump--container").addClass("js-forum-topic-post-jump--container-focus"),Vt(".js-forum-topic-post-jump--cover").hide(),Vt(".js-forum-topic-post-jump--counter").hide(),(t=Vt(".js-forum-topic-post-jump--input").val(this.forum.currentPostPosition).show().focus())[0].selectionStart=0,t[0].selectionEnd=t.val().length},t}();var $t=r(9755),Jt=function(t,e){return function(){return t.apply(e,arguments)}};const Gt=function(){function t(t){this.bbcodePreview=t.bbcodePreview,this.forum=t.forum,this.stickyFooter=t.stickyFooter,this.toggleStick=Jt(this.toggleStick,this),this.toggleDeactivate=Jt(this.toggleDeactivate,this),this.toggle=Jt(this.toggle,this),this.stickOrUnstick=Jt(this.stickOrUnstick,this),this.posted=Jt(this.posted,this),this.enableFlash=Jt(this.enableFlash,this),this.deactivate=Jt(this.deactivate,this),this.activateWithReply=Jt(this.activateWithReply,this),this.activate=Jt(this.activate,this),this.setState=Jt(this.setState,this),this.getState=Jt(this.getState,this),this.deleteState=Jt(this.deleteState,this),this.available=Jt(this.available,this),this.initialize=Jt(this.initialize,this),this.container=document.getElementsByClassName("js-forum-topic-reply--container"),this.box=document.getElementsByClassName("js-forum-topic-reply"),this.block=document.getElementsByClassName("js-forum-topic-reply--block"),this.input=document.getElementsByClassName("js-forum-topic-reply--input"),this.toggleButtons=document.getElementsByClassName("js-forum-topic-reply--toggle"),this.fixedBar=document.getElementsByClassName("js-sticky-footer--fixed-bar"),$t(document).on("ajax:success",".js-forum-topic-reply",this.posted),$t(document).on("click",".js-forum-topic-reply--deactivate",this.toggleDeactivate),$t(document).on("click",".js-forum-topic-reply--toggle",this.toggle),$t(document).on("ajax:success",".js-forum-topic-reply--quote",this.activateWithReply),$t(document).on("focus",".js-forum-topic-reply--input",this.activate),$t.subscribe("stickyFooter",this.stickOrUnstick),$t(document).on("turbolinks:load",this.initialize)}return t.prototype.marker=function(){return document.querySelector('.js-sticky-footer[data-sticky-footer-target="forum-topic-reply"]')},t.prototype.$input=function(){return $t(".js-forum-topic-reply--input")},t.prototype.initialize=function(){if(this.available())return this.deleteState("sticking"),"1"===this.getState("active")?this.activate():void 0},t.prototype.available=function(){return this.block.length},t.prototype.deleteState=function(t){return localStorage.removeItem("forum-topic-reply--"+(0,p.JJ)().pathname+"--"+t)},t.prototype.getState=function(t){return localStorage.getItem("forum-topic-reply--"+(0,p.JJ)().pathname+"--"+t)},t.prototype.setState=function(t,e){return localStorage.setItem("forum-topic-reply--"+(0,p.JJ)().pathname+"--"+t,e)},t.prototype.activate=function(){var t,e,r,i;for(this.setState("active","1"),this.stickyFooter.markerEnable(this.marker()),$t.publish("stickyFooter:check"),t=0,e=(r=this.toggleButtons).length;t<e;t++)r[t].classList.add("js-activated");return"1"!==this.getState("sticking")&&null!=currentUser.id&&this.enableFlash(),Timeout.set(0,(i=this,function(){return i.input[0].focus()}))},t.prototype.activateWithReply=function(t,e){var r,i;return e+="\n",(i=(r=this.$input()).val())&&(e=i+"\n"+e),r.val(e).trigger("input"),r[0].selectionStart=e.length,this.activate()},t.prototype.deactivate=function(){var t,e,r,i,n;for(this.stickyFooter.markerDisable(this.marker()),this.setState("active","0"),$t.publish("stickyFooter:check"),this.disableFlash(),n=[],e=0,r=(i=this.toggleButtons).length;e<r;e++)t=i[e],n.push(t.classList.remove("js-activated"));return n},t.prototype.disableFlash=function(){return $t(".js-forum-topic-reply").removeClass("js-forum-topic-reply-flash")},t.prototype.enableFlash=function(){return $t(".js-forum-topic-reply").addClass("js-forum-topic-reply-flash"),Timeout.set(500,this.disableFlash)},t.prototype.posted=function(t,e){var r,i;return i=this.input[0],this.deactivate(),i.value="",this.bbcodePreview.hidePreview({target:i}),r=$t(e),this.forum.postPosition(r[0])-1!==this.forum.postPosition(this.forum.endPost())||"1"===t.target.dataset.forceReload?(0,p.c4)(r.find(".js-post-url").attr("href")):(this.forum.setTotalPosts(this.forum.totalPosts()+1),this.forum.endPost().insertAdjacentHTML("afterend",e),this.forum.endPost().scrollIntoView())},t.prototype.stickOrUnstick=function(t,e){var r;return r=osuCore.windowSize.isDesktop?"forum-topic-reply"===e:"1"===this.getState("active"),this.toggleStick(r)},t.prototype.toggle=function(){return"1"===this.getState("active")?this.deactivate():this.activate()},t.prototype.toggleDeactivate=function(t){return t.stopPropagation(),this.deactivate()},t.prototype.toggleStick=function(t){var e,r,i,n,s;if(n="1"===this.getState("sticking"),document.body.style.overflow=!t||osuCore.windowSize.isDesktop?"":"hidden",t!==n)return r=this.box[0],t?(this.setState("sticking","1"),r.dataset.state="stick",s=this.fixedBar[0]):(this.deleteState("sticking"),null!=r.dataset.state&&delete r.dataset.state,s=this.container[0]),i=(e=this.$input()).is(":focus"),s.insertBefore(r,s.firstChild),i?e.focus():void 0},t}();var Xt=r(9755),Kt=function(t,e){return function(){return t.apply(e,arguments)}};const Qt=function(){function t(){this.save=Kt(this.save,this),this.onKeyup=Kt(this.onKeyup,this),this.onInput=Kt(this.onInput,this),this.editShow=Kt(this.editShow,this),this.cancel=Kt(this.cancel,this),this.abort=Kt(this.abort,this),this.input=document.getElementsByClassName("js-forum-topic-title--input"),this.saveButton=document.getElementsByClassName("js-forum-topic-title--save"),this.title=document.getElementsByClassName("js-forum-topic-title--title"),this.toggleables=document.getElementsByClassName("js-forum-topic-title--toggleable"),addEventListener("turbolinks:before-cache",this.abort),Xt(document).on("click",".js-forum-topic-title--edit-start",this.editShow),Xt(document).on("click",".js-forum-topic-title--save",this.save),Xt(document).on("keyup",".js-forum-topic-title--input",this.onKeyup),Xt(document).on("click",".js-forum-topic-title--cancel",this.cancel),Xt(document).on("input",".js-forum-topic-title--input",this.onInput)}return t.prototype.abort=function(){var t;return null!=(t=this.xhr)?t.abort():void 0},t.prototype.cancel=function(){return this.abort(),Xt(this.toggleables).removeAttr("data-title-edit"),this.input[0].value=this.input[0].defaultValue},t.prototype.editShow=function(){return Xt(this.toggleables).attr("data-title-edit",1),this.input[0].selectionStart=this.input[0].value.length,this.input[0].focus()},t.prototype.onInput=function(){return this.saveButton[0].disabled=!(0,A.W)(this.input[0].value)},t.prototype.onKeyup=function(t){switch(t.key){case"Enter":return this.save();case"Escape":return this.cancel()}},t.prototype.save=function(){var t,e,r,i;if(e=(t=this.input[0]).value,null!=(0,A.G)(e))return e===t.defaultValue?this.cancel():(t.disabled=!0,this.saveButton[0].disabled=!0,this.abort(),this.xhr=Xt.ajax(t.dataset.url,{method:"PUT",data:(r={},r[""+t.name]=e,r)}).done((function(){return(0,p.sl)()})).fail((i=this,function(e){return t.disabled=!1,i.saveButton[0].disabled=!1,(0,j.hd)()(e)})))},t}();var Yt=r(9755),te=function(t,e){return function(){return t.apply(e,arguments)}};const ee=function(){function t(){this.shouldContinue=te(this.shouldContinue,this),this.loading=te(this.loading,this),this.fail=te(this.fail,this),this.done=te(this.done,this),this.abortAll=te(this.abortAll,this),Yt(document).on("ajax:before",".js-forum-topic-watch-ajax",this.shouldContinue),Yt(document).on("ajax:send",".js-forum-topic-watch-ajax",this.loading),Yt(document).on("ajax:error",".js-forum-topic-watch-ajax",this.fail),Yt(document).on("ajax:success",".js-forum-topic-watch-ajax",this.done),this.xhr=[],this.unknownState=!1}return t.prototype.abortAll=function(){var t,e;for(t=[];null!=(e=this.xhr.pop());)t.push(e.abort());return t},t.prototype.done=function(){return this.unknownState=!1},t.prototype.fail=function(t,e,r){var i;i=t.currentTarget,"abort"===r&&(i.dataset.skipAjaxErrorPopup="1"),i.classList.remove("js-forum-topic-watch-ajax--loading"),i.disabled=!1},t.prototype.loading=function(t,e){var r;this.unknownState=!0,this.abortAll(),this.xhr.push(e),(0,_.Lt)(),(r=t.currentTarget).dataset.skipAjaxErrorPopup="0",r.classList.add("js-forum-topic-watch-ajax--loading"),r.disabled=!0},t.prototype.shouldContinue=function(t){return this.unknownState||"1"!==t.currentTarget.dataset.forumTopicWatchAjaxIsActive},t}();var re=r(7294),ie=r(9139),ne=r(9755);class se extends re.PureComponent{constructor(t){super(t),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:`gallery-contest-${(0,ie.d)()}`}),Object.defineProperty(this,"mainRef",{enumerable:!0,configurable:!0,writable:!0,value:re.createRef()}),Object.defineProperty(this,"buttonState",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const t=this.button();return null!=t&&null!=t.dataset.contestVoteMeta?JSON.parse(t.dataset.contestVoteMeta):{hasVote:!1,isLoading:!1,isSelected:!1,votingOver:!1}}}),Object.defineProperty(this,"buttonTitle",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(!this.state.isLoading&&!this.state.button.votingOver)return this.state.button.isSelected?(0,f.dW)("contest.voting.button.remove"):this.state.button.hasVote?(0,f.dW)("contest.voting.button.add"):(0,f.dW)("contest.voting.button.used_up")}}),Object.defineProperty(this,"isDisabled",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.state.isLoading||this.state.button.votingOver||!this.state.button.isSelected&&!this.state.button.hasVote}),Object.defineProperty(this,"loadingEnd",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({isLoading:!1}),this.syncState()}}),Object.defineProperty(this,"loadingStart",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({isLoading:!0})}}),Object.defineProperty(this,"mainClass",{enumerable:!0,configurable:!0,writable:!0,value:()=>{let t="pswp__button pswp__button--contest-vote js-gallery-extra";return this.state.button.isSelected&&(t+=" pswp__button--contest-vote-active"),this.isDisabled()&&(t+=" pswp__button--disabled"),t}}),Object.defineProperty(this,"resetTooltip",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const t=this.mainRef.current;null!=t&&tooltipDefault.remove(t)}}),Object.defineProperty(this,"syncState",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({button:this.buttonState()})}}),Object.defineProperty(this,"vote",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(this.isDisabled())return;const t=this.button();null!=t&&t.click()}}),this.state={button:this.buttonState(),isLoading:!1}}componentDidMount(){ne.subscribe(`contest:vote:click.${this.eventId}`,this.loadingStart),ne.subscribe(`contest:vote:end.${this.eventId}`,this.loadingEnd),this.props.pswp.listen("afterChange",this.syncState)}componentDidUpdate(){this.resetTooltip()}componentWillUnmount(){ne.unsubscribe(`.${this.eventId}`)}render(){return re.createElement("button",{ref:this.mainRef,className:this.mainClass(),onClick:this.vote,title:this.buttonTitle()},re.createElement("span",{className:this.iconClass()}))}button(){if(null==this.props.pswp.currItem)return;const t=this.props.pswp.currItem.element.dataset.buttonId;return document.querySelector(`.js-contest-vote-button[data-button-id='${t}']`)}iconClass(){return this.state.isLoading?"fas fa-sync fa-spin":"fas fa-star"}}var oe=r(7735),ae=r(9755);class le extends re.PureComponent{constructor(t){super(t),Object.defineProperty(this,"getVoteState",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var t;return JSON.parse(null!==(t=this.voteSummary().dataset.contestVoteSummary)&&void 0!==t?t:"")}}),Object.defineProperty(this,"syncState",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState(this.getVoteState())}}),Object.defineProperty(this,"voteSummary",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const t=document.querySelector(".js-contest-vote-summary");if(t instanceof HTMLElement)return t;throw new Error(".js-contest-vote-summary is not HTMLElement")}}),this.state=this.getVoteState()}componentDidMount(){ae.subscribe("contest:vote:end",this.syncState)}componentWillUnmount(){ae.unsubscribe("contest:vote:end",this.syncState)}render(){return re.createElement("div",{className:"pswp__button pswp__button--vote-progress"},re.createElement(oe.D,{current:this.state.voteCount,max:this.state.maxVotes,theme:"gallery-contest",tooltip:(0,f.dW)("contest.voting.progress._",{max:this.state.maxVotes,used:this.state.voteCount})}))}}var ue=r(3935),ce=r(9755);class he{constructor(t,e){Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"root",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"destroy",{enumerable:!0,configurable:!0,writable:!0,value:()=>{(0,ue.unmountComponentAtNode)(this.root),ce(document).off(`.${this.eventId}`)}}),this.root=t.querySelector(".js-pswp-buttons"),(0,ue.render)(re.createElement(re.Fragment,null,re.createElement(se,{pswp:e}),re.createElement(le,null)),this.root),this.eventId=`gallery-contest-${(0,ie.d)()}`,ce(document).on(`turbolinks:before-cache.${this.eventId}`,this.destroy),e.listen("destroy",this.destroy)}}var de=r(8832),pe=r.n(de),me=r(8411),fe=r.n(me),ge=r(9755),ve=r(6486),be=function(t,e){return function(){return t.apply(e,arguments)}};const ye=function(){function t(){this.switchPreview=be(this.switchPreview,this),this.thumbBoundsFn=be(this.thumbBoundsFn,this),this.open=be(this.open,this),this.initiateOpen=be(this.initiateOpen,this),this.container=document.getElementsByClassName("pswp"),ge(document).on("click",".js-gallery",this.initiateOpen),ge(document).on("click",".js-gallery-thumbnail",this.switchPreview),ge(document).on("turbolinks:before-cache",(function(){return ge(".js-gallery--container").remove()}))}return t.prototype.initiateOpen=function(t){var e,r,i;if(!(e=ge(t.currentTarget)).parents("a").length)return t.preventDefault(),i=parseInt(e.attr("data-index"),10),r=e.attr("data-gallery-id"),this.open({galleryId:r,index:i})},t.prototype.open=function(t){var e,r,i,n;return r=t.galleryId,i=t.index,(e=this.container[0].cloneNode(!0)).classList.add("js-gallery--container"),document.body.appendChild(e),n=new(pe())(e,fe(),this.data(r),{showHideOpacity:!0,getThumbBoundsFn:this.thumbBoundsFn(r),index:i,history:!1,timeToIdle:null}),ve.startsWith(r,"contest-")&&new he(e,n),n.init(),ge(document).one("gallery:close",(function(){try{return n.close()}catch(t){}}))},t.prototype.data=function(t){var e,r,i,n,s,o,a;for(o=[],r=0,i=(n=document.querySelectorAll(".js-gallery[data-gallery-id='"+t+"']")).length;r<i;r++)a=null!=(s=(e=n[r]).getAttribute("data-src"))?s:e.getAttribute("href"),o.push({element:e,msrc:a,src:a,w:parseInt(e.getAttribute("data-width"),10),h:parseInt(e.getAttribute("data-height"),10)});return o},t.prototype.thumbBoundsFn=function(t){return function(e){var r,i,n,s,o,a,l;return l=(r=ge(".js-gallery[data-gallery-id='"+t+"'][data-index='"+e+"']")).offset(),a=[r.width(),r.height()],i=[l.left+a[0]/2,l.top+a[1]/2],n=[parseInt(r.attr("data-width"),10),parseInt(r.attr("data-height"),10)],s=Math.max(a[0]/n[0],a[1]/n[1]),o=n.map((function(t){return t*s})),{x:i[0]-o[0]/2,y:i[1]-o[1]/2,w:o[0]}}},t.prototype.switchPreview=function(t){var e,r,i,n,s,o,a,l,u,c;for(t.preventDefault(),i=(l=ge(t.currentTarget)[0].dataset).galleryId,n=l.index,r=ge(".js-gallery[data-gallery-id='"+i+"']"),e=ge(".js-gallery-thumbnail[data-gallery-id='"+i+"']"),c=[],s=0,o=(u=ve.zip(e,r)).length;s<o;s++)n===(a=u[s])[0].dataset.index?(a[0].classList.add("js-gallery-thumbnail--active"),c.push((0,H.Ji)(a[1]))):(a[0].classList.remove("js-gallery-thumbnail--active"),c.push((0,H.U6)(a[1])));return c},t}();var we=r(9755),ke=function(t,e){return function(){return t.apply(e,arguments)}};const je=function(){function t(){this.dragend=ke(this.dragend,this),this.dragenter=ke(this.dragenter,this),we(document).on("dragenter",this.dragenter),we(document).on("dragover",this.dragend)}return t.prototype.dragenter=function(){if(!this.dragging)return this.dragging=!0,we.publish("dragenterGlobal")},t.prototype.dragend=function(t){var e,r;if(this.dragging)return r=this,e=function(){return r.dragging=!1,we.publish("dragendGlobal")},Timeout.clear(this.dragendTimer),this.dragendTimer=Timeout.set(100,e)},t}();var _e=r(7543),xe=r(6486);const Ee=0,Pe=0,Ce=0,Se=40;class Te{constructor(){Object.defineProperty(this,"area",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"height",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"maxElem",{enumerable:!0,configurable:!0,writable:!0,value:{x:0,y:0}}),Object.defineProperty(this,"peakTextLength",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"scaleX",{enumerable:!0,configurable:!0,writable:!0,value:_e.scaleLinear()}),Object.defineProperty(this,"scaleY",{enumerable:!0,configurable:!0,writable:!0,value:_e.scaleTime()}),Object.defineProperty(this,"svg",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"svgArea",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"svgContainerInner",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"svgContainerOuter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"svgPeakCircle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"svgPeakText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"width",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"resize",{enumerable:!0,configurable:!0,writable:!0,value:()=>{0!==this.data.length&&(this.width=parseInt(this.svgContainerOuter.style("width"),10)-Pe-Ce,this.height=parseInt(this.svgContainerOuter.style("height"),10)-Se-Ee,this.scaleX.range([0,this.width]),this.scaleY.range([this.height,0]),this.svgContainerInner.attr("width",this.width+Pe+Ce).attr("height",this.height+Se+Ee),this.svgArea.datum(this.data).attr("d",this.area),this.svgPeakCircle.attr("cx",this.scaleX(this.maxElem.x)),this.svgPeakText.attr("x",(()=>{const t=this.scaleX(this.maxElem.x)+10;return this.peakTextLength+t>this.width?this.scaleX(this.maxElem.x)-(this.peakTextLength+10):t})))}}),this.svgContainerOuter=_e.select(".js-landing-graph"),this.svgContainerOuter.selectAll("svg").remove(),this.svgContainerInner=this.svgContainerOuter.append("svg").attr("class","landing-graph"),this.svg=this.svgContainerInner.append("g").attr("transform",`translate(${Pe}, ${Se+1})`),this.svgArea=this.svg.append("path").attr("class","landing-graph__area"),this.svgPeakText=this.svg.append("text").attr("class","landing-graph__text").attr("y",-10),this.svgPeakCircle=this.svg.append("circle").attr("class","landing-graph__circle").attr("cy",0).attr("r",5),this.area=_e.area().curve(_e.curveBasis).x((t=>this.scaleX(t.x))).y0((()=>this.height)).y1((t=>this.scaleY(t.y))),this.loadData(),this.resize()}loadData(){var t,e,r;if(this.data=(0,$.Mo)("json-stats"),0===this.data.length)return;this.maxElem=null!==(t=(0,xe.maxBy)(this.data,(t=>t.y)))&&void 0!==t?t:this.data[0];const i=_e.extent(this.data,(t=>t.x));this.scaleX.domain([null!==(e=i[0])&&void 0!==e?e:0,null!==(r=i[1])&&void 0!==r?r:0]),this.scaleY.domain([0,this.maxElem.y]),this.svgPeakText.text((0,f.dW)("home.landing.peak",{count:(0,P.uf)(this.maxElem.y)}));const n=this.svgPeakText.node();if(null==n)throw new Error("peak text node is missing");this.peakTextLength=n.getComputedTextLength()}}var Oe=r(9755),Me=function(t,e){return function(){return t.apply(e,arguments)}};const Le=function(){function t(){this.resize=Me(this.resize,this),this.initialize=Me(this.initialize,this),Oe(window).on("resize",this.resize),Oe(document).on("turbolinks:load",this.initialize)}return t.prototype.container=document.getElementsByClassName("js-landing-graph"),t.prototype.initialize=function(){var t;if(null!=this.container[0])return null!=(t=this.container[0])._chart?t._chart:t._chart=new Te},t.prototype.resize=function(){var t;if(null!=this.container[0])return null!=(t=this.container[0]._chart)?t.resize():void 0},t}();var Ne=r(9755),De=function(t,e){return function(){return t.apply(e,arguments)}};const Be=function(){function t(){this.setMenu=De(this.setMenu,this),this.refresh=De(this.refresh,this),this.hideMenu=De(this.hideMenu,this),this.onMouseLeave=De(this.onMouseLeave,this),this.onMouseEnter=De(this.onMouseEnter,this),this.onTouchStart=De(this.onTouchStart,this),this.onGlobalTouchstart=De(this.onGlobalTouchstart,this),this.onDocumentReady=De(this.onDocumentReady,this),this.currentTree=De(this.currentTree,this),this.defaultMenu=De(this.defaultMenu,this),this.menuTimeout=150,Ne(document).on("touchstart",".js-menu",this.onTouchStart),Ne(document).on("mouseenter",".js-menu",this.onMouseEnter),Ne(document).on("mouseleave",".js-menu",this.onMouseLeave),Ne(document).on("touchstart",this.onGlobalTouchstart),Ne(document).on("turbolinks:load",this.onDocumentReady)}return t.prototype.$menuLink=function(t){return Ne(".js-menu[data-menu-target"+(t?"='"+t+"'":"")+"]")},t.prototype.closestMenuId=function(t){return t.closest("[data-menu-id]").attr("data-menu-id")},t.prototype.defaultMenu=function(){var t,e;return null!=(t=document.querySelector('.js-menu[data-menu-default="1"]'))&&null!=(e=t.dataset)?e.menuTarget:void 0},t.prototype.parentsMenuId=function(t){return t.parents("[data-menu-id]").attr("data-menu-id")},t.prototype.currentTree=function(){var t,e;if(!this.currentMenu)return[];for(t=[e=this.currentMenu];e=this.closestMenuId(this.$menuLink(e));)t.push(e);return t},t.prototype.onDocumentReady=function(){return this.refresh(),this.setMenu(null,(t=this,function(){return t.closestMenuId(Ne(":hover").last())}));var t},t.prototype.onGlobalTouchstart=function(t){if(this.currentMenu&&null==t.target.closest(".js-menu"))return this.hideMenu()},t.prototype.onTouchStart=function(t){var e,r,i,n,s,o;if(r=t.currentTarget,null!=(n=r.dataset.menuTarget))return e=Ne(n),t.preventDefault(),s=parseInt(null!=(i=r.dataset.menuShowDelay)?i:this.menuTimeout,10),this.setMenu(s,(o=this,function(){return o.currentMenu===n?o.closestMenuId(e):n}))},t.prototype.onMouseEnter=function(t){var e,r,i,n;return e=t.currentTarget,i=parseInt(null!=(r=e.dataset.menuShowDelay)?r:this.menuTimeout,10),this.setMenu(i,(n=this,function(){var t;return null!=(t=e.dataset.menuTarget)?t:n.closestMenuId(Ne(e))}))},t.prototype.onMouseLeave=function(t){var e,r;return e=Ne(t.currentTarget),this.setMenu(null,(r=this,function(){return r.parentsMenuId(e)}))},t.prototype.hideMenu=function(){return this.setMenu()},t.prototype.refresh=function(){var t,e,r,i,n,s,o;for(null==this.currentMenu&&(this.currentMenu=this.defaultMenu()),s=document.querySelectorAll(".js-menu[data-menu-id]"),t=this.currentTree(),Ne.publish("menu:current",this.currentMenu),o=[],e=0,r=s.length;e<r;e++)n=(i=s[e]).getAttribute("data-menu-id"),-1===t.indexOf(n)?((0,H.U6)(i),o.push(this.$menuLink(n).removeClass("js-menu--active"))):((0,H.Ji)(i),this.$menuLink(n).addClass("js-menu--active"),o.push(Ne(i).trigger("menu:showing")));return o},t.prototype.setMenu=function(t,e){return null==t&&(t=this.menuTimeout),Timeout.clear(this.refreshTimeout),this.refreshTimeout=Timeout.set(t,(r=this,function(){return r.currentMenu="function"==typeof e?e():void 0,r.refresh()}));var r},t}();var Re=r(9755),Ie=function(t,e){return function(){return t.apply(e,arguments)}};const qe=function(){function t(){this.hideOrShow=Ie(this.hideOrShow,this),this.load=Ie(this.load,this),this.containers=document.getElementsByClassName("js-nav-button--container"),this.items=document.getElementsByClassName("js-nav-button--item"),this.main=document.getElementsByClassName("js-nav-button"),addEventListener("turbolinks:load",this.load)}return t.prototype.load=function(){var t,e,r,i;if(this.listening||(this.listening=!0,Re(window).on("resize",this.hideOrShow)),0!==this.main.length){for(this.itemWidth=this.items[0].offsetWidth,this.defaultWidth=0,e=0,r=(i=this.containers).length;e<r;e++)t=i[e],this.defaultWidth+=t.offsetWidth;return this.hideOrShow()}},t.prototype.hideOrShow=function(){var t,e,r,i,n,s,o,a,l;if(0!==this.main.length){for(t=this.main[0].offsetWidth,e=this.defaultWidth,i=0,s=(a=this.items).length;i<s;i++)a[i].classList.remove("hidden");if(t<e)for(n=0,o=(l=this.items).length;n<o;n++)if(r=l[n],e-=this.itemWidth,r.classList.add("hidden"),t>=e)return}},t}();var Ae=r(9755),ze=r(6486),Ue=function(t,e){return function(){return t.apply(e,arguments)}};const We=function(){function t(t){this.clickMenu=t,this.showMenuBg=Ue(this.showMenuBg,this),this.loginBoxVisible=Ue(this.loginBoxVisible,this),this.autoMobileNav=Ue(this.autoMobileNav,this),this.autoCenterPopup=Ue(this.autoCenterPopup,this),this.menuBg=document.getElementsByClassName("js-nav2--menu-bg"),Ae.subscribe("click-menu:current",this.autoCenterPopup),Ae.subscribe("click-menu:current",this.autoMobileNav),Ae.subscribe("menu:current",this.showMenuBg)}return t.prototype.autoCenterPopup=function(t,e){var r,i,n,s,o,a,l,u,c,h,d;for(h=e.target,this.currentMenu=h,Ae(window).off("resize.nav2-center-popup"),s=0,o=(u=document.querySelectorAll(".js-nav2--centered-popup")).length;s<o;s++)null!=(r=(l=u[s]).closest(".js-click-menu"))&&(r.dataset.clickMenuId===this.currentMenu?(l.classList.remove("hidden"),i=l,a=document.querySelector(".js-click-menu[data-click-menu-target='"+this.currentMenu+"']")):l.classList.add("hidden"));if(null!=i)return d=this,n=function(){return d.centerPopup(i,a)},Ae(window).on("resize.nav2-center-popup",n),n(),null!=(c=i.querySelector(".js-nav2--autofocus"))?c.focus():void 0},t.prototype.autoMobileNav=function(t,e){var r,i,n,s;return r=e.previousTree,i=e.target,n=e.tree,"mobile-menu"===i&&(this.clickMenu.show("mobile-nav"),Timeout.set(0,(s=this,function(){return Ae(s.clickMenu.menu("mobile-menu")).finish().slideDown(150)}))),this.showingMobileNav=-1!==n.indexOf("mobile-menu"),this.showingMobileNav?(document.body.classList.add("js-nav2--active"),(0,Ct.z)(this,!0)):-1!==r.indexOf("mobile-menu")?((0,Ct.z)(this,!1),Timeout.set(0,function(t){return function(){return Ae(t.clickMenu.menu("mobile-menu")).finish().slideUp(150,(function(){return document.body.classList.toggle("js-nav2--active",t.showingMobileNav)}))}}(this))):void 0},t.prototype.centerPopup=function(t,e){var r,i,n,s,o,a,l,u,c,h,d,p;return u=t.getBoundingClientRect(),n=t.parentElement.getBoundingClientRect(),p=e.getBoundingClientRect(),r=document.body.getBoundingClientRect().width-5,d=p.width/2,s=u.width/2,i=(l=(o=n.left)+(a=p.left+d-o-s))<0?-1*p.left:(h=l+u.width,(c=Math.round(h-r))>0?a-c:a),i=Math.floor(i),t.style.transform="translateX("+i+"px)"},t.prototype.loginBoxVisible=function(){return"nav2-login-box"===this.currentMenu},t.prototype.showMenuBg=function(t,e){var r;return r=ze.startsWith(e,"nav2-menu-popup-"),(0,H.Eo)(this.menuBg[0],r)},t}();var Fe=r(6486),Ve=r(9755);const Ze=function(){function t(){var t,e,r;this.loadPreview=(t=this.loadPreview,e=this,function(){return t.apply(e,arguments)}),this.debouncedLoadPreview=Fe.debounce(this.loadPreview,500),Ve(document).on("input",".js-post-preview--auto",(r=this,function(t){return r.debouncedLoadPreview(t.currentTarget)}))}return t.prototype.loadPreview=function(t){var e,r,i,n,s,o;if(e=Ve(t).closest("form"),n=t.value,s=(r=e.find(".js-post-preview--preview"))[0],i=e.find(".js-post-preview--box"),null!=s)if(null!=(o=s._xhr)&&o.abort(),""!==n){if(r.attr("data-raw")!==n)return s._xhr=Ve.post((0,m.B)("bbcode-preview"),{text:n}).done((function(t){return r.html(t),r.attr("data-raw",n),i.removeClass("hidden")}));i.removeClass("hidden")}else i.addClass("hidden")},t}();var He=r(6486),$e=r(9755),Je=r(2918),Ge=function(t,e){return function(){return t.apply(e,arguments)}};const Xe=function(){function t(){this.restoreFocus=Ge(this.restoreFocus,this),this.searchingToggle=Ge(this.searchingToggle,this),this.submit=Ge(this.submit,this),this.submitForm=Ge(this.submitForm,this),this.submitInput=Ge(this.submitInput,this),this.maybeSubmitInput=Ge(this.maybeSubmitInput,this),this.forumPostReset=Ge(this.forumPostReset,this),this.debouncedSubmitInput=He.debounce(this.submitInput,500),$e(document).on("click",".js-search--forum-options-reset",this.forumPostReset),$e(document).on("input",".js-search--input",this.debouncedSubmitInput),$e(document).on("keydown",".js-search--input",this.maybeSubmitInput),$e(document).on("submit",".js-search",this.submitForm),addEventListener("turbolinks:load",this.restoreFocus)}return t.prototype.forumPostReset=function(){var t;return(t=$e(".js-search")).find("[name=username], [name=forum_id]").val(""),t.find("[name=forum_children]").prop("checked",!1)},t.prototype.maybeSubmitInput=function(t){if("Enter"===t.key)return t.preventDefault(),t.target.blur(),this.submitInput(t)},t.prototype.submitInput=function(t){var e,r,i;if(""!==(i=(e=t.currentTarget).value.trim())&&i!==(null!=(r=e.dataset.searchCurrent)?r.trim():void 0))return e.dataset.searchCurrent=i,this.submit()},t.prototype.submitForm=function(t){return t.preventDefault(),this.submit()},t.prototype.submit=function(){var t,e;return this.searchingToggle(!0),t=$e(".js-search").serialize(),$e(document).one("turbolinks:before-cache",(e=this,function(){return e.activeElement=document.activeElement,e.searchingToggle(!1)})),Je.visit("?"+t)},t.prototype.searchingToggle=function(t){return $e(".js-search--header").toggleClass("js-search--searching",t)},t.prototype.restoreFocus=function(){var t;return null!=(t=this.activeElement)&&t.focus(),this.activeElement=null},t}();var Ke=r(9755),Qe=function(){function t(){}return t.fetchApprovalLink=function(t){return new Promise((function(e,r){return Ke.post((0,m.B)("payments.paypal.create"),{order_id:t}).done(e).fail((function(t){return r({xhr:t})}))}))},t}(),Ye=r(9755),tr=function(){function t(){}return t.promiseInit=function(e){return Promise.all([t.fetchToken(e),t.fetchScript()]).then((function(r){return t.onXsollaReady(e),XPayStationWidget.init(r[0])}))},t.fetchScript=function(){var t;return null!=(t=M.Z.turbolinksReload.load("https://static.xsolla.com/embed/paystation/1.0.7/widget.min.js"))?t:Promise.resolve()},t.fetchToken=function(t){return new Promise((function(e,r){return Ye.post((0,m.B)("payments.xsolla.token"),{orderNumber:t}).done((function(t){return e(t)})).fail((function(t){return r({xhr:t})}))}))},t.onXsollaReady=function(t){var e;return e=!1,XPayStationWidget.on(XPayStationWidget.eventTypes.STATUS_DONE,(function(){return e=!0})),XPayStationWidget.on(XPayStationWidget.eventTypes.CLOSE,(function(){if(e)return(0,_.Uq)(),_.Uq.flush(),window.location=(0,m.B)("payments.xsolla.completed",{foreignInvoice:t})}))},t}(),er=r(9755),rr=r(6486),ir=function(){function t(){}return t.CHECKOUT_SELECTOR=".js-store-checkout-button",t.initialize=function(){var e,r,i,n,s,o,a;for(i={},r=0,n=(a=document.querySelectorAll(t.CHECKOUT_SELECTOR)).length;r<n;r++)switch(e=a[r],o=e.dataset.provider,s=e.dataset.orderNumber,o){case"centili":i.centili=Promise.resolve();break;case"free":i.free=Promise.resolve();break;case"paypal":i.paypal=Promise.resolve();break;case"xsolla":i.xsolla=tr.promiseInit(s)}return er(t.CHECKOUT_SELECTOR).on("click.checkout",(function(e){var r,n,s;if(n=e.target.dataset,r=n.orderId,null!=(o=n.provider))return(0,_.Uq)(),_.Uq.flush(),null!=(s=i[o])?s.then((function(){var t,e;return t=null!=(e=document.querySelector(".js-hide-from-activity"))?e.checked:void 0,er.post((0,m.B)("store.checkout.store"),{hide_from_activity:t,provider:o,orderId:r})})).then((function(){return t.startPayment(e.target.dataset)})).catch(t.handleError):void 0}))},t.startPayment=function(t){var e,r,i;switch(e=t.orderId,r=t.provider,i=t.url,r){case"centili":return new Promise((function(t){return window.location.href=i}));case"paypal":return Qe.fetchApprovalLink(e).then((function(t){return window.location.href=t}));case"xsolla":return new Promise((function(t){return XPayStationWidget.open(),(0,_.Lt)(),t()}))}},t.handleError=function(t){var e;if((0,_.Lt)(),!t.getResponseHeader||(e=t.getResponseHeader("Content-Type"),!rr.startsWith(e,"application/javascript")))return(0,j.qQ)(null!=t?t.xhr:void 0)},t}(),nr=r(9755),sr=r(6486),or=r(381),ar=function(t,e){return function(){return t.apply(e,arguments)}};const lr=function(){function t(){this.timeagoTip=ar(this.timeagoTip,this),this.rollback=ar(this.rollback,this),this.autoAddTooltip=ar(this.autoAddTooltip,this),this.onMouseOver=ar(this.onMouseOver,this),nr(document).on("mouseover touchstart","[title]:not(iframe)",this.onMouseOver),nr(document).on("mouseenter touchstart",".u-ellipsis-overflow, .u-ellipsis-overflow-desktop, .u-ellipsis-pre-overflow",this.autoAddTooltip),nr(document).on("turbolinks:load",this.rollback)}return t.prototype.onMouseOver=function(t){var e,r,i,n,s,o,a,l,u,c;if(c=(n=t.currentTarget).getAttribute("title"),n.removeAttribute("title"),s=(0,A.G)(n.dataset.htmlTitle),0!==sr.size(c)||null!=s){if(e=n.classList.contains("js-timeago")||n.classList.contains("js-tooltip-time")?this.timeagoTip(n,c):null!=s?s:nr("<span>").text(c),!n._tooltip)return n._tooltip=!0,r=null!=(u=n.dataset.tooltipPosition)?u:"top center",a=function(){switch(r){case"top center":return"bottom center";case"left center":return"right center";case"right center":return"left center";case"bottom center":return"top center"}}(),o="1"===n.dataset.tooltipHoverable,i="qtip tooltip-default","fixed"===n.dataset.tooltipFloat&&(i+=" tooltip-default--fixed"),null!=n.dataset.tooltipModifiers&&(i+=" tooltip-default--"+n.dataset.tooltipModifiers),o&&(i+=" u-hover"),l={overwrite:!1,content:e,position:{my:a,at:r,viewport:nr(window)},show:{event:t.type,ready:!0},hide:{event:"click mouseleave"},style:{classes:i,tip:{width:10,height:8}}},"touchstart"===t.type&&(l.hide={inactive:3e3,event:"unfocus"}),n.dataset.tooltipPinPosition&&(l.position.effect=!1),n.dataset.tooltipHideEvents&&(l.hide.event=n.dataset.tooltipHideEvents),o&&(l.hide.delay=200,l.hide.fixed=!0),n.dataset.origTitle=c,nr(n).qtip(l,t);nr(n).qtip("set",{"content.text":e})}},t.prototype.autoAddTooltip=function(t){var e,r,i;return i=t.currentTarget,r=(e=nr(i)).qtip("api"),i.offsetWidth<i.scrollWidth?r?r.enable():(e.attr("title",e.text()),e.trigger(t.type)):null!=r?r.disable():void 0},t.prototype.remove=function(t){if(t._tooltip)return nr(t).qtip("destroy",!0),t._tooltip=!1,null==t.getAttribute("title")&&t.setAttribute("title",t.dataset.origTitle),delete t.dataset.origTitle},t.prototype.rollback=function(){var t,e,r,i,n;for(nr(".qtip").remove(),n=[],e=0,r=(i=document.querySelectorAll("[data-orig-title]")).length;e<r;e++)t=i[e],n.push(t.setAttribute("title",t.dataset.origTitle));return n},t.prototype.timeagoTip=function(t,e){var r,i,n,s,o,a;return a=null!=(n=null!=(s=t.getAttribute("datetime"))?s:e)?n:t.textContent,o=or(a),r=nr("<strong>").text(o.format("LL")),i=nr("<span>").addClass("tooltip-default__time").text(o.format("LTS")+" "+this.tzString(o)),nr("<span>").append(r).append(" ").append(i)},t.prototype.tzString=function(t){var e;return"UTC"+((e=t.utcOffset())%60==0?(e>=0?"+":"")+e/60:t.format("Z"))},t}();var ur=r(2918),cr=r(381),hr=r(9755),dr=r(9755);ur.start(),ur.setProgressBarDelay(0),cr.relativeTimeThreshold("ss",44),cr.relativeTimeThreshold("s",120),cr.relativeTimeThreshold("m",120),cr.relativeTimeThreshold("h",48),cr.relativeTimeThreshold("d",62),cr.relativeTimeThreshold("M",24),hr.timeago.inWords=function(t){return cr.duration(-1*t).humanize(!0)},dr(document).on("turbolinks:request-start",_.Uq),dr(document).on("turbolinks:request-end",_.Lt),dr(document).on("submit","form",(function(t){if("0"!==t.currentTarget.dataset.loadingOverlay)return(0,_.Uq)()})),dr(document).on("turbolinks:load",(function(){return Z.initialize(),ir.initialize()})),null==window.accountEdit&&(window.accountEdit=new q),null==window.accountEditAvatar&&(window.accountEditAvatar=new D),null==window.bbcodePreview&&(window.bbcodePreview=new W),null==window.changelogChartLoader&&(window.changelogChartLoader=new rt),null==window.checkboxValidation&&(window.checkboxValidation=new nt),null==window.fancyGraph&&(window.fancyGraph=new dt),null==window.formClear&&(window.formClear=new mt),null==window.formError&&(window.formError=new kt),null==window.formToggle&&(window.formToggle=new xt),null==window.forum&&(window.forum=new Lt),null==window.forumAutoClick&&(window.forumAutoClick=new Rt),null==window.forumCover&&(window.forumCover=new zt),null==window.forumTopicTitle&&(window.forumTopicTitle=new Qt),null==window.forumTopicWatchAjax&&(window.forumTopicWatchAjax=new ee),null==window.gallery&&(window.gallery=new ye),null==window.globalDrag&&(window.globalDrag=new je),null==window.landingGraph&&(window.landingGraph=new Le),null==window.menu&&(window.menu=new Be),null==window.navButton&&(window.navButton=new qe),null==window.postPreview&&(window.postPreview=new Ze),null==window.search&&(window.search=new Xe),null==window.tooltipDefault&&(window.tooltipDefault=new lr),null==window.formConfirmation&&(window.formConfirmation=new bt(window.formError)),null==window.forumPostsSeek&&(window.forumPostsSeek=new Ft(window.forum)),null==window.forumTopicPostJump&&(window.forumTopicPostJump=new Ht(window.forum)),null==window.forumTopicReply&&(window.forumTopicReply=new Gt({bbcodePreview:window.bbcodePreview,forum:window.forum,stickyFooter:osuCore.stickyFooter})),null==window.nav2&&(window.nav2=new We(osuCore.clickMenu)),dr(document).on("change",".js-url-selector",(function(t){return(0,p.c4)(t.target.value,"1"===t.target.dataset.keepScroll)})),dr(document).on("keydown",(function(t){if("Escape"===t.key)return dr.publish("key:esc")}));var pr=r(9119),mr=r(1228),fr=r(714),gr=r(5069),vr=r(9323);function br(t){const e={glow:t.count>0,mobile:"mobile"===t.type};return re.createElement("span",{className:(0,It.sb)("notification-icon",e)},re.createElement("i",{className:t.iconClassName}),re.createElement("span",{className:"notification-icon__count"},t.ready?(r=t.count,(0,P.uf)(r>0?r:0)):"..."));var r}var yr=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};let wr=class extends re.Component{get unreadCount(){return M.Z.dataStore.notificationStore.unreadStacks.getOrCreateType({objectType:"channel"}).total}constructor(t){super(t),(0,l.rC)(this)}render(){return re.createElement(br,{count:this.unreadCount,iconClassName:"fas fa-comment-alt",ready:M.Z.notificationsWorker.hasData,type:this.props.type})}};yr([l.Fl],wr.prototype,"unreadCount",null),wr=yr([vr.Pi],wr);const kr=wr;var jr=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};const _r="countdown-timer";let xr=class extends re.Component{get deadline(){return u(this.props.deadline).valueOf()}get diff(){return Math.max(this.deadline-(new Date).valueOf(),0)/1e3}constructor(t){super(t),Object.defineProperty(this,"timer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),(0,l.rC)(this)}componentWillUnmount(){window.clearTimeout(this.timer)}render(){const t=this.diff,e={days:Math.floor(t/86400),hours:Math.floor(t/3600%24),minutes:Math.floor(t/60%60),seconds:Math.floor(t%60)};return 0!==t&&this.setTimeout(),re.createElement("div",{className:_r},re.createElement("div",{className:`${_r}__header`},`${(0,f.dW)("common.time.remaining")}:`),Object.entries(e).map((([t,e])=>re.createElement("div",{key:t,className:`${_r}__field`},re.createElement("div",{className:`${_r}__digit`},e<10?`0${e}`:e),re.createElement("div",{className:`${_r}__label`},(0,f.dW)(`common.countdown.${t}`))))))}setTimeout(){this.timer=window.setTimeout((()=>this.forceUpdate()),1e3)}};jr([l.Fl],xr.prototype,"deadline",null),xr=jr([vr.Pi],xr);const Er=xr;var Pr=r(6244),Cr=r(3890);function Sr({posts:t}){return re.createElement("div",{className:"landing-news"},t.length>0&&re.createElement(re.Fragment,null,re.createElement("div",{className:"landing-news__posts"},re.createElement(Pr.Z,{modifiers:["landing","hover"],post:t[0]})),re.createElement("div",{className:"landing-news__posts"},xe.slice(t,1).map(((t,e)=>re.createElement(Pr.Z,{key:e,modifiers:["landing","hover"],post:t})))),re.createElement("div",{className:"landing-news__link"},re.createElement(Cr.Z,{hasMore:!0,label:(0,f.dW)("home.landing.see_more_news"),loading:!1,modifiers:["no-icon"],url:(0,m.B)("news.index")}))))}var Tr=r(7581),Or=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};let Mr=class extends re.Component{get unreadCount(){return Tr.O3.filter((t=>!(null==t||"channel"===t))).reduce(((t,e)=>t+M.Z.dataStore.notificationStore.unreadStacks.getOrCreateType({objectType:e}).total),0)}constructor(t){super(t),(0,l.rC)(this)}render(){return re.createElement(br,{count:this.unreadCount,iconClassName:"fas fa-bell",ready:M.Z.notificationsWorker.hasData,type:this.props.type})}};Or([l.Fl],Mr.prototype,"unreadCount",null),Mr=Or([vr.Pi],Mr);const Lr=Mr;var Nr=r(6741),Dr=r(4403),Br=r(7292),Rr=r(6817);function Ir({beatmapset:t,modifiers:e=[]}){const r=(0,m.B)("beatmapsets.show",{beatmapset:t.id});return re.createElement("a",{className:(0,It.sb)("beatmapset-search-card",e),href:r},re.createElement(Br.Z,{beatmapset:t,modifiers:"search",size:"list"}),re.createElement("div",{className:"beatmapset-search-card__details"},re.createElement("div",{className:"beatmapset-search-card__title"},`${(0,Rr.YQ)(t)} `,re.createElement("span",{className:"beatmapset-search-card__title-artist"},(0,f.dW)("users.show.extra.beatmaps.by_artist",{artist:(0,Rr.aU)(t)}))),re.createElement("div",{className:"beatmapset-search-card__extra"},(0,f.dW)("beatmapsets.show.details.mapped_by",{mapper:t.creator}))))}var qr=r(5523),Ar=r(1759),zr=r(6568),Ur=r(6407);function Wr({user:t,modifiers:e=[]}){const r=(0,m.B)("users.show",{user:t.id});return re.createElement("div",{className:(0,It.sb)("user-search-card",e)},re.createElement("a",{className:"user-search-card__background-container",href:r}),re.createElement("div",{className:"user-search-card__container"},re.createElement("a",{className:"user-search-card__avatar-container",href:r},re.createElement("div",{className:"avatar avatar--full",style:{backgroundImage:(0,It.eF)(t.avatar_url)}})),re.createElement("div",{className:"user-search-card__details"},re.createElement("div",{className:"user-search-card__col user-search-card__col--flag"},re.createElement(qr.Z,{country:t.country})),re.createElement("a",{className:"user-search-card__col user-search-card__col--username",href:r},t.username),t.is_supporter?re.createElement("div",{className:"user-search-card__col user-search-card__col--icon u-hidden-narrow"},re.createElement(zr.Z,{level:t.support_level,modifiers:"quick-search"})):null,re.createElement(Ur.Z,{groups:t.groups,short:!0,wrapper:"user-search-card__col user-search-card__col--icon"}),re.createElement("div",{className:"user-search-card__col user-search-card__col--icon"},re.createElement(Ar.Z,{modifiers:"quick-search",userId:t.id})))))}var Fr=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};const Vr=["forum_post","wiki_page"];let Zr=class extends re.Component{constructor(){super(...arguments),Object.defineProperty(this,"inputRef",{enumerable:!0,configurable:!0,writable:!0,value:re.createRef()}),Object.defineProperty(this,"focus",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var t;null!=this.inputRef.current&&(this.inputRef.current.selectionStart=0,this.inputRef.current.selectionEnd=this.inputRef.current.value.length,this.props.worker.selectNone(),null===(t=this.inputRef.current)||void 0===t||t.focus())}}),Object.defineProperty(this,"onInputKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:t=>{var e;const r=t.key;"Enter"===r&&(null===(e=(0,P.h3)(t.target))||void 0===e||e.blur(),this.props.worker.debouncedSearch.flush(),this.navigateToSelected()),"ArrowUp"!==r&&"ArrowDown"!==r||this.props.worker.cycleSelectedItem("ArrowDown"===r?1:-1)}}),Object.defineProperty(this,"onMouseEnter",{enumerable:!0,configurable:!0,writable:!0,value:t=>{var e;const r=t.currentTarget.dataset.section,i=parseInt(null!==(e=t.currentTarget.dataset.index)&&void 0!==e?e:"0",10);this.selectBox(r,i)}}),Object.defineProperty(this,"onMouseLeave",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.worker.selectNone()}}),Object.defineProperty(this,"updateQuery",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.props.worker.updateQuery(t.currentTarget.value)}})}render(){let t=(0,It.sb)("quick-search",this.props.modifiers);return t+=" u-fancy-scrollbar",re.createElement("div",{className:t},re.createElement("div",{className:"quick-search-input"},re.createElement("div",{className:"quick-search-input__field"},re.createElement("span",{className:"quick-search-input__icon"},this.props.worker.searching?re.createElement(Nr.$,null):re.createElement("span",{className:"fas fa-search"})),re.createElement("input",{ref:this.inputRef,className:"quick-search-input__input js-click-menu--autofocus",onChange:this.updateQuery,onKeyDown:this.onInputKeyDown,placeholder:(0,f.dW)("home.search.placeholder"),type:"search",value:this.props.worker.query})),null!=this.props.onClose&&re.createElement("button",{className:"btn-osu-big btn-osu-big--quick-search-close",onClick:this.props.onClose,type:"button"},(0,f.dW)("common.buttons.close"))),this.renderResult())}boxIsActive(t,e){var r;const i=this.props.worker;return i.currentSection===t&&(null===(r=i.selected)||void 0===r?void 0:r.index)===e}count(t){return null===this.props.worker.searchResult?0:this.props.worker.searchResult[t].total}navigateToSelected(){const t=this.props.worker.selectedURL;null!=t&&(0,p.c4)(t,!1)}renderBeatmapsets(){return null===this.props.worker.searchResult?null:re.createElement("div",{className:"quick-search-items"},this.props.worker.searchResult.beatmapset.beatmapsets.map(((t,e)=>re.createElement("div",{key:t.id,className:"quick-search-items__item","data-index":e,"data-section":"beatmapset",onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},re.createElement(Ir,{beatmapset:t,modifiers:this.boxIsActive("beatmapset",e)?["active"]:[]})))),re.createElement("div",{className:"quick-search-items__item","data-section":"beatmapset_others",onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},this.renderResultLink("beatmapset",this.boxIsActive("beatmapset_others",0))))}renderMoreOtherResultLink(){const t=Vr.filter((t=>this.count(t)>0));return 0===t.length?null:re.createElement("div",{className:"quick-search-items"},t.map(((t,e)=>re.createElement("div",{key:t,className:"quick-search-items__item","data-index":e,"data-section":"others",onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},this.renderResultLink(t,this.boxIsActive("others",e))))))}renderNoMoreOtherResultLink(){const t=Vr.filter((t=>0===this.count(t)));return 0===t.length?null:re.createElement("div",{className:"quick-search-items quick-search-items--empty"},t.map((t=>re.createElement("div",{key:t,className:"quick-search-items__item"},(0,f.dW)("quick_search.result.empty_for",{modes:(0,f.dW)(`quick_search.mode.${t}`)})))))}renderOthers(){return 0===this.count("forum_post")&&0===this.count("wiki_page")?re.createElement("span",{className:"quick-search-items quick-search-items--empty"},(0,f.dW)("quick_search.result.empty_for",{modes:(0,f.m2)([(0,f.dW)("quick_search.mode.forum_post"),(0,f.dW)("quick_search.mode.wiki_page")])})):re.createElement(re.Fragment,null,this.renderMoreOtherResultLink(),this.renderNoMoreOtherResultLink())}renderResult(){return null==this.props.worker.searchResult?null:re.createElement("div",{className:"quick-search-result"},re.createElement("div",{className:"quick-search-result__item"},this.renderTitle("user"),this.renderUsers()),re.createElement("div",{className:"quick-search-result__item"},this.renderTitle("beatmapset"),this.renderBeatmapsets()),re.createElement("div",{className:"quick-search-result__item"},this.renderTitle("other"),this.renderOthers()))}renderResultLink(t,e=!1){let r="quick_search.result.";return r+=Vr.includes(t)?"title":"more",re.createElement("a",{className:(0,It.sb)("search-result-more",e?["active"]:[]),href:(0,m.B)("search",{mode:t,query:this.props.worker.query})},re.createElement("div",{className:"search-result-more__content"},(0,f.dW)(r,{mode:(0,f.dW)(`quick_search.mode.${t}`)}),re.createElement("span",{className:"search-result-more__count"},(0,P.uf)(this.count(t)))),re.createElement("div",{className:"search-result-more__arrow"},re.createElement("span",{className:"fas fa-angle-right"})))}renderTitle(t){return re.createElement("h2",{className:"title"},re.createElement(Dr.Z,{mappings:{mode:re.createElement("strong",null,(0,f.dW)(`quick_search.mode.${t}`))},pattern:(0,f.dW)("quick_search.result.title")}))}renderUsers(){return null==this.props.worker.searchResult?null:0===this.count("user")?re.createElement("span",{className:"quick-search-items quick-search-items--empty"},(0,f.dW)("quick_search.result.empty",{mode:(0,f.dW)("quick_search.mode.beatmapset")})):re.createElement("div",{className:"quick-search-items"},this.props.worker.searchResult.user.users.map(((t,e)=>re.createElement("div",{key:t.id,className:"quick-search-items__item","data-index":e,"data-section":"user",onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},re.createElement(Wr,{modifiers:this.boxIsActive("user",e)?["active"]:[],user:t})))),this.count("user")>this.props.worker.searchResult.user.users.length&&re.createElement("div",{className:"quick-search-items__item","data-section":"user_others",onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},this.renderResultLink("user",this.boxIsActive("user_others",0))))}selectBox(t,e=0){this.props.worker.setSelected(t,e)}};Zr=Fr([vr.Pi],Zr);const Hr=Zr;var $r=r(9003),Jr=r(9755),Gr=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};let Xr=class extends re.Component{constructor(){super(...arguments),Object.defineProperty(this,"formRef",{enumerable:!0,configurable:!0,writable:!0,value:re.createRef()}),Object.defineProperty(this,"searchPath",{enumerable:!0,configurable:!0,writable:!0,value:(0,m.B)("search",void 0,!1)}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{open:!1}}),Object.defineProperty(this,"toggle",{enumerable:!0,configurable:!0,writable:!0,value:t=>{null!=M.Z.currentUser&&(null!=t&&t.preventDefault(),this.isSearchPage?Jr(".js-search--input").focus():this.setState({open:!this.state.open}))}})}get isSearchPage(){return(0,p.JJ)().pathname===this.searchPath}componentDidUpdate(t,e){var r;!e.open&&this.state.open&&(null===(r=this.formRef.current)||void 0===r||r.focus())}render(){let t="nav2__menu-link-main nav2__menu-link-main--search";return(this.state.open||(0,p.JJ)().pathname===(0,m.B)("search",void 0,!1))&&(t+=" u-section--bg-normal"),re.createElement(re.Fragment,null,re.createElement("a",{className:t,href:(0,m.B)("search"),onClick:this.toggle},re.createElement("span",{className:"fas fa-search"})),this.renderModal())}renderModal(){return!this.state.open||this.isSearchPage?null:re.createElement($r.Z,{onClose:this.toggle},re.createElement(Hr,{ref:this.formRef,onClose:this.toggle,worker:this.props.worker}))}};Xr=Gr([vr.Pi],Xr);const Kr=Xr;var Qr=r(7018),Yr=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};const ti={id:null,text:(0,f.dW)("rankings.countries.all")};let ei=class extends re.Component{get items(){return[ti,...this.props.items.sort(((t,e)=>{var r,i;return(null===(r=M.Z.currentUser)||void 0===r?void 0:r.country_code)===t.id?-1:(null===(i=M.Z.currentUser)||void 0===i?void 0:i.country_code)===e.id?1:t.text.localeCompare(e.text)}))]}constructor(t){super(t),Object.defineProperty(this,"handleRenderOption",{enumerable:!0,configurable:!0,writable:!0,value:t=>re.createElement("a",{key:t.option.id,className:t.cssClasses,href:(0,S.bj)(null,{country:t.option.id,page:null}),onClick:t.onClick},t.children)}),Object.defineProperty(this,"onChange",{enumerable:!0,configurable:!0,writable:!0,value:t=>{(0,p.c4)((0,S.bj)(null,{country:t.id,page:null}))}}),(0,l.rC)(this)}render(){var t;return re.createElement("div",{className:"ranking-filter ranking-filter--full"},re.createElement("div",{className:"ranking-filter__title"},(0,f.dW)("rankings.countries.title")),re.createElement(Qr.Z,{modifiers:"ranking",onChange:this.onChange,options:this.items,renderOption:this.handleRenderOption,selected:null!==(t=this.props.current)&&void 0!==t?t:ti}))}};Yr([l.Fl],ei.prototype,"items",null),ei=Yr([vr.Pi],ei);const ri=ei;var ii=r(2873);const ni=["all","friends"];class si extends re.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"onChange",{enumerable:!0,configurable:!0,writable:!0,value:t=>{(0,p.c4)((0,S.bj)(null,{filter:t.currentTarget.dataset.value,page:null}))}})}render(){var t;return re.createElement("div",{className:"ranking-filter"},re.createElement("div",{className:"ranking-filter__title"},(0,f.dW)("rankings.filter.title")),re.createElement(ii.P,{currentValue:null!==(t=this.props.current)&&void 0!==t?t:"all",onChange:this.onChange,showTitle:!1,values:ni}))}}class oi extends re.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"onChange",{enumerable:!0,configurable:!0,writable:!0,value:t=>{(0,p.c4)((0,S.bj)(null,{page:null,variant:t.currentTarget.dataset.value}))}})}render(){var t;return re.createElement("div",{className:"ranking-filter"},re.createElement("div",{className:"ranking-filter__title"},(0,f.dW)("rankings.filter.variant.title")),re.createElement(ii.P,{currentValue:null!==(t=this.props.current)&&void 0!==t?t:"all",onChange:this.onChange,showTitle:!1,transPrefix:`beatmaps.variant.${this.props.current_ruleset}.`,values:this.props.items}))}}function ai(t){return(0,S.bj)(null,{spotlight:t.toString()})}class li extends re.PureComponent{render(){return re.createElement(Qr.Z,{modifiers:"spotlight",onChange:this.handleChange,options:this.props.options,renderOption:this.renderOption,selected:this.props.selected})}handleChange(t){(0,p.c4)(ai(t.id))}renderOption({children:t,cssClasses:e,onClick:r,option:i}){return re.createElement("a",{key:i.id,className:e,href:ai(i.id),onClick:r},t)}}var ui=r(4888),ci=r(7762),hi=r(8259),di=r(2094),pi=r(9755);const mi="qtip--user-card";let fi,gi,vi=!1;function bi(t){const e=t.dataset.userId;t._tooltip=e;const r=function(){if(null==gi){const t=document.createElement("div");t.innerHTML=(0,ci.renderToStaticMarkup)(re.createElement(ui.O,null));const e=t.children[0];if(!(e instanceof HTMLElement))throw new Error("expected render of UserCard to be HTMLElement but got something else");gi=e}return gi}().cloneNode(!0);r.classList.remove("js-react--user-card"),r.classList.add("js-react--user-card-tooltip"),r.dataset.lookup=e,null!=t.dataset.tooltipPosition&&(r.dataset.tooltipPosition=t.dataset.tooltipPosition),pi(t).qtip(function(t){var e;const r=null!==(e=t.dataset.tooltipPosition)&&void 0!==e?e:"right center";return{content:{text:t},events:{render:M.Z.reactTurbolinks.boot,show:Ci},hide:{delay:220,effect:Ei,fixed:!0},position:{adjust:{scroll:!1},at:r,my:yi(r),viewport:pi(window)},show:{delay:200,effect:xi,ready:!0},style:{classes:mi,def:!1,tip:!1}}}(r))}function yi(t){switch(t){case"top center":return"bottom center";case"top right":return"bottom left";case"left center":return"right center";case"bottom center":return"top center"}return"left center"}function wi(){vi=!1,fi=null}function ki(){vi=!0}function ji(){vi=!1}function _i(t){var e,r;if(null!=fi)return;if(M.Z.windowSize.isMobile)return;const i=t.currentTarget,n=(0,A.G)(i.dataset.userId);if(null!=n&&!xe.find(null!==(r=null===(e=M.Z.currentUser)||void 0===e?void 0:e.blocks)&&void 0!==r?r:[],{target_id:parseInt(n,10)})){if(null==i._tooltip)return bi(i);if(i._tooltip!==i.dataset.userId){const t=pi(i).qtip("api");if(null!=t){const e=t.tooltip;if(null!=e){const t=e.querySelector(".js-react--user-card-tooltip");null!=t&&(0,ue.unmountComponentAtNode)(t)}t.destroy(),delete i._tooltip}}}}function xi(){pi(this).fadeTo(110,1)}function Ei(){pi(this).fadeTo(110,0)}function Pi(t,e){if(null==e)return;const r=e.dataset.hasqtip;if(null==r)return;const i=document.getElementById(`qtip-${r}`);if(null==i)return;const n=pi(i).qtip("api");if(null!=n){const t=i.querySelector(".js-react--user-card-tooltip");null!=t&&(0,ue.unmountComponentAtNode)(t),setTimeout((()=>{n.destroy(!0),delete e._tooltip}),0)}}function Ci(t,e){if(null!=fi||M.Z.windowSize.isMobile)return t.preventDefault();const r=e.target[0];r._tooltip!==r.dataset.userId&&(t.preventDefault(),pi(r).trigger("mouseover"))}class Si extends re.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"contextActiveKeyDidChange",{enumerable:!0,configurable:!0,writable:!0,value:hi.Gw.bind(this)}),Object.defineProperty(this,"activeKeyDidChange",{enumerable:!0,configurable:!0,writable:!0,value:t=>{fi=t,this.contextActiveKeyDidChange(t),null!=t||vi||pi(`.${mi}`).qtip("hide")}})}componentDidMount(){this.getUser().then((t=>{this.setState({user:t})}))}getUser(){const t=(0,m.B)("users.card",{user:this.props.lookup});return pi.ajax({dataType:"json",type:"GET",url:t})}render(){const t=this.state.activeKey===this.props.lookup;return re.createElement(di.d.Provider,{value:this.props.container},re.createElement(hi.Xl.Provider,{value:{activeKeyDidChange:this.activeKeyDidChange}},re.createElement(hi.XI.Provider,{value:this.props.lookup},re.createElement(ui.O,{activated:t,user:this.state.user}))))}}var Ti=r(8293),Oi=r(2918),Mi=r(9755),Li=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};class Ni{get isSuggestionsVisible(){return this.shouldShowSuggestions&&this.suggestions.length>0}get selectedItem(){return this.suggestions[this.selectedIndex]}get displayText(){return null==this.selectedItem?this.query:this.selectedItem.title}constructor(){Object.defineProperty(this,"selectedIndex",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"shouldShowSuggestions",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"suggestions",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"debouncedFetchSuggestions",{enumerable:!0,configurable:!0,writable:!0,value:(0,xe.debounce)((()=>this.fetchSuggestions()),200)}),Object.defineProperty(this,"query",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),(0,l.rC)(this)}cancel(){var t;null===(t=this.xhr)||void 0===t||t.abort(),this.debouncedFetchSuggestions.cancel()}search(){const t=this.displayText.trim();t.length&&Oi.visit((0,m.B)("search",{mode:"wiki_page",query:t}))}selectIndex(t){return t<-1?this.selectIndex(this.suggestions.length-1):t>=this.suggestions.length?this.selectIndex(-1):(this.selectedIndex=t,void(this.shouldShowSuggestions=!0))}shiftSelectedIndex(t){this.selectIndex(this.selectedIndex+t)}unselect(t){this.selectIndex(-1),this.shouldShowSuggestions=this.shouldShowSuggestions&&!t}updateQuery(t){var e;const r=t.trim(),i=this.query.trim();this.query=t,this.selectedIndex=-1,i!==r&&(null===(e=this.xhr)||void 0===e||e.abort(),r.length>1?this.debouncedFetchSuggestions():this.suggestions.length=0)}fetchSuggestions(){this.xhr=Mi.getJSON((0,m.B)("wiki-suggestions"),{query:this.query.trim()}).done((0,l.aD)((t=>{null!=t&&(this.suggestions=(0,l.LO)(t),this.shouldShowSuggestions=!0)})))}}Li([l.LO],Ni.prototype,"selectedIndex",void 0),Li([l.LO],Ni.prototype,"shouldShowSuggestions",void 0),Li([l.LO],Ni.prototype,"suggestions",void 0),Li([l.LO],Ni.prototype,"query",void 0),Li([l.Fl],Ni.prototype,"isSuggestionsVisible",null),Li([l.Fl],Ni.prototype,"selectedItem",null),Li([l.Fl],Ni.prototype,"displayText",null),Li([l.aD],Ni.prototype,"cancel",null),Li([l.aD],Ni.prototype,"search",null),Li([l.aD],Ni.prototype,"selectIndex",null),Li([l.aD],Ni.prototype,"shiftSelectedIndex",null),Li([l.aD],Ni.prototype,"unselect",null),Li([l.aD],Ni.prototype,"updateQuery",null),Li([l.aD],Ni.prototype,"fetchSuggestions",null);var Di=r(9755),Bi=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};let Ri=class extends re.Component{constructor(){super(...arguments),Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:new Ni}),Object.defineProperty(this,"keepSelectionInView",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:re.createRef()}),Object.defineProperty(this,"handleChange",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.controller.updateQuery(t.target.value)}}),Object.defineProperty(this,"handleEsc",{enumerable:!0,configurable:!0,writable:!0,value:t=>{"Escape"===t.key&&this.controller.unselect(!0)}}),Object.defineProperty(this,"handleKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:t=>{const e=t.key;"Enter"===e?null==this.controller.selectedItem?this.handleSearch():(0,p.c4)((0,S.dP)(this.controller.selectedItem.path)):"ArrowUp"!==e&&"ArrowDown"!==e||(this.keepSelectionInView=!0,this.controller.shiftSelectedIndex("ArrowDown"===e?1:-1))}}),Object.defineProperty(this,"handleMouseDown",{enumerable:!0,configurable:!0,writable:!0,value:t=>{null!=this.ref.current&&(t.composedPath().includes(this.ref.current)||this.controller.unselect(!0))}}),Object.defineProperty(this,"handleMouseLeave",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.controller.unselect(!1)}}),Object.defineProperty(this,"handleSearch",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.controller.search()}}),Object.defineProperty(this,"handleSuggestionMouseEnter",{enumerable:!0,configurable:!0,writable:!0,value:t=>{var e;this.keepSelectionInView=!1,this.controller.selectIndex(parseInt(null!==(e=t.currentTarget.dataset.index)&&void 0!==e?e:"",10))}})}componentDidMount(){document.addEventListener("keydown",this.handleEsc),document.addEventListener("mousedown",this.handleMouseDown)}componentDidUpdate(){var t;this.keepSelectionInView&&(null===(t=Di(".wiki-search__suggestion--active")[0])||void 0===t||t.scrollIntoView({block:"nearest",inline:"nearest"}),this.keepSelectionInView=!1)}componentWillUnmount(){document.removeEventListener("keydown",this.handleEsc),document.removeEventListener("mousedown",this.handleMouseDown),this.controller.cancel()}render(){return re.createElement("div",{className:"wiki-search"},re.createElement("div",{className:"wiki-search__bar"},re.createElement("input",{autoFocus:!0,className:"wiki-search__input",onChange:this.handleChange,onKeyDown:this.handleKeyDown,placeholder:(0,f.dW)("common.input.search"),value:this.controller.displayText}),re.createElement("button",{className:"wiki-search__button",onClick:this.handleSearch},re.createElement("i",{className:"fa fa-search"}))),this.renderSuggestions())}renderSuggestions(){return this.controller.isSuggestionsVisible?re.createElement("div",{ref:this.ref,className:"wiki-search__suggestions u-fancy-scrollbar",onMouseLeave:this.handleMouseLeave},this.controller.suggestions.map(((t,e)=>re.createElement("a",{key:e,className:(0,It.sb)("wiki-search__suggestion",{active:this.controller.selectedIndex===e}),"data-index":e,href:(0,S.dP)(t.path),onMouseEnter:this.handleSuggestionMouseEnter},re.createElement("span",{dangerouslySetInnerHTML:{__html:t.highlight}}))))):null}};Ri=Bi([vr.Pi],Ri);var Ii=r(8050),qi=r(6160),Ai=r(2903),zi=r(8035),Ui=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};let Wi=class extends re.Component{get links(){return this.typeNames.map((t=>({title:(0,f.dW)(`notifications.filters.${null!=t?t:"_"}`),type:t})))}constructor(t){var e;super(t),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{hasError:!1}}),Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:new qi.Z(M.Z.dataStore.notificationStore,{excludes:this.props.excludes,isWidget:!0},null!==(e=this.props.only)&&void 0!==e?e:null)}),Object.defineProperty(this,"typeNames",{enumerable:!0,configurable:!0,writable:!0,value:Tr.O3.filter((t=>!this.props.excludes.includes(t)))}),Object.defineProperty(this,"handleFilterClick",{enumerable:!0,configurable:!0,writable:!0,value:t=>{var e;const r=null!==(e=t.currentTarget.dataset.type)&&void 0!==e?e:null;this.controller.navigateTo(r)}}),Object.defineProperty(this,"handleMarkAsRead",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.controller.markCurrentTypeAsRead()}}),Object.defineProperty(this,"handleShowMore",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.controller.loadMore()}}),Object.defineProperty(this,"renderFilter",{enumerable:!0,configurable:!0,writable:!0,value:t=>{const e=this.controller.getType(t.type),r=t.type===this.controller.currentFilter;if(null!==e.name&&e.isEmpty&&!r)return null;const i={"data-type":t.type},n=r?["active"]:[];return re.createElement("button",Object.assign({key:t.title,className:(0,It.sb)("notification-popup__filter",n),onClick:this.handleFilterClick},i),re.createElement("span",{className:"notification-popup__filter-count"},this.controller.getTotal(e)),re.createElement("span",null,t.title))}}),(0,l.rC)(this)}static getDerivedStateFromError(t){return console.error(t),{hasError:!0}}render(){var t;const e=`notification-popup u-fancy-scrollbar ${null!==(t=this.props.extraClasses)&&void 0!==t?t:""}`;return re.createElement(Ii.u.Provider,{value:{excludes:this.props.excludes,isWidget:!0}},re.createElement("div",{className:e},re.createElement("div",{className:"notification-popup__scroll-container"},this.renderFilters(),re.createElement("div",{className:"notification-popup__buttons"},this.renderHistoryLink(),re.createElement("div",{className:"notification-popup__clear-button"},this.renderMarkAsReadButton())),re.createElement("div",{className:"notification-stacks"},this.renderStacks(),this.renderShowMore()))))}renderFilters(){return null==this.props.only&&M.Z.notificationsWorker.hasData?re.createElement("div",{className:"notification-popup__filters"},this.links.map(this.renderFilter)):null}renderHistoryLink(){var t;const e="channel"===this.props.only?"chat.index":"notifications.index";return re.createElement("a",{className:"notification-popup__filter",href:(0,m.B)(e)},(0,f.dW)(`notifications.see_${null!==(t=this.props.only)&&void 0!==t?t:"all"}`))}renderMarkAsReadButton(){var t;const e=this.controller.type;return e.isEmpty?null:re.createElement(Ai.Z,{isMarkingAsRead:this.controller.isMarkingCurrentTypeAsRead,onMarkAsRead:this.handleMarkAsRead,text:(0,f.dW)("notifications.mark_read",{type:(0,f.dW)(`notifications.action_type.${null!==(t=e.name)&&void 0!==t?t:"_"}`)})})}renderShowMore(){const t=this.controller.type;return re.createElement(Cr.Z,{callback:this.handleShowMore,hasMore:null==t?void 0:t.hasMore,loading:null==t?void 0:t.isLoading,modifiers:["notification-group","notification-list"]})}renderStacks(){if(this.state.hasError)return;const t=this.controller.stacks.map((t=>re.createElement(zi.Z,{key:t.id,stack:t})));if(0===t.length){let t="notifications.loading";return M.Z.notificationsWorker.hasData?t=null==this.controller.currentFilter?"notifications.all_read":"notifications.none":M.Z.notificationsWorker.waitingVerification&&(t="notifications.verifying"),re.createElement("p",{key:"empty",className:"notification-popup__empty"},(0,f.dW)(t))}return t}};Object.defineProperty(Wi,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{excludes:[]}}),Ui([l.Fl],Wi.prototype,"links",null),Wi=Ui([vr.Pi],Wi);const Fi=Wi;var Vi=r(9755),Zi=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};const Hi=["user","user_others","beatmapset","beatmapset_others","others"],$i=["forum_post","wiki_page"];class Ji{constructor(){Object.defineProperty(this,"debouncedSearch",{enumerable:!0,configurable:!0,writable:!0,value:(0,xe.debounce)((()=>this.search()),500)}),Object.defineProperty(this,"query",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"searching",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"searchResult",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"selected",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),(0,l.rC)(this)}cycleSelectedItem(t){let e;if(this.selected)e=Object.assign({},this.selected),e.index+=t;else if(t>0)e={index:0,section:0};else{const t=Hi.length-1,r=Hi[t];e={index:this.sectionLength(r)-1,section:t}}if(e.index<0||e.index>=this.sectionLength(Hi[e.section])){let r=e.section;do{if(r=(r+t)%Hi.length,r<0&&(r=Hi.length+r),r===e.section)return}while(0===this.sectionLength(Hi[r]));e={index:t>0?0:this.sectionLength(Hi[r])-1,section:r}}this.selected=e}get currentSection(){if(this.selected)return Hi[this.selected.section]}get selectedURL(){var t,e;const r=this.searchResult;if(this.selected&&r)switch(Hi[this.selected.section]){case"user":{const e=null===(t=r.user.users[this.selected.index])||void 0===t?void 0:t.id;return e?(0,m.B)("users.show",{user:e}):void 0}case"user_others":return(0,m.B)("search",{mode:"user",query:this.query});case"beatmapset":{const t=null===(e=r.beatmapset.beatmapsets[this.selected.index])||void 0===e?void 0:e.id;return t?(0,m.B)("beatmapsets.show",{beatmapset:t}):void 0}case"beatmapset_others":return(0,m.B)("search",{mode:"beatmapset",query:this.query});case"others":{const t=$i.filter((t=>r[t].total>0))[this.selected.index];return(0,m.B)("search",{mode:t,query:this.query})}}}search(){const t=this.query.trim();0!==t.length?(this.searching=!0,this.xhr=Vi.get((0,m.B)("quick-search"),{query:t}).done((0,l.aD)((t=>{this.searchResult=t,this.selected=null}))).always((0,l.aD)((()=>{this.searching=!1})))):this.reset()}selectNone(){this.selected=null}setSelected(t,e){this.selected={index:e,section:Hi.indexOf(t)}}updateQuery(t){this.query=t,this.selected=null,this.debouncedSearch()}reset(){this.debouncedSearch.cancel(),null!=this.xhr&&this.xhr.abort(),this.searching=!1,this.searchResult=null,this.selected=null}sectionLength(t){const e=this.searchResult;if(!e)return 0;switch(t){case"user":return e.user.users.length;case"user_others":return e.user.total>e.user.users.length?1:0;case"beatmapset":return e.beatmapset.beatmapsets.length;case"beatmapset_others":return 1;case"others":return $i.filter((t=>e[t].total>0)).length}return 0}}Zi([l.LO],Ji.prototype,"query",void 0),Zi([l.LO],Ji.prototype,"searching",void 0),Zi([l.LO],Ji.prototype,"searchResult",void 0),Zi([l.LO],Ji.prototype,"selected",void 0),Zi([l.aD],Ji.prototype,"cycleSelectedItem",null),Zi([l.Fl],Ji.prototype,"currentSection",null),Zi([l.Fl],Ji.prototype,"selectedURL",null),Zi([l.aD],Ji.prototype,"search",null),Zi([l.aD],Ji.prototype,"selectNone",null),Zi([l.aD],Ji.prototype,"setSelected",null),Zi([l.aD],Ji.prototype,"updateQuery",null),Zi([l.aD],Ji.prototype,"reset",null);var Gi=r(9755),Xi=function(t,e,r,i){var n,s=arguments.length,o=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(s<3?n(o):s>3?n(e,r,o):n(e,r))||o);return s>3&&o&&Object.defineProperty(e,r,o),o};const Ki="json-store-supporter-tag",Qi=[1,2,4,6,12,18,24];let Yi=class extends re.Component{get cost(){return Math.floor(this.sliderValue)}get discount(){if(this.duration>=12)return 46;const t=100*(1-this.cost/this.duration/4);return Math.max(0,Math.round(t))}get duration(){switch(!0){case this.cost>=26:return Math.floor(this.cost/26*12);case this.cost>=24:return 10;case this.cost>=22:return 9;case this.cost>=20:return 8;case this.cost>=16:return 6;case this.cost>=12:return 4;case this.cost>=8:return 2;case this.cost>=4:return 1;default:return 0}}get durationInYears(){return{months:Math.floor(this.duration%12),years:Math.floor(this.duration/12)}}get durationText(){const t=this.durationInYears,e=[];return t.years>0&&e.push((0,f.jn)("common.count.years",t.years)),t.months>0&&e.push((0,f.jn)("common.count.months",t.months)),e.join(", ")}get isGiftingSelf(){var t;return null!=this.user&&this.user.id===(null===(t=M.Z.currentUser)||void 0===t?void 0:t.id)}get isValidUser(){return null!=this.user&&Number.isFinite(this.user.id)&&this.user.id>0}constructor(t){var e;super(t),Object.defineProperty(this,"debouncedGetUser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"giftMessageRef",{enumerable:!0,configurable:!0,writable:!0,value:re.createRef()}),Object.defineProperty(this,"savedGiftMessage",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"sliderRef",{enumerable:!0,configurable:!0,writable:!0,value:re.createRef()}),Object.defineProperty(this,"sliderValue",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"username",{enumerable:!0,configurable:!0,writable:!0,value:null!==(e=(0,p.Kn)().get("target"))&&void 0!==e?e:""}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"getUser",{enumerable:!0,configurable:!0,writable:!0,value:t=>{this.xhr=Gi.ajax({data:{username:t},dataType:"json",type:"POST",url:(0,m.B)("users.check-username-exists")}),this.xhr.done((t=>(0,l.z)((()=>{this.user=t})))).fail(j.qQ).always((()=>{this.xhr=null}))}}),Object.defineProperty(this,"handleBeforeCache",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var t,e;(0,$.Cw)(Ki,{savedGiftMessage:null!==(e=null===(t=this.giftMessageRef.current)||void 0===t?void 0:t.value)&&void 0!==e?e:"",sliderValue:this.sliderValue,username:this.username})}}),Object.defineProperty(this,"handlePresetClick",{enumerable:!0,configurable:!0,writable:!0,value:t=>{var e,r;const i=function(t){switch(!0){case t>=12:return Math.ceil(t/12*26);case 10===t:return 24;case 9===t:return 22;case 8===t:return 20;case 6===t:return 16;case 4===t:return 12;case 2===t:return 8;case 1===t:return 4}}(+(null!==(r=null===(e=t.currentTarget.dataset)||void 0===e?void 0:e.months)&&void 0!==r?r:0));null!=i&&null!=this.sliderRef.current&&Gi(this.sliderRef.current).slider("value",i)}}),Object.defineProperty(this,"handleSliderValueChanged",{enumerable:!0,configurable:!0,writable:!0,value:(t,e)=>{null!=e.value&&(this.sliderValue=e.value)}}),Object.defineProperty(this,"handleUsernameChange",{enumerable:!0,configurable:!0,writable:!0,value:t=>{var e;this.username=t.currentTarget.value,this.debouncedGetUser.cancel(),null===(e=this.xhr)||void 0===e||e.abort(),""===this.username?this.user=M.Z.currentUserOrFail:(this.user=null,this.debouncedGetUser(this.username))}}),this.debouncedGetUser=(0,xe.debounce)(this.getUser,300),document.addEventListener("turbolinks:before-cache",this.handleBeforeCache),(0,l.rC)(this);const r=(0,$.Um)(Ki,!0);null!=r&&(this.savedGiftMessage=r.savedGiftMessage,this.sliderValue=r.sliderValue,this.username=r.username),""!==this.username?(this.user=null,this.debouncedGetUser(this.username)):this.user=M.Z.currentUserOrFail,(0,vr.b4)(this,(0,l.EH)((()=>{g(this.isValidUser),null!=this.sliderRef.current&&Gi(this.sliderRef.current).slider({disabled:!this.isValidUser})})))}componentDidMount(){this.initializeSlider()}componentWillUnmount(){var t;document.removeEventListener("turbolinks:before-cache",this.handleBeforeCache),null===(t=this.xhr)||void 0===t||t.abort()}render(){var t;return re.createElement("div",{className:"store-supporter-tag"},re.createElement("input",{defaultValue:this.cost,id:"supporter-tag-form-price",name:"item[cost]",type:"hidden"}),re.createElement("input",{defaultValue:null===(t=this.user)||void 0===t?void 0:t.id,name:"item[extra_data][target_id]",type:"hidden"}),re.createElement("div",{className:"store-supporter-tag__user-search"},re.createElement(ui.O,{user:this.user}),re.createElement("input",{autoComplete:"off",className:"store-supporter-tag__input",id:"username",name:"item[extra_data][username]",onChange:this.handleUsernameChange,placeholder:(0,f.dW)("store.supporter_tag.gift"),value:this.username}),re.createElement("div",{"data-visibility":!this.isValidUser||this.isGiftingSelf?"hidden":"visible"},re.createElement("textarea",{ref:this.giftMessageRef,className:"store-supporter-tag__input store-supporter-tag__input--message",defaultValue:this.savedGiftMessage,maxLength:this.props.maxMessageLength,name:"item[extra_data][message]",placeholder:(0,f.dW)("store.supporter_tag.gift_message",{length:this.props.maxMessageLength}),rows:3}))),re.createElement("div",{className:"store-slider"},re.createElement("div",{ref:this.sliderRef,className:`${(0,It.sb)("ui-slider",{disabled:!this.isValidUser})} ui-slider-horizontal`},re.createElement("div",{className:"ui-slider-handle"},re.createElement("div",{className:"store-slider__fake-callout"},re.createElement("div",{className:"store-slider__callout"},re.createElement("div",{className:"store-slider__bigtext"},"USD ",this.cost),re.createElement("div",null,this.durationText),re.createElement("div",{className:"store-slider__subtext"},(0,f.dW)("store.discount",{percent:this.discount})))))),re.createElement("div",{className:"store-slider__presets"},re.createElement("span",{className:"store-slider__presets-blurb"},(0,f.dW)("supporter_tag.months")),Qi.map((t=>re.createElement("div",{key:t,className:(0,It.sb)("store-slider__preset",{active:this.duration>=t,disabled:!this.isValidUser}),"data-months":t,onClick:this.handlePresetClick},t))))))}initializeSlider(){const t=this.sliderRef.current;if(null!=t)return Gi(t).slider({animate:!0,change:this.handleSliderValueChanged,max:52,min:4,range:"min",slide:this.handleSliderValueChanged,step:.125,value:this.sliderValue})}};Xi([l.LO],Yi.prototype,"sliderValue",void 0),Xi([l.LO],Yi.prototype,"user",void 0),Xi([l.LO],Yi.prototype,"username",void 0),Xi([l.Fl],Yi.prototype,"cost",null),Xi([l.Fl],Yi.prototype,"duration",null),Xi([l.aD],Yi.prototype,"getUser",void 0),Xi([l.aD],Yi.prototype,"handleSliderValueChanged",void 0),Xi([l.aD],Yi.prototype,"handleUsernameChange",void 0),Yi=Xi([vr.Pi],Yi);const tn=Yi;var en=r(3317),rn=r(1327),nn=r(9755);function sn(t){return JSON.parse(null!=t?t:"")}function on(t){if(null==t)throw new Error("unexpected undefined value");return t}M.Z.reactTurbolinks.register("countdownTimer",(t=>re.createElement(Er,{deadline:on(t.dataset.deadline)}))),M.Z.reactTurbolinks.register("blockButton",(t=>re.createElement(gr.Z,{userId:parseInt(on(t.dataset.target),10)}))),M.Z.reactTurbolinks.register("beatmap-discussion-events",(()=>{const t={events:(0,$.Mo)("json-events"),mode:"list",users:(0,en.e)((0,$.Mo)("json-users"),"id")};return re.createElement(fr.Z,Object.assign({},t))})),M.Z.reactTurbolinks.register("beatmapset-panel",(t=>{const e=sn(t.dataset.beatmapsetPanel);return re.createElement(pr.Z,Object.assign({},(0,l.LO)(e)))})),M.Z.reactTurbolinks.register("basic-select-options",(()=>re.createElement(mr.Z,Object.assign({},(0,$.Mo)("json-basic-select-options"))))),M.Z.reactTurbolinks.register("spotlight-select-options",(()=>re.createElement(li,Object.assign({},(0,$.Mo)("json-spotlight-select-options"))))),M.Z.reactTurbolinks.register("chat-icon",(t=>re.createElement(kr,{type:t.dataset.type}))),M.Z.reactTurbolinks.register("main-notification-icon",(t=>re.createElement(Lr,{type:t.dataset.type}))),M.Z.reactTurbolinks.register("notification-widget",(t=>re.createElement(Fi,Object.assign({},sn(t.dataset.notificationWidget)))));const an=new Ji;M.Z.reactTurbolinks.register("quick-search",(()=>re.createElement(Hr,{worker:an}))),M.Z.reactTurbolinks.register("quick-search-button",(()=>re.createElement(Kr,{worker:an}))),M.Z.reactTurbolinks.register("ranking-country-filter",(()=>re.createElement(ri,Object.assign({},(0,$.Mo)("json-country-filter"))))),M.Z.reactTurbolinks.register("ranking-user-filter",(()=>re.createElement(si,Object.assign({},(0,$.Mo)("json-user-filter"))))),M.Z.reactTurbolinks.register("ranking-variant-filter",(()=>re.createElement(oi,Object.assign({},(0,$.Mo)("json-variant-filter"))))),M.Z.reactTurbolinks.register("store-supporter-tag",(t=>{const e=(0,rn.w)(t.dataset.maxMessageLength);if(null==e)throw new Error("missing maxMessageLength");return re.createElement(tn,{maxMessageLength:e})})),M.Z.reactTurbolinks.register("user-card",(t=>{var e,r;return re.createElement(ui.O,{modifiers:sn(null!==(e=t.dataset.modifiers)&&void 0!==e?e:"null"),user:"1"===t.dataset.isCurrentUser?M.Z.currentUser:sn(null!==(r=t.dataset.user)&&void 0!==r?r:"null")})})),M.Z.reactTurbolinks.register("user-card-tooltip",(t=>re.createElement(Si,{container:t,lookup:on(t.dataset.lookup)}))),nn(document).ready((function(){pi(document).on("mouseover",".js-usercard",_i),pi(document).on("mouseenter",".js-react--user-card-tooltip",ki),pi(document).on("mouseleave",".js-react--user-card-tooltip",ji),pi(document).on("turbolinks:before-cache",wi),pi.subscribe("user-card:remove.tooltip",Pi)})),M.Z.reactTurbolinks.register("user-cards",(t=>{var e,r;return re.createElement(Ti.G,{modifiers:sn(null!==(e=t.dataset.modifiers)&&void 0!==e?e:"null"),users:sn(null!==(r=t.dataset.users)&&void 0!==r?r:"[]"),viewMode:"card"})})),M.Z.reactTurbolinks.register("wiki-search",(()=>re.createElement(Ri,null))),M.Z.reactTurbolinks.register("landing-news",(()=>re.createElement(Sr,{posts:(0,$.Mo)("json-posts")})))}},t=>{var e=e=>t(t.s=e);t.O(0,[736,351],(()=>(e(2353),e(4200))));t.O()}]);
//# sourceMappingURL=app.8c747b61.js.map