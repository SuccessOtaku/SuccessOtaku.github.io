"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[351],{2858:(e,t,s)=>{s.d(t,{Z:()=>f});var r,a=s(7294),i=s(2278),n=s(3336),o=s(5076),l=s(1270),c=s(6486);a.createElement,r={add:"fas fa-plus",fix:"fas fa-check",misc:"far fa-circle"};var u,d=function(e){var t,s;return t=e.entry,s=c.escape(t.title).replace(/(`+)([^`]+)\1/g,"<code>$2</code>"),(0,i.div)({className:"changelog-entry",key:t.id},(0,i.div)({className:"changelog-entry__row"},(0,i.div)({className:"changelog-entry__title "+(t.major?"changelog-entry__title--major":"")},(0,i.span)({className:"changelog-entry__title-icon"},(0,i.span)({className:"changelog-entry__icon "+r[t.type]})),null!=t.url?(0,i.a)({href:t.url,className:"changelog-entry__link",dangerouslySetInnerHTML:{__html:s}}):(0,i.span)({dangerouslySetInnerHTML:{__html:s}}),null!=t.github_url?(0,i.span)(null," (",(0,i.a)({className:"changelog-entry__link",href:t.github_url},t.repository.replace(/^.*\//,"")+"#"+t.github_pull_request_id),")"):void 0,function(){var e,s,r,a,n;return n=c.escape(t.github_user.display_name),e=null!=(a=null!=(s=t.github_user.github_url)?s:t.github_user.user_url)?"<a data-user-id='"+(null!=(r=t.github_user.user_id)?r:"")+"' class='changelog-entry__user-link js-usercard' href='"+c.escape(a)+"' >"+n+"</a>":n,(0,i.span)({className:"changelog-entry__user",dangerouslySetInnerHTML:{__html:(0,l.dW)("changelog.entry.by",{user:e})}})}())),null!=t.message_html?(0,i.div)({className:"changelog-entry__row changelog-entry__row--message",dangerouslySetInnerHTML:{__html:t.message_html}}):void 0)},p=s(6486),m=s(381),h=function(e,t){return function(){return e.apply(t,arguments)}},b={}.hasOwnProperty;u=a.createElement;var f=function(e){function t(){return this.renderNav=h(this.renderNav,this),this.render=h(this.render,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var s in t)b.call(t,s)&&(e[s]=t[s]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.render=function(){var e,t,s,r,a,l,c;return e=(0,n.sb)("build",this.props.modifiers),r=p.groupBy(this.props.build.changelog_entries,"category"),t=p(r).keys().sort().value(),(0,i.div)({className:e+" t-changelog-stream--"+p.kebabCase(this.props.build.update_stream.display_name)},(0,i.div)({className:"build__version"},this.renderNav({version:"previous",icon:"fas fa-chevron-left"}),(0,i.a)({className:"build__version-link",href:(0,o.TR)(this.props.build)},(0,i.span)({className:"build__stream"},this.props.build.update_stream.display_name)," ",(0,i.span)({className:"u-changelog-stream--text"},this.props.build.display_version)),this.renderNav({version:"next",icon:"fas fa-chevron-right"})),null!=(l=this.props.showDate)&&l?(0,i.div)({className:"build__date"},m(this.props.build.created_at).format("LL")):void 0,null!=this.props.build.youtube_id&&null!=(c=this.props.showVideo)&&c?(0,i.div)({className:"build__video"},(0,i.iframe)({className:"u-embed-wide",allowFullScreen:!0,src:"https://www.youtube.com/embed/"+this.props.build.youtube_id+"?rel=0"})):void 0,function(){var e,n,o;for(o=[],e=0,n=t.length;e<n;e++)s=t[e],o.push((0,i.div)({key:s,className:"build__changelog-entries-container"},(0,i.div)({className:"build__changelog-entries-category"},s),(0,i.div)({className:"build__changelog-entries"},function(){var e,t,n,o,l;for(l=[],e=0,t=(n=r[s]).length;e<t;e++)a=n[e],l.push((0,i.div)({key:null!=(o=a.id)?o:a.created_at+"-"+a.title,className:"build__changelog-entry"},u(d,{entry:a})));return l}())));return o}())},t.prototype.renderNav=function(e){var t,s,r;if(r=e.version,s=e.icon,null!=this.props.build.versions)return null!=(t=this.props.build.versions[r])?(0,i.a)({className:"build__version-link",href:(0,o.TR)(t),title:t.display_version},(0,i.i)({className:s})):(0,i.span)({className:"build__version-link build__version-link--disabled"},(0,i.i)({className:s}))},t}(a.PureComponent)},735:(e,t,s)=>{s.d(t,{s:()=>d});var r=s(7294),a=s(2278),i=s(3336),n=s(1270),o=s(5076),l=s(6486),c=function(e,t){return function(){return e.apply(t,arguments)}},u={}.hasOwnProperty;r.createElement;var d=function(e){function t(){return this.renderHeaderStream=c(this.renderHeaderStream,this),this.render=c(this.render,this),t.__super__.constructor.apply(this,arguments)}return function(e,t){for(var s in t)u.call(t,s)&&(e[s]=t[s]);function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype}(t,e),t.prototype.render=function(){var e;return(0,a.div)({className:(0,i.sb)("update-streams-v2",[null!=this.props.currentStreamId?"with-active":void 0])},(0,a.div)({className:"update-streams-v2__container"},function(){var t,s,r,a;for(a=[],t=0,s=(r=this.props.updateStreams).length;t<s;t++)e=r[t],a.push(this.renderHeaderStream({stream:e}));return a}.call(this)))},t.prototype.renderHeaderStream=function(e){var t,s,r;return s=e.stream,r=l.kebabCase(s.display_name),t=(0,i.sb)("update-streams-v2__item",[r,s.is_featured?"featured":void 0,this.props.currentStreamId===s.id?"active":void 0]),t+=" t-changelog-stream--"+r,(0,a.a)({href:(0,o.TR)(s.latest_build),key:s.id,className:t},(0,a.div)({className:"update-streams-v2__bar u-changelog-stream--bg"}),(0,a.p)({className:"update-streams-v2__row update-streams-v2__row--name"},s.display_name),(0,a.p)({className:"update-streams-v2__row update-streams-v2__row--version"},s.latest_build.display_version),s.user_count>0?(0,a.p)({className:"update-streams-v2__row update-streams-v2__row--users"},(0,n.jn)("changelog.builds.users_online",s.user_count)):void 0)},t}(r.PureComponent)},8457:(e,t,s)=>{s.d(t,{O:()=>r});class r{constructor(e){Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:e})}}},8701:(e,t,s)=>{s.d(t,{Z:()=>r});class r{}},789:(e,t,s)=>{s.d(t,{Z:()=>r});class r{constructor(e){Object.defineProperty(this,"userId",{enumerable:!0,configurable:!0,writable:!0,value:e})}}},1723:(e,t,s)=>{s.d(t,{WI:()=>a,yz:()=>i});const r=new class{constructor(){Object.defineProperty(this,"listeners",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"dispatch",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.listeners.forEach((t=>{t.handleDispatchAction(e)}))}})}get size(){return this.listeners.size}clear(){this.listeners.clear()}has(e){return this.listeners.has(e)}register(e){this.listeners.add(e)}unregister(e){this.listeners.delete(e)}};const a=r.dispatch;function i(e){return class extends e{constructor(...e){var t;super(...e),"object"==typeof(t=this)&&null!=t&&"handleDispatchAction"in t&&r.register(this)}}}},382:(e,t,s)=>{s.d(t,{u:()=>r});const r=["deleted","hype","mapperNotes","mine","pending","praises","resolved","total"]},5692:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(5050),a=s(7294),i=s(7012);function n({message:e,isTimeline:t}){return t?a.createElement(r.Z,{maxLength:i.nc,message:e,modifiers:"discussion"}):null}},1480:(e,t,s)=>{s.d(t,{Z:()=>v});var r=s(3974),a=s(7294),i=s(9469),n=s(1356),o=s(3955),l=s(5305),c=s(6741),u=s(5119),d=s(8949),p=s(9323),m=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let h=class extends a.Component{constructor(e){super(e),Object.defineProperty(this,"loaded",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"handleOnLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.loaded=!0}}),(0,d.rC)(this)}render(){if(null==this.props.src)return null;const e=(0,u.B)("beatmapsets.discussions.media-url",{url:this.props.src}),t=a.createElement(a.Fragment,null,!this.loaded&&this.renderSpinner(),a.createElement("img",Object.assign({},this.props.node.properties,{loading:"lazy",onLoad:this.handleOnLoad,src:e})));return a.createElement(r.FU.Consumer,null,(({inLink:s})=>s?a.createElement("span",{className:"beatmapset-discussion-image-link"},t):a.createElement("a",{className:"beatmapset-discussion-image-link",href:e,rel:"nofollow noreferrer",target:"_blank"},t)))}renderSpinner(){return a.createElement("span",{className:"beatmapset-discussion-image-link__spinner"},a.createElement(c.$,null))}};m([d.LO],h.prototype,"loaded",void 0),m([d.aD],h.prototype,"handleOnLoad",void 0),h=m([p.Pi],h);const b=h,f=Object.freeze({a:r.fv,em:(0,r.Us)("em"),img:b,li:(0,r.Us)("li"),p:(0,r.Us)("p"),strong:(0,r.Us)("strong")});class v extends a.Component{render(){return a.createElement(i.D,{className:"osu-md osu-md--discussions",components:f,remarkPlugins:[o.Z,[l.Z,{type:this.props.type}],n.Z],transformLinkUri:r.H,unwrapDisallowed:!0},this.props.markdown)}}},1467:(e,t,s)=>{s.d(t,{_:()=>i,q:()=>r});const r=["reviews","generalAll","general","timeline","events"],a=new Set(r);function i(e){return a.has(e)}},5813:(e,t,s)=>{s.d(t,{n:()=>r,y:()=>a});const r=["hype","mapper_note","praise","problem","review","suggestion"],a={hype:"fas fa-bullhorn",mapper_note:"far fa-sticky-note",praise:"fas fa-heart",problem:"fas fa-exclamation-circle",resolved:"far fa-check-circle",review:"fas fa-tasks",suggestion:"far fa-circle"}},6835:(e,t,s)=>{s.d(t,{$:()=>Z});var r=s(6486),a=s(8949),i=s(9323),n=s(8125),o=s(5078),l=s(7294),c=s(7012),u=s(6817),d=s(3336),p=s(1270),m=s(5813),h=s(2009),b=s(5119),f=s(7762),v=s(9703),g=s(9711),y=s(9755),w=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};const _=["up","down"];let E=class extends l.Component{get canDownvote(){return null!=o.Z.currentUser&&(o.Z.currentUser.is_admin||o.Z.currentUser.is_moderator||o.Z.currentUser.is_bng)}constructor(e){super(e),Object.defineProperty(this,"tooltips",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"voteXhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"handleClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{null==this.voteXhr&&((0,g.Uq)(),this.voteXhr=y.ajax((0,b.B)("beatmapsets.discussions.vote",{discussion:this.props.discussion.id}),{data:{beatmap_discussion_vote:{score:e.currentTarget.dataset.score}},method:"PUT"}),this.voteXhr.done((e=>this.props.discussionsState.update({beatmapset:e}))).fail(v.qQ).always((0,a.aD)((()=>{(0,g.Lt)(),this.voteXhr=null}))))}}),Object.defineProperty(this,"handleHover",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;const r=e.currentTarget,a=r.dataset.type;null!==(t=(s=this.tooltips)[a])&&void 0!==t||(s[a]=(0,h.N)(r,"top center",this.getTooltipContent(a)))}}),(0,a.rC)(this)}componentDidUpdate(){var e,t;for(const s of _)null===(t=null===(e=this.tooltips[s])||void 0===e?void 0:e.qtip("api"))||void 0===t||t.set("content.text",this.getTooltipContent(s))}componentWillUnmount(){var e;null===(e=this.voteXhr)||void 0===e||e.abort()}render(){return _.map((e=>l.createElement("div",{key:e,"data-type":e,onMouseOver:this.handleHover,onTouchStart:this.handleHover},this.renderVote(e))))}getTooltipContent(e){const t=this.props.discussion.votes[e],s=t<1?(0,p.dW)(`beatmaps.discussions.votes.none.${e}`):`${(0,p.dW)(`beatmaps.discussions.votes.latest.${e}`)}:`,r=this.props.discussion.votes.voters[e].map((e=>{var t;return null!==(t=this.props.users.get(e))&&void 0!==t?t:{id:e}}));return(0,f.renderToStaticMarkup)(l.createElement(h.Z,{count:t,title:s,users:r}))}renderVote(e){var t;const[s,r]="up"===e?[1,"thumbs-up"]:[-1,"thumbs-down"],a=(null===(t=this.props.discussion.current_user_attributes)||void 0===t?void 0:t.vote_score)===s?0:s,i=null!=this.voteXhr||this.props.cannotVote||"down"===e&&!this.canDownvote;return l.createElement("button",{className:(0,d.sb)("beatmap-discussion-vote",e,{inactive:0!==a}),"data-score":a,disabled:i,onClick:this.handleClick},l.createElement("i",{className:`fas fa-${r}`}),l.createElement("span",{className:"beatmap-discussion-vote__count"},this.props.discussion.votes[e]))}};w([a.LO],E.prototype,"voteXhr",void 0),w([a.Fl],E.prototype,"canDownvote",null),w([a.aD],E.prototype,"handleClick",void 0),E=w([i.Pi],E);const P=E;var O=s(7010),j=s(2163),k=s(4929),N=s(7937),S=s(3924),C=s(5692),T=s(9755),x=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};const D="beatmap-discussion-post",R={reply:"fas fa-reply",reply_reopen:"fas fa-exclamation-circle",reply_resolve:"fas fa-check"},M={reply_reopen:!1,reply_resolve:!0};let I=class extends l.Component{get canReopen(){var e,t;return this.props.discussion.can_be_resolved&&null!==(t=null===(e=this.props.discussion.current_user_attributes)||void 0===e?void 0:e.can_reopen)&&void 0!==t&&t}get canResolve(){var e,t;return this.props.discussion.can_be_resolved&&null!==(t=null===(e=this.props.discussion.current_user_attributes)||void 0===e?void 0:e.can_resolve)&&void 0!==t&&t}get isTimeline(){return null!=this.props.discussion.timestamp}get storageKey(){return`beatmapset-discussion:reply:${this.props.discussion.id}:message`}get storedMessage(){var e;return null!==(e=localStorage.getItem(this.storageKey))&&void 0!==e?e:""}get validPost(){return(0,c.Ks)(this.message,this.isTimeline)}constructor(e){super(e),Object.defineProperty(this,"box",{enumerable:!0,configurable:!0,writable:!0,value:l.createRef()}),Object.defineProperty(this,"editing",{enumerable:!0,configurable:!0,writable:!0,value:(0,S.W)(this.storedMessage)}),Object.defineProperty(this,"handleKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:this.storedMessage}),Object.defineProperty(this,"posting",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"postXhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"startEditing",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"editStart",{enumerable:!0,configurable:!0,writable:!0,value:()=>{o.Z.userLogin.showIfGuest(this.editStart)||(this.editing=!0,this.startEditing=!0)}}),Object.defineProperty(this,"handleChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.setMessage(e.target.value)}}),Object.defineProperty(this,"handleKeyDownCallback",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{switch(e){case N.z.Cancel:this.editing=!1;break;case N.z.Submit:this.post(t)}}}),Object.defineProperty(this,"onCancelClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{(0,S.W)(this.message)&&!confirm((0,p.dW)("common.confirmation_unsaved"))||(this.editing=!1,this.setMessage(""))}}),Object.defineProperty(this,"post",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;if(!this.validPost||null!=this.postXhr)return;(0,g.Uq)();const s=null!==(t=e.currentTarget.dataset.action)&&void 0!==t?t:"reply";this.posting=s;const r={beatmap_discussion:{resolved:M[s]},beatmap_discussion_id:this.props.discussion.id,beatmap_discussion_post:{message:this.message}};this.postXhr=T.ajax((0,b.B)("beatmapsets.discussions.posts.store"),{data:r,method:"POST"}),this.postXhr.done((e=>(0,a.z)((()=>{this.editing=!1,this.setMessage(""),this.props.discussionsState.update(e)})))).fail(v.qQ).always((0,a.aD)((()=>{(0,g.Lt)(),this.postXhr=null,this.posting=null})))}}),(0,a.rC)(this),this.handleKeyDown=(0,N.k)(this.handleKeyDownCallback)}componentDidUpdate(e){var t;e.discussion.id===this.props.discussion.id?this.startEditing&&(this.startEditing=!1,null===(t=this.box.current)||void 0===t||t.focus()):this.message=this.storedMessage}componentWillUnmount(){var e;null===(e=this.postXhr)||void 0===e||e.abort()}render(){return this.editing?this.renderBox():this.renderPlaceholder()}renderBox(){return l.createElement("div",{className:`${D} ${D}--reply ${D}--new-reply`},this.renderCancelButton(),l.createElement("div",{className:`${D}__content`},l.createElement("div",{className:`${D}__avatar`},l.createElement(k.Z,{modifiers:"full-rounded",user:o.Z.currentUser})),l.createElement("div",{className:`${D}__message-container`},l.createElement(j.Z,{className:`${D}__message ${D}__message--editor`,disabled:null!=this.posting,innerRef:this.box,onChange:this.handleChange,onKeyDown:this.handleKeyDown,placeholder:(0,p.dW)("beatmaps.discussions.reply_placeholder"),value:this.message}))),l.createElement("div",{className:`${D}__footer ${D}__footer--notice`},(0,p.dW)("beatmaps.discussions.reply_notice"),l.createElement(C.Z,{isTimeline:this.isTimeline,message:this.message})),l.createElement("div",{className:`${D}__footer`},l.createElement("div",{className:`${D}__actions`},l.createElement("div",{className:`${D}__actions-group`},this.canResolve&&!this.props.discussion.resolved&&this.renderReplyButton("reply_resolve"),this.canReopen&&this.props.discussion.resolved&&this.renderReplyButton("reply_reopen"),this.renderReplyButton("reply")))))}renderCancelButton(){return l.createElement("button",{className:`${D}__action ${D}__action--cancel`,disabled:null!=this.posting,onClick:this.onCancelClick},l.createElement("i",{className:"fas fa-times"}))}renderPlaceholder(){const[e,t,s]=null!=o.Z.currentUser?[(0,p.dW)("beatmap_discussions.reply.open.user"),"fas fa-reply",o.Z.currentUser.is_silenced]:[(0,p.dW)("beatmap_discussions.reply.open.guest"),"fas fa-sign-in-alt",!1];return l.createElement("div",{className:`${D} ${D}--reply ${D}--new-reply ${D}--new-reply-placeholder`},l.createElement(O.Z,{disabled:s,icon:t,modifiers:"beatmap-discussion-reply-open",props:{onClick:this.editStart},text:e}))}renderReplyButton(e){return l.createElement("div",{className:`${D}__action`},l.createElement(O.Z,{disabled:!this.validPost||null!=this.posting,icon:R[e],isBusy:this.posting===e,props:{"data-action":e,onClick:this.post},text:(0,p.dW)(`common.buttons.${e}`)}))}setMessage(e){this.message=e,(0,S.W)(this.message)?localStorage.setItem(this.storageKey,this.message):localStorage.removeItem(this.storageKey)}};x([a.LO],I.prototype,"box",void 0),x([a.LO],I.prototype,"editing",void 0),x([a.LO],I.prototype,"message",void 0),x([a.LO],I.prototype,"posting",void 0),x([a.aD],I.prototype,"componentDidUpdate",null),x([a.aD],I.prototype,"editStart",void 0),x([a.aD],I.prototype,"handleKeyDownCallback",void 0),x([a.aD],I.prototype,"onCancelClick",void 0),x([a.aD],I.prototype,"post",void 0),x([a.aD],I.prototype,"setMessage",null),I=x([i.Pi],I);var L=s(5989),A=s(4403),$=s(9696);function B({post:e,user:t}){"resolved"!==e.message.type&&(0,$.Q)(e.message.type);const s=(0,d.sb)("beatmap-discussion-system-post",e.message.type,{deleted:null!=e.deleted_at});return l.createElement("div",{className:s},l.createElement("div",{className:"beatmap-discussion-system-post__content"},l.createElement(A.Z,{mappings:{user:l.createElement("a",{className:"beatmap-discussion-system-post__user",href:(0,b.B)("users.show",{user:t.id})},t.username)},pattern:(0,p.dW)(`beatmap_discussions.system.resolved.${e.message.value}`)})))}var U=s(2786),F=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};const W="beatmap-discussion";function H({type:e}){const t="resolved"===e?"beatmaps.discussions.resolved":`beatmaps.discussions.message_type.${e}`;return l.createElement("span",{className:m.y[e],style:{color:`var(--beatmapset-discussion-colour--${e})`},title:(0,p.dW)(t)})}let Z=class extends l.Component{get beatmapset(){var e;return null===(e=this.props.discussionsState)||void 0===e?void 0:e.beatmapset}get currentBeatmap(){var e;return null===(e=this.props.discussionsState)||void 0===e?void 0:e.currentBeatmap}get canBeRepliedTo(){var e;return null!=this.beatmapset&&!(0,u.wm)(this.beatmapset)&&(!this.beatmapset.discussion_locked||(0,c.e7)())&&(null==this.props.discussion.beatmap_id||null==(null===(e=this.currentBeatmap)||void 0===e?void 0:e.deleted_at))}get collapsed(){var e,t,s,r;return null!==(r=null!==(t=null===(e=this.props.discussionsState)||void 0===e?void 0:e.discussionCollapsed.get(this.props.discussion.id))&&void 0!==t?t:null===(s=this.props.discussionsState)||void 0===s?void 0:s.discussionDefaultCollapsed)&&void 0!==r&&r}get highlighted(){var e;return(null===(e=this.props.discussionsState)||void 0===e?void 0:e.highlightedDiscussionId)===this.props.discussion.id}get readonly(){return null==this.props.discussionsState}get readPostIds(){var e;return null===(e=this.props.discussionsState)||void 0===e?void 0:e.readPostIds}get resolvedStateChangedPostId(){var e;if(null==this.props.discussionsState)return-1;const t=(0,r.findLast)(this.props.discussion.posts,(e=>e.system&&"resolved"===e.message.type));return null!==(e=null==t?void 0:t.id)&&void 0!==e?e:-1}get showDeleted(){var e,t;return null===(t=null===(e=this.props.discussionsState)||void 0===e?void 0:e.showDeleted)||void 0===t||t}get users(){return this.props.store.users}constructor(e){super(e),Object.defineProperty(this,"lastResolvedState",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"handleCollapseClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;null===(e=this.props.discussionsState)||void 0===e||e.discussionCollapsed.set(this.props.discussion.id,!this.collapsed)}}),Object.defineProperty(this,"handleSetHighlight",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.defaultPrevented||null==this.props.discussionsState||(this.props.discussionsState.highlightedDiscussionId=this.props.discussion.id)}}),Object.defineProperty(this,"renderReply",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(!this.isVisible(e))return null;if(e.system&&"resolved"===e.message.type){if(this.lastResolvedState===e.message.value)return null;this.lastResolvedState=e.message.value}return this.renderPost(e,"reply")}}),(0,a.rC)(this)}render(){var e;if(!this.isVisible(this.props.discussion))return null;const t=(0,c.of)(this.props.discussion);if(null==t)return null;const s=(0,d.sb)(`${W}__line`,{resolved:this.props.discussion.resolved});this.lastResolvedState=!1;const r=null!==(e=this.users.get(this.props.discussion.user_id))&&void 0!==e?e:n.z7,a=(0,c.G2)({beatmapset:this.beatmapset,currentBeatmap:this.currentBeatmap,discussion:this.props.discussion,user:r}),i=(0,d.sb)(W,{deleted:null!=this.props.discussion.deleted_at,highlighted:this.highlighted,"horizontal-desktop":"review"!==this.props.discussion.message_type,preview:this.readonly,review:"review"===this.props.discussion.message_type,timeline:null!=this.props.discussion.timestamp,unread:!this.isRead(t)});return l.createElement("div",{className:`${i}`,onClick:this.handleSetHighlight,style:{"--discussion-colour":`var(--beatmapset-discussion-colour--${this.props.discussion.message_type})`}},l.createElement("div",{className:`${W}__timestamp hidden-xs`},this.renderTimestamp()),l.createElement("div",{className:`${W}__discussion js-beatmap-discussion-jump`,"data-id":this.props.discussion.id},l.createElement("div",{className:`${W}__top`,style:(0,d.$$)(a)},l.createElement("div",{className:`${W}__top-user`},l.createElement(U.O,{group:a,hideStripe:!0,user:r})),l.createElement("div",{className:`${W}__top-message`},this.renderPost(t,"discussion")),this.renderPostButtons()),this.postFooter(),l.createElement("div",{className:s})))}isOwner(e){return null!=o.Z.currentUser&&o.Z.currentUser.id===e.user_id}isRead(e){var t;return(null===(t=this.readPostIds)||void 0===t?void 0:t.has(e.id))||this.isOwner(e)||this.readonly}isVisible(e){return null!=e&&(this.showDeleted||null==e.deleted_at)}postFooter(){if(null==this.props.discussionsState)return null;let e=`${W}__expanded`;return this.collapsed&&(e+=" hidden"),l.createElement("div",{className:e},l.createElement("div",{className:`${W}__replies`},this.props.discussion.posts.slice(1).map(this.renderReply)),null!=this.props.discussionsState&&this.canBeRepliedTo&&l.createElement(I,{discussion:this.props.discussion,discussionsState:this.props.discussionsState}))}renderPost(e,t){var s;const r=null!==(s=this.users.get(e.user_id))&&void 0!==s?s:n.z7;return e.system?l.createElement(B,{key:e.id,post:e,user:r}):l.createElement(L.Z,{key:e.id,discussion:this.props.discussion,discussionsState:this.props.discussionsState,post:e,read:this.isRead(e),readonly:this.readonly,resolvedStateChangedPostId:this.resolvedStateChangedPostId,store:this.props.store,type:t,user:r})}renderPostButtons(){var e;if(null==this.props.discussionsState)return null;const t=this.props.store.users.get(this.props.discussion.user_id);return l.createElement("div",{className:`${W}__top-actions`},l.createElement("div",{className:`${W}__actions`},null!=this.props.parentDiscussion&&l.createElement("a",{className:`${W}__link-to-parent js-beatmap-discussion--jump`,href:(0,c.bf)({discussion:this.props.parentDiscussion}),title:(0,p.dW)("beatmap_discussions.review.go_to_parent")},l.createElement("i",{className:"fas fa-tasks"})),l.createElement("span",{className:"visible-xs"},l.createElement(H,{type:this.props.discussion.message_type})),l.createElement(P,{cannotVote:this.isOwner(this.props.discussion)||null!==(e=null==t?void 0:t.is_bot)&&void 0!==e&&e||!this.canBeRepliedTo,discussion:this.props.discussion,discussionsState:this.props.discussionsState,users:this.users}),l.createElement("button",{className:`${W}__action ${W}__action--with-line`,onClick:this.handleCollapseClick},l.createElement("div",{className:(0,d.sb)("beatmap-discussion-expand",{expanded:!this.collapsed})},l.createElement("i",{className:"fas fa-chevron-down"})))))}renderTimestamp(){return l.createElement("div",{className:(0,d.sb)("beatmap-discussion-timestamp",{sticky:this.props.isTimelineVisible})},null!=this.props.discussion.timestamp&&this.props.isTimelineVisible&&l.createElement("div",{className:"beatmap-discussion-timestamp__point"}),l.createElement("div",{className:"beatmap-discussion-timestamp__icons-container"},l.createElement("div",{className:"beatmap-discussion-timestamp__icons"},l.createElement(H,{type:this.props.discussion.message_type}),this.props.discussion.resolved&&l.createElement(H,{type:"resolved"})),null!=this.props.discussion.timestamp&&l.createElement("div",{className:"beatmap-discussion-timestamp__text"},(0,c.i$)(this.props.discussion.timestamp))))}};F([a.Fl],Z.prototype,"canBeRepliedTo",null),F([a.Fl],Z.prototype,"collapsed",null),F([a.Fl],Z.prototype,"highlighted",null),F([a.Fl],Z.prototype,"resolvedStateChangedPostId",null),F([a.aD],Z.prototype,"handleCollapseClick",void 0),F([a.aD],Z.prototype,"handleSetHighlight",void 0),Z=F([i.Pi],Z)},7125:(e,t,s)=>{s.d(t,{Z:()=>be});var r=s(7735),a=s(6741),i=s(8156),n=s(5119),o=s(9323),l=s(5078),c=s(7294),u=s(4822),d=s(7645),p=s(8872),m=s(9703),h=s(7012),b=s(6817),f=s(3336),v=s(1270);const g=c.createContext([]);var y=s(2938),w=s(5076),_=s(9434),E=s(1426),P=s(4498);const O=c.createContext(null);class j extends c.Component{constructor(){super(...arguments),Object.defineProperty(this,"renderButton",{enumerable:!0,configurable:!0,writable:!0,value:(e,t,s)=>{var r;const a=null!==(r=this.props.menuOptions.find((e=>e.id===this.props.selected)))&&void 0!==r?r:this.props.menuOptions[0],i=[];return this.props.disabled&&(s=()=>{},i.push("disabled")),c.createElement("div",{ref:t,className:(0,f.sb)("icon-dropdown-menu",i),contentEditable:!1,onClick:s},a.icon,e)}}),Object.defineProperty(this,"renderMenuItem",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;return c.createElement("button",{key:e.id,className:(0,f.sb)("simple-menu__item",{active:e.id===this.props.selected}),"data-id":e.id,onClick:this.select},null===(t=e.renderIcon)||void 0===t||t?c.createElement(c.Fragment,null,c.createElement("div",{className:(0,f.sb)("simple-menu__item-icon","icon-dropdown-menu")},e.icon),c.createElement("div",{className:"simple-menu__label"},e.label)):e.label)}}),Object.defineProperty(this,"select",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;e.preventDefault();const s=e.currentTarget;null!=s&&this.props.onSelect(null!==(t=s.dataset.id)&&void 0!==t?t:"")}})}render(){return c.createElement(P.Z,{customRender:this.renderButton,direction:"right"},(()=>c.createElement("div",{className:"simple-menu simple-menu--popup-menu-compact"},this.props.menuOptions.map(this.renderMenuItem))))}}Object.defineProperty(j,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:O});const k=j;class N extends c.Component{constructor(){super(...arguments),Object.defineProperty(this,"select",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t="all"!==e?parseInt(e,10):void 0,s=p.F3.findPath(this.context,this.props.element);u.YR.setNodes(this.context,{beatmapId:t},{at:s})}})}render(){var e;const t=[],s="full-width";return t.push({icon:c.createElement("i",{className:"fas fa-fw fa-star-of-life"}),id:"all",label:c.createElement("div",{className:(0,f.sb)("beatmap-list-item",s)},c.createElement("div",{className:"beatmap-list-item__col beatmap-list-item__col--icon"},c.createElement("i",{className:"fas fa-xs fa-star-of-life"})),c.createElement("div",{className:"beatmap-list-item__col beatmap-list-item__col--main"},(0,v.dW)("beatmaps.discussions.mode.scopes.generalAll"))),renderIcon:!1}),this.props.beatmaps.forEach((e=>{null==e.deleted_at&&t.push({icon:c.createElement(_.p,{beatmap:e}),id:e.id.toString(),label:c.createElement(E.Z,{beatmap:e,mapper:null,modifiers:s}),renderIcon:!1})})),c.createElement(k,{disabled:this.props.disabled,menuOptions:t,onSelect:this.select,selected:null===(e=this.props.element.beatmapId)||void 0===e?void 0:e.toString()})}}Object.defineProperty(N,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:O});const S=N;var C=s(5813);const T=["praise","problem","suggestion"];class x extends c.Component{constructor(){super(...arguments),Object.defineProperty(this,"select",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=p.F3.findPath(this.context,this.props.element);u.YR.setNodes(this.context,{discussionType:e},{at:t})}})}render(){const e=T.map((e=>({icon:c.createElement("span",{className:C.y[e],style:{color:`var(--beatmapset-discussion-colour--${e})`}}),id:e,label:(0,v.dW)(`beatmaps.discussions.message_type.${e}`)})));return c.createElement(k,{disabled:this.props.disabled,menuOptions:e,onSelect:this.select,selected:this.props.element.discussionType})}}Object.defineProperty(x,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:O});const D=x;var R=s(3030),M=s(9755),I=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};const L="beatmap-discussion-review-post-embed-preview";let A=class extends c.Component{constructor(){super(...arguments),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"tooltipContent",{enumerable:!0,configurable:!0,writable:!0,value:c.createRef()}),Object.defineProperty(this,"tooltipEl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"componentDidMount",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.editable()&&u.YR.setNodes(this.context,{timestamp:void 0},{at:this.path()})}}),Object.defineProperty(this,"componentDidUpdate",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(!this.editable())return;const e=this.path();let t=!1;if("embed"===this.props.element.type&&null!=this.props.element.beatmapId){const s=this.props.element.children[0].text,r=h.Xe.exec(s);let a;null!==r&&0===r.index&&(a=r[2]),a!==this.props.element.timestamp&&(t=!0),u.YR.setNodes(this.context,{timestamp:a},{at:e})}else u.YR.setNodes(this.context,{timestamp:void 0},{at:e}),t=!0;t&&(this.cache={},this.destroyTooltip())}}),Object.defineProperty(this,"createTooltip",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=this.timestamp();if(null==t)return;const s=e.currentTarget,r=`${this.selectedBeatmap()}-${t}`;this.tooltipEl&&this.tooltipEl._tooltip===r||(this.tooltipEl=s,s._tooltip=r,M(s).qtip({content:{text:()=>{var e;return null===(e=this.tooltipContent.current)||void 0===e?void 0:e.innerHTML}},hide:{delay:200,fixed:!0},position:{at:"top center",my:"bottom center",viewport:M(window)},show:{delay:200,ready:!0},style:{classes:"tooltip-default tooltip-default--interactable"}}),this.tooltipEl=s)}}),Object.defineProperty(this,"delete",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.setTimeout((()=>u.YR.delete(this.context,{at:this.path()})),0)}}),Object.defineProperty(this,"destroyTooltip",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(!this.tooltipEl)return;const e=M(this.tooltipEl).qtip("api");null!=e&&(e.destroy(),this.tooltipEl=void 0)}}),Object.defineProperty(this,"discussionType",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.props.element.discussionType}),Object.defineProperty(this,"editable",{enumerable:!0,configurable:!0,writable:!0,value:()=>!(this.props.editMode&&null!=this.props.element.discussionId)}),Object.defineProperty(this,"isRelevantDiscussion",{enumerable:!0,configurable:!0,writable:!0,value:e=>null!=e&&e.beatmap_id===this.selectedBeatmap()}),Object.defineProperty(this,"nearbyDiscussions",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.timestamp(),t=this.selectedBeatmap();if(null==e||null==t)return[];if(null==this.cache.nearbyDiscussions||this.cache.nearbyDiscussions.timestamp!==e||this.cache.nearbyDiscussions.beatmap_id!==t){const s=[...this.discussions.values()].filter(this.isRelevantDiscussion);this.cache.nearbyDiscussions={beatmap_id:t,discussions:(0,h.Uq)(s,e),timestamp:e}}return this.cache.nearbyDiscussions.discussions}}),Object.defineProperty(this,"nearbyDraftEmbeds",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=this.timestamp();if(null!=t&&0!==e.length)return e.filter((e=>{if(null==e.timestamp||e.beatmapId!==this.props.element.beatmapId)return!1;const s=(0,h.ZB)(e.timestamp);return null!=s&&Math.abs(s-t)<=5e3}))}}),Object.defineProperty(this,"nearbyIndicator",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;if(!this.editable()||null==this.timestamp()||"praise"===this.discussionType())return null;const s=this.nearbyDiscussions(),r=null!==(t=this.nearbyDraftEmbeds(e))&&void 0!==t?t:[];if(s.length>0||r.length>1){const e=[];s.forEach((t=>{if(null==t.timestamp)return;const s=(0,h.i$)(t.timestamp);e.push(this.props.editMode?s:(0,w.Dz)((0,h.bf)({discussion:t}),s,{classNames:["js-beatmap-discussion--jump"]}))})),r.length>1&&e.push((0,v.dW)("beatmap_discussions.nearby_posts.unsaved",{count:r.length-1}));const t=(0,v.m2)(e),a=(0,v.dW)("beatmap_discussions.nearby_posts.notice",{existing_timestamps:t,timestamp:this.props.element.timestamp});return c.createElement("div",{className:`${L}__indicator ${L}__indicator--warning`,contentEditable:!1,onMouseOver:this.createTooltip,onTouchStart:this.createTooltip},c.createElement("script",{dangerouslySetInnerHTML:{__html:a},ref:this.tooltipContent,type:"text/html"}),c.createElement("i",{className:"fas fa-exclamation-triangle"}))}return null}}),Object.defineProperty(this,"path",{enumerable:!0,configurable:!0,writable:!0,value:()=>p.F3.findPath(this.context,this.props.element)}),Object.defineProperty(this,"selectedBeatmap",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.props.element.beatmapId}),Object.defineProperty(this,"timestamp",{enumerable:!0,configurable:!0,writable:!0,value:()=>(0,h.ZB)(this.props.element.timestamp)})}get discussions(){return this.props.store.discussions}componentWillUnmount(){this.destroyTooltip()}render(){var e;const t=this.editable(),s=t?[]:["read-only"],r=null!=this.props.element.beatmapId?"diff":"all-diff",a=(0,v.dW)(`beatmaps.discussions.review.embed.timestamp.${r}`,{type:(0,v.dW)(`beatmaps.discussions.message_type.${this.discussionType()}`)}),i=c.createElement("button",{className:`${L}__delete`,contentEditable:!1,disabled:this.props.readOnly,onClick:this.delete,title:(0,v.dW)("beatmaps.discussions.review.embed."+(t?"delete":"unlink"))},c.createElement("i",{className:"fas fa-"+(t?"trash-alt":"link")})),n=c.createElement(g.Consumer,null,(e=>c.createElement(y.Qj,null,(()=>this.nearbyIndicator(e))))),o=this.props.editMode&&t?c.createElement("div",{className:`${L}__indicator`,contentEditable:!1,title:(0,v.dW)("beatmaps.discussions.review.embed.unsaved")},c.createElement("i",{className:"fas fa-pencil-alt"})):null,l=this.props.readOnly||!t,u=this.discussions.get(this.props.element.discussionId),d=null!=u?(0,R.m)(u):"praise"===this.discussionType()?"praise":null;return c.createElement("div",Object.assign({className:"beatmap-discussion beatmap-discussion--preview",contentEditable:t,suppressContentEditableWarning:!0},this.props.attributes),c.createElement("div",{className:(0,f.sb)(L,s,d)},c.createElement("div",{className:`${L}__content`},c.createElement("div",{className:`${L}__selectors`,contentEditable:!1},c.createElement(S,{beatmaps:this.props.discussionsState.sortedBeatmaps,disabled:l,element:this.props.element}),c.createElement(D,{beatmaps:this.props.discussionsState.sortedBeatmaps,disabled:l,element:this.props.element}),c.createElement("div",{className:`${L}__timestamp`,contentEditable:!1},c.createElement("span",{title:t?a:""},null!==(e=this.props.element.timestamp)&&void 0!==e?e:(0,v.dW)("beatmap_discussions.timestamp_display.general"))),o,n),c.createElement("div",{className:`${L}__stripe`,contentEditable:!1}),c.createElement("div",{className:`${L}__message-container`},this.props.children),o,n)),i)}};Object.defineProperty(A,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:O}),A=I([o.Pi],A);const $=A;var B=s(3924);const U=e=>e.length,F=e=>{const t=H(e);return null!=t&&("type"in t&&"embed"===t.type)},W=(e,t)=>{const[s]=u.ML.nodes(e,{match:e=>u.xv.isText(e)&&!0===e[t],mode:"all"});return null!=s},H=e=>{if(e.selection)return u.NB.parent(e,u.e6.start(e.selection).path)},Z=(e,t)=>{u.YR.setNodes(e,{[t]:!W(e,t)||null},{match:e=>u.xv.isText(e),split:!0})};function G(e,t){const s=e.trim();if(0===s.length)return;const r=`${t}${s}${t}`;return s===e?r:e.replace(s,r)}function V(e){return e.children.map((e=>{if(""!==e.text){const t=e.text.replace(/([*_\\])/g,"\\$1");return e.bold&&e.italic?G(t,"***"):e.bold?G(t,"**"):e.italic?G(t,"*"):t}})).join("")}const z=e=>{const t=[];e.forEach((e=>{switch(e.type){case"paragraph":t.push({text:V(e),type:"paragraph"});break;case"embed":t.push(function(e){var t;return null!=e.discussionId?{discussion_id:e.discussionId,type:"embed"}:{beatmap_id:null!==(t=e.beatmapId)&&void 0!==t?t:null,discussion_type:e.discussionType,text:e.children[0].text,timestamp:(0,h.ZB)(e.timestamp),type:"embed"}}(e))}}));const s=t[t.length-1];return"paragraph"!==s.type||(0,B.W)(s.text)||t.pop(),JSON.stringify(t)};var q=s(5863),K=s(6486),J=s(9139),X=s(9755);class Q extends c.Component{constructor(e){super(e),Object.defineProperty(this,"bn",{enumerable:!0,configurable:!0,writable:!0,value:"beatmap-discussion-editor-insertion-menu"}),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:`editor-insertion-menu-${(0,J.d)()}`}),Object.defineProperty(this,"hideInsertMenuTimer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hoveredBlock",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"insertPosition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"insertRef",{enumerable:!0,configurable:!0,writable:!0,value:c.createRef()}),Object.defineProperty(this,"mouseOver",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"scrollContainer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throttledContainerMouseExit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throttledContainerMouseMove",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throttledMenuMouseEnter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throttledMenuMouseExit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throttledScroll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"containerMouseMove",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(!e.originalEvent)return;const t=e.originalEvent.clientY,s=this.scrollContainer.children[0].children;let r=0;for(const i of s){if(t<i.getBoundingClientRect().top){if(r>0){const e=s[r-1];t<e.getBoundingClientRect().top+e.getBoundingClientRect().height/2&&r--}break}r<s.length-1&&r++}this.hoveredBlock=s[r];const a=this.hoveredBlock.getBoundingClientRect();t>a.top+a.height/2?this.insertPosition="below":this.insertPosition="above",this.updatePosition(),this.showMenu(),this.startHideTimer()}}),Object.defineProperty(this,"forceHideMenu",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.mouseOver=!1,this.hideMenu()}}),Object.defineProperty(this,"hideMenu",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.insertRef.current&&!this.mouseOver&&(this.insertRef.current.style.display="none")}}),Object.defineProperty(this,"insertBlock",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s,r,a,i,n;const o=this.context,l=null===(t=this.hoveredBlock)||void 0===t?void 0:t.lastChild,c=e.currentTarget.dataset.discussionType,d=null===(s=this.props.currentBeatmap)||void 0===s?void 0:s.id;let m;switch(c){case"suggestion":case"problem":case"praise":m={beatmapId:d,children:[{text:""}],discussionType:c,type:"embed"};break;case"paragraph":m={children:[{text:""}],type:"paragraph"}}if(!m||!l)return;let h,b=p.F3.toSlateNode(o,l);if(u.xv.isText(b)&&""===b.text||u.W_.isElement(b)&&u.ML.isEmpty(o,b))if("above"===this.insertPosition){const e=null===(a=null===(r=this.hoveredBlock)||void 0===r?void 0:r.previousSibling)||void 0===a?void 0:a.lastChild;null!=e?(b=p.F3.toSlateNode(o,e),h=u.ML.end(o,p.F3.findPath(o,b))):h={offset:0,path:[]}}else{const e=null===(n=null===(i=this.hoveredBlock)||void 0===i?void 0:i.previousSibling)||void 0===n?void 0:n.lastChild;null!=e?(b=p.F3.toSlateNode(o,e),h=u.ML.start(o,p.F3.findPath(o,b))):h=u.ML.end(o,[])}else{const e=p.F3.findPath(o,b);h="above"===this.insertPosition?u.ML.start(o,e):u.ML.end(o,e)}u.YR.insertNodes(o,m,{at:h})}}),Object.defineProperty(this,"insertButton",{enumerable:!0,configurable:!0,writable:!0,value:e=>{let t="fas fa-question";switch(e){case"praise":case"problem":case"suggestion":t=C.y[e];break;case"paragraph":t="fas fa-indent"}return c.createElement("button",{className:`${this.bn}__menu-button ${this.bn}__menu-button--${e}`,"data-discussion-type":e,onClick:this.insertBlock,title:(0,v.dW)(`beatmaps.discussions.review.insert-block.${e}`),type:"button"},c.createElement("i",{className:t}))}}),Object.defineProperty(this,"menuMouseEnter",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.mouseOver=!0}}),Object.defineProperty(this,"menuMouseLeave",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.mouseOver=!1,this.startHideTimer()}}),this.throttledContainerMouseExit=(0,K.throttle)((()=>{setTimeout(this.hideMenu,100)}),10),this.throttledContainerMouseMove=(0,K.throttle)(this.containerMouseMove,10),this.throttledMenuMouseEnter=(0,K.throttle)(this.menuMouseEnter,10),this.throttledMenuMouseExit=(0,K.throttle)(this.menuMouseLeave,10),this.throttledScroll=(0,K.throttle)(this.forceHideMenu,10)}componentDidMount(){this.insertRef.current&&(X(this.insertRef.current).on(`mouseenter.${this.eventId}`,this.throttledMenuMouseEnter),X(this.insertRef.current).on(`mouseleave.${this.eventId}`,this.throttledMenuMouseExit)),X(window).on(`scroll.${this.eventId}`,this.throttledScroll)}componentDidUpdate(){this.forceHideMenu()}componentWillUnmount(){X(window).off(`.${this.eventId}`),this.scrollContainer&&X(this.scrollContainer).off(`.${this.eventId}`),this.insertRef.current&&X(this.insertRef.current).off(`.${this.eventId}`)}render(){return c.createElement(q.Z,null,c.createElement("div",{ref:this.insertRef,className:`${this.bn}`},c.createElement("div",{className:`${this.bn}__body`},c.createElement("i",{className:"fas fa-plus"}),c.createElement("div",{className:`${this.bn}__buttons`},this.insertButton("suggestion"),this.insertButton("problem"),this.insertButton("praise"),this.insertButton("paragraph")))))}setScrollContainer(e){this.scrollContainer&&X(this.scrollContainer).off(`.${this.eventId}`),this.scrollContainer=e,X(this.scrollContainer).on(`mousemove.${this.eventId}`,this.throttledContainerMouseMove),X(this.scrollContainer).on(`mouseleave.${this.eventId}`,this.throttledContainerMouseExit),X(this.scrollContainer).on(`scroll.${this.eventId}`,this.throttledScroll)}showMenu(){this.insertRef.current&&(this.insertRef.current.style.display="flex")}startHideTimer(){window.clearTimeout(this.hideInsertMenuTimer),this.hideInsertMenuTimer=window.setTimeout(this.hideMenu,2e3)}updatePosition(){if(!this.scrollContainer||!this.hoveredBlock||!this.insertRef.current)return;const e=this.hoveredBlock.getBoundingClientRect(),t=this.scrollContainer.getBoundingClientRect();this.insertRef.current.style.left=`${t.left+15}px`,this.insertRef.current.style.width=t.width-30+"px","above"===this.insertPosition?this.insertRef.current.style.top=e.top-10+"px":"below"===this.insertPosition&&(this.insertRef.current.style.top=e.top+e.height-10+"px")}}Object.defineProperty(Q,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:O});const Y=e=>{const t=c.useContext(O),s=c.useCallback((s=>{s.preventDefault(),Z(t,e.format)}),[t,e.format]);return c.createElement("button",{className:(0,f.sb)("beatmap-discussion-editor-toolbar__button",{active:W(t,e.format)}),onMouseDown:s},c.createElement("i",{className:`fas fa-${e.format}`}))};var ee=s(9755);const te="beatmap-discussion-editor-toolbar";class se extends c.Component{constructor(){super(...arguments),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:`editor-toolbar-${(0,J.d)()}`}),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:c.createRef()}),Object.defineProperty(this,"scrollContainer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scrollTimer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"throttledUpdate",{enumerable:!0,configurable:!0,writable:!0,value:(0,K.throttle)((()=>this.updatePosition()),100)})}get selectionRange(){const{selection:e}=this.context;if(!e||!p.F3.isFocused(this.context)||u.e6.isCollapsed(e)||""===u.ML.string(this.context,e))return null;const t=window.getSelection();return null==t?void 0:t.getRangeAt(0)}get visible(){return null!=this.selectionRange}componentDidMount(){ee(window).on(`scroll.${this.eventId}`,this.throttledUpdate),this.updatePosition()}componentDidUpdate(){this.updatePosition()}componentWillUnmount(){ee(window).off(`.${this.eventId}`),this.scrollContainer&&ee(this.scrollContainer).off(`.${this.eventId}`),this.throttledUpdate.cancel()}hide(){const e=this.ref.current;e&&(e.style.display="none")}render(){return null!=this.context&&this.visible?c.createElement(q.Z,null,c.createElement("div",{ref:this.ref,className:te},c.createElement(Y,{format:"bold"}),c.createElement(Y,{format:"italic"}),c.createElement("div",{className:`${te}__popup-tail`}))):null}setScrollContainer(e){this.scrollContainer&&ee(this.scrollContainer).off(`.${this.eventId}`),this.scrollContainer=e,ee(this.scrollContainer).on(`scroll.${this.eventId}`,this.throttledUpdate)}updatePosition(){const e=this.ref.current;e&&null!=this.context&&(window.clearTimeout(this.scrollTimer),this.scrollTimer=window.setTimeout((()=>{var t,s;const r=this.selectionRange;if(null==r)return this.hide();for(const e of u.ML.positions(this.context,{at:null!==(t=this.context.selection)&&void 0!==t?t:void 0,unit:"block"})){const t=u.NB.parent(this.context,e.path);if(u.W_.isElement(t)&&"embed"===t.type)return this.hide()}const a=null===(s=this.scrollContainer)||void 0===s?void 0:s.getBoundingClientRect(),i=r.getBoundingClientRect();if(null!=a&&(i.top<a.top||i.top>a.bottom))return this.hide();e.style.display="block",e.style.left=`${i.left+(window.pageXOffset-e.offsetWidth)/2+i.width/2}px`,e.style.top=i.top-e.clientHeight-10+"px"}),10))}}Object.defineProperty(se,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:O});var re=s(5437),ae=s(5305),ie=s(1240);function ne(e,t){let s;try{s=JSON.parse(e)}catch(i){return console.error("error parsing srcDoc"),[]}const r=(0,ie.l)().use(re.Z).use(ae.Z,{type:"editor"}),a=[];return s.forEach((e=>{switch(e.type){case"paragraph":if((0,B.W)(e.text.trim())){const t=r.parse(e.text);if(null==t.children||t.children.length<1){console.error("children missing... ?");break}const s=oe(t.children);s.length>0?a.push({children:s,type:"paragraph"}):a.push({children:[{text:""}],type:"paragraph"})}else a.push({children:[{text:""}],type:"paragraph"});break;case"embed":{const r=e,i=t.get(r.discussion_id);if(null==i){console.error("unknown/external discussion referenced",r.discussion_id);break}if(s=i.message_type,!T.includes(s)){console.error("unsupported embed type",i.message_type);break}const n=(0,h.of)(i);if(null==n||n.system){console.error("embed starting post is missing or is system post",r.discussion_id);break}a.push({beatmapId:i.beatmap_id,children:[{text:n.message}],discussionId:i.id,discussionType:i.message_type,timestamp:null!=i.timestamp?(0,h.i$)(i.timestamp):void 0,type:"embed"});break}default:console.error("unknown block encountered",e)}var s})),a}function oe(e,t){let s=[];const r=null!=t?t:{bold:!1,italic:!1};return e.forEach((e=>{const t={bold:r.bold||"strong"===e.type,italic:r.italic||"emphasis"===e.type};var a;"children"in(a=e)&&Array.isArray(a.children)?s=s.concat(oe(e.children,t)):function(e){return"text"===e.type}(e)&&s.push({bold:t.bold,italic:t.italic,text:e.value})})),s}var le=s(4594),ce=s(9755),ue=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n},de=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]])}return s};const pe=[Object.freeze({children:[{text:""}],type:"paragraph"})];function me(e){return"embed"===e.type&&null==e.discussionId}let he=class extends c.Component{get beatmaps(){return this.props.store.beatmaps}get beatmapset(){return this.props.discussionsState.beatmapset}get discussions(){return this.props.store.discussions}get editMode(){return null!=this.props.document}constructor(e){if(super(e),Object.defineProperty(this,"bn",{enumerable:!0,configurable:!0,writable:!0,value:"beatmap-discussion-editor"}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"insertMenuRef",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localStorageKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scrollContainerRef",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"slateEditor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"toolbarRef",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"initialValue",{enumerable:!0,configurable:!0,writable:!0,value:pe}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"blockWrapper",{enumerable:!0,configurable:!0,writable:!0,value:e=>c.createElement("div",{className:`${this.bn}__block`},e)}),Object.defineProperty(this,"decorateTimestamps",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const[t,s]=e,r=[];if(!u.xv.isText(t))return r;const a=RegExp(h.Xe,"g");let i;for(;null!==(i=a.exec(t.text));)r.push({anchor:{offset:i.index,path:s},focus:{offset:i.index+i[0].length,path:s},timestamp:i[0]});return r}}),Object.defineProperty(this,"onChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(0===e.length&&(console.error("value is empty in Editor.onChange"),e=pe),!this.editMode){const s=JSON.stringify(e);0===(t=e).length||1===t.length&&"paragraph"===t[0].type&&1===t[0].children.length&&""===t[0].children[0].text?localStorage.removeItem(this.localStorageKey):localStorage.setItem(this.localStorageKey,s)}var t;this.setState({blockCount:U(e),value:e},(()=>{var e,t;p.F3.isFocused(this.slateEditor)&&this.props.onFocus&&this.props.onFocus(),null===(t=(e=this.props).onChange)||void 0===t||t.call(e)}))}}),Object.defineProperty(this,"onKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.nativeEvent;(0,i.ZP)("mod+b",t)?(e.preventDefault(),Z(this.slateEditor,"bold")):(0,i.ZP)("mod+i",t)?(e.preventDefault(),Z(this.slateEditor,"italic")):(0,i.ZP)("shift+enter",t)?F(this.slateEditor)&&(e.preventDefault(),this.slateEditor.insertText("\n")):((0,i.ZP)("delete",t)||(0,i.ZP)("backspace",t))&&(e=>{const t=H(e);return null!=t&&"type"in t&&u.ML.isEmpty(e,t)})(this.slateEditor)&&(e.preventDefault(),u.YR.removeNodes(this.slateEditor),0===this.slateEditor.children.length&&this.resetEditorValue())}}),Object.defineProperty(this,"post",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null==this.xhr&&this.showConfirmationIfRequired()&&this.setState({posting:!0},(()=>{this.xhr=ce.ajax((0,n.B)("beatmapsets.discussion.review",{beatmapset:this.beatmapset.id}),{data:{document:this.serialize()},method:"POST"}),this.xhr.done((e=>{this.props.discussionsState.update({beatmapset:e}),this.resetInput()})).fail(m.qQ).always((()=>{this.xhr=null,this.setState({posting:!1})}))}))}}),Object.defineProperty(this,"renderBlockCount",{enumerable:!0,configurable:!0,writable:!0,value:e=>c.createElement(r.D,{current:this.state.blockCount,max:this.context.max_blocks,onlyShowAsWarning:!0,theme:e,tooltip:(0,v.dW)("beatmap_discussions.review.block_count",{max:this.context.max_blocks,used:this.state.blockCount})})}),Object.defineProperty(this,"renderElement",{enumerable:!0,configurable:!0,writable:!0,value:e=>{let t;switch(e.element.type){case"embed":{const{element:s}=e,r=de(e,["element"]);t=c.createElement($,Object.assign({discussionsState:this.props.discussionsState,editMode:this.editMode,element:s,readOnly:this.state.posting,store:this.props.store},r));break}default:t=e.children}return this.blockWrapper(t)}}),Object.defineProperty(this,"renderLeaf",{enumerable:!0,configurable:!0,writable:!0,value:e=>{let t=e.children;return e.leaf.bold&&(t=c.createElement("strong",Object.assign({},e.attributes),t)),e.leaf.italic&&(t=c.createElement("em",Object.assign({},e.attributes),t)),null!=e.leaf.timestamp?c.createElement("span",Object.assign({className:"beatmap-discussion-timestamp-decoration"},e.attributes),t):c.createElement("span",Object.assign({},e.attributes),t)}}),Object.defineProperty(this,"resetInput",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e&&(e.preventDefault(),!confirm((0,v.dW)("common.confirmation")))||this.resetEditorValue()}}),Object.defineProperty(this,"scrollSelectionIntoView",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{var s;null===(s=t.startContainer.parentElement)||void 0===s||s.scrollIntoView({block:"nearest",inline:"nearest"})}}),Object.defineProperty(this,"serialize",{enumerable:!0,configurable:!0,writable:!0,value:()=>z(this.state.value)}),Object.defineProperty(this,"showConfirmationIfRequired",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.state.value.some((e=>"embed"===e.type&&"problem"===e.discussionType&&null==e.discussionId));const t=null!=l.Z.currentUser&&(l.Z.currentUser.is_admin||l.Z.currentUser.is_moderator||l.Z.currentUser.is_full_bn),s="qualified"===this.beatmapset.status&&e,r=null!=l.Z.currentUser&&(l.Z.currentUser.is_admin||l.Z.currentUser.is_nat||l.Z.currentUser.is_bng),a="pending"===this.beatmapset.status&&(0,b.c0)(this.beatmapset.nominations,"current")>0&&e;return t&&s?confirm((0,v.dW)("beatmaps.nominations.reset_confirm.disqualify")):!r||!a||confirm((0,v.dW)("beatmaps.nominations.reset_confirm.nomination_reset"))}}),Object.defineProperty(this,"updateDrafts",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.cache.draftEmbeds=this.state.value.filter(me)}}),Object.defineProperty(this,"withNormalization",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const{insertData:t,normalizeNode:s}=e;return e.insertData=s=>{F(this.slateEditor)?e.insertText(s.getData("text/plain")):t(s)},e.normalizeNode=t=>{const[r,a]=t;if(u.W_.isElement(r)&&"embed"===r.type)for(const[s,i]of u.NB.children(e,a)){if(u.W_.isElement(s)&&!e.isInline(s))return void u.YR.unwrapNodes(e,{at:i});if(u.xv.isText(s)&&(s.bold||s.italic))return void u.YR.unsetNodes(e,["bold","italic"],{at:i});if(null!=r.beatmapId){const t=this.beatmaps.get(r.beatmapId);null!=t&&null==t.deleted_at||u.YR.setNodes(e,{beatmapId:void 0},{at:a})}}s(t)},e}}),this.slateEditor=this.withNormalization((0,p.BU)((0,d.VC)((0,u.Jh)()))),this.scrollContainerRef=c.createRef(),this.toolbarRef=c.createRef(),this.insertMenuRef=c.createRef(),this.localStorageKey=`newDiscussion-${this.beatmapset.id}`,this.editMode)this.initialValue=this.valueFromProps();else{const e=localStorage.getItem(this.localStorageKey);if(null!=e)try{this.initialValue=JSON.parse(e)}catch(t){console.error("invalid json in localStorage, ignoring"),localStorage.removeItem(this.localStorageKey)}}this.state={blockCount:U(this.initialValue),posting:!1,value:this.initialValue}}get canSave(){return!this.state.posting&&this.state.blockCount<=this.context.max_blocks}componentDidMount(){this.scrollContainerRef.current&&(this.toolbarRef.current&&this.toolbarRef.current.setScrollContainer(this.scrollContainerRef.current),this.insertMenuRef.current&&this.insertMenuRef.current.setScrollContainer(this.scrollContainerRef.current))}componentDidUpdate(e){if(this.props.document!==e.document){const e=this.valueFromProps();this.setState({blockCount:U(e),value:e})}}componentWillUnmount(){var e;null===(e=this.xhr)||void 0===e||e.abort()}render(){this.cache={};const e="beatmap-discussion-editor",t=this.editMode?["edit-mode"]:[];return this.state.posting&&t.push("readonly"),this.updateDrafts(),c.createElement("div",{className:(0,f.sb)(e,t)},c.createElement("div",{className:`${e}__content`},c.createElement(O.Provider,{value:this.slateEditor},c.createElement(p.mH,{editor:this.slateEditor,onChange:this.onChange,value:this.initialValue},c.createElement("div",{ref:this.scrollContainerRef,className:`${e}__input-area`},c.createElement(se,{ref:this.toolbarRef}),c.createElement(Q,{ref:this.insertMenuRef,currentBeatmap:this.props.discussionsState.currentBeatmap}),c.createElement(g.Provider,{value:this.cache.draftEmbeds||[]},c.createElement(p.CX,{decorate:this.decorateTimestamps,onKeyDown:this.onKeyDown,placeholder:(0,v.dW)("beatmaps.discussions.message_placeholder.review"),readOnly:this.state.posting,renderElement:this.renderElement,renderLeaf:this.renderLeaf,scrollSelectionIntoView:this.scrollSelectionIntoView}))),this.editMode&&c.createElement("div",{className:`${e}__inner-block-count`},this.renderBlockCount("lighter")),!this.editMode&&c.createElement("div",{className:`${e}__button-bar`},c.createElement("button",{className:"btn-osu-big btn-osu-big--forum-secondary",disabled:this.state.posting,onClick:this.resetInput,type:"button"},(0,v.dW)("common.buttons.clear")),c.createElement("div",null,c.createElement("span",{className:`${e}__block-count`},this.renderBlockCount()),c.createElement("button",{className:"btn-osu-big btn-osu-big--forum-primary",disabled:!this.canSave,onClick:this.post,type:"submit"},this.state.posting?c.createElement(a.$,null):(0,v.dW)("common.buttons.post"))))))))}resetEditorValue(){u.YR.deselect(this.slateEditor),this.slateEditor.children=pe,this.slateEditor.onChange()}valueFromProps(){return this.props.editing&&null!=this.props.document?ne(this.props.document,this.discussions):[]}};Object.defineProperty(he,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:le._}),Object.defineProperty(he,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{editing:!1}}),he=ue([o.Pi],he);const be=he},78:(e,t,s)=>{s.d(t,{Z:()=>r});const r=Object.freeze({colour:"hsl(var(--hsl-l1))",has_listing:!1,has_playmodes:!1,id:-1,identifier:"owner",is_probationary:!1,name:"Beatmap Mapper",short_name:"MAPPER"})},4985:(e,t,s)=>{s.d(t,{Z:()=>m});var r=s(3974),a=s(7294),i=s(9469),n=s(3555),o=s(3955),l=s(5305),c=s(7012),u=s(3924);const d=Object.freeze({a:function(e){const t=(0,c.cO)(e.href);return null!=t.children?a.createElement("a",Object.assign({},t)):a.createElement(a.Fragment,null,e.children)},code:p,em:p,img:function(e){var t;return a.createElement(a.Fragment,null,null!==(t=(0,u.G)(e.alt))&&void 0!==t?t:"[image]")},p,pre:p,strong:p});function p(e){return a.createElement(a.Fragment,null,(0,r.F8)(e.children))}class m extends a.Component{render(){var e;return a.createElement(i.D,{className:"plain-text-preview",components:d,rehypePlugins:[[n.Z,{maxChars:null!==(e=this.props.maxLength)&&void 0!==e?e:c.g8}]],remarkPlugins:[o.Z,[l.Z,{type:this.props.type}]],transformLinkUri:r.H,unwrapDisallowed:!0},this.props.markdown)}}},5989:(e,t,s)=>{s.d(t,{Z:()=>R});var r=s(7125),a=s(7294),i=s(1480),n=s(3030);class o extends a.Component{render(){const e=[];try{JSON.parse(this.props.post.message).forEach(((t,s)=>{switch(t.type){case"paragraph":{const r=""===t.text.trim()?"&nbsp;":t.text;e.push(a.createElement(i.Z,{key:s,markdown:r,type:"reviews"}));break}case"embed":t.discussion_id&&e.push(a.createElement(n.j,{key:s,data:{discussion_id:t.discussion_id},store:this.props.store}))}}))}catch(t){e.push(a.createElement("div",{key:null},"[error parsing review]"))}return a.createElement("div",{className:"beatmap-discussion-review-post"},e)}}var l=s(7010),c=s(9240),u=s(2325),d=s(4403),p=s(2163),m=s(12),h=s(6871),b=s(5119),f=s(6486),v=s(8949),g=s(9323),y=s(8125),w=s(5078),_=s(9703),E=s(7012),P=s(6817),O=s(3336),j=s(7937),k=s(1270),N=s(5692),S=s(2786),C=s(9755),T=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};const x="beatmap-discussion-post";let D=class extends a.Component{get beatmap(){var e;return null===(e=this.props.discussionsState)||void 0===e?void 0:e.currentBeatmap}get beatmapset(){var e;return null===(e=this.props.discussionsState)||void 0===e?void 0:e.beatmapset}get users(){return this.props.store.users}get canEdit(){return null!=this.beatmapset&&(this.isAdmin||!(0,P.wm)(this.beatmapset)&&this.isOwn&&this.props.post.id>this.props.resolvedStateChangedPostId&&!this.beatmapset.discussion_locked)}get canDelete(){var e;return"discussion"===this.props.type?null===(e=this.props.discussion.current_user_attributes)||void 0===e?void 0:e.can_destroy:this.canModerate||this.canEdit}get canModerate(){return(0,E.e7)()}get canReport(){return null!=w.Z.currentUser&&this.props.post.user_id!==w.Z.currentUser.id}get deleteModel(){return"reply"===this.props.type?this.props.post:this.props.discussion}get isAdmin(){var e,t;return null!==(t=null===(e=w.Z.currentUser)||void 0===e?void 0:e.is_admin)&&void 0!==t&&t}get isOwn(){return null!=w.Z.currentUser&&w.Z.currentUser.id===this.props.post.user_id}get isPosting(){return null!=this.xhr}get isReview(){return"review"===this.props.discussion.message_type&&"discussion"===this.props.type}get isTimeline(){return null!=this.props.discussion.timestamp}constructor(e){super(e),Object.defineProperty(this,"canSave",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"editing",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"handleTextareaKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"messageBodyRef",{enumerable:!0,configurable:!0,writable:!0,value:a.createRef()}),Object.defineProperty(this,"reviewEditorRef",{enumerable:!0,configurable:!0,writable:!0,value:a.createRef()}),Object.defineProperty(this,"textareaMinHeight",{enumerable:!0,configurable:!0,writable:!0,value:"0"}),Object.defineProperty(this,"textareaRef",{enumerable:!0,configurable:!0,writable:!0,value:a.createRef()}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"editCancel",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.editing=!1}}),Object.defineProperty(this,"editStart",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.textareaMinHeight=null!=this.messageBodyRef.current?`${this.messageBodyRef.current.getBoundingClientRect().height+50}px`:"0",this.editing=!0,this.message=this.props.post.message}}),Object.defineProperty(this,"handleEditorChange",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t;this.canSave=null!==(t=null===(e=this.reviewEditorRef.current)||void 0===e?void 0:e.canSave)&&void 0!==t&&t}}),Object.defineProperty(this,"handleMarkRead",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;null===(e=this.props.discussionsState)||void 0===e||e.markAsRead(this.props.post.id)}}),Object.defineProperty(this,"handleTextareaChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.message=e.target.value,this.canSave=(0,E.Ks)(this.message,this.isTimeline)}}),Object.defineProperty(this,"handleTextareaKeyDownCallback",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e===j.z.Submit&&this.updatePost()}}),Object.defineProperty(this,"updatePost",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(!this.isPosting){if(this.isReview){if(null==this.reviewEditorRef.current)return void console.error("reviewEditor is missing!");const e=this.reviewEditorRef.current.serialize();if((0,f.isEqual)(JSON.parse(this.props.post.message),JSON.parse(e)))return void(this.editing=!1);if(!this.reviewEditorRef.current.showConfirmationIfRequired())return;this.message=e}this.message!==this.props.post.message?(this.xhr=C.ajax((0,b.B)("beatmapsets.discussions.posts.update",{post:this.props.post.id}),{data:{beatmap_discussion_post:{message:this.message}},method:"PUT"}),this.xhr.done((e=>(0,v.z)((()=>{var t;this.editing=!1,null===(t=this.props.discussionsState)||void 0===t||t.update({beatmapset:e})})))).fail(_.qQ).always((0,v.aD)((()=>this.xhr=null)))):this.editing=!1}}}),(0,v.rC)(this),this.handleTextareaKeyDown=(0,j.k)(this.handleTextareaKeyDownCallback),(0,g.b4)(this,(0,v.EH)((()=>{this.editing&&setTimeout((()=>{var e;return null===(e=this.textareaRef.current)||void 0===e?void 0:e.focus()}),0)})))}componentWillUnmount(){var e;null===(e=this.xhr)||void 0===e||e.abort()}render(){const e=(0,O.sb)(x,this.props.type,{deleted:null!=this.props.post.deleted_at,editing:this.editing,unread:!this.props.read&&"discussion"!==this.props.type});return a.createElement("div",{className:`${e} js-beatmap-discussion-jump`,"data-post-id":this.props.post.id,onClick:this.handleMarkRead},a.createElement("div",{className:`${x}__content`},"reply"===this.props.type&&a.createElement(S.O,{group:(0,E.G2)({beatmapset:this.beatmapset,currentBeatmap:this.beatmap,discussion:this.props.discussion,user:this.props.user}),user:this.props.user}),this.editing?this.renderMessageEditor():this.renderMessageViewer()))}deleteHref(e){const[t,s]="reply"===this.props.type?["beatmapsets.discussions.posts","post"]:["beatmapsets.discussions","discussion"];return(0,b.B)(`${t}.${e}`,{[s]:this.deleteModel.id})}renderDeletedBy(){var e;if(null==this.deleteModel.deleted_at)return null;const t=null!==(e=this.users.get(this.deleteModel.deleted_by_id))&&void 0!==e?e:y.z7;return a.createElement("span",{className:`${x}__info`},a.createElement(d.Z,{mappings:{delete_time:a.createElement(m.Z,{dateTime:this.deleteModel.deleted_at,relative:!0}),editor:a.createElement(h.Z,{className:`${x}__info-user`,user:t})},pattern:(0,k.dW)("beatmaps.discussions.deleted")}))}renderEdited(){var e;if(null==this.props.post.last_editor_id||this.props.post.updated_at===this.props.post.created_at)return null;const t=null!==(e=this.users.get(this.props.post.last_editor_id))&&void 0!==e?e:y.z7;return a.createElement("span",{className:`${x}__info`},a.createElement(d.Z,{mappings:{editor:a.createElement(h.Z,{className:`${x}__info-user`,user:t}),update_time:a.createElement(m.Z,{dateTime:this.props.post.updated_at,relative:!0})},pattern:(0,k.dW)("beatmaps.discussions.edited")}))}renderKudosuAction(e){return a.createElement("a",{className:`js-beatmapset-discussion-update ${x}__action ${x}__action--button`,"data-confirm":(0,k.dW)("common.confirmation"),"data-method":"POST","data-remote":!0,href:(0,b.B)(`beatmapsets.discussions.${e}-kudosu`,{discussion:this.props.discussion.id})},(0,k.dW)(`beatmaps.discussions.${e}_kudosu`))}renderMessageEditor(){if(null==this.props.discussionsState||!this.canEdit)return;const e=!this.isPosting&&this.canSave,t=this.props.post.message;return a.createElement("div",{className:`${x}__message-container`},this.isReview?a.createElement(r.Z,{ref:this.reviewEditorRef,discussion:this.props.discussion,discussionsState:this.props.discussionsState,document:t,editing:this.editing,onChange:this.handleEditorChange,store:this.props.store}):a.createElement(a.Fragment,null,a.createElement(p.Z,{className:`${x}__message ${x}__message--editor`,disabled:this.isPosting,innerRef:this.textareaRef,onChange:this.handleTextareaChange,onKeyDown:this.handleTextareaKeyDown,style:{minHeight:this.textareaMinHeight},value:this.message}),a.createElement(N.Z,{isTimeline:this.isTimeline,message:this.message})),a.createElement("div",{className:`${x}__actions`},a.createElement("div",{className:`${x}__actions-group`},a.createElement("div",{className:`${x}__actions-group`},a.createElement("div",{className:`${x}__action`},a.createElement(l.Z,{disabled:this.isPosting,props:{onClick:this.editCancel},text:(0,k.dW)("common.buttons.cancel")}))),a.createElement("div",{className:`${x}__action`},a.createElement(l.Z,{disabled:!e,props:{onClick:this.updatePost},text:(0,k.dW)("common.buttons.save")})))))}renderMessageViewer(){return a.createElement("div",{className:`${x}__message-container`},this.isReview?a.createElement("div",{className:`${x}__message`},a.createElement(o,{post:this.props.post,store:this.props.store})):a.createElement("div",{ref:this.messageBodyRef,className:`${x}__message`},a.createElement(i.Z,{markdown:this.props.post.message})),a.createElement("div",{className:`${x}__info-container`},a.createElement("span",{className:`${x}__info`},a.createElement(m.Z,{dateTime:this.props.post.created_at,relative:!0})),this.renderDeletedBy(),this.renderEdited(),"discussion"===this.props.type&&this.props.discussion.kudosu_denied&&a.createElement("span",{className:`${x}__info`},(0,k.dW)("beatmaps.discussions.kudosu_denied"))),this.renderMessageViewerActions())}renderMessageViewerActions(){return a.createElement("div",{className:`${x}__actions`},a.createElement("div",{className:`${x}__actions-group`},a.createElement("span",{className:`${x}__action ${x}__action--button`},a.createElement(c.Z,{label:(0,k.dW)("common.buttons.permalink"),value:(0,E.bf)({discussion:this.props.discussion,post:"reply"===this.props.type?this.props.post:void 0}),valueAsUrl:!0})),this.renderMessageViewerEditingActions(),this.canReport&&a.createElement(u.c,{className:`${x}__action ${x}__action--button`,reportableId:this.props.post.id.toString(),reportableType:"beatmapset_discussion_post",user:this.props.user})))}renderMessageViewerEditingActions(){var e;if(!this.props.readonly&&null!=this.props.discussionsState)return a.createElement(a.Fragment,null,this.canEdit&&a.createElement("button",{className:`${x}__action ${x}__action--button`,onClick:this.editStart},(0,k.dW)("beatmaps.discussions.edit")),null==this.deleteModel.deleted_at&&this.canDelete&&a.createElement("a",{className:`js-beatmapset-discussion-update ${x}__action ${x}__action--button`,"data-confirm":(0,k.dW)("common.confirmation"),"data-method":"DELETE","data-remote":!0,href:this.deleteHref("destroy")},(0,k.dW)("beatmaps.discussions.delete")),null!=this.deleteModel.deleted_at&&this.canModerate&&a.createElement("a",{className:`js-beatmapset-discussion-update ${x}__action ${x}__action--button`,"data-confirm":(0,k.dW)("common.confirmation"),"data-method":"POST","data-remote":!0,href:this.deleteHref("restore")},(0,k.dW)("beatmaps.discussions.restore")),"discussion"===this.props.type&&(null===(e=this.props.discussion.current_user_attributes)||void 0===e?void 0:e.can_moderate_kudosu)&&(this.props.discussion.can_grant_kudosu?this.renderKudosuAction("deny"):this.props.discussion.kudosu_denied&&this.renderKudosuAction("allow")))}};Object.defineProperty(D,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{resolvedStateChangedPostId:-1}}),T([v.LO],D.prototype,"canSave",void 0),T([v.LO],D.prototype,"editing",void 0),T([v.LO],D.prototype,"message",void 0),T([v.LO],D.prototype,"textareaMinHeight",void 0),T([v.LO],D.prototype,"xhr",void 0),T([v.Fl],D.prototype,"canEdit",null),T([v.Fl],D.prototype,"canReport",null),T([v.Fl],D.prototype,"deleteModel",null),T([v.Fl],D.prototype,"isAdmin",null),T([v.Fl],D.prototype,"isOwn",null),T([v.Fl],D.prototype,"isPosting",null),T([v.Fl],D.prototype,"isReview",null),T([v.Fl],D.prototype,"isTimeline",null),T([v.aD],D.prototype,"editCancel",void 0),T([v.aD],D.prototype,"editStart",void 0),T([v.aD],D.prototype,"handleEditorChange",void 0),T([v.aD],D.prototype,"handleTextareaChange",void 0),T([v.aD],D.prototype,"updatePost",void 0),D=T([g.Pi],D);const R=D},4594:(e,t,s)=>{s.d(t,{_:()=>r});const r=s(7294).createContext({max_blocks:0})},3030:(e,t,s)=>{s.d(t,{j:()=>p,m:()=>u});var r=s(5813),a=s(9434),i=s(7294),n=s(7012),o=s(3336),l=s(1270),c=s(1480);function u(e){return{deleted:null!=e.deleted_at,"general-all":null==e.beatmap_id,praise:"praise"===e.message_type,resolved:e.resolved&&"praise"!==e.message_type}}const d="beatmap-discussion-review-post-embed-preview",p=({data:e,store:t})=>{const s=t.beatmaps,p=t.discussions.get(e.discussion_id);if(null==p)return i.createElement("div",{className:(0,o.sb)(d,["deleted","lighter"])},i.createElement("div",{className:`${d}__missing`},(0,l.dW)("beatmaps.discussions.review.embed.missing")));const m=(0,n.of)(p);if(null==m||m.system)return console.error("embed starting post is missing or is system post",p.id),null;const h=null==p.beatmap_id?void 0:s.get(p.beatmap_id),b=()=>{if(null!=p.parent_id)return i.createElement("div",{className:`${d}__link`},i.createElement("a",{className:`${d}__link-text js-beatmap-discussion--jump`,href:(0,n.bf)({discussion:p}),title:(0,l.dW)("beatmap_discussions.review.go_to_child")},i.createElement("i",{className:"fas fa-external-link-alt"})))};return i.createElement("div",{className:(0,o.sb)(d,"lighter",u(p))},i.createElement("div",{className:`${d}__content`},i.createElement("div",{className:`${d}__selectors`},i.createElement("div",{className:"icon-dropdown-menu icon-dropdown-menu--disabled"},null!=h&&i.createElement(a.p,{beatmap:h,withTooltip:!0}),null==p.beatmap_id&&i.createElement("i",{className:"fas fa-fw fa-star-of-life",title:(0,l.dW)("beatmaps.discussions.mode.scopes.generalAll")})),i.createElement("div",{className:"icon-dropdown-menu icon-dropdown-menu--disabled"},(()=>{const e=p.message_type;return i.createElement("div",null,i.createElement("span",{className:r.y[e],style:{color:`var(--beatmapset-discussion-colour--${e})`},title:(0,l.dW)(`beatmaps.discussions.message_type.${e}`)}))})()),i.createElement("div",{className:`${d}__timestamp`},i.createElement("div",{className:`${d}__timestamp-text`},null!==p.timestamp?(0,n.i$)(p.timestamp):(0,l.dW)("beatmap_discussions.timestamp_display.general"))),i.createElement("div",{className:`${d}__stripe`}),b()),i.createElement("div",{className:`${d}__stripe`}),i.createElement("div",{className:`${d}__message-container`},i.createElement("div",{className:`${d}__body`},i.createElement(c.Z,{markdown:m.message}))),b()))}},2786:(e,t,s)=>{s.d(t,{O:()=>u});var r=s(4929),a=s(4318),i=s(5119),n=s(7294),o=s(3336),l=s(1270);const c="beatmap-discussion-user-card";class u extends n.PureComponent{render(){return n.createElement("div",{className:c,style:(0,o.$$)(this.props.group)},n.createElement("div",{className:`${c}__avatar`},this.props.user.is_deleted?n.createElement("span",{className:`${c}__user-link`},n.createElement(r.Z,{modifiers:"full-rounded",user:this.props.user})):n.createElement("a",{className:`${c}__user-link`,href:(0,i.B)("users.show",{user:this.props.user.id})},n.createElement(r.Z,{modifiers:"full-rounded",user:this.props.user}))),n.createElement("div",{className:`${c}__user`},n.createElement("div",{className:`${c}__user-row`},this.props.user.is_deleted?n.createElement("span",{className:`${c}__user-link`},this.renderUsername()):n.createElement("a",{className:`${c}__user-link`,href:(0,i.B)("users.show",{user:this.props.user.id})},this.renderUsername()),!this.props.user.is_bot&&!this.props.user.is_deleted&&n.createElement("a",{className:`${c}__user-modding-history-link`,href:(0,i.B)("users.modding.index",{user:this.props.user.id}),title:(0,l.dW)("beatmap_discussion_posts.item.modding_history_link")},n.createElement("i",{className:"fas fa-align-left"}))),n.createElement("div",{className:`${c}__user-badge`},n.createElement(a.Z,{group:this.props.group}))),!this.props.hideStripe&&n.createElement("div",{className:`${c}__user-stripe`}))}renderUsername(){return n.createElement("span",{className:"u-ellipsis-overflow"},this.props.user.username)}}Object.defineProperty(u,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{hideStripe:!1}})},9119:(e,t,s)=>{s.d(t,{B:()=>R,Z:()=>F});var r=s(4057),a=s(7292),i=s(7735),n=s(4403),o=s(12),l=s(6871),c=s(5119),u=s(6486),d=s(8949),p=s(9323),m=s(5078),h=s(7294),b=s(92),f=s(7629),v=s(6817),g=s(3336),y=s(3775),w=s(1270),_=s(5076),E=s(1426),P=s(5863),O=s(9755),j=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};const k={entered:{opacity:1},entering:{},exited:{},exiting:{},unmounted:{}},N=(0,p.Pi)((({beatmaps:e})=>h.createElement("div",{className:"beatmaps-popup__group"},e.map((e=>h.createElement(S,{key:e.id,beatmap:e})))))),S=(0,p.Pi)((({beatmap:e})=>h.createElement("a",{className:"beatmaps-popup-item",href:(0,c.B)("beatmaps.show",{beatmap:e.id})},h.createElement(E.Z,{beatmap:e,mapper:null}))));let C=class extends h.Component{constructor(e){super(e),Object.defineProperty(this,"contentRef",{enumerable:!0,configurable:!0,writable:!0,value:h.createRef()}),Object.defineProperty(this,"position",{enumerable:!0,configurable:!0,writable:!0,value:{left:"0px",top:"0px",width:"0px"}}),Object.defineProperty(this,"updatePosition",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.props.parent;if(null==e)return;const t=e.getBoundingClientRect();this.position.top=`${window.scrollY+t.bottom}px`,this.position.left=`${window.scrollX+t.left}px`,this.position.width=`${t.width}px`}}),(0,d.rC)(this)}componentDidMount(){O(window).on("resize",this.updatePosition)}componentWillUnmount(){O(window).off("resize",this.updatePosition)}render(){this.updatePosition();const e=Object.assign(Object.assign({opacity:0,transitionDuration:`${this.props.transitionDuration}ms`},k[this.props.state]),this.position);return h.createElement(P.Z,null,h.createElement("div",{ref:this.contentRef,className:(0,g.sb)("beatmaps-popup",[`size-${m.Z.userPreferences.get("beatmapset_card_size")}`]),onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,style:e},h.createElement("div",{className:"beatmaps-popup__content"},[...this.props.groupedBeatmaps].map((([e,t])=>t.length>0&&h.createElement(N,{key:e,beatmaps:t}))))))}};j([d.LO],C.prototype,"position",void 0),j([d.aD],C.prototype,"updatePosition",void 0),C=j([p.Pi],C);const T=C;var x=s(9755),D=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};const R=["normal","extra"],M={approved:"ranked_date",graveyard:"last_updated",loved:"ranked_date",pending:"last_updated",qualified:"ranked_date",ranked:"ranked_date",wip:"last_updated"},I=(0,p.Pi)((({beatmap:e})=>h.createElement("div",{className:"beatmapset-panel__beatmap-dot",style:{"--bg":(0,f.yh)(e.difficulty_rating)}}))),L=(0,p.Pi)((({compact:e,beatmaps:t,mode:s})=>h.createElement("div",{className:"beatmapset-panel__extra-item beatmapset-panel__extra-item--dots"},h.createElement("div",{className:"beatmapset-panel__beatmap-icon"},h.createElement("i",{className:`fal fa-extra-mode-${s}`})),e?h.createElement("div",{className:"beatmapset-panel__beatmap-count"},t.length):t.map((e=>h.createElement(I,{key:e.id,beatmap:e})))))),A=(0,p.Pi)((({beatmapset:e})=>h.createElement(l.Z,{className:"beatmapset-panel__mapper-link u-hover",user:{id:e.user_id,username:e.creator}}))),$=({icon:e,titleVariant:t})=>h.createElement("div",{className:"beatmapset-panel__play-icon",title:(0,w.dW)(`beatmapsets.show.info.${t}`)},h.createElement("i",{className:e})),B=({icon:e,title:t,type:s,value:r})=>h.createElement("div",{className:`beatmapset-panel__stats-item beatmapset-panel__stats-item--${s}`,title:t},h.createElement("span",{className:"beatmapset-panel__stats-item-icon"},h.createElement("i",{className:`fa-fw ${e}`})),h.createElement("span",null,(0,y.Eu)(r)));let U=class extends h.Component{get beatmapDotsCompact(){return null!=this.props.beatmapset.beatmaps&&this.props.beatmapset.beatmaps.length>12}get displayDate(){const e=M[this.props.beatmapset.status],t=this.props.beatmapset[e];if(null==t)throw Error("trying to display null date");return t}get downloadLink(){var e;if(null==m.Z.currentUser)return{title:(0,w.dW)("beatmapsets.show.details.logged-out")};if(null===(e=this.props.beatmapset.availability)||void 0===e?void 0:e.download_disabled)return{title:(0,w.dW)("beatmapsets.availability.disabled")};let t,s,r=m.Z.userPreferences.get("beatmapset_download");if("direct"!==r||m.Z.currentUser.is_supporter||(r="all"),"direct"===r)t=(0,_.vU)(this.props.beatmapset.id),s="direct";else{const e={beatmapset:this.props.beatmapset.id};this.props.beatmapset.video?"no_video"===r?(e.noVideo=1,s="no_video"):s="video":s="all",t=(0,c.B)("beatmapsets.download",e)}return{title:(0,w.dW)(`beatmapsets.panel.download.${s}`),url:t}}get favourite(){return this.props.beatmapset.has_favourited?{icon:"fas fa-heart",toggleTitleVariant:"unfavourite"}:{icon:"far fa-heart",toggleTitleVariant:"favourite"}}get groupedBeatmaps(){return(0,f.ru)(this.props.beatmapset.beatmaps)}get isBeatmapsPopupVisible(){return this.beatmapsPopupHover||this.mobileExpanded}get nominations(){return null!=this.props.beatmapset.nominations_summary?this.props.beatmapset.nominations_summary:null!=this.props.beatmapset.nominations?this.props.beatmapset.nominations.legacy_mode?this.props.beatmapset.nominations:{current:(0,u.sum)((0,u.values)(this.props.beatmapset.nominations.current)),required:(0,u.sum)((0,u.values)(this.props.beatmapset.nominations.required))}:void 0}get showHypeCounts(){return null!=this.props.beatmapset.hype}get showVisual(){return(0,v.uX)(this.props.beatmapset)}get url(){return(0,c.B)("beatmapsets.show",{beatmapset:this.props.beatmapset.id})}constructor(e){super(e),Object.defineProperty(this,"beatmapsPopupHover",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"beatmapsPopupRef",{enumerable:!0,configurable:!0,writable:!0,value:h.createRef()}),Object.defineProperty(this,"blockRef",{enumerable:!0,configurable:!0,writable:!0,value:h.createRef()}),Object.defineProperty(this,"mobileExpanded",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"timeouts",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"beatmapsPopupDelayedHide",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.clearTimeout(this.timeouts.beatmapsPopup),this.beatmapsPopupHover&&(this.timeouts.beatmapsPopup=window.setTimeout((0,d.aD)((()=>{this.beatmapsPopupHover=!1})),500))}}),Object.defineProperty(this,"beatmapsPopupDelayedShow",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.clearTimeout(this.timeouts.beatmapsPopup),this.beatmapsPopupHover||(this.timeouts.beatmapsPopup=window.setTimeout((0,d.aD)((()=>{this.beatmapsPopupHover=!0})),100))}}),Object.defineProperty(this,"beatmapsPopupHide",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.clearTimeout(this.timeouts.beatmapsPopup),this.beatmapsPopupHover=!1}}),Object.defineProperty(this,"beatmapsPopupKeep",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.clearTimeout(this.timeouts.beatmapsPopup),this.beatmapsPopupHover=!0}}),Object.defineProperty(this,"onBeatmapsPopupEnter",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.beatmapsPopupKeep()}}),Object.defineProperty(this,"onBeatmapsPopupLeave",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.beatmapsPopupDelayedHide()}}),Object.defineProperty(this,"onDocumentClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s,r;this.mobileExpanded&&((null===(t=this.blockRef.current)||void 0===t?void 0:t.contains(e.target))||(null===(r=null===(s=this.beatmapsPopupRef.current)||void 0===s?void 0:s.contentRef.current)||void 0===r?void 0:r.contains(e.target))||(x(document).off("click",this.onDocumentClick),this.mobileExpanded=!1))}}),Object.defineProperty(this,"onExtraRowEnter",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.beatmapsPopupDelayedShow()}}),Object.defineProperty(this,"onExtraRowLeave",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.beatmapsPopupDelayedHide()}}),Object.defineProperty(this,"onMobileExpandToggleClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.mobileExpanded=!this.mobileExpanded,this.mobileExpanded&&x(document).on("click",this.onDocumentClick)}}),Object.defineProperty(this,"toggleFavourite",{enumerable:!0,configurable:!0,writable:!0,value:()=>{(0,v.F)(this.props.beatmapset)}}),(0,d.rC)(this)}componentWillUnmount(){x(document).off("click",this.onDocumentClick),Object.values(this.timeouts).forEach((e=>{window.clearTimeout(e)}))}render(){let e=(0,g.sb)("beatmapset-panel",{"beatmaps-popup-visible":this.isBeatmapsPopupVisible,"mobile-expanded":this.mobileExpanded,[`size-${m.Z.userPreferences.get("beatmapset_card_size")}`]:!0,"with-hype-counts":this.showHypeCounts});return this.showVisual&&(e+=" js-audio--player"),h.createElement("div",{ref:this.blockRef,className:e,"data-audio-url":this.props.beatmapset.preview_url,onMouseLeave:this.beatmapsPopupHide,style:{"--beatmaps-popup-transition-duration":"150ms"}},this.renderBeatmapsPopup(),this.renderCover(),h.createElement("div",{className:"beatmapset-panel__content"},this.renderPlayArea(),this.renderInfoArea(),this.renderMenuArea()),h.createElement("button",{className:"beatmapset-panel__mobile-expand",onClick:this.onMobileExpandToggleClick,type:"button"},h.createElement("span",{className:"fas fa-angle-"+(this.mobileExpanded?"up":"down")})))}renderBeatmapsPopup(){return h.createElement(b.ZP,{in:this.isBeatmapsPopupVisible,mountOnEnter:!0,timeout:{enter:0,exit:150},unmountOnExit:!0},(e=>h.createElement(T,{ref:this.beatmapsPopupRef,groupedBeatmaps:this.groupedBeatmaps,onMouseEnter:this.onBeatmapsPopupEnter,onMouseLeave:this.onBeatmapsPopupLeave,parent:this.blockRef.current,state:e,transitionDuration:150})))}renderCover(){return h.createElement("a",{className:"beatmapset-panel__cover-container",href:this.url},h.createElement("div",{className:"beatmapset-panel__cover-col beatmapset-panel__cover-col--play"},h.createElement(a.Z,{beatmapset:this.props.beatmapset,modifiers:"full",size:"list"})),h.createElement("div",{className:"beatmapset-panel__cover-col beatmapset-panel__cover-col--info"},m.Z.windowSize.isDesktop&&h.createElement(a.Z,{beatmapset:this.props.beatmapset,modifiers:"full",size:"card"})))}renderInfoArea(){return h.createElement("div",{className:"beatmapset-panel__info"},h.createElement("div",{className:"beatmapset-panel__info-row beatmapset-panel__info-row--title"},h.createElement("a",{className:"beatmapset-panel__main-link u-ellipsis-overflow",href:this.url},(0,v.YQ)(this.props.beatmapset)),h.createElement("div",{className:"beatmapset-panel__badge-container"},h.createElement(r.Z,{beatmapset:this.props.beatmapset,type:"nsfw"}),h.createElement(r.Z,{beatmapset:this.props.beatmapset,type:"spotlight"}))),h.createElement("div",{className:"beatmapset-panel__info-row beatmapset-panel__info-row--artist"},h.createElement("a",{className:"beatmapset-panel__main-link u-ellipsis-overflow",href:this.url},(0,w.dW)("beatmapsets.show.details.by_artist",{artist:(0,v.aU)(this.props.beatmapset)})),h.createElement("div",{className:"beatmapset-panel__badge-container"},h.createElement(r.Z,{beatmapset:this.props.beatmapset,type:"featured_artist"}))),h.createElement("div",{className:"beatmapset-panel__info-row beatmapset-panel__info-row--source"},h.createElement("div",{className:"u-ellipsis-overflow"},this.props.beatmapset.source)),h.createElement("div",{className:"beatmapset-panel__info-row beatmapset-panel__info-row--mapper"},h.createElement("div",{className:"u-ellipsis-overflow"},h.createElement(n.Z,{mappings:{mapper:h.createElement(A,{beatmapset:this.props.beatmapset})},pattern:(0,w.dW)("beatmapsets.show.details.mapped_by")}))),h.createElement("div",{className:"beatmapset-panel__info-row beatmapset-panel__info-row--stats"},this.showHypeCounts&&null!=this.props.beatmapset.hype&&h.createElement(B,{icon:"fas fa-bullhorn",title:(0,w.dW)("beatmaps.hype.required_text",{current:(0,y.uf)(this.props.beatmapset.hype.current),required:(0,y.uf)(this.props.beatmapset.hype.required)}),type:"hype",value:this.props.beatmapset.hype.current}),this.showHypeCounts&&null!=this.nominations&&h.createElement(B,{icon:"fas fa-thumbs-up",title:(0,w.dW)("beatmaps.nominations.required_text",{current:(0,y.uf)(this.nominations.current),required:(0,y.uf)(this.nominations.required)}),type:"nominations",value:this.nominations.current}),h.createElement(B,{icon:this.favourite.icon,title:(0,w.dW)("beatmaps.panel.favourites",{count:(0,y.uf)(this.props.beatmapset.favourite_count)}),type:"favourite-count",value:this.props.beatmapset.favourite_count}),h.createElement(B,{icon:"fas fa-play-circle",title:(0,w.dW)("beatmaps.panel.playcount",{count:(0,y.uf)(this.props.beatmapset.play_count)}),type:"play-count",value:this.props.beatmapset.play_count}),h.createElement("div",{className:"beatmapset-panel__stats-item beatmapset-panel__stats-item--date"},h.createElement("span",{className:"beatmapset-panel__stats-item-icon"},h.createElement("i",{className:"fa-fw fas fa-check-circle"})),h.createElement(o.Z,{dateTime:this.displayDate}))),h.createElement("a",{className:"beatmapset-panel__info-row beatmapset-panel__info-row--extra",href:this.url,onMouseEnter:this.onExtraRowEnter,onMouseLeave:this.onExtraRowLeave},h.createElement("div",{className:"beatmapset-panel__extra-item"},h.createElement("div",{className:"beatmapset-status beatmapset-status--panel",style:{"--bg-hsl":`var(--beatmapset-${this.props.beatmapset.status}-bg-hsl)`,"--colour":`var(--beatmapset-${this.props.beatmapset.status}-colour)`}},(0,w.dW)(`beatmapsets.show.status.${this.props.beatmapset.status}`))),[...this.groupedBeatmaps].map((([e,t])=>t.length>0&&h.createElement(L,{key:e,beatmaps:t,compact:this.beatmapDotsCompact,mode:e})))))}renderMenuArea(){return h.createElement("div",{className:"beatmapset-panel__menu-container"},h.createElement("div",{className:"beatmapset-panel__menu"},null==m.Z.currentUser?h.createElement("span",{className:"beatmapset-panel__menu-item beatmapset-panel__menu-item--disabled",title:(0,w.dW)("beatmapsets.show.details.favourite_login")},h.createElement("span",{className:this.favourite.icon})):h.createElement("button",{className:"beatmapset-panel__menu-item",onClick:this.toggleFavourite,title:(0,w.dW)(`beatmapsets.show.details.${this.favourite.toggleTitleVariant}`),type:"button"},h.createElement("span",{className:this.favourite.icon})),null==this.downloadLink.url?h.createElement("span",{className:"beatmapset-panel__menu-item beatmapset-panel__menu-item--disabled",title:this.downloadLink.title},h.createElement("span",{className:"fas fa-file-download"})):h.createElement("a",{className:"beatmapset-panel__menu-item","data-turbolinks":"false",href:this.downloadLink.url,title:this.downloadLink.title},h.createElement("span",{className:"fas fa-file-download"}))))}renderPlayArea(){return h.createElement("div",{className:"beatmapset-panel__play-container"},this.showVisual&&h.createElement("button",{className:"beatmapset-panel__play js-audio--play",type:"button"},h.createElement("span",{className:"play-button"})),h.createElement("div",{className:"beatmapset-panel__play-progress"},h.createElement(i.D,{current:0,ignoreProgress:!0,max:1,onlyShowAsWarning:!1,theme:"beatmapset-panel"})),h.createElement("div",{className:"beatmapset-panel__play-icons"},this.props.beatmapset.video&&h.createElement($,{icon:"fas fa-film",titleVariant:"video"}),this.props.beatmapset.storyboard&&h.createElement($,{icon:"fas fa-image",titleVariant:"storyboard"})))}};D([d.LO],U.prototype,"beatmapsPopupHover",void 0),D([d.LO],U.prototype,"mobileExpanded",void 0),D([d.Fl],U.prototype,"beatmapDotsCompact",null),D([d.Fl],U.prototype,"displayDate",null),D([d.Fl],U.prototype,"downloadLink",null),D([d.Fl],U.prototype,"favourite",null),D([d.Fl],U.prototype,"groupedBeatmaps",null),D([d.Fl],U.prototype,"isBeatmapsPopupVisible",null),D([d.Fl],U.prototype,"nominations",null),D([d.Fl],U.prototype,"showHypeCounts",null),D([d.Fl],U.prototype,"showVisual",null),D([d.Fl],U.prototype,"url",null),D([d.aD],U.prototype,"beatmapsPopupHide",void 0),D([d.aD],U.prototype,"beatmapsPopupKeep",void 0),D([d.aD],U.prototype,"onDocumentClick",void 0),D([d.aD],U.prototype,"onMobileExpandToggleClick",void 0),U=D([p.Pi],U);const F=U},434:(e,t,s)=>{s.d(t,{Z:()=>l});var r=s(5119),a=s(1270),i=s(9696);const n=["show","discussions"];function o(e,t){switch(e){case"discussions":return(0,r.B)("beatmapsets.discussion",{beatmapset:t.id});case"show":if(null==t)throw new Error("can't make show url without beatmapset");return(0,r.B)("beatmapsets.show",{beatmapset:t.id});default:return(0,i.Q)(e),""}}function l(e,t){return n.map((s=>({active:s===e,title:(0,a.dW)(`layout.header.beatmapsets.${s}`),url:o(s,t)})))}},849:(e,t,s)=>{s.d(t,{C4:()=>m,C8:()=>c,IQ:()=>v,In:()=>l,JJ:()=>h,Ki:()=>f,_U:()=>d,bG:()=>g,mr:()=>u,vE:()=>p,zJ:()=>b});var r=s(5119),a=s(8949),i=s(9603),n=s(5078),o=s(9755);function l(e,t){return o.post((0,r.B)("chat.ack"),{history_since:t,since:e})}function c(e){return o.post((0,r.B)("chat.channels.store"),e)}function u(e){return o.get((0,r.B)("chat.channels.show",{channel:e})).then((0,a.aD)((e=>(n.Z.dataStore.userStore.updateMany(e.users),e.channel))))}function d(e,t){return o.get((0,r.B)("chat.channels.messages.index",Object.assign({channel:e,return_object:1},t))).then((0,a.aD)((e=>(n.Z.dataStore.userStore.updateMany(e.users),e.messages.map((e=>i.Z.fromJson(e)))))))}function p(){return o.get((0,r.B)("chat.channels.index"))}function m(e,t){return o.get((0,r.B)("chat.updates"),{history_since:t,includes:["presence","silences"],since:e})}function h(e,t){return o.ajax({type:"PUT",url:(0,r.B)("chat.channels.join",{channel:e,user:t})})}function b(e,t){return o.ajax({type:"PUT",url:(0,r.B)("chat.channels.mark-as-read",{channel:e,message:t})})}function f(e,t){return o.post((0,r.B)("chat.new"),{is_action:t.isAction,message:t.content,target_id:e,uuid:t.uuid})}function v(e,t){return o.ajax((0,r.B)("chat.channels.part",{channel:e,user:t}),{method:"DELETE"})}function g(e){return o.post((0,r.B)("chat.channels.messages.store",{channel:e.channelId}),{is_action:e.isAction,message:e.content,target_id:e.channelId,target_type:"channel",uuid:e.uuid})}},6699:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(5078),a=s(7294),i=s(9139);class n extends a.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:`admin-menu-${(0,i.d)()}`})}render(){var e;if(!(null===(e=r.Z.currentUser)||void 0===e?void 0:e.is_admin))return null;const t=this.props.items.map((e=>a.createElement(e.component,Object.assign({key:`${e.icon}-${e.text}`,className:"admin-menu-item"},e.props),a.createElement("span",{className:"admin-menu-item__content"},a.createElement("span",{className:"admin-menu-item__label admin-menu-item__label--icon"},a.createElement("span",{className:e.icon})),a.createElement("span",{className:"admin-menu-item__label admin-menu-item__label--text"},e.text)))));return a.createElement("div",{className:"admin-menu"},a.createElement("button",{className:"admin-menu__button js-menu","data-menu-target":`admin-menu-${this.eventId}`},a.createElement("span",{className:"fas fa-angle-up"}),a.createElement("span",{className:"admin-menu__button-icon fas fa-tools"})),a.createElement("div",{className:"admin-menu__menu js-menu","data-menu-id":`admin-menu-${this.eventId}`,"data-visibility":"hidden"},t))}}},8079:(e,t,s)=>{s.d(t,{Z:()=>u});var r=s(8949),a=s(9323),i=s(7294),n=s(1270),o=s(9755),l=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let c=class extends i.Component{constructor(e){super(e),Object.defineProperty(this,"lastScrollY",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"reset",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.lastScrollY=null}}),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t,s;if(null==this.lastScrollY){const r=null==(null===(e=this.props.anchor)||void 0===e?void 0:e.current)?0:null!==(s=null===(t=o(this.props.anchor.current).offset())||void 0===t?void 0:t.top)&&void 0!==s?s:0;window.pageYOffset>r&&(this.lastScrollY=window.pageYOffset,window.scrollTo(window.pageXOffset,r),this.mountObserver())}else window.scrollTo(window.pageXOffset,this.lastScrollY),this.lastScrollY=null}}),Object.defineProperty(this,"onScroll",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.lastScrollY=null,document.removeEventListener("scroll",this.onScroll),this.removeObserver()}}),(0,r.rC)(this)}componentWillUnmount(){document.removeEventListener("scroll",this.onScroll),this.removeObserver()}render(){return i.createElement("button",{className:"back-to-top","data-tooltip-float":"fixed",onClick:this.onClick,title:(0,n.dW)(null==this.lastScrollY?"common.buttons.back_to_top":"common.buttons.back_to_previous")},i.createElement("span",{className:null==this.lastScrollY?"fas fa-angle-up":"fas fa-angle-down"}))}mountObserver(){var e,t;const s=null!==(t=null===(e=this.props.anchor)||void 0===e?void 0:e.current)&&void 0!==t?t:document.body;this.observer=new IntersectionObserver((e=>{for(const t of e)if(t.target===s&&0===t.boundingClientRect.top){document.addEventListener("scroll",this.onScroll);break}})),this.observer.observe(s)}removeObserver(){null!=this.observer&&(this.observer.disconnect(),this.observer=null)}};l([r.LO],c.prototype,"lastScrollY",void 0),l([r.aD],c.prototype,"reset",void 0),l([r.aD],c.prototype,"onClick",void 0),l([r.aD],c.prototype,"onScroll",void 0),c=l([a.Pi],c);const u=c},7868:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(6486),a=s(7294),i=s(3336),n=s(3775);function o(e){let t=0===e.total?0:e.current/e.total;return t=(0,r.clamp)(t,0,1),a.createElement("div",{className:(0,i.sb)("bar",e.modifiers),style:{"--fill":100*t+"%"},title:e.title},a.createElement("div",{className:"bar__fill"}),null!=e.textPrecision&&a.createElement("div",{className:"bar__text"},(0,n.uf)(t,e.textPrecision,{style:"percent"})))}},1228:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(7018),a=s(5119),i=s(7294),n=s(9014);class o extends i.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"handleChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{(0,n.c4)(this.href(e.id))}}),Object.defineProperty(this,"renderOption",{enumerable:!0,configurable:!0,writable:!0,value:e=>i.createElement("a",{key:e.option.id,className:e.cssClasses,href:this.href(e.option.id),onClick:e.onClick},e.children)})}render(){return i.createElement(r.Z,{modifiers:"basic",onChange:this.handleChange,options:this.props.items,renderOption:this.renderOption,selected:this.props.currentItem})}href(e){switch(this.props.type){case"judge_results":return(0,a.B)("contest-entries.judge-results",{contest_entry:null!=e?e:0});case"multiplayer":return(0,a.B)("multiplayer.rooms.show",{room:null!=e?e:"latest"});case"seasons":return(0,a.B)("seasons.show",{season:null!=e?e:"latest"})}}}},9006:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(6486),a=s(7294),i=s(3336),n=s(1270),o=s(5076);class l extends a.Component{constructor(){super(...arguments),Object.defineProperty(this,"bodyRef",{enumerable:!0,configurable:!0,writable:!0,value:a.createRef()}),Object.defineProperty(this,"sizeSelectRef",{enumerable:!0,configurable:!0,writable:!0,value:a.createRef()}),Object.defineProperty(this,"cancel",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;((null===(t=this.bodyRef.current)||void 0===t?void 0:t.value)===this.props.rawValue||confirm((0,n.dW)("common.confirmation_unsaved")))&&(null!=this.bodyRef.current&&(this.bodyRef.current.value=this.props.rawValue),this.sendOnChange({event:e,type:"cancel"}))}}),Object.defineProperty(this,"onKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.props.ignoreEsc||"Escape"!==e.key||this.cancel()}}),Object.defineProperty(this,"save",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.sendOnChange({event:e,type:"save"})}})}componentDidMount(){null!=this.sizeSelectRef.current&&(this.sizeSelectRef.current.value=""),null!=this.bodyRef.current&&(this.bodyRef.current.selectionEnd=0,this.bodyRef.current.focus())}render(){let e=(0,i.sb)("bbcode-editor",this.props.modifiers);return e+=" js-bbcode-preview--form",a.createElement("form",{className:e,"data-state":"write"},a.createElement("div",{className:"bbcode-editor__content"},a.createElement("textarea",{ref:this.bodyRef,className:"bbcode-editor__body js-bbcode-preview--body",defaultValue:this.props.rawValue,disabled:this.props.disabled,name:"body",onKeyDown:this.onKeyDown,placeholder:this.props.placeholder}),a.createElement("div",{className:"bbcode-editor__preview"},a.createElement("div",{className:"forum-post-content js-bbcode-preview--preview"})),a.createElement("div",{className:"bbcode-editor__buttons-bar"},a.createElement("div",{className:"bbcode-editor__buttons bbcode-editor__buttons--toolbar"},this.renderToolbar()),a.createElement("div",{className:"bbcode-editor__buttons bbcode-editor__buttons--actions"},a.createElement("div",{className:"bbcode-editor__button bbcode-editor__button--cancel"},this.actionButton(this.cancel,(0,n.dW)("common.buttons.cancel"))),a.createElement("div",{className:"bbcode-editor__button bbcode-editor__button--hide-on-write"},this.renderPreviewHideButton()),a.createElement("div",{className:"bbcode-editor__button bbcode-editor__button--hide-on-preview"},this.renderPreviewShowButton()),a.createElement("div",{className:"bbcode-editor__button"},this.actionButton(this.save,(0,n.dW)("common.buttons.save"),"forum-primary"))))))}actionButton(e,t,s="forum-secondary"){return a.createElement("button",{className:(0,i.sb)("btn-osu-big",s),disabled:this.props.disabled,onClick:e,type:"button"},t)}renderPreviewHideButton(){return a.createElement("button",{className:"js-bbcode-preview--hide btn-osu-big btn-osu-big--forum-secondary",disabled:this.props.disabled,type:"button"},(0,n.dW)("forum.topic.create.preview_hide"))}renderPreviewShowButton(){return a.createElement("button",{className:"js-bbcode-preview--show btn-osu-big btn-osu-big--forum-secondary",disabled:this.props.disabled,type:"button"},(0,n.dW)("forum.topic.create.preview"))}renderToolbar(){return a.createElement("div",{className:"post-box-toolbar"},this.toolbarButton("bold","fas fa-bold"),this.toolbarButton("italic","fas fa-italic"),this.toolbarButton("strikethrough","fas fa-strikethrough"),this.toolbarButton("heading","fas fa-heading"),this.toolbarButton("link","fas fa-link"),this.toolbarButton("spoilerbox","fas fa-barcode"),this.toolbarButton("list-numbered","fas fa-list-ol"),this.toolbarButton("list","fas fa-list"),this.toolbarButton("image","fas fa-image"),this.toolbarButton("imagemap","fas fa-map"),this.toolbarSizeSelect(),a.createElement("a",{className:"post-box-toolbar__help",href:(0,o.dP)("BBCode"),rel:"noreferrer",target:"_blank"},(0,n.dW)("bbcode.help")))}sendOnChange({event:e,type:t}){var s,r;this.props.onChange({event:e,hasChanged:(null===(s=this.bodyRef.current)||void 0===s?void 0:s.value)!==this.props.rawValue,type:t,value:null===(r=this.bodyRef.current)||void 0===r?void 0:r.value})}toolbarButton(e,t){return a.createElement("button",{className:`btn-circle btn-circle--bbcode js-bbcode-btn--${e}`,disabled:this.props.disabled,title:(0,n.dW)(`bbcode.${(0,r.snakeCase)(e)}`),type:"button"},a.createElement("span",{className:"btn-circle__content"},a.createElement("span",{className:t})))}toolbarSizeSelect(){return a.createElement("label",{className:"bbcode-size-select",title:(0,n.dW)("bbcode.size._")},a.createElement("span",{className:"bbcode-size-select__label"},(0,n.dW)("bbcode.size._")),a.createElement("i",{className:"fas fa-chevron-down"}),a.createElement("select",{ref:this.sizeSelectRef,className:"bbcode-size-select__select js-bbcode-btn--size",disabled:this.props.disabled},a.createElement("option",{value:"50"},(0,n.dW)("bbcode.size.tiny")),a.createElement("option",{value:"85"},(0,n.dW)("bbcode.size.small")),a.createElement("option",{value:"100"},(0,n.dW)("bbcode.size.normal")),a.createElement("option",{value:"150"},(0,n.dW)("bbcode.size.large"))))}}Object.defineProperty(l,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{disabled:!1,ignoreEsc:!1}});const c=l},152:(e,t,s)=>{s.d(t,{Z:()=>d});var r=s(9323),a=s(7294),i=s(3775),n=s(1270),o=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};const l="beatmap-basic-stats",c=["total_length","bpm","count_circles","count_sliders"];let u=class extends a.Component{constructor(){super(...arguments),Object.defineProperty(this,"renderEntry",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t={};let s="";const r=this.props.beatmap[e];let o;switch(e){case"bpm":{r>1e3&&(o="∞");const e=this.props.beatmapset.offset;0!==e&&(s+=` (${(0,n.dW)("beatmapsets.show.stats.offset",{offset:(0,i.uf)(e)})})`);break}case"total_length":o=(0,i.LU)(this.props.beatmap[e]),t.hit_length=(0,i.LU)(this.props.beatmap.hit_length)}return null!=o||(o=(0,i.uf)(r)),a.createElement("div",{key:e,className:`${l}__entry`,title:`${(0,n.dW)(`beatmapsets.show.stats.${e}`,t)}${s}`},a.createElement("div",{className:`${l}__entry-icon`,style:{backgroundImage:`url(/images/layout/beatmapset-page/${e}.svg)`}}),a.createElement("span",null,o))}})}render(){return a.createElement("div",{className:l},c.map(this.renderEntry))}};u=o([r.Pi],u);const d=u},9434:(e,t,s)=>{s.d(t,{p:()=>u});var r=s(7294),a=s(7762),i=s(7629),n=s(3336),o=s(9139),l=s(6793),c=s(9755);class u extends r.Component{constructor(){super(...arguments),Object.defineProperty(this,"tooltipId",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"handleMouseOver",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(!this.props.withTooltip)return;const t=e.currentTarget;if(t._tooltip===this.tooltipId)return;const s=c((0,a.renderToStaticMarkup)(r.createElement("div",{className:"tooltip-beatmap"},r.createElement("div",{className:"tooltip-beatmap__content"},r.createElement("div",null,this.props.beatmap.version),r.createElement(l.Z,{rating:this.props.beatmap.difficulty_rating})))));if(null!=t._tooltip)return t._tooltip=this.tooltipId,void c(t).qtip("set",{"content.text":s});t._tooltip=this.tooltipId;const i={content:s,hide:"touchstart"===e.type?{event:"touchstart unfocus",inactive:3e3}:{event:"click mouseleave"},overwrite:!1,position:{at:"top center",my:"bottom center",viewport:c(window)},show:{event:e.type,ready:!0},style:{classes:"qtip qtip--tooltip-beatmap",tip:{height:9,width:10}}};c(t).qtip(i,e)}})}render(){this.tooltipId=`beatmap-icon-${this.props.beatmap.id}-${(0,o.d)()}`;const e=this.props.beatmap.convert&&!this.props.showConvertMode?"osu":this.props.beatmap.mode,t=(0,n.sb)("beatmap-icon",this.props.modifiers,{"with-hover":this.props.withTooltip}),s={"--diff":(0,i.yh)(this.props.beatmap.difficulty_rating)};return r.createElement("div",{className:t,onMouseOver:this.handleMouseOver,onTouchStart:this.handleMouseOver,style:s},r.createElement("i",{className:`fal fa-extra-mode-${e}`}))}}Object.defineProperty(u,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{showConvertMode:!1,withTooltip:!1}})},1426:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(6793),a=s(6871),i=s(7294),n=s(3336),o=s(1270),l=s(4403);class c extends i.PureComponent{render(){const e="deleted_at"in this.props.beatmap&&null!==this.props.beatmap.deleted_at,t=`${this.props.beatmap.version}${e?` [${(0,o.dW)("beatmap_discussions.index.deleted_beatmap")}]`:""}`;return i.createElement("div",{className:(0,n.sb)("beatmap-list-item",{deleted:e,inline:this.props.inline},this.props.modifiers)},i.createElement("div",{className:"beatmap-list-item__col beatmap-list-item__col--icon"},i.createElement("span",{className:`fal fa-extra-mode-${this.props.beatmap.mode}`})),i.createElement("div",{className:"beatmap-list-item__col"},i.createElement(r.Z,{rating:this.props.beatmap.difficulty_rating})),i.createElement("div",{className:"beatmap-list-item__col beatmap-list-item__col--main"},i.createElement("div",{className:"beatmap-list-item__version "+(this.props.inline?"":"u-ellipsis-overflow")},null!=this.props.beatmapUrl?i.createElement("a",{className:"beatmap-list-item__version-link",href:this.props.beatmapUrl},t):t," ",i.createElement("span",{className:"beatmap-list-item__mapper"},this.renderMapper()))))}renderMapper(){if(null==this.props.mapper)return null;const e=this.props.beatmapset.user_id!==this.props.beatmap.user_id;if(!e&&!this.props.showNonGuestMapper)return null;const t=e?"mapped_by_guest":"mapped_by",s=e?this.props.mapper:{id:this.props.beatmapset.user_id,username:this.props.beatmapset.creator};return i.createElement(l.Z,{mappings:{mapper:i.createElement(a.Z,{user:s})},pattern:(0,o.dW)(`beatmapsets.show.details.${t}`)})}}},4057:(e,t,s)=>{s.d(t,{Z:()=>l});var r=s(5119),a=s(7294),i=s(3336),n=s(1270),o=s(5076);function l(e){let t;switch(e.type){case"featured_artist":if(null==e.beatmapset.track_id)return null;t=(0,r.B)("tracks.show",{track:e.beatmapset.track_id});break;case"nsfw":if(!e.beatmapset.nsfw)return null;break;case"spotlight":if(!e.beatmapset.spotlight)return null;t=(0,o.dP)("Beatmap_Spotlights")}const s=(0,n.dW)(`beatmapsets.${e.type}_badge.label`),l=(0,i.sb)("beatmapset-badge",e.modifiers,e.type);return null==t?a.createElement("span",{className:l},s):a.createElement("a",{className:l,href:t},s)}},7292:(e,t,s)=>{s.d(t,{Z:()=>l});var r=s(7294),a=s(6817),i=s(3336),n=s(3775),o=s(1270);function l(e){var t;const s=(0,i.sb)("beatmapset-cover",e.modifiers);if(null!==(t=e.isDeleted)&&void 0!==t&&t)return r.createElement("div",{className:s,title:(0,o.dW)("beatmapsets.cover.deleted")},r.createElement("span",{className:"fas fa-trash"}));const l=null!=e.beatmapset&&(e.forceShowVisual||(0,a.uX)(e.beatmapset))?(0,n.ib)(e.beatmapset.covers[e.size]):void 0;return r.createElement("div",{className:s,style:l})}},9394:(e,t,s)=>{s.d(t,{Z:()=>v});var r=s(4985),a=s(7292),i=s(12),n=s(5119),o=s(6486),l=s(8125),c=s(7294),u=s(7012),d=s(3336),p=s(3775),m=s(1270),h=s(4403),b=s(6871);function f(e){return"string"==typeof e?e.toLowerCase().replace(/ /g,"-"):""}class v extends c.PureComponent{get beatmapsetId(){var e;return null===(e=this.props.event.beatmapset)||void 0===e?void 0:e.id}get discussionId(){const e=this.props.event.comment;if(null!=e&&"object"==typeof e&&"beatmap_discussion_id"in e)return e.beatmap_discussion_id}get discussion(){var e,t;return null!==(e=this.props.event.discussion)&&void 0!==e?e:null===(t=this.props.discussions)||void 0===t?void 0:t.get(this.discussionId)}get firstPost(){var e,t,s,r;const a=null!==(t=null===(e=this.discussion)||void 0===e?void 0:e.starting_post)&&void 0!==t?t:null===(r=null===(s=this.discussion)||void 0===s?void 0:s.posts)||void 0===r?void 0:r[0];return(null==a?void 0:a.system)?null:a}render(){return"discussions"===this.props.mode?this.renderDiscussionsVersion():this.renderProfileVersion()}renderDiscussionsVersion(){var e;const t=null!==(e=this.props.time)&&void 0!==e?e:this.props.event.created_at;return c.createElement("div",{className:"beatmapset-event"},c.createElement("div",{className:"beatmapset-event__icon",style:this.iconStyle()}),c.createElement("div",{className:"beatmapset-event__time"},c.createElement(i.Z,{dateTime:t,format:"LT"})),c.createElement("div",{className:"beatmapset-event__content"},this.content()))}renderProfileVersion(){let e;return null!=this.beatmapsetId&&(e=(0,n.B)("beatmapsets.discussion",{beatmapset:this.beatmapsetId}),null!=this.discussionId&&(e=`${e}#/${this.discussionId}`)),c.createElement("div",{className:"beatmapset-event"},null!=e?c.createElement("a",{href:e},c.createElement(a.Z,{beatmapset:this.props.event.beatmapset,size:"list"})):c.createElement(a.Z,{isDeleted:!0}),c.createElement("div",{className:(0,d.sb)("beatmapset-event__icon",["beatmapset-activities"]),style:this.iconStyle()}),c.createElement("div",null,c.createElement("div",{className:"beatmapset-event__content"},this.content()),c.createElement("div",{className:"beatmap-discussion-post__info"},c.createElement(i.Z,{dateTime:this.props.event.created_at,relative:!0}))))}content(){var e,t,s,a;let i,o="",d="[unknown user]",v="",g="";if(null!=this.discussionId){if(null==this.discussion)g=(0,n.B)("beatmapsets.discussions.show",{discussion:this.discussionId}),v=(0,m.dW)("beatmapset_events.item.discussion_deleted");else{const s=null===(e=this.firstPost)||void 0===e?void 0:e.message;g=(0,u.bf)({discussion:this.discussion}),v=null!=s?c.createElement(r.Z,{markdown:s}):"[no preview]";const a=null!==(t=this.props.users.get(this.discussion.user_id))&&void 0!==t?t:l.z7;d=c.createElement(b.Z,{user:a})}o=c.createElement("a",{className:"js-beatmap-discussion--jump",href:g},`#${this.discussionId}`)}else"string"==typeof this.props.event.comment&&(v=this.props.event.comment);if("discussion_lock"!==this.props.event.type&&"remove_from_loved"!==this.props.event.type||(v=this.props.event.comment.reason),null!=this.props.event.user_id){const e=this.props.users.get(this.props.event.user_id);i=null!=e?c.createElement(b.Z,{user:e}):l.ei.username}const y={discussion:o,discussion_user:d,text:v,user:i};if(null!=this.props.event.comment&&"object"==typeof this.props.event.comment)for(const[r,n]of Object.entries(this.props.event.comment))"number"!=typeof n&&"string"!=typeof n||(y[r]=n);let w=this.props.event.type;switch(this.props.event.type){case"disqualify":"string"==typeof this.props.event.comment&&(w="disqualify_legacy");break;case"genre_edit":y.new=(0,m.dW)(`beatmaps.genre.${f(this.props.event.comment.new)}`),y.old=(0,m.dW)(`beatmaps.genre.${f(this.props.event.comment.old)}`);break;case"language_edit":y.new=(0,m.dW)(`beatmaps.language.${f(this.props.event.comment.new)}`),y.old=(0,m.dW)(`beatmaps.language.${f(this.props.event.comment.old)}`);break;case"nominate":{const e=null===(s=this.props.event.comment)||void 0===s?void 0:s.modes;if(null!=e&&e.length>0){w="nominate_modes";const t=e.map((e=>(0,m.dW)(`beatmaps.mode.${e}`)));y.modes=(0,m.m2)(t)}break}case"nsfw_toggle":w+=`.${(null===(a=this.props.event.comment)||void 0===a?void 0:a.new)?"to_1":"to_0"}`;break;case"beatmap_owner_change":{const e=this.props.event.comment;y.new_user=c.createElement("a",{href:(0,n.B)("users.show",{user:e.new_user_id})},e.new_user_username),y.beatmap=c.createElement("a",{href:(0,n.B)("beatmaps.show",{beatmap:e.beatmap_id})},e.beatmap_version);break}case"nomination_reset_received":{const e=this.props.event.comment;"profile"===this.props.mode?(w+="_profile",y.user=c.createElement("a",{href:(0,n.B)("users.show",{user:e.source_user_id})},e.source_user_username)):y.source_user=c.createElement("a",{href:(0,n.B)("users.show",{user:e.source_user_id})},e.source_user_username);break}case"offset_edit":y.new=(0,p.uf)(this.props.event.comment.new),y.old=(0,p.uf)(this.props.event.comment.old)}const _=`beatmapset_events.event.${w}`;let E=(0,m.dW)(_);return null==i||(0,m.dW)(_).includes(":user")||(E+=" (:user)"),c.createElement(h.Z,{mappings:y,pattern:E})}iconStyle(){return{"--bg":`var(--bg-${(0,o.kebabCase)(this.props.event.type)})`}}}},714:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(9394),a=s(7294);class i extends a.PureComponent{render(){return this.props.events.map((e=>a.createElement(r.Z,{key:e.id,event:e,mode:this.props.mode,users:this.props.users})))}}},5855:(e,t,s)=>{s.d(t,{Z:()=>d});var r=s(4403),a=s(12),i=s(4929),n=s(6871),o=s(381),l=s(7294),c=s(1270);const u="beatmapset-mapping";class d extends l.PureComponent{render(){var e;const t={username:this.props.beatmapset.creator},s=null!==(e=this.props.user)&&void 0!==e?e:this.props.beatmapset.user;return null!=s&&(t.id=s.id,t.avatar_url=s.avatar_url),l.createElement("div",{className:u},l.createElement(n.Z,{user:t},l.createElement(i.Z,{modifiers:"beatmapset",user:t})),l.createElement("div",{className:`${u}__content`},l.createElement("div",{className:`${u}__mapper`},l.createElement(r.Z,{mappings:{mapper:l.createElement(n.Z,{className:`${u}__user`,user:t})},pattern:(0,c.dW)("beatmapsets.show.details.mapped_by")})),this.renderDate("submitted","submitted_date"),this.props.beatmapset.ranked>0?this.renderDate(this.props.beatmapset.status,"ranked_date"):this.renderDate("updated","last_updated")))}renderDate(e,t){const s=this.props.beatmapset[t];if(null==s)throw new Error(`beatmapset data is missing the expected date attribute: ${t}`);const i=Math.abs(o().diff(o(s),"weeks"))<4;return l.createElement("div",null,l.createElement(r.Z,{mappings:{timeago:l.createElement("strong",null,l.createElement(a.Z,{dateTime:s,relative:i}))},pattern:(0,c.dW)(`beatmapsets.show.details_date.${e}`)}))}}},7010:(e,t,s)=>{s.d(t,{Z:()=>l});var r=s(7294),a=s(3336),i=s(3924),n=s(6741);class o extends r.Component{get disabled(){return this.props.disabled||this.props.isBusy}get text(){return null==this.props.text?null:"string"==typeof this.props.text?{top:this.props.text}:this.props.text}render(){let e=(0,a.sb)("btn-osu-big",this.props.modifiers,{disabled:this.disabled});return null!=this.props.extraClasses&&(e+=` ${this.props.extraClasses.join(" ")}`),this.disabled?r.createElement("span",Object.assign({className:e},this.props.props,{onClick:void 0}),this.renderChildren()):(0,i.W)(this.props.href)?r.createElement("a",Object.assign({className:e,href:this.props.href},this.props.props),this.renderChildren()):r.createElement("button",Object.assign({className:e,type:this.props.isSubmit?"submit":"button"},this.props.props),this.renderChildren())}renderChildren(){const e=this.text;return r.createElement("span",{className:(0,a.sb)("btn-osu-big__content",{center:null==e||null==this.props.icon})},null!=e&&r.createElement("span",{className:"btn-osu-big__left"},r.createElement("span",{className:"btn-osu-big__text-top"},e.top),"bottom"in e&&null!=e.bottom&&r.createElement("span",{className:"btn-osu-big__text-bottom"},e.bottom)),null!=this.props.icon&&r.createElement("span",{className:"btn-osu-big__icon"},r.createElement("span",{className:"fa fa-fw"},this.props.isBusy?r.createElement(n.$,{modifiers:"center-inline"}):r.createElement("span",{className:this.props.icon}))))}}Object.defineProperty(o,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{disabled:!1,extraClasses:[],isBusy:!1,isSubmit:!1,props:{}}});const l=o},5069:(e,t,s)=>{s.d(t,{Z:()=>f});var r=s(5119),a=s(8949),i=s(9323),n=s(5078),o=s(7294),l=s(9703),c=s(3336),u=s(1270),d=s(6741),p=s(9755),m=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};const h="textual-button";let b=class extends o.Component{get block(){var e;return null===(e=n.Z.currentUser)||void 0===e?void 0:e.blocks.find((e=>e.target_id===this.props.userId))}constructor(e){super(e),Object.defineProperty(this,"loading",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clicked",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t;confirm((0,u.dW)("common.confirmation"))?this.toggleBlock():null===(t=(e=this.props).onClick)||void 0===t||t.call(e)}}),Object.defineProperty(this,"toggleBlock",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.loading=!0,null==this.block?this.xhr=p.ajax((0,r.B)("blocks.store",{target:this.props.userId}),{type:"POST"}):this.xhr=p.ajax((0,r.B)("blocks.destroy",{block:this.props.userId}),{type:"DELETE"}),this.xhr.done(this.updateBlocks).fail((0,l.Gi)(this.toggleBlock)).always((0,a.aD)((()=>this.loading=!1)))}}),Object.defineProperty(this,"updateBlocks",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;null!=n.Z.currentUser&&(n.Z.currentUser.blocks=e.filter((e=>"block"===e.relation_type)),n.Z.currentUser.friends=e.filter((e=>"friend"===e.relation_type))),null===(s=(t=this.props).onClick)||void 0===s||s.call(t)}}),(0,a.rC)(this)}get isVisible(){return null!=n.Z.currentUser&&Number.isFinite(this.props.userId)&&this.props.userId!==n.Z.currentUser.id}componentWillUnmount(){var e;null===(e=this.xhr)||void 0===e||e.abort()}render(){if(!this.isVisible)return null;const e=(0,c.sb)(h,this.props.modifiers,"block");let t,s;return null==this.props.wrapperClass?s=e:(t=e,s=this.props.wrapperClass),o.createElement("button",{className:s,disabled:this.loading,onClick:this.clicked,type:"button"},o.createElement("span",{className:t},this.loading?o.createElement("span",{className:`${h}__icon fa-fw`},o.createElement(d.$,null)):o.createElement("span",{className:`${h}__icon fas fa-ban fa-fw`})," ",null==this.block?(0,u.dW)("users.blocks.button.block"):(0,u.dW)("users.blocks.button.unblock")))}};m([a.LO],b.prototype,"loading",void 0),m([a.Fl],b.prototype,"block",null),m([a.Fl],b.prototype,"isVisible",null),m([a.aD],b.prototype,"toggleBlock",void 0),m([a.aD],b.prototype,"updateBlocks",void 0),b=m([i.Pi],b);const f=b},7735:(e,t,s)=>{s.d(t,{D:()=>n});var r=s(7294),a=s(3336),i=s(3924);class n extends r.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"bn",{enumerable:!0,configurable:!0,writable:!0,value:"circular-progress"})}render(){var e;const t=this.bn,s=Math.min(1,this.props.current/this.props.max);if(this.props.onlyShowAsWarning&&s<.75)return null;const n=this.props.ignoreProgress?void 0:{transform:`rotate(${s}turn)`};return r.createElement("div",{className:(0,a.sb)(t,{over:1===s,over50:s>.5,warn:s>=.75&&s<1,[this.props.theme]:(0,i.W)(this.props.theme)}),title:null!==(e=this.props.tooltip)&&void 0!==e?e:`${this.props.current} / ${this.props.max}`},r.createElement("div",{className:`${t}__label`},this.props.max-this.props.current),r.createElement("div",{className:`${t}__slice`},r.createElement("div",{className:`${t}__circle`,style:n}),r.createElement("div",{className:`${t}__circle ${t}__circle--fill`})))}}Object.defineProperty(n,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{ignoreProgress:!1,onlyShowAsWarning:!1,theme:""}})},9240:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(5859),a=s(7294),i=s(1270),n=s(9755);const o="click-to-copy";class l extends a.Component{constructor(){super(...arguments),Object.defineProperty(this,"linkRef",{enumerable:!0,configurable:!0,writable:!0,value:a.createRef()}),Object.defineProperty(this,"timer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"titles",{enumerable:!0,configurable:!0,writable:!0,value:{default:(0,i.dW)("common.buttons.click_to_copy"),onClick:(0,i.dW)("common.buttons.click_to_copy_copied")}}),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault(),r.writeText(this.props.value);const t=this.api;null!=t&&(t.set("content.text",this.titles.onClick),window.clearTimeout(this.timer),this.timer=window.setTimeout(this.resetTooltip,1e3))}}),Object.defineProperty(this,"onMouseLeave",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.clearTimeout(this.timer),this.resetTooltip()}}),Object.defineProperty(this,"resetTooltip",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.api;null!=e&&(e.hide(),this.timer=window.setTimeout((()=>{e.set("content.text",this.titles.default)}),100))}})}get api(){if(null!=this.linkRef.current)return n(this.linkRef.current).qtip("api")}componentWillUnmount(){window.clearTimeout(this.timer)}render(){var e;return this.props.value?a.createElement("a",{ref:this.linkRef,className:o,"data-tooltip-hide-events":"mouseleave","data-tooltip-pin-position":!0,"data-tooltip-position":"bottom center",href:this.props.valueAsUrl?this.props.value:"#",onClick:this.onClick,onMouseLeave:this.onMouseLeave,title:this.titles.default},null!==(e=this.props.label)&&void 0!==e?e:this.props.value,this.props.showIcon&&a.createElement("i",{className:`fas fa-paste ${o}__icon`})):a.createElement("span",null)}}Object.defineProperty(l,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{showIcon:!1,valueAsUrl:!1}});const c=l},1581:(e,t,s)=>{s.d(t,{Z:()=>g});var r=s(2163),a=s(8949),i=s(9323),n=s(5078),o=s(7294),l=s(3336),c=s(7937),u=s(1270),d=s(7010),p=s(6741),m=s(4929),h=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};const b="comment-editor",f={edit:"save",new:"post",reply:"reply"};let v=class extends o.Component{get canComment(){return null!=n.Z.currentUser&&("edit"===this.mode||null==this.canNewCommentReason)}get canNewCommentReason(){return null==this.props.commentableMeta?null:"current_user_attributes"in this.props.commentableMeta?this.props.commentableMeta.current_user_attributes.can_new_comment_reason:(0,u.dW)("authorization.comment.store.disabled")}get isValid(){return this.message.length>0}get initialMessage(){var e;return null!==(e=this.props.message)&&void 0!==e?e:""}get mode(){return null!=this.props.parent?"reply":null!=this.props.id?"edit":"new"}get placeholder(){var e;return this.canComment?(0,u.dW)(`comments.placeholder.${this.mode}`):null!==(e=this.canNewCommentReason)&&void 0!==e?e:void 0}constructor(e){super(e),Object.defineProperty(this,"handleKeyDown",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"posting",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"textarea",{enumerable:!0,configurable:!0,writable:!0,value:o.createRef()}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"close",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null!=this.props.close&&(this.initialMessage===this.message||confirm((0,u.dW)("common.confirmation_unsaved")))&&this.props.close()}}),Object.defineProperty(this,"handleKeyDownCallback",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e===c.z.Cancel?this.close():e===c.z.Submit&&this.post()}}),Object.defineProperty(this,"onChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.message=e.currentTarget.value}}),Object.defineProperty(this,"post",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t,s,r;const i={commentableMeta:this.props.commentableMeta,id:this.props.id,message:this.message,mode:this.mode,parentId:null===(e=this.props.parent)||void 0===e?void 0:e.id};this.props.controller.isPosting(i)||("edit"!==this.mode||this.message!==(null!==(t=this.props.message)&&void 0!==t?t:"")?this.props.controller.apiPost(i,(0,a.aD)((()=>{var e,t,s,r;this.message="",null===(t=(e=this.props).onPosted)||void 0===t||t.call(e,this.mode),null===(r=(s=this.props).close)||void 0===r||r.call(s)}))):null===(r=(s=this.props).close)||void 0===r||r.call(s))}}),this.handleKeyDown=(0,c.k)(this.handleKeyDownCallback),this.message=this.initialMessage,(0,a.rC)(this)}componentDidMount(){var e;null!==(e=this.props.focus)&&void 0!==e&&!e||null==this.textarea.current||(this.textarea.current.selectionStart=-1,this.textarea.current.focus())}componentWillUnmount(){var e;null===(e=this.xhr)||void 0===e||e.abort()}render(){const e=(0,l.sb)(b,this.props.modifiers,{fancy:"new"===this.mode});return o.createElement("div",{className:e},"new"===this.mode&&o.createElement("div",{className:`${b}__avatar`},o.createElement(m.Z,{modifiers:"full-circle",user:n.Z.currentUser})),o.createElement(r.Z,{className:`${b}__message`,disabled:!this.canComment||this.posting,innerRef:this.textarea,onChange:this.onChange,onKeyDown:this.handleKeyDown,placeholder:this.placeholder,value:this.message}),o.createElement("div",{className:`${b}__footer`},o.createElement("div",{className:`${b}__footer-item ${b}__footer-item--notice hidden-xs`},this.canComment&&(0,u.dW)("comments.editor.textarea_hint._",{action:(0,u.dW)(`comments.editor.textarea_hint.${this.mode}`)})),null!=this.props.close&&o.createElement("div",{className:`${b}__footer-item`},o.createElement(d.Z,{disabled:this.posting,modifiers:"comment-editor",props:{onClick:this.props.close},text:(0,u.dW)("common.buttons.cancel")})),null!=n.Z.currentUser?o.createElement("div",{className:`${b}__footer-item`},o.createElement(d.Z,{disabled:!this.isValid,isBusy:this.posting,modifiers:"comment-editor",props:{onClick:this.post},text:{top:this.posting?o.createElement(p.$,{modifiers:"center-inline"}):(0,u.dW)(`common.buttons.${f[this.mode]}`)}})):o.createElement("div",{className:`${b}__footer-item`},o.createElement(d.Z,{extraClasses:["js-user-link"],modifiers:"comment-editor",text:(0,u.dW)(`comments.guest_button.${this.mode}`)}))))}};h([a.LO],v.prototype,"message",void 0),h([a.LO],v.prototype,"posting",void 0),h([a.Fl],v.prototype,"canComment",null),h([a.Fl],v.prototype,"mode",null),h([a.Fl],v.prototype,"placeholder",null),h([a.aD],v.prototype,"onChange",void 0),h([a.aD],v.prototype,"post",void 0),v=h([i.Pi],v);const g=v},8573:(e,t,s)=>{s.d(t,{Z:()=>p});var r=s(9323),a=s(7294),i=s(3336),n=s(1270),o=s(3890),l=s(6741),c=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};const u="comment-show-more";let d=class extends a.Component{constructor(){super(...arguments),Object.defineProperty(this,"load",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.controller.apiLoadMore(this.props.parent)}})}get loading(){return this.props.controller.isLoading(this.props.parent)}get hasMoreComments(){var e;return null==this.props.parent||null===(e=this.props.controller.state.hasMore[this.props.parent.id])||void 0===e||e}render(){var e,t;return this.props.comments.length>=this.props.total?null:this.hasMoreComments?null!==(e=this.props.top)&&void 0!==e&&e?a.createElement(o.Z,{callback:this.load,hasMore:!0,loading:this.loading,modifiers:"comments",remaining:this.props.total-this.props.comments.length}):a.createElement("div",{className:(0,i.sb)(u,this.props.modifiers)},this.loading?a.createElement(l.$,null):a.createElement("button",{className:`${u}__link`,onClick:this.load},null!==(t=this.props.label)&&void 0!==t?t:(0,n.dW)("common.buttons.show_more"))):null}};d=c([r.Pi],d);const p=d},8462:(e,t,s)=>{s.d(t,{Z:()=>C});var r=s(5119),a=s(6486),i=s(8949),n=s(9323),o=s(8125),l=s(5078),c=s(7294),u=s(3336);let d=null;function p(e){const t=function(){if(null==d&&(d=document.querySelector(".js-estimate-min-lines"),null==d))throw new Error("js-estimate-min-lines placeholder element is missing!");return d}();t.innerHTML=e;const s=t.firstChild;let r=t;s instanceof HTMLElement&&(r=s);const a=parseFloat(window.getComputedStyle(r).getPropertyValue("line-height")),i=t.scrollHeight;return{count:Math.ceil(i/a),height:i,lineHeight:a}}var m,h=s(3775),b=s(1270),f=s(9240),v=s(1581),g=s(8573),y=s(3635),w=s(2325),_=s(3890),E=s(6741),P=s(4403),O=s(12),j=s(4929),k=s(6871),N=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let S=m=class extends c.Component{get hasVoted(){return this.props.controller.state.votedCommentIds.has(this.props.comment.id)}get isBlocked(){return null!=this.props.comment.userId&&l.Z.currentUserModel.blocks.has(this.props.comment.userId)}get isLongContent(){return null!=this.lines&&this.lines.count>=9}get lines(){var e;return p(null!==(e=this.props.comment.messageHtml)&&void 0!==e?e:"")}get meta(){return this.props.controller.getCommentableMeta(this.props.comment)}get parentComment(){return null==this.props.comment.parentId?void 0:this.props.controller.state.comments[this.props.comment.parentId]}get parentPreview(){var e;const t=this.parentComment;if(null==t)throw new Error("trying to render parent preview without parent");return t.isDeleted?(0,b.dW)("comments.deleted"):null!=t.userId&&l.Z.currentUserModel.blocks.has(t.userId)?(0,b.dW)("users.blocks.comment_text"):(0,a.truncate)((0,h.oN)(null!==(e=t.messageHtml)&&void 0!==e?e:""),{length:100})}get postingVote(){return this.props.controller.isVoting(this.props.comment)}get replies(){const e=this.props.controller.state.commentIdsByParentId[this.props.comment.id];return this.props.controller.getComments(e)}get user(){return this.getCommentUser(this.props.comment)}constructor(e){if(super(e),Object.defineProperty(this,"clipped",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"editing",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"expandReplies",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"forceShow",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"showMoreRef",{enumerable:!0,configurable:!0,writable:!0,value:c.createRef()}),Object.defineProperty(this,"showNewReply",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"onCloseEdit",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.editing=!1}}),Object.defineProperty(this,"onCloseReplyBox",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.showNewReply=!1}}),Object.defineProperty(this,"onDelete",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.controller.apiDelete(this.props.comment)}}),Object.defineProperty(this,"onLoadReplies",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.controller.apiLoadMore(this.props.comment),this.onToggleReplies()}}),Object.defineProperty(this,"onReplyPosted",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.expandReplies="reply"===e}}),Object.defineProperty(this,"onRestore",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.controller.apiRestore(this.props.comment)}}),Object.defineProperty(this,"onShowDeletedToggleClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{l.Z.userPreferences.set("comments_show_deleted",!l.Z.userPreferences.get("comments_show_deleted"))}}),Object.defineProperty(this,"onToggleClip",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.clipped=!this.clipped}}),Object.defineProperty(this,"onToggleEdit",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.editing=!this.editing}}),Object.defineProperty(this,"onToggleForceShow",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.forceShow=!this.forceShow}}),Object.defineProperty(this,"onToggleNewReply",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.showNewReply=!this.showNewReply}}),Object.defineProperty(this,"onTogglePinned",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.controller.apiTogglePin(this.props.comment)}}),Object.defineProperty(this,"onToggleReplies",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.expandReplies=!this.expandReplies}}),Object.defineProperty(this,"onToggleVote",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.controller.apiToggleVote(this.props.comment)}}),Object.defineProperty(this,"renderComment",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(null!=e&&(!e.isDeleted||l.Z.userPreferences.get("comments_show_deleted")))return c.createElement(m,{key:e.id,comment:e,controller:this.props.controller,depth:this.props.depth+1,expandReplies:this.props.expandReplies,modifiers:this.props.modifiers})}}),l.Z.windowSize.isMobile)this.expandReplies=!1;else if(this.props.comment.isDeleted)this.expandReplies=!1;else if(null!=this.props.expandReplies)this.expandReplies=this.props.expandReplies;else{const e=this.replies;this.expandReplies=!this.isBlocked&&(null==e?void 0:e.length)>0&&this.props.depth<6}(0,i.rC)(this)}render(){return c.createElement("div",{className:(0,u.sb)("comment",this.props.modifiers,{top:0===this.props.depth})},this.props.comment.isDeleted||!this.isBlocked||this.forceShow?this.renderMain():this.renderBlocked())}getCommentUser(e){var t;return null!==(t=this.getUser(e.userId))&&void 0!==t?t:null==e.legacyName?o.z7:{username:e.legacyName}}getUser(e){return this.props.controller.getUser(e)}renderBlocked(){return c.createElement("div",{className:(0,u.sb)("comment__main","deleted")},c.createElement("span",{className:this.props.depth>0?"comment__avatar":void 0,style:{height:"auto"}}),c.createElement("div",{className:"comment__container"},c.createElement("div",{className:"comment__message"},c.createElement("p",{className:"osu-md osu-md--comment osu-md__paragraph"},(0,b.dW)("users.blocks.comment_text")," ",this.renderForceShowButton()))))}renderCommentableMeta(){if(!this.props.showCommentableMeta)return;const e=this.meta;return null!=e?c.createElement("div",{className:"comment__commentable-meta"},null!=this.props.comment.commentableType&&c.createElement("span",{className:"comment__commentable-meta-type"},c.createElement("span",{className:"comment__commentable-meta-icon fas fa-comment"})," ",(0,b.dW)(`comments.commentable_name.${this.props.comment.commentableType}`)),"url"in e?c.createElement("a",{className:"comment__link",href:e.url},e.title):c.createElement("span",null,e.title)):void 0}renderDelete(){if(!this.props.comment.isDeleted&&this.props.comment.canDelete)return c.createElement("div",{className:"comment__row-item"},c.createElement("button",{className:"comment__action",onClick:this.onDelete,type:"button"},(0,b.dW)("common.buttons.delete")))}renderDeletedBy(){var e;if(null!=this.props.comment.deletedAt&&this.props.comment.canModerate)return c.createElement("div",{className:"comment__row-item comment__row-item--info"},c.createElement(P.Z,{mappings:{timeago:c.createElement(O.Z,{dateTime:this.props.comment.deletedAt,relative:!0}),user:null==this.props.comment.deletedById?(0,b.dW)("comments.deleted_by_system"):c.createElement(k.Z,{user:null!==(e=this.getUser(this.props.comment.deletedById))&&void 0!==e?e:o.z7})},pattern:(0,b.dW)("comments.deleted_by")}))}renderEdit(){if(this.props.comment.canEdit)return c.createElement("div",{className:"comment__row-item"},c.createElement("button",{className:(0,u.sb)("comment__action",{active:this.editing}),onClick:this.onToggleEdit,type:"button"},(0,b.dW)("common.buttons.edit")))}renderEditedBy(){var e;if(null!=this.props.comment.editedAt&&!this.props.comment.isDeleted)return c.createElement("div",{className:"comment__row-item comment__row-item--info"},c.createElement(P.Z,{mappings:{timeago:c.createElement(O.Z,{dateTime:this.props.comment.editedAt,relative:!0}),user:c.createElement(k.Z,{user:null!==(e=this.getUser(this.props.comment.editedById))&&void 0!==e?e:o.z7})},pattern:(0,b.dW)("comments.edited")}))}renderFooter(){return c.createElement("div",{className:"comment__row comment__row--footer"},this.props.comment.canHaveVote&&c.createElement("div",{className:"comment__row-item visible-xs"},this.renderVoteButton(!0)),c.createElement("div",{className:"comment__row-item comment__row-item--info"},c.createElement(O.Z,{dateTime:this.props.comment.createdAt,relative:!0})),this.renderPermalink(),this.renderReplyButton(),this.renderEdit(),this.renderRestore(),this.renderDelete(),this.renderPin(),this.renderReport(),this.renderEditedBy(),this.renderDeletedBy(),this.renderForceShow(),this.renderRepliesText())}renderForceShow(){if(this.isBlocked&&!this.props.comment.isDeleted)return c.createElement("div",{className:"comment__row-item"},this.renderForceShowButton())}renderForceShowButton(){return c.createElement("button",{className:"comment__action",onClick:this.onToggleForceShow,type:"button"},this.forceShow?(0,b.dW)("users.blocks.hide_comment"):(0,b.dW)("users.blocks.show_comment"))}renderMain(){return c.createElement(c.Fragment,null,this.renderRepliesToggle(),this.renderCommentableMeta(),this.renderToolbar(),c.createElement("div",{className:(0,u.sb)("comment__main",{clip:this.clipped&&this.isLongContent,deleted:this.props.comment.isDeleted||this.isBlocked}),style:{"--clip-lines":7,"--line-height":null==this.lines?void 0:`${this.lines.lineHeight}px`}},this.props.comment.canHaveVote&&c.createElement("div",{className:"comment__float-container comment__float-container--left hidden-xs"},this.renderVoteButton(!1)),this.renderUserAvatar(),c.createElement("div",{className:"comment__container"},c.createElement("div",{className:"comment__row comment__row--header"},c.createElement(k.Z,{className:"comment__row-item",user:this.user}),this.renderOwnerBadge(),this.props.comment.pinned&&c.createElement("span",{className:"comment__row-item  comment__row-item--pinned"},c.createElement("span",{className:"fa fa-thumbtack"})," ",(0,b.dW)("comments.pinned")),this.renderParentLink(),this.props.comment.isDeleted&&c.createElement("span",{className:"comment__row-item comment__row-item--deleted"},(0,b.dW)("comments.deleted"))),this.editing?c.createElement("div",{className:"comment__editor"},c.createElement(v.Z,{close:this.onCloseEdit,controller:this.props.controller,id:this.props.comment.id,message:this.props.comment.message,modifiers:this.props.modifiers})):null!=this.props.comment.messageHtml&&c.createElement(c.Fragment,null,c.createElement("div",{className:"comment__message",dangerouslySetInnerHTML:{__html:this.props.comment.messageHtml}}),this.isLongContent&&this.renderToggleClipButton()),this.renderFooter(),this.renderReplyBox())),this.props.comment.repliesCount>0&&c.createElement("div",{className:(0,u.sb)("comment__replies",{hidden:!this.expandReplies,indented:this.props.depth<6})},this.replies.map(this.renderComment),c.createElement(y.Z,{comments:this.replies}),c.createElement(g.Z,{ref:this.showMoreRef,comments:this.replies,controller:this.props.controller,label:0===this.replies.length?(0,b.dW)("comments.load_replies"):void 0,modifiers:this.props.modifiers,parent:this.props.comment,total:this.props.comment.repliesCount})))}renderOwnerBadge(){const e=this.meta;if(null!=e&&"owner_id"in e&&null!=e.owner_id&&this.props.comment.userId===e.owner_id)return c.createElement("div",{className:"comment__row-item"},c.createElement("div",{className:"comment__owner-badge"},e.owner_title))}renderParentLink(){const e=this.parentComment;if(null==e)return;const t=this.getCommentUser(e),s=c.createElement(c.Fragment,null,c.createElement("span",{className:"fas fa-reply"}),` ${t.username}`);return c.createElement("span",{className:"comment__row-item comment__row-item--parent"},this.props.linkParent?c.createElement("a",{className:"comment__link",href:(0,r.B)("comments.show",{comment:e.id}),title:this.parentPreview},s):c.createElement("span",{title:this.parentPreview},s))}renderPermalink(){return c.createElement("div",{className:"comment__row-item"},c.createElement("span",{className:"comment__action comment__action--permalink"},c.createElement(f.Z,{label:(0,b.dW)("common.buttons.permalink"),value:(0,r.B)("comments.show",{comment:this.props.comment.id}),valueAsUrl:!0})))}renderPin(){if(this.props.comment.canPin)return c.createElement("div",{className:"comment__row-item"},c.createElement("button",{className:"comment__action",onClick:this.onTogglePinned,type:"button"},(0,b.dW)("common.buttons."+(this.props.comment.pinned?"unpin":"pin"))))}renderRepliesText(){if(0===this.props.comment.repliesCount)return;let e,t;return this.expandReplies||0!==this.replies.length?(t=this.onToggleReplies,e=(0,b.jn)("comments.replies_count",this.props.comment.repliesCount)):(t=this.onLoadReplies,e=(0,b.dW)("comments.load_replies")),c.createElement("div",{className:"comment__row-item comment__row-item--replies"},c.createElement(_.Z,{callback:t,direction:this.expandReplies?"up":"down",hasMore:!0,label:e,modifiers:"comment-replies"}))}renderRepliesToggle(){if(!(this.props.depth>0||0===this.replies.length))return c.createElement("div",{className:"comment__float-container comment__float-container--right"},c.createElement("button",{className:"comment__top-show-replies",onClick:this.onToggleReplies,type:"button"},c.createElement("span",{className:"fas "+(this.expandReplies?"fa-angle-up":"fa-angle-down")})))}renderReplyBox(){if(this.showNewReply)return c.createElement("div",{className:"comment__reply-box"},c.createElement(v.Z,{close:this.onCloseReplyBox,commentableMeta:this.meta,controller:this.props.controller,modifiers:this.props.modifiers,onPosted:this.onReplyPosted,parent:this.props.comment}))}renderReplyButton(){if(!this.props.comment.isDeleted)return c.createElement("div",{className:"comment__row-item"},c.createElement("button",{className:(0,u.sb)("comment__action",{active:this.showNewReply}),onClick:this.onToggleNewReply,type:"button"},(0,b.dW)("common.buttons.reply")))}renderReport(){if(this.props.comment.canReport)return c.createElement("div",{className:"comment__row-item"},c.createElement(w.c,{className:"comment__action",reportableId:this.props.comment.id.toString(),reportableType:"comment",user:this.user}))}renderRestore(){if(this.props.comment.isDeleted&&this.props.comment.canRestore)return c.createElement("div",{className:"comment__row-item"},c.createElement("button",{className:"comment__action",onClick:this.onRestore,type:"button"},(0,b.dW)("common.buttons.restore")))}renderToggleClipButton(){return c.createElement("button",{className:"comment__toggle-clip",onClick:this.onToggleClip,type:"button"},(0,b.dW)("common.buttons."+(this.clipped?"read_more":"show_less")))}renderToolbar(){if(this.props.showToolbar)return c.createElement("div",{className:"comment__toolbar"},c.createElement("div",{className:"sort"},c.createElement("div",{className:"sort__items"},c.createElement("button",{className:"sort__item sort__item--button",onClick:this.onShowDeletedToggleClick,type:"button"},c.createElement("span",{className:"sort__item-icon"},c.createElement("span",{className:l.Z.userPreferences.get("comments_show_deleted")?"fas fa-check-square":"far fa-square"})),(0,b.dW)("common.buttons.show_deleted")))))}renderUserAvatar(){const e=this.user;return"id"in e?c.createElement("a",{className:"comment__avatar js-usercard","data-user-id":e.id,href:(0,r.B)("users.show",{user:e.id})},c.createElement(j.Z,{modifiers:"full-circle",user:e})):c.createElement("span",{className:"comment__avatar"},c.createElement(j.Z,{modifiers:"full-circle",user:Object.assign({avatar_url:void 0},e)}))}renderVoteButton(e){const t=this.hasVoted,s=(0,u.sb)("comment-vote",this.props.modifiers,{disabled:!this.props.comment.canVote,inline:e,on:t,posting:this.postingVote}),r=e||t?null:c.createElement("div",{className:"comment-vote__hover"},"+1");return c.createElement("button",{className:s,disabled:this.postingVote||!this.props.comment.canVote,onClick:this.onToggleVote,type:"button"},c.createElement("span",{className:"comment-vote__text"},"+",(0,h.Eu)(this.props.comment.votesCount)),this.postingVote&&c.createElement("span",{className:"comment-vote__spinner"},c.createElement(E.$,null)),r)}};Object.defineProperty(S,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{linkParent:!1,showCommentableMeta:!1,showToolbar:!1}}),N([i.LO],S.prototype,"clipped",void 0),N([i.LO],S.prototype,"editing",void 0),N([i.LO],S.prototype,"expandReplies",void 0),N([i.LO],S.prototype,"forceShow",void 0),N([i.LO],S.prototype,"showNewReply",void 0),N([i.Fl],S.prototype,"isBlocked",null),N([i.Fl],S.prototype,"lines",null),N([i.Fl],S.prototype,"meta",null),N([i.Fl],S.prototype,"parentComment",null),N([i.Fl],S.prototype,"parentPreview",null),N([i.Fl],S.prototype,"user",null),N([i.aD],S.prototype,"onCloseEdit",void 0),N([i.aD],S.prototype,"onCloseReplyBox",void 0),N([i.aD],S.prototype,"onReplyPosted",void 0),N([i.aD],S.prototype,"onToggleClip",void 0),N([i.aD],S.prototype,"onToggleEdit",void 0),N([i.aD],S.prototype,"onToggleForceShow",void 0),N([i.aD],S.prototype,"onToggleNewReply",void 0),N([i.aD],S.prototype,"onToggleReplies",void 0),S=m=N([n.Pi],S);const C=S},3619:(e,t,s)=>{s.d(t,{Z:()=>g});var r=s(5119),a=s(6486),i=s(8949),n=s(5078),o=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class l{constructor(e,t){Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"commentableId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"commentableType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"createdAt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"deletedAt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"deletedById",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"editedAt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"editedById",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"legacyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageHtml",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parentId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pinned",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"repliesCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updatedAt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"votesCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.commentableId=e.commentable_id,this.commentableType=e.commentable_type,this.createdAt=e.created_at,this.deletedAt=e.deleted_at,this.deletedById=e.deleted_by_id,this.editedAt=e.edited_at,this.editedById=e.edited_by_id,this.id=e.id,this.legacyName=e.legacy_name,this.message=e.message,this.messageHtml=e.message_html,this.parentId=e.parent_id,this.pinned=e.pinned,this.repliesCount=e.replies_count,this.updatedAt=e.updated_at,this.userId=e.user_id,this.votesCount=e.votes_count,(0,i.rC)(this)}get canDelete(){return this.canModerate||this.isOwner}get canEdit(){return this.canModerate||this.isOwner&&!this.isDeleted}get canHaveVote(){return!this.isDeleted}get canModerate(){return null!=n.Z.currentUser&&(n.Z.currentUser.is_admin||n.Z.currentUser.is_moderator)}get canPin(){if(null==n.Z.currentUser||null!=this.parentId&&!this.pinned)return!1;if(n.Z.currentUser.is_admin)return!0;if("beatmapset"!==this.commentableType||!this.pinned&&this.controller.state.pinnedCommentIds.length>0)return!1;if(this.canModerate)return!0;if(!this.isOwner)return!1;const e=this.controller.getCommentableMeta(this);return null!=e&&"owner_id"in e&&e.owner_id===n.Z.currentUser.id}get canReport(){return null!=n.Z.currentUser&&this.userId!==n.Z.currentUser.id}get canRestore(){return this.canModerate}get canVote(){return!this.isOwner}get isDeleted(){return null!=this.deletedAt}get isEdited(){return null!=this.editedAt}get isOwner(){return null!=n.Z.currentUser&&this.userId===n.Z.currentUser.id}toJson(){return{commentable_id:this.commentableId,commentable_type:this.commentableType,created_at:this.createdAt,deleted_at:this.deletedAt,deleted_by_id:this.deletedById,edited_at:this.editedAt,edited_by_id:this.editedById,id:this.id,legacy_name:this.legacyName,message:this.message,message_html:this.messageHtml,parent_id:this.parentId,pinned:this.pinned,replies_count:this.repliesCount,updated_at:this.updatedAt,user_id:this.userId,votes_count:this.votesCount}}}o([i.Fl],l.prototype,"canDelete",null),o([i.Fl],l.prototype,"canEdit",null),o([i.Fl],l.prototype,"canHaveVote",null),o([i.Fl],l.prototype,"canModerate",null),o([i.Fl],l.prototype,"canPin",null),o([i.Fl],l.prototype,"canReport",null),o([i.Fl],l.prototype,"canRestore",null),o([i.Fl],l.prototype,"canVote",null),o([i.Fl],l.prototype,"isDeleted",null),o([i.Fl],l.prototype,"isEdited",null),o([i.Fl],l.prototype,"isOwner",null);var c=s(9703),u=s(1270),d=s(9696),p=s(9755),m=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};function h(e){Object.values(e).forEach((e=>null==e?void 0:e.abort()))}function b(){return{commentableMetaItems:{},commentIdsByParentId:{},comments:{},hasMore:{},isFollowing:!1,pinnedCommentIds:[],sort:"new",topLevelCount:0,total:0,users:{},votedCommentIds:new Set}}function f(e){return null!=e&&"id"in e?`${e.type}-${e.id}`:"null"}function v(e){var t,s;switch(e.mode){case"edit":return null!==(t=e.id)&&void 0!==t?t:0;case"new":return f(e.commentableMeta);case"reply":return null!==(s=e.parentId)&&void 0!==s?s:0;default:throw(0,d.Q)(e.mode),new Error("unsupported mode")}}class g{get commentableMeta(){return this.state.commentableMetaItems[f(this.baseCommentableMeta)]}get pinnedComments(){return this.getComments(this.state.pinnedCommentIds)}get stateEl(){var e;const t=(null!==(e=window.newBody)&&void 0!==e?e:document.body).querySelector(this.stateSelector);if(t instanceof HTMLScriptElement)return t;throw new Error("missing state element")}get topLevelComments(){var e;return this.getComments(null!==(e=this.state.commentIdsByParentId[0])&&void 0!==e?e:[])}constructor(e,t){Object.defineProperty(this,"stateSelector",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"baseCommentableMeta",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"nextState",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"destroyed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"destroy",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.destroyed||(document.removeEventListener("turbolinks:before-cache",this.destroy),h(this.xhr),this.stateStore(),this.destroyed=!0)}});const s=this.stateEl,r=s.dataset.savedState;if(null!=r)this.state=this.stateFromJson(JSON.parse(r));else{this.state=b();const e=JSON.parse(s.text);this.loadBundle(e,!1,!0)}(0,i.rC)(this),document.addEventListener("turbolinks:before-cache",this.destroy)}apiDelete(e){var t;if(this.isDeleting(e)||!confirm((0,u.dW)("common.confirmation")))return;const s=`delete-${e.id}`;this.xhr[s]=p.ajax((0,r.B)("comments.destroy",{comment:e.id}),{method:"DELETE"}),null===(t=this.xhr[s])||void 0===t||t.done((e=>this.loadBundle(e))).fail(c.qQ).always((0,i.aD)((()=>{delete this.xhr[s]})))}apiLoadMore(e){var t,s,n;if(this.isLoading(e))return;const o=null!==(t=null==e?void 0:e.id)&&void 0!==t?t:0,l={parent_id:o,sort:this.state.sort};null==e?null!=this.baseCommentableMeta&&(l.commentable_id=this.baseCommentableMeta.id,l.commentable_type=this.baseCommentableMeta.type):(l.commentable_id=e.commentableId,l.commentable_type=e.commentableType);const c=(0,a.last)(null!==(s=this.state.commentIdsByParentId[o])&&void 0!==s?s:[]);null!=c&&(l.after=c);const u=`load-${o}`;this.xhr[u]=p.ajax((0,r.B)("comments.index"),{data:l,dataType:"json"}),null===(n=this.xhr[u])||void 0===n||n.done((e=>this.loadBundle(e))).always((0,i.aD)((()=>{delete this.xhr[u]})))}apiPost(e,t){var s;if(this.isPosting(e))return;if(n.Z.userLogin.showIfGuest((()=>this.apiPost(e,t))))return;const a={comment:{message:e.message}};let o=(0,r.B)("comments.store"),l="POST";switch(e.mode){case"edit":if(null==e.id)throw new Error("missing post id in edit mode");o=(0,r.B)("comments.update",{comment:e.id}),l="PUT";break;case"new":if(null==e.commentableMeta||!("id"in e.commentableMeta))throw new Error("missing commentable meta in new mode");a.comment.commentable_type=e.commentableMeta.type,a.comment.commentable_id=e.commentableMeta.id;break;case"reply":if(null==e.parentId)throw new Error("missing parent in reply mode");a.comment.parent_id=e.parentId;break;default:throw(0,d.Q)(e.mode),new Error("unsupported mode")}const u=`${e.mode}-${v(e)}`;this.xhr[u]=p.ajax(o,{data:a,method:l}),null===(s=this.xhr[u])||void 0===s||s.always((0,i.aD)((()=>{delete this.xhr[u]}))).done((e=>(0,i.z)((()=>{t(),this.loadBundle(e,!1)})))).fail(c.qQ)}apiRestore(e){var t;if(this.isDeleting(e)||!confirm((0,u.dW)("common.confirmation")))return;const s=`delete-${e.id}`;this.xhr[s]=p.ajax((0,r.B)("comments.restore",{comment:e.id}),{method:"POST"}),null===(t=this.xhr[s])||void 0===t||t.done((e=>this.loadBundle(e))).fail(c.qQ).always((0,i.aD)((()=>{delete this.xhr[s]})))}apiSetSort(e){if(null!=this.xhr.sort)return;this.nextState.sort=e;const t={parent_id:0,sort:e};null!=this.commentableMeta&&"id"in this.commentableMeta&&(t.commentable_id=this.commentableMeta.id,t.commentable_type=this.commentableMeta.type),this.xhr.sort=p.ajax((0,r.B)("comments.index"),{data:t,dataType:"json"}),this.xhr.sort.done((e=>(0,i.z)((()=>{h(this.xhr),this.state=b(),this.nextState={},this.xhr={},this.loadBundle(e,!1,!0),n.Z.userPreferences.set("comments_sort",this.state.sort)}))))}apiToggleFollow(){if(null!=this.nextState.isFollowing)return;const e=this.commentableMeta;if(null==e||!("id"in e))return;const t=this.nextState.isFollowing=!this.state.isFollowing;this.xhr.follow=p.ajax((0,r.B)("follows.store"),{data:{follow:{notifiable_id:e.id,notifiable_type:e.type,subtype:"comment"}},dataType:"json",method:this.nextState.isFollowing?"POST":"DELETE"}),this.xhr.follow.always((0,i.aD)((()=>{delete this.xhr.follow,this.nextState.isFollowing=void 0}))).done((0,i.aD)((()=>{this.state.isFollowing=t}))).fail(c.qQ)}apiTogglePin(e){var t;const s=`pin-${e.id}`;null==this.xhr[s]&&e.canPin&&(this.xhr[s]=p.ajax((0,r.B)("comments.pin",{comment:e.id}),{method:e.pinned?"DELETE":"POST"}),null===(t=this.xhr[s])||void 0===t||t.done((e=>this.loadBundle(e))).fail(c.qQ).always((0,i.aD)((()=>{delete this.xhr[s]}))))}apiToggleVote(e){var t;if(this.isVoting(e))return;if(n.Z.userLogin.showIfGuest((()=>this.apiToggleVote(e))))return;let s,a;this.state.votedCommentIds.has(e.id)?(s="DELETE",a="delete"):(s="POST",a="add");const o=`vote-${e.id}`;this.xhr[o]=p.ajax((0,r.B)("comments.vote",{comment:e.id}),{method:s}),null===(t=this.xhr[o])||void 0===t||t.done((t=>(0,i.z)((()=>{this.loadBundle(t),this.state.votedCommentIds[a](e.id)})))).fail(c.qQ).always((0,i.aD)((()=>{delete this.xhr[o]})))}getCommentableMeta(e){var t;return null!==(t=this.state.commentableMetaItems[`${e.commentableType}-${e.commentableId}`])&&void 0!==t?t:{title:""}}getComments(e){const t=[];for(const s of null!=e?e:[]){const e=this.state.comments[s];null!=e&&t.push(e)}return t}getUser(e){return null==e?void 0:this.state.users[e]}isLoading(e){var t;return null!=this.xhr[`load-${null!==(t=null==e?void 0:e.id)&&void 0!==t?t:0}`]}isPosting(e){return null!=this.xhr[`${e.mode}-${v(e)}`]}isVoting(e){return null!=this.xhr[`vote-${e.id}`]}addComment(e){var t;const s=e.id;(null===(t=this.state.comments[s])||void 0===t?void 0:t.updatedAt)!==e.updated_at&&(this.state.comments[s]=new l(e,this))}addCommentId(e,t){var s,r,a,i;const n=null!==(s=e.parent_id)&&void 0!==s?s:0;null!==(r=(i=this.state.commentIdsByParentId)[n])&&void 0!==r||(i[n]=[]);const o=null!==(a=this.state.commentIdsByParentId[n])&&void 0!==a?a:[],l=e.id;o.includes(l)||(t?o.push(l):o.unshift(l))}isDeleting(e){return null!=this.xhr[`delete-${e.id}`]}loadBundle(e,t=!0,s=!1){var r;if(s){this.state.commentIdsByParentId[0]=[];const t=this.state.commentIdsByParentId[0];e.comments.forEach((e=>{t.push(e.id),this.addComment(e)})),this.state.sort=e.sort}else e.comments.forEach((e=>{this.addCommentId(e,t),this.addComment(e)}));e.included_comments.forEach((e=>{this.addCommentId(e,!0),this.addComment(e)})),this.state.pinnedCommentIds=[],(null!==(r=e.pinned_comments)&&void 0!==r?r:[]).forEach((e=>{this.state.pinnedCommentIds.push(e.id),this.addComment(e)})),e.user_votes.forEach((e=>this.state.votedCommentIds.add(e))),this.state.isFollowing=e.user_follow,this.state.hasMore[e.has_more_id]=e.has_more,null!=e.top_level_count&&null!=e.total&&(this.state.topLevelCount=e.top_level_count,this.state.total=e.total);for(const i of e.users){const e=i.id;(0,a.isEqual)(this.state.users[e],i)||(this.state.users[e]=i)}for(const i of e.commentable_meta){const e=f(i);(0,a.isEqual)(this.state.commentableMetaItems[e],i)||(this.state.commentableMetaItems[e]=i)}}stateFromJson(e){const t={};for(const s of e.comments)t[s.id]=new l(s,this);return{commentableMetaItems:e.commentableMetaItems,commentIdsByParentId:e.commentIdsByParentId,comments:t,hasMore:e.hasMore,isFollowing:e.isFollowing,pinnedCommentIds:e.pinnedCommentIds,sort:e.sort,topLevelCount:e.topLevelCount,total:e.total,users:e.users,votedCommentIds:new Set(e.votedCommentIds)}}stateStore(){const e=[];for(const s of Object.values(this.state.comments))null!=s&&e.push(s.toJson());const t={commentableMetaItems:this.state.commentableMetaItems,commentIdsByParentId:this.state.commentIdsByParentId,comments:e,hasMore:this.state.hasMore,isFollowing:this.state.isFollowing,pinnedCommentIds:this.state.pinnedCommentIds,sort:this.state.sort,topLevelCount:this.state.topLevelCount,total:this.state.total,users:this.state.users,votedCommentIds:[...this.state.votedCommentIds]};this.stateEl.dataset.savedState=JSON.stringify(t)}}m([i.LO],g.prototype,"nextState",void 0),m([i.LO],g.prototype,"state",void 0),m([i.LO],g.prototype,"xhr",void 0),m([i.aD],g.prototype,"apiDelete",null),m([i.aD],g.prototype,"apiLoadMore",null),m([i.aD],g.prototype,"apiPost",null),m([i.aD],g.prototype,"apiRestore",null),m([i.aD],g.prototype,"apiSetSort",null),m([i.aD],g.prototype,"apiToggleFollow",null),m([i.aD],g.prototype,"apiTogglePin",null),m([i.aD],g.prototype,"apiToggleVote",null),m([i.aD],g.prototype,"loadBundle",null),m([i.aD],g.prototype,"stateFromJson",null),m([i.aD],g.prototype,"stateStore",null)},8134:(e,t,s)=>{s.d(t,{Z:()=>_});var r=s(9323),a=s(5078),i=s(7294),n=s(3336),o=s(3775),l=s(1270),c=s(8462),u=s(1581),d=s(8573),p=s(3619),m=s(2873),h=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let b=class extends i.Component{constructor(){super(...arguments),Object.defineProperty(this,"handleChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;this.props.controller.apiSetSort(null!==(t=e.currentTarget.dataset.value)&&void 0!==t?t:"")}})}render(){var e;return i.createElement(m.P,{currentValue:null!==(e=this.props.controller.nextState.sort)&&void 0!==e?e:this.props.controller.state.sort,modifiers:this.props.modifiers,onChange:this.handleChange,values:["new","old","top"]})}};b=h([r.Pi],b);const f=b;var v=s(3635),g=s(6741),y=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let w=class extends i.Component{constructor(e){super(e),Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onToggleFollow",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.controller.apiToggleFollow()}}),this.controller=new p.Z(this.props.controllerStateSelector,this.props.baseCommentableMeta)}componentWillUnmount(){this.controller.destroy()}render(){const e=this.controller.topLevelComments,t=e.filter((e=>!e.pinned)),s=this.controller.pinnedComments;return i.createElement("div",{className:(0,n.sb)("comments",this.props.modifiers),id:"comments"},i.createElement("h2",{className:"comments__title"},(0,l.dW)("comments.title"),i.createElement("span",{className:"comments__count"},(0,o.uf)(this.controller.state.total))),s.length>0&&i.createElement("div",{className:"comments__items comments__items--pinned"},this.renderComments(s,!0)),i.createElement("div",{className:"comments__new"},i.createElement(u.Z,{commentableMeta:this.controller.commentableMeta,controller:this.controller,focus:!1,modifiers:this.props.modifiers})),i.createElement("div",{className:"comments__items comments__items--toolbar"},i.createElement(f,{controller:this.controller,modifiers:this.props.modifiers}),i.createElement("div",{className:(0,n.sb)("sort",this.props.modifiers)},i.createElement("div",{className:"sort__items"},this.renderFollowToggle(),this.renderShowDeletedToggle()))),0===t.length?i.createElement("div",{className:"comments__items comments__items--empty"},0===s.length?(0,l.dW)("comments.empty"):(0,l.dW)("comments.empty_other")):i.createElement("div",{className:(0,n.sb)("comments__items",{loading:null!=this.controller.nextState.sort})},this.renderComments(t,!1),i.createElement(v.Z,{comments:e,modifiers:"top"}),i.createElement(d.Z,{comments:e,controller:this.controller,modifiers:(0,n.sw)("top",this.props.modifiers),top:!0,total:this.controller.state.topLevelCount})))}onToggleShowDeleted(){a.Z.userPreferences.set("comments_show_deleted",!a.Z.userPreferences.get("comments_show_deleted"))}renderComment(e,t){if(!e.isDeleted||a.Z.userPreferences.get("comments_show_deleted"))return i.createElement(c.Z,{key:e.id,comment:e,controller:this.controller,depth:0,expandReplies:t,modifiers:this.props.modifiers})}renderComments(e,t){const s=!t&&void 0;return e.map((e=>this.renderComment(e,s)))}renderFollowToggle(){let e,t;return null!=this.controller.nextState.isFollowing&&(e=i.createElement(g.$,{modifiers:"center-inline"})),this.controller.state.isFollowing?(null!=e||(e=i.createElement("span",{className:"fas fa-eye-slash"})),t=(0,l.dW)("common.buttons.watch.to_0")):(null!=e||(e=i.createElement("span",{className:"fas fa-eye"})),t=(0,l.dW)("common.buttons.watch.to_1")),i.createElement("button",{className:"sort__item sort__item--button",disabled:null!=this.controller.nextState.isFollowing,onClick:this.onToggleFollow,type:"button"},i.createElement("span",{className:"sort__item-icon"},e),t)}renderShowDeletedToggle(){const e=a.Z.userPreferences.get("comments_show_deleted")?"fas fa-check-square":"far fa-square";return i.createElement("button",{className:"sort__item sort__item--button",onClick:this.onToggleShowDeleted,type:"button"},i.createElement("span",{className:"sort__item-icon"},i.createElement("span",{className:e})),(0,l.dW)("common.buttons.show_deleted"))}};w=y([r.Pi],w);const _=w},3635:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(7294),a=s(3336),i=s(1270);class n extends r.Component{render(){const e=this.props.comments.filter((e=>null!=e.deletedAt)).length;return 0===e?null:r.createElement("div",{className:(0,a.sb)("deleted-comments-count",this.props.modifiers)},r.createElement("span",{className:"deleted-comments-count__icon"},r.createElement("span",{className:"far fa-trash-alt"})),(0,i.jn)("comments.deleted_count",e))}}},6793:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(7294),a=s(7629),i=s(3336),n=s(3775);function o(e){return r.createElement("div",{className:(0,i.sb)("difficulty-badge",{"expert-plus":e.rating>=6.5}),style:{"--bg":(0,a.yh)(e.rating)}},r.createElement("span",{className:"difficulty-badge__icon"},r.createElement("span",{className:"fas fa-star"})),r.createElement("span",{className:"difficulty-badge__rating"},(0,n.uf)(e.rating,2)))}},1185:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(6486),a=s(7294),i=s(3336);function n(e){const t=Math.max(0,e.current),s=Math.max(1,e.total);return a.createElement("div",{className:(0,i.sb)("discrete-bar",e.modifiers)},(0,r.times)(s,(s=>a.createElement("div",{key:s,className:(0,i.sb)("discrete-bar__item",{on:s<t})},e.label))))}},5523:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(7294),a=s(3336);const i=e=>`/assets/images/flags/${e.split("").map((e=>(e.charCodeAt(0)+127397).toString(16))).join("-")}.svg`;function n({country:e,modifiers:t}){return null==e||null==e.code?null:r.createElement("span",{className:(0,a.sb)("flag-country",t),style:{backgroundImage:`url('${i(e.code)}')`},title:e.name})}},542:(e,t,s)=>{s.d(t,{Z:()=>d});var r=s(5119),a=s(5078),i=s(7294),n=s(3336),o=s(9139),l=s(6741),c=s(9755);class u extends i.PureComponent{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:`follow-toggle-${(0,o.d)()}`}),Object.defineProperty(this,"toggleXhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;const t={follow:{notifiable_id:this.props.follow.notifiable_id,notifiable_type:this.props.follow.notifiable_type,subtype:this.props.follow.subtype}},s=this.state.following?"DELETE":"POST";null===(e=this.toggleXhr)||void 0===e||e.abort(),this.setState({toggling:!0},(()=>{this.toggleXhr=c.ajax((0,r.B)("follows.store"),{data:t,method:s}).done((()=>{"mapping"===this.props.follow.subtype?a.Z.currentUserModel.updateFollowUserMapping(!this.state.following,this.props.follow.notifiable_id):this.setState({following:!this.state.following})})).always((()=>{this.setState({toggling:!1})}))}))}}),Object.defineProperty(this,"refresh",{enumerable:!0,configurable:!0,writable:!0,value:()=>{"mapping"===this.props.follow.subtype&&this.setState({following:a.Z.currentUserModel.following.has(this.props.follow.notifiable_id)})}}),this.state={following:this.props.following,toggling:!1}}componentDidMount(){"mapping"===this.props.follow.subtype&&c.subscribe(`user:followUserMapping:refresh.${this.eventId}`,this.refresh)}componentWillUnmount(){c.unsubscribe(`.${this.eventId}`)}render(){return i.createElement("button",{className:(0,n.sb)("btn-circle",this.props.modifiers),disabled:this.state.toggling,onClick:this.onClick,type:"button"},i.createElement("span",{className:"btn-circle__content"},this.renderToggleIcon()))}renderToggleIcon(){if(this.state.toggling)return i.createElement("span",{className:"btn-circle__icon"},i.createElement(l.$,null));let e,t;return this.state.following?(t="fas fa-bell",e="fas fa-bell-slash"):(t="far fa-bell",e="fas fa-bell"),i.createElement(i.Fragment,null,i.createElement("span",{className:"btn-circle__icon btn-circle__icon--hover-show"},i.createElement("span",{className:e})),i.createElement("span",{className:"btn-circle__icon btn-circle__icon--hover-hide"},i.createElement("span",{className:t})))}}Object.defineProperty(u,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{following:!0}});const d=u},7454:(e,t,s)=>{s.d(t,{Z:()=>h});var r=s(5119),a=s(5078),i=s(7294),n=s(9703),o=s(3336),l=s(3775),c=s(1270),u=s(9139),d=s(6741),p=s(9755);const m="user-action-button";class h extends i.Component{constructor(e){var t;super(e),Object.defineProperty(this,"buttonRef",{enumerable:!0,configurable:!0,writable:!0,value:i.createRef()}),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:`follow-user-mapping-button-${(0,u.d)()}`}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({loading:!0},(()=>{const e={data:{follow:{notifiable_id:this.props.userId,notifiable_type:"user",subtype:"mapping"}}};this.state.following?(e.type="DELETE",e.url=(0,r.B)("follows.destroy")):(e.type="POST",e.url=(0,r.B)("follows.store")),this.xhr=p.ajax(e).done(this.updateData).fail((0,n.f$)(this.buttonRef.current)).always((()=>this.setState({loading:!1})))}))}}),Object.defineProperty(this,"refresh",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({following:a.Z.currentUserModel.following.has(this.props.userId)})}}),Object.defineProperty(this,"updateData",{enumerable:!0,configurable:!0,writable:!0,value:()=>{a.Z.currentUserModel.updateFollowUserMapping(!this.state.following,this.props.userId)}});const s=a.Z.currentUserModel.following.has(this.props.userId);let o=null!==(t=this.props.followers)&&void 0!==t?t:0;!1!==s&&(o-=1),this.state={followersWithoutSelf:o,following:s,loading:!1}}componentDidMount(){p.subscribe(`user:followUserMapping:refresh.${this.eventId}`,this.refresh)}componentWillUnmount(){var e;p.unsubscribe(`.${this.eventId}`),null===(e=this.xhr)||void 0===e||e.abort()}render(){const e=!(null==a.Z.currentUser||a.Z.currentUser.id===this.props.userId);if(!e&&!this.props.alwaysVisible)return null;const t=e?(0,c.dW)("follows.mapping."+(this.state.following?"to_0":"to_1")):(0,c.dW)("follows.mapping.followers"),s=(0,o.sb)(m,this.props.modifiers,{friend:this.state.following}),r=this.state.loading||!e;return i.createElement("div",{title:t},i.createElement("button",{ref:this.buttonRef,className:s,disabled:r,onClick:this.onClick},this.renderIcon(),this.renderCounter()))}followers(){return this.state.followersWithoutSelf+(this.state.following?1:0)}renderCounter(){if(null!=this.props.showFollowerCounter&&null!=this.props.followers)return i.createElement("span",{className:`${m}__counter`},(0,l.uf)(this.followers()))}renderIcon(){const e=this.state.loading?i.createElement(d.$,null):i.createElement("i",{className:"fas fa-bell"});return i.createElement("span",{className:`${m}__icon-container`},e)}}},7863:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(5119),a=s(7294),i=s(3336),n=s(1270);function o(e){return a.createElement("div",{className:"page-tabs page-tabs--follows"},["comment","forum_topic","mapping","modding"].map((t=>a.createElement("a",{key:t,className:(0,i.sb)("page-tabs__tab",{active:t===e.currentSubtype}),href:(0,r.B)("follows.index",{subtype:t})},(0,n.dW)(`follows.${t}.title`)))))}},1759:(e,t,s)=>{s.d(t,{Z:()=>y});var r=s(789),a=s(1723),i=s(5119),n=s(8949),o=s(9323),l=s(5078),c=s(7294),u=s(9703),d=s(3336),p=s(3775),m=s(1270),h=s(6741),b=s(9755),f=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};const v="user-action-button";let g=class extends c.Component{get followers(){return this.followersWithoutSelf+(null==this.friend?0:1)}get friend(){return l.Z.currentUserModel.friends.get(this.props.userId)}get isFriendLimit(){return null==l.Z.currentUser||l.Z.currentUser.friends.length>=l.Z.currentUser.max_friends}get isVisible(){return null!=l.Z.currentUser&&Number.isFinite(this.props.userId)&&this.props.userId!==l.Z.currentUser.id&&!l.Z.currentUser.blocks.some((e=>e.target_id===this.props.userId))}get loading(){return null!=this.xhr}get showFollowerCounter(){return null!=this.props.followers}get title(){return this.isVisible?null!=this.friend?(0,m.dW)("friends.buttons.remove"):this.isFriendLimit?(0,m.dW)("friends.too_many"):(0,m.dW)("friends.buttons.add"):(0,m.dW)("friends.buttons.disabled")}constructor(e){var t;super(e),Object.defineProperty(this,"followersWithoutSelf",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clicked",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null==this.xhr&&(this.xhr=null==this.friend?b.ajax((0,i.B)("friends.store",{target:this.props.userId}),{type:"POST"}):b.ajax((0,i.B)("friends.destroy",{friend:this.props.userId}),{type:"DELETE"}),this.xhr.done(this.updateFriends).fail((0,u.Gi)(this.clicked)).always((0,n.aD)((()=>this.xhr=void 0))))}}),Object.defineProperty(this,"updateFriends",{enumerable:!0,configurable:!0,writable:!0,value:e=>{null!=l.Z.currentUser&&(l.Z.currentUser.friends=e,(0,a.WI)(new r.Z(this.props.userId)))}}),this.followersWithoutSelf=null!==(t=this.props.followers)&&void 0!==t?t:0,(0,n.rC)(this),(0,n.z)((()=>{null!=this.friend&&(this.followersWithoutSelf-=1)}))}componentWillUnmount(){var e;null===(e=this.xhr)||void 0===e||e.abort()}render(){if(!this.props.alwaysVisible&&!this.isVisible)return null;const e=null==this.friend||this.loading?null:this.friend.mutual?"mutual":"friend",t=(0,d.sb)(v,this.props.modifiers,e),s=!this.isVisible||this.loading||this.isFriendLimit&&null==this.friend;return c.createElement("div",{title:this.title},c.createElement("button",{className:t,disabled:s,onClick:this.clicked,type:"button"},c.createElement("span",{className:`${v}__icon-container`},this.renderIcon()),this.renderCounter()))}renderCounter(){if(this.showFollowerCounter)return c.createElement("span",{className:`${v}__counter`},(0,p.uf)(this.followers))}renderIcon(){return this.loading?c.createElement(h.$,null):this.isVisible?null!=this.friend?c.createElement(c.Fragment,null,c.createElement("span",{className:`${v}__icon ${v}__icon--hover-visible`},c.createElement("span",{className:"fas fa-user-times"})),this.friend.mutual?c.createElement("span",{className:`${v}__icon ${v}__icon--hover-hidden`},c.createElement("span",{className:"fas fa-user-friends"})):c.createElement("span",{className:`${v}__icon ${v}__icon--hover-hidden`},c.createElement("span",{className:"fas fa-user"}))):c.createElement("span",{className:this.isFriendLimit?"fas fa-user":"fas fa-user-plus"}):c.createElement("span",{className:"fas fa-user"})}};Object.defineProperty(g,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{alwaysVisible:!1}}),f([n.LO],g.prototype,"followersWithoutSelf",void 0),f([n.LO],g.prototype,"xhr",void 0),f([n.Fl],g.prototype,"followers",null),f([n.Fl],g.prototype,"friend",null),f([n.Fl],g.prototype,"isFriendLimit",null),f([n.Fl],g.prototype,"isVisible",null),f([n.Fl],g.prototype,"title",null),f([n.aD],g.prototype,"clicked",void 0),f([n.aD],g.prototype,"updateFriends",void 0),g=f([o.Pi],g);const y=g},5112:(e,t,s)=>{s.d(t,{Z:()=>p});var r=s(5078),a=s(7294),i=s(3336),n=s(8278),o=s(1270),l=s(3924),c=s(9755);const u={actionKey:{"forum.topic_watches_controller.index":"main.home_controller.index","main.account_controller.edit":"main.home_controller.index","main.beatmapset_watches_controller.index":"main.home_controller.index","main.follows_controller.index":"main.home_controller.index","main.friends_controller.index":"main.home_controller.index"},controllerKey:{"main.artist_tracks_controller._":"main.artists_controller._","main.store_controller._":"store._","multiplayer.rooms_controller._":"main.ranking_controller._"},namespaceKey:{"admin_forum._":"admin._"}};class d extends a.Component{constructor(){super(...arguments),Object.defineProperty(this,"cancelSyncHeight",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}componentDidMount(){this.cancelSyncHeight=r.Z.reactTurbolinks.runAfterPageLoad((()=>{c.publish("sync-height:force")}))}componentWillUnmount(){var e;null===(e=this.cancelSyncHeight)||void 0===e||e.call(this)}render(){const e=(0,i.sb)("header-v4",(0,l.G)(this.props.theme),this.props.modifiers);return a.createElement("div",{className:e},a.createElement("div",{className:"header-v4__container header-v4__container--main"},a.createElement("div",{className:"header-v4__bg-container"},a.createElement("div",{className:"header-v4__bg",style:{backgroundImage:(0,i.eF)(this.props.backgroundImage)}})),a.createElement("div",{className:"hidden-xs js-sync-height--target","data-sync-height-id":"notification-banners"}),a.createElement("div",{className:"header-v4__content"},this.props.contentPrepend,a.createElement("div",{className:"header-v4__row header-v4__row--title"},a.createElement("div",{className:"header-v4__icon"}),a.createElement("div",{className:"header-v4__title"},this.title())),this.props.contentAppend)),this.props.links.length>0&&a.createElement("div",{className:"header-v4__container"},a.createElement("div",{className:"header-v4__content"},a.createElement("div",{className:"header-v4__row header-v4__row--bar"},this.renderLinks(),this.renderLinksMobile(),this.props.linksAppend))))}renderLinks(){const e=this.props.links.map((e=>{const t=[];return e.active&&t.push("active"),a.createElement("li",{key:`${e.url}-${e.title}`,className:"header-nav-v4__item"},a.createElement("a",Object.assign({className:(0,i.sb)("header-nav-v4__link",t),href:e.url,onClick:this.props.onLinkClick},e.data),a.createElement("span",{className:"fake-bold","data-content":e.title},e.title)))})),t=this.props.linksBreadcrumb?"ol":"ul",s=[];return s.push(this.props.linksBreadcrumb?"breadcrumb":"list"),a.createElement(t,{className:(0,i.sb)("header-nav-v4",s)},e)}renderLinksMobile(){if(this.props.linksBreadcrumb)return null;if(0===this.props.links.length)return null;let e=this.props.links[0];const t=this.props.links.map((t=>{const s=[];return t.active&&(s.push("active"),e=t),a.createElement("li",{key:`${t.url}-${t.title}`},a.createElement("a",Object.assign({className:"header-nav-mobile__item js-click-menu--close",href:t.url,onClick:this.props.onLinkClick},t.data),t.title))}));return a.createElement("div",{className:"header-nav-mobile"},a.createElement("a",{className:"header-nav-mobile__toggle js-click-menu","data-click-menu-target":"header-nav-mobile",href:e.url},e.title,a.createElement("span",{className:"header-nav-mobile__toggle-icon"},a.createElement("span",{className:"fas fa-chevron-down"}))),a.createElement("ul",{className:"header-nav-mobile__menu js-click-menu","data-click-menu-id":"header-nav-mobile","data-visibility":"hidden"},t))}title(){var e,t,s;const r=(0,n.Mo)("json-route-section");let a=`${r.namespace}.${r.controller}.${r.action}`;a=null!==(e=u.actionKey[a])&&void 0!==e?e:a;let i=`${r.namespace}.${r.controller}._`;i=null!==(t=u.controllerKey[i])&&void 0!==t?t:i;let l=`${r.namespace}._`;l=null!==(s=u.namespaceKey[l])&&void 0!==s?s:l;const c=[`page_title.${a}`,`page_title.${i}`,`page_title.${l}`];for(const n of c)if((0,o.Xl)(n,fallbackLocale))return(0,o.dW)(n);return"unknown"}}Object.defineProperty(d,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{links:[],linksBreadcrumb:!1}});const p=d},4001:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(7294),a=s(3775),i=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]])}return s};function n(e){const{className:t="",src2x:s}=e,n=i(e,["className","src2x"]);return null==n.src?r.createElement("img",Object.assign({},n,{className:`${t} u-hidden`})):r.createElement("img",Object.assign({className:t,srcSet:`${n.src} 1x, ${null!=s?s:(0,a.bG)(n.src)} 2x`},n))}},1646:(e,t,s)=>{s.d(t,{Z:()=>l});var r=s(9323),a=s(7294),i=s(3336),n=s(1270),o=s(5050);const l=(0,r.Pi)((e=>{const t=null!=e.model&&e.model.errors[e.name]&&e.model.showError[e.name];return a.createElement("label",{className:(0,i.sb)("input-container",{error:t},e.modifiers),htmlFor:e.for},null!=e.labelKey&&a.createElement("div",{className:"input-container__label"},(0,n.dW)(e.labelKey),null!=e.model&&null!=e.maxLength&&a.createElement(o.Z,{maxLength:e.maxLength,message:e.model.inputs[e.name]})),e.children)}))},5788:(e,t,s)=>{s.d(t,{Z:()=>r});const r=(0,s(7294).createContext)(null)},2105:(e,t,s)=>{s.d(t,{Z:()=>p});var r=s(6741),a=s(8949),i=s(9323),n=s(7294),o=s(3336),l=s(1270),c=s(5788),u=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let d=class extends n.Component{get ready(){var e,t;return this.hasUpdated||this.skipLazyLoad||this.loaded&&!(null!==(t=null===(e=this.context)||void 0===e?void 0:e.scrolling)&&void 0!==t&&t)}constructor(e){var t;super(e),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"hasUpdated",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"loaded",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:n.createRef()}),Object.defineProperty(this,"skipLazyLoad",{enumerable:!0,configurable:!0,writable:!0,value:null!==(t=this.props.hasData)&&void 0!==t&&t}),Object.defineProperty(this,"load",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;this.error=!1,null===(e=this.observer)||void 0===e||e.disconnect(),this.props.onLoad().then((0,a.aD)((()=>{this.loaded=!0,this.error=!1}))).catch((0,a.aD)((()=>this.error=!0)))}}),this.loaded=this.skipLazyLoad,this.skipLazyLoad||(this.observer=new IntersectionObserver((e=>{e.some((e=>e.isIntersecting))&&this.load()}),{rootMargin:"400px 0px 400px 0px"})),(0,a.rC)(this)}componentDidMount(){var e;this.skipLazyLoad||null==this.ref.current||null===(e=this.observer)||void 0===e||e.observe(this.ref.current)}componentDidUpdate(e,t,s){if(!this.hasUpdated&&!this.skipLazyLoad&&this.loaded&&null!=s){if(null==this.context)throw new Error("LazyLoadContext is missing.");this.hasUpdated=!0,this.context.done(this.props.name,s)}}componentWillUnmount(){var e;null===(e=this.observer)||void 0===e||e.disconnect()}getSnapshotBeforeUpdate(){var e,t;return null!==(t=null===(e=this.context)||void 0===e?void 0:e.getSnapshot(this.props.name))&&void 0!==t?t:null}render(){return n.createElement("div",{ref:this.ref,className:(0,o.sb)("lazy-load",{loading:!this.ready})},this.ready?this.renderLoaded():this.renderNotLoaded())}renderLoaded(){if(!this.skipLazyLoad&&null==this.context)throw new Error("LazyLoadContext is missing.");return this.props.children}renderNotLoaded(){return this.error?n.createElement("div",{className:"lazy-load__error"},n.createElement("p",null,(0,l.dW)("errors.load_failed")),n.createElement("div",{className:"lazy-load__button"},n.createElement("button",{className:"btn-osu-big btn-osu-big--rounded-thin",onClick:this.load,type:"button"},(0,l.dW)("common.buttons.retry")))):n.createElement(r.$,null)}};Object.defineProperty(d,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:c.Z}),u([a.LO],d.prototype,"error",void 0),u([a.LO],d.prototype,"loaded",void 0),u([a.LO],d.prototype,"skipLazyLoad",void 0),u([a.Fl],d.prototype,"ready",null),u([a.aD],d.prototype,"load",void 0),d=u([i.Pi],d);const p=d},5050:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(7294),a=s(3336);function i(e,t){return e.length>t?"over":e.length>.95*t?"almost-over":null}function n({maxLength:e,message:t,modifiers:s}){return r.createElement("div",{className:(0,a.sb)("message-length-counter",i(t,e),s)},`${t.length} / ${e}`)}},3439:(e,t,s)=>{s.d(t,{Z:()=>c});const r=JSON.parse('{"EZ":{"acronym":"EZ","name":"Easy","setting_labels":{"retries":"Extra Lives"},"type":"DifficultyReduction"},"NF":{"acronym":"NF","name":"No Fail","setting_labels":{},"type":"DifficultyReduction"},"HT":{"acronym":"HT","name":"Half Time","setting_labels":{"speed_change":"Speed decrease","adjust_pitch":"Adjust pitch"},"type":"DifficultyReduction"},"DC":{"acronym":"DC","name":"Daycore","setting_labels":{"speed_change":"Speed decrease"},"type":"DifficultyReduction"},"HR":{"acronym":"HR","name":"Hard Rock","setting_labels":{},"type":"DifficultyIncrease"},"SD":{"acronym":"SD","name":"Sudden Death","setting_labels":{"restart":"Restart on fail"},"type":"DifficultyIncrease"},"PF":{"acronym":"PF","name":"Perfect","setting_labels":{"restart":"Restart on fail"},"type":"DifficultyIncrease"},"DT":{"acronym":"DT","name":"Double Time","setting_labels":{"speed_change":"Speed increase","adjust_pitch":"Adjust pitch"},"type":"DifficultyIncrease"},"NC":{"acronym":"NC","name":"Nightcore","setting_labels":{"speed_change":"Speed increase"},"type":"DifficultyIncrease"},"HD":{"acronym":"HD","name":"Hidden","setting_labels":{"only_fade_approach_circles":"Only fade approach circles"},"type":"DifficultyIncrease"},"FL":{"acronym":"FL","name":"Flashlight","setting_labels":{"follow_delay":"Follow delay","size_multiplier":"Flashlight size","combo_based_size":"Change size based on combo"},"type":"DifficultyIncrease"},"BL":{"acronym":"BL","name":"Blinds","setting_labels":{},"type":"DifficultyIncrease"},"ST":{"acronym":"ST","name":"Strict Tracking","setting_labels":{},"type":"DifficultyIncrease"},"AC":{"acronym":"AC","name":"Accuracy Challenge","setting_labels":{"minimum_accuracy":"Minimum accuracy","accuracy_judge_mode":"Accuracy mode","restart":"Restart on fail"},"type":"DifficultyIncrease"},"TP":{"acronym":"TP","name":"Target Practice","setting_labels":{"seed":"Seed","metronome":"Metronome ticks"},"type":"Conversion"},"DA":{"acronym":"DA","name":"Difficulty Adjust","setting_labels":{"circle_size":"Circle Size","approach_rate":"Approach Rate","drain_rate":"HP Drain","overall_difficulty":"Accuracy","extended_limits":"Extended Limits","scroll_speed":"Scroll Speed","hard_rock_offsets":"Spicy Patterns"},"type":"Conversion"},"CL":{"acronym":"CL","name":"Classic","setting_labels":{"no_slider_head_accuracy":"No slider head accuracy requirement","classic_note_lock":"Apply classic note lock","always_play_tail_sample":"Always play a slider\'s tail sample","fade_hit_circle_early":"Fade out hit circles earlier","classic_health":"Classic health"},"type":"Conversion"},"RD":{"acronym":"RD","name":"Random","setting_labels":{"angle_sharpness":"Angle sharpness","seed":"Seed"},"type":"Conversion"},"MR":{"acronym":"MR","name":"Mirror","setting_labels":{"reflection":"Mirrored axes"},"type":"Conversion"},"AL":{"acronym":"AL","name":"Alternate","setting_labels":{},"type":"Conversion"},"SG":{"acronym":"SG","name":"Single Tap","setting_labels":{},"type":"Conversion"},"AT":{"acronym":"AT","name":"Autoplay","setting_labels":{},"type":"Automation"},"CN":{"acronym":"CN","name":"Cinema","setting_labels":{},"type":"Automation"},"RX":{"acronym":"RX","name":"Relax","setting_labels":{},"type":"Automation"},"AP":{"acronym":"AP","name":"Autopilot","setting_labels":{},"type":"Automation"},"SO":{"acronym":"SO","name":"Spun Out","setting_labels":{},"type":"Automation"},"TR":{"acronym":"TR","name":"Transform","setting_labels":{},"type":"Fun"},"WG":{"acronym":"WG","name":"Wiggle","setting_labels":{"strength":"Strength"},"type":"Fun"},"SI":{"acronym":"SI","name":"Spin In","setting_labels":{},"type":"Fun"},"GR":{"acronym":"GR","name":"Grow","setting_labels":{"start_scale":"Starting Size"},"type":"Fun"},"DF":{"acronym":"DF","name":"Deflate","setting_labels":{"start_scale":"Starting Size"},"type":"Fun"},"WU":{"acronym":"WU","name":"Wind Up","setting_labels":{"initial_rate":"Initial rate","final_rate":"Final rate","adjust_pitch":"Adjust pitch"},"type":"Fun"},"WD":{"acronym":"WD","name":"Wind Down","setting_labels":{"initial_rate":"Initial rate","final_rate":"Final rate","adjust_pitch":"Adjust pitch"},"type":"Fun"},"TC":{"acronym":"TC","name":"Traceable","setting_labels":{},"type":"Fun"},"BR":{"acronym":"BR","name":"Barrel Roll","setting_labels":{"spin_speed":"Roll speed","direction":"Direction"},"type":"Fun"},"AD":{"acronym":"AD","name":"Approach Different","setting_labels":{"scale":"Initial size","style":"Style"},"type":"Fun"},"MU":{"acronym":"MU","name":"Muted","setting_labels":{"inverse_muting":"Start muted","enable_metronome":"Enable metronome","mute_combo_count":"Final volume at combo","affects_hit_sounds":"Mute hit sounds"},"type":"Fun"},"NS":{"acronym":"NS","name":"No Scope","setting_labels":{"hidden_combo_count":"Hidden at combo"},"type":"Fun"},"MG":{"acronym":"MG","name":"Magnetised","setting_labels":{"attraction_strength":"Attraction strength"},"type":"Fun"},"RP":{"acronym":"RP","name":"Repel","setting_labels":{"repulsion_strength":"Repulsion strength"},"type":"Fun"},"AS":{"acronym":"AS","name":"Adaptive Speed","setting_labels":{"initial_rate":"Initial rate","adjust_pitch":"Adjust pitch"},"type":"Fun"},"FR":{"acronym":"FR","name":"Freeze Frame","setting_labels":{},"type":"Fun"},"BU":{"acronym":"BU","name":"Bubbles","setting_labels":{},"type":"Fun"},"SY":{"acronym":"SY","name":"Synesthesia","setting_labels":{},"type":"Fun"},"DP":{"acronym":"DP","name":"Depth","setting_labels":{"max_depth":"Maximum depth","show_approach_circles":"Show Approach Circles"},"type":"Fun"},"TD":{"acronym":"TD","name":"Touch Device","setting_labels":{},"type":"System"},"SV2":{"acronym":"SV2","name":"Score V2","setting_labels":{},"type":"System"},"SW":{"acronym":"SW","name":"Swap","setting_labels":{},"type":"Conversion"},"FF":{"acronym":"FF","name":"Floating Fruits","setting_labels":{},"type":"Fun"},"FI":{"acronym":"FI","name":"Fade In","setting_labels":{},"type":"DifficultyIncrease"},"CO":{"acronym":"CO","name":"Cover","setting_labels":{"coverage":"Coverage","direction":"Direction"},"type":"DifficultyIncrease"},"DS":{"acronym":"DS","name":"Dual Stages","setting_labels":{},"type":"Conversion"},"IN":{"acronym":"IN","name":"Invert","setting_labels":{},"type":"Conversion"},"CS":{"acronym":"CS","name":"Constant Speed","setting_labels":{},"type":"Conversion"},"HO":{"acronym":"HO","name":"Hold Off","setting_labels":{},"type":"Conversion"},"1K":{"acronym":"1K","name":"One Key","setting_labels":{},"type":"Conversion"},"2K":{"acronym":"2K","name":"Two Keys","setting_labels":{},"type":"Conversion"},"3K":{"acronym":"3K","name":"Three Keys","setting_labels":{},"type":"Conversion"},"4K":{"acronym":"4K","name":"Four Keys","setting_labels":{},"type":"Conversion"},"5K":{"acronym":"5K","name":"Five Keys","setting_labels":{},"type":"Conversion"},"6K":{"acronym":"6K","name":"Six Keys","setting_labels":{},"type":"Conversion"},"7K":{"acronym":"7K","name":"Seven Keys","setting_labels":{},"type":"Conversion"},"8K":{"acronym":"8K","name":"Eight Keys","setting_labels":{},"type":"Conversion"},"9K":{"acronym":"9K","name":"Nine Keys","setting_labels":{},"type":"Conversion"},"10K":{"acronym":"10K","name":"Ten Keys","setting_labels":{},"type":"Conversion"},"V2":{"acronym":"V2","name":"Score V2","setting_labels":{},"type":"Conversion"},"NM":{"acronym":"NM","name":"No Mod","setting_labels":{},"type":"Conversion"}}');var a=s(7294),i=s(3336);const n=new Intl.NumberFormat("en");function o(e){return"boolean"==typeof e?e?"on":"off":"number"==typeof e?n.format(e):String(e)}function l(e,t){var s;const r=[];for(const[a,i]of Object.entries(null!==(s=t.settings)&&void 0!==s?s:{}))if("speed_change"===a)r.push(`${o(i)}×`);else{const t=e.setting_labels[a];null!=t&&r.push(`${t}: ${o(i)}`)}return 0===r.length?"":` (${r.join(", ")})`}function c({mod:e}){var t;const s=null!==(t=r[e.acronym])&&void 0!==t?t:{acronym:e.acronym,name:"",setting_labels:{},type:"Fun"};return a.createElement("div",{className:(0,i.sb)("mod",s.acronym,`type-${s.type}`),"data-acronym":s.acronym,title:`${s.name}${l(s,e)}`})}},9003:(e,t,s)=>{s.d(t,{Z:()=>c,g:()=>o});var r=s(7294),a=s(3857),i=s(5863),n=s(9755);const o=()=>0!==l.size,l=new Set;class c extends r.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"clickEndTarget",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clickStartTarget",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:r.createRef()}),Object.defineProperty(this,"close",{enumerable:!0,configurable:!0,writable:!0,value:()=>{l.delete(this),(0,a.z)(this,!1)}}),Object.defineProperty(this,"handleBeforeCache",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.close()}}),Object.defineProperty(this,"handleEsc",{enumerable:!0,configurable:!0,writable:!0,value:e=>{null!=this.props.onClose&&"Escape"===e.key&&this.props.onClose()}}),Object.defineProperty(this,"handleMouseDown",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.clickStartTarget=e.target}}),Object.defineProperty(this,"handleMouseUp",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.clickEndTarget=e.target}}),Object.defineProperty(this,"hideModal",{enumerable:!0,configurable:!0,writable:!0,value:e=>{null!=this.props.onClose&&0===e.button&&e.target===this.ref.current&&this.clickEndTarget===this.clickStartTarget&&this.props.onClose()}}),Object.defineProperty(this,"open",{enumerable:!0,configurable:!0,writable:!0,value:()=>{l.add(this),(0,a.z)(this,!0)}})}componentDidMount(){document.addEventListener("keydown",this.handleEsc),n(document).on("turbolinks:before-cache",this.handleBeforeCache),this.open()}componentWillUnmount(){this.close(),document.removeEventListener("keydown",this.handleEsc),n(document).off("turbolinks:before-cache",this.handleBeforeCache)}render(){return r.createElement(i.Z,null,r.createElement("div",{ref:this.ref,className:"js-react-modal",onClick:this.hideModal,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp},this.props.children))}}},9045:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(5119),a=s(7294),i=s(1270),n=s(5112);function o(e){const t=[{active:"index"===e.section,title:(0,i.dW)("news.index.title.info"),url:(0,r.B)("news.index")}];return"show"===e.section&&null!=e.post&&t.push({active:!0,title:e.post.title,url:(0,r.B)("news.show",{news:e.post.slug})}),a.createElement(n.Z,{links:t,linksBreadcrumb:!0,theme:"news"})}},3430:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(7294),a=s(5863),i=s(9755);const n="notification-banner-v2";class o extends r.PureComponent{constructor(e){var t;super(e),Object.defineProperty(this,"portalRoot",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const s=(null!==(t=window.newBody)&&void 0!==t?t:document.body).querySelector(".js-notification-banners");if(null==s)throw new Error("Notification banner container is missing");this.portalRoot=s}componentDidMount(){this.notifySyncHeight()}componentWillUnmount(){window.setTimeout(this.notifySyncHeight)}render(){return r.createElement(a.Z,{root:this.portalRoot},r.createElement("div",{className:`${n} ${n}--${this.props.type}`},r.createElement("div",{className:`${n}__col ${n}__col--icon`}),r.createElement("div",{className:`${n}__col ${n}__col--label`},r.createElement("div",{className:`${n}__type`},this.props.type),r.createElement("div",{className:`${n}__text`},this.props.title)),r.createElement("div",{className:`${n}__col`},r.createElement("div",{className:`${n}__text`},this.props.message))))}notifySyncHeight(){i.publish("sync-height:force")}}},2500:(e,t,s)=>{s.d(t,{H:()=>m});var r=s(1956),a=s(9323),i=s(5078),n=s(7294),o=s(7629),l=s(1270),c=s(8010),u=s(596),d=s(2325),p=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let m=class extends n.Component{render(){const{score:e,user:t}=this.props,s=(0,o.Dd)(e.ruleset_id);return n.createElement(u.Y,null,(a=>{var o;return n.createElement("div",{className:"simple-menu"},i.Z.scorePins.canBePinned(e)&&n.createElement(r.Z,{className:"simple-menu__item",onUpdate:a,score:e}),(0,c.O0)(e)&&n.createElement("a",{className:"simple-menu__item",href:(0,c.JP)(e)},(0,l.dW)("users.show.extra.top_ranks.view_details")),(0,c.sQ)(e)&&n.createElement("a",{className:"simple-menu__item js-login-required--click","data-turbolinks":!1,href:(0,c.M8)(e),onClick:a},(0,l.dW)("users.show.extra.top_ranks.download_replay")),(0,c.aG)(e)&&n.createElement(d.c,{className:"simple-menu__item",onFormOpen:a,reportableId:(null!==(o=e.best_id)&&void 0!==o?o:e.id).toString(),reportableType:"solo_score"===e.type?e.type:`score_best_${s}`,user:t}))}))}};m=p([a.Pi],m)},9473:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(7294),a=s(3336),i=s(1270);class n extends r.Component{constructor(){super(...arguments),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;const r=e.currentTarget.dataset.mode;this.props.currentMode===r?e.preventDefault():null===(s=(t=this.props).onClick)||void 0===s||s.call(t,e,r)}}),Object.defineProperty(this,"renderLink",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;const s=r.createElement(r.Fragment,null,r.createElement("span",{className:`fal fa-extra-mode-${e.mode}`,title:e.disabled?void 0:(0,i.dW)(`beatmaps.mode.${e.mode}`)}),e.mode===this.props.defaultMode&&r.createElement("span",{className:"game-mode-link__icon",title:(0,i.dW)("users.show.edit.default_playmode.is_default_tooltip")},r.createElement("span",{className:"fas fa-star"})),null!=e.count&&r.createElement("span",{className:"game-mode-link__badge"},e.count)),n=(0,a.sb)("game-mode-link",{active:e.mode===this.props.currentMode,disabled:e.disabled});return r.createElement("li",{key:e.mode},e.disabled?r.createElement("span",{className:n},s):r.createElement("a",{className:n,"data-mode":e.mode,href:null!==(t=e.href)&&void 0!==t?t:"#",onClick:this.onClick},s))}})}render(){return r.createElement("ul",{className:(0,a.sb)("game-mode",this.props.modifiers)},this.props.entries.map(this.renderLink))}}},596:(e,t,s)=>{s.d(t,{Y:()=>n});var r=s(4498),a=s(7294),i=s(8259);function n(e){const t=a.useContext(i.Xl),s=a.useContext(i.XI),n=a.useCallback((()=>t.activeKeyDidChange(null)),[t]),o=a.useCallback((()=>t.activeKeyDidChange(s)),[t,s]);return a.useEffect((()=>()=>t.activeKeyDidChange(null)),[t]),a.createElement(r.Z,Object.assign({onHide:n,onShow:o},e))}},4498:(e,t,s)=>{s.d(t,{Z:()=>u});var r=s(7294),a=s(2094),i=s(6122),n=s(9139),o=s(5863),l=s(9755);class c extends r.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{active:!1}}),Object.defineProperty(this,"buttonRef",{enumerable:!0,configurable:!0,writable:!0,value:r.createRef()}),Object.defineProperty(this,"eventId",{enumerable:!0,configurable:!0,writable:!0,value:`popup-menu-${(0,n.d)()}`}),Object.defineProperty(this,"menuRef",{enumerable:!0,configurable:!0,writable:!0,value:r.createRef()}),Object.defineProperty(this,"menuRootRef",{enumerable:!0,configurable:!0,writable:!0,value:r.createRef()}),Object.defineProperty(this,"tooltipHideEvent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dismiss",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({active:!1})}}),Object.defineProperty(this,"hide",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(!this.state.active||(0,i.u)())return;const t=e.originalEvent;null!=t&&("key"in t&&"Escape"===t.key||"button"in t&&0===t.button&&!this.isMenuInPath(t.composedPath()))&&this.setState({active:!1})}}),Object.defineProperty(this,"resize",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(!this.state.active)return;const e=this.buttonRef.current,t=this.menuRef.current,s=this.menuRootRef.current;if(null==e||null==t||null==s)throw new Error("missing button and/or menu element");if(null==e.offsetParent)return void(s.style.display="none");const r=e.getBoundingClientRect(),a=t.getBoundingClientRect(),{scrollX:i,scrollY:n}=window;let o=i+r.right;("right"===this.props.direction||r.x-a.width<0)&&(o+=a.width-r.width),s.style.display="block",s.style.position="absolute",s.style.top=`${Math.floor(n+r.bottom+5)}px`,s.style.left=`${Math.floor(o)}px`;const l=this.tooltipElement;null!=l&&(s.style.zIndex=getComputedStyle(l).zIndex)}}),Object.defineProperty(this,"toggle",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({active:!this.state.active})}})}get $tooltipElement(){const e=this.tooltipElement;return null==e?null:l(e)}get tooltipElement(){var e;return null===(e=this.context)||void 0===e?void 0:e.closest(".qtip")}componentDidMount(){var e;this.tooltipHideEvent=null===(e=this.$tooltipElement)||void 0===e?void 0:e.qtip("option","hide.event"),l(window).on(`resize.${this.eventId}`,this.resize)}componentDidUpdate(e,t){var s,r,a,i,n;if(t.active!==this.state.active)if(this.state.active){this.resize();const e=this.$tooltipElement;null!=e&&(this.tooltipHideEvent=e.qtip("option","hide.event"),e.qtip("option","hide.event",!1)),l(document).on(`click.${this.eventId} keydown.${this.eventId}`,this.hide),null===(r=(s=this.props).onShow)||void 0===r||r.call(s)}else null===(a=this.$tooltipElement)||void 0===a||a.qtip("option","hide.event",this.tooltipHideEvent),l(document).off(`click.${this.eventId} keydown.${this.eventId}`,this.hide),null===(n=(i=this.props).onHide)||void 0===n||n.call(i)}componentWillUnmount(){l(document).off(`.${this.eventId}`),l(window).off(`.${this.eventId}`)}render(){return this.props.customRender?this.props.customRender(this.renderMenu(),this.buttonRef,this.toggle):r.createElement(r.Fragment,null,r.createElement("button",{ref:this.buttonRef,className:"popup-menu",onClick:this.toggle,type:"button"},r.createElement("span",{className:"fas fa-ellipsis-v"})),this.renderMenu())}isMenuInPath(e){for(const t of["menuRootRef","buttonRef"]){const s=this[t].current;if(null!=s&&e.includes(s))return!0}return!1}renderMenu(){return this.state.active?r.createElement(o.Z,null,r.createElement("div",{ref:this.menuRootRef},r.createElement("div",{ref:this.menuRef,className:"popup-menu-float"},this.props.children(this.dismiss)))):null}}Object.defineProperty(c,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:a.d}),Object.defineProperty(c,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{children:()=>null,direction:"left"}});const u=c},5863:(e,t,s)=>{s.d(t,{Z:()=>o,w:()=>n});var r=s(7294),a=s(3935);const i="js-portal";function n(){var e;for(const t of(null!==(e=window.newBody)&&void 0!==e?e:document.body).querySelectorAll(`.${i}`))t.remove()}class o extends r.PureComponent{constructor(e){super(e),Object.defineProperty(this,"container",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.container=document.createElement("div"),this.container.className=i}componentDidMount(){var e,t;(null!==(t=null!==(e=this.props.root)&&void 0!==e?e:window.newBody)&&void 0!==t?t:document.body).appendChild(this.container)}componentWillUnmount(){this.container.remove()}render(){return(0,a.createPortal)(this.props.children,this.container)}}},1237:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(7294),a=s(3775),i=s(1270);function n(e){return r.createElement("h3",{className:"title title--page-extra-small"},(0,i.dW)(e.titleKey),null!=e.count&&r.createElement("span",{className:"title__count"},(0,a.uf)(e.count)))}},6140:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(7294),a=s(3336),i=s(1270);function n(e){const t=(0,a.sb)("page-mode-link","profile-page",{"is-active":e.page===e.currentPage}),s=(0,i.dW)(`users.show.extra.${e.page}.title`);return r.createElement("span",{className:t},r.createElement("span",{className:"fake-bold","data-content":s},s))}},2477:(e,t,s)=>{s.d(t,{Z:()=>E});var r=s(8949),a=s(9323),i=s(8082),n=s(2992),o=s(7294),l=s(3775),c=s(8278),u=s(1270),d=s(7563),p=s(5076),m=s(2105),h=s(3890),b=s(4403),f=s(12),v=s(7048),g=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};const y="json-kudosu";function w({kudosu:e}){const t={amount:o.createElement("strong",{className:"profile-extra-entries__kudosu-amount"},(0,u.dW)("users.show.extra.kudosu.entry.amount",{amount:(0,l.uf)(Math.abs(e.amount))})),giver:null==e.giver?(0,u.dW)("users.deleted"):o.createElement("a",{href:e.giver.url},e.giver.username),post:null==e.post.url?e.post.title:o.createElement("a",{href:e.post.url},e.post.title)};return o.createElement("li",{className:"profile-extra-entries__item"},o.createElement("div",{className:"profile-extra-entries__detail"},o.createElement("div",{className:"profile-extra-entries__text"},o.createElement(b.Z,{mappings:t,pattern:(0,u.dW)(`users.show.extra.kudosu.entry.${e.model}.${e.action}`)}))),o.createElement("div",{className:"profile-extra-entries__time"},o.createElement(f.Z,{dateTime:e.created_at,relative:!0})))}let _=class extends o.Component{get hasData(){return null!=this.kudosu}constructor(e){var t;super(e),Object.defineProperty(this,"kudosu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"showMoreXhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"handleOnLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>(this.xhr=(0,n.Z)({id:this.props.userId},"kudosu"),this.xhr.done((e=>(0,r.z)((()=>{this.kudosu=e,this.saveState()})))),this.xhr)}),Object.defineProperty(this,"handleShowMore",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null!=this.kudosu&&(this.showMoreXhr=(0,d.Af)(this.kudosu,this.props.userId).done(this.saveState))}}),Object.defineProperty(this,"saveState",{enumerable:!0,configurable:!0,writable:!0,value:()=>{(0,c.Cw)(y,this.kudosu)}}),this.kudosu=null!==(t=(0,c.Um)(y))&&void 0!==t?t:e.kudosu,(0,r.rC)(this)}componentWillUnmount(){var e,t;null===(e=this.xhr)||void 0===e||e.abort(),null===(t=this.showMoreXhr)||void 0===t||t.abort()}render(){return o.createElement("div",{className:"page-extra"},o.createElement(i.Z,{name:this.props.name,withEdit:this.props.withEdit}),o.createElement(m.Z,{hasData:this.hasData,name:this.props.name,onLoad:this.handleOnLoad},o.createElement("div",{className:"kudosu-box"},o.createElement(v.Z,{description:o.createElement(b.Z,{mappings:{link:o.createElement("a",{href:(0,p.dP)("Kudosu")},(0,u.dW)("users.show.extra.kudosu.total_info.link"))},pattern:(0,u.dW)("users.show.extra.kudosu.total_info._")}),label:(0,u.dW)("users.show.extra.kudosu.total"),modifiers:"kudosu",value:(0,l.uf)(this.props.total)})),this.renderEntries()))}renderEntries(){return null==this.kudosu?null:0===this.kudosu.items.length?o.createElement("div",{className:"profile-extra-entries profile-extra-entries--kudosu"},(0,u.dW)("users.show.extra.kudosu.entry.empty")):o.createElement("ul",{className:"profile-extra-entries profile-extra-entries--kudosu"},this.kudosu.items.map((e=>o.createElement(w,{key:e.id,kudosu:e}))),o.createElement("li",{className:"profile-extra-entries__item u-contents"},o.createElement(h.Z,Object.assign({},this.kudosu.pagination,{callback:this.handleShowMore,modifiers:"profile-page"}))))}};g([r.LO],_.prototype,"kudosu",void 0),g([r.Fl],_.prototype,"hasData",null),g([r.aD],_.prototype,"handleOnLoad",void 0),g([r.aD],_.prototype,"handleShowMore",void 0),_=g([a.Pi],_);const E=_},6018:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(4001),a=s(5119),i=s(7294);function n({banner:e}){return null==e.image?null:i.createElement("a",{className:"profile-tournament-banner",href:(0,a.B)("tournaments.show",{tournament:e.tournament_id})},i.createElement(r.Z,{className:"profile-tournament-banner__image",src:e.image,src2x:e["image@2x"]}))}},3518:(e,t,s)=>{s.d(t,{Hd:()=>v,Y1:()=>f});var r=s(7018),a=s(5119),i=s(8949),n=s(9323),o=s(7294),l=s(3935),c=s(9703),u=s(1270),d=s(9003),p=s(4403),m=s(9755),h=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};const b="report-form";function f(e){const t=document.createElement("div");(0,l.render)(o.createElement(w,{reportableId:e.reportableId,reportableType:e.reportableType,root:t,username:e.username}),t)}const v={beatmapset:"beatmapset",beatmapset_discussion_post:"beatmapset_discussion_post",comment:"comment",forum_post:"forum_post",score_best_fruits:"scores",score_best_mania:"scores",score_best_osu:"scores",score_best_taiko:"scores",solo_score:"scores",user:"user"},g={Cheating:(0,u.dW)("users.report.options.cheating"),MultipleAccounts:(0,u.dW)("users.report.options.multiple_accounts"),Insults:(0,u.dW)("users.report.options.insults"),Spam:(0,u.dW)("users.report.options.spam"),UnwantedContent:(0,u.dW)("users.report.options.unwanted_content"),Nonsense:(0,u.dW)("users.report.options.nonsense"),Other:(0,u.dW)("users.report.options.other")},y={beatmapset:["UnwantedContent","Other"],beatmapset_discussion_post:["Insults","Spam","UnwantedContent","Nonsense","Other"],comment:["Insults","Spam","UnwantedContent","Nonsense","Other"],forum_post:["Insults","Spam","UnwantedContent","Nonsense","Other"],scores:["Cheating","MultipleAccounts","Other"]};let w=class extends o.Component{get canSubmit(){return!this.disabled&&this.comments.length>0}get groupKey(){return v[this.props.reportableType]}get options(){var e;return(null!==(e=y[this.groupKey])&&void 0!==e?e:Object.keys(g)).map((e=>({id:e,text:g[e]})))}constructor(e){super(e),Object.defineProperty(this,"comments",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"completed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"disabled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"selectedReason",{enumerable:!0,configurable:!0,writable:!0,value:this.options[0]}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"handleClose",{enumerable:!0,configurable:!0,writable:!0,value:()=>{(0,l.unmountComponentAtNode)(this.props.root)}}),Object.defineProperty(this,"handleCommentsChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.comments=e.target.value}}),Object.defineProperty(this,"handleReasonChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.selectedReason=e}}),Object.defineProperty(this,"handleSubmit",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.disabled=!0;const e={data:{comments:this.comments,reason:this.selectedReason.id,reportable_id:this.props.reportableId,reportable_type:this.props.reportableType},dataType:"json",type:"POST",url:(0,a.B)("reports.store")};m.ajax(e).done((0,i.aD)((()=>{this.timeout=window.setTimeout(this.handleClose,1e3),this.completed=!0}))).fail((0,i.aD)((e=>{(0,c.qQ)(e),this.disabled=!1})))}}),(0,i.rC)(this)}componentDidMount(){m(document).on("turbolinks:before-cache",this.handleClose)}componentWillUnmount(){m(document).off("turbolinks:before-cache",this.handleClose),window.clearTimeout(this.timeout)}render(){return o.createElement(d.Z,{onClose:this.handleClose},o.createElement("div",{className:b},o.createElement("div",{className:`${b}__header`},o.createElement("div",{className:`${b}__row ${b}__row--exclamation`},o.createElement("i",{className:"fas fa-exclamation-triangle"})),o.createElement("div",{className:`${b}__row ${b}__row--title`},o.createElement("span",null,this.renderTitle()))),!this.completed&&this.renderFormContent()))}renderFormContent(){return o.createElement("div",null,0!==this.options.length&&o.createElement(o.Fragment,null,o.createElement("div",{className:`${b}__row`},(0,u.dW)("users.report.reason")),o.createElement("div",{className:`${b}__row`},o.createElement(r.Z,{blackout:!1,modifiers:"report",onChange:this.handleReasonChange,options:this.options,selected:this.selectedReason}))),o.createElement("div",{className:`${b}__row`},(0,u.dW)("users.report.comments")),o.createElement("div",{className:`${b}__row`},o.createElement("textarea",{className:`${b}__textarea`,maxLength:2e3,onChange:this.handleCommentsChange,placeholder:(0,u.dW)("users.report.placeholder"),value:this.comments})),o.createElement("div",{className:`${b}__row ${b}__row--buttons`},o.createElement("button",{className:`${b}__button ${b}__button--report`,disabled:!this.canSubmit,onClick:this.handleSubmit,type:"button"},(0,u.dW)("users.report.actions.send")),o.createElement("button",{className:`${b}__button`,disabled:this.disabled,onClick:this.handleClose,type:"button"},(0,u.dW)("users.report.actions.cancel"))))}renderTitle(){return this.completed?(0,u.dW)("users.report.thanks"):o.createElement(p.Z,{mappings:{username:o.createElement("strong",null,this.props.username)},pattern:(0,u.dW)(`report.${this.groupKey}.title`)})}};h([i.LO],w.prototype,"comments",void 0),h([i.LO],w.prototype,"completed",void 0),h([i.LO],w.prototype,"disabled",void 0),h([i.LO],w.prototype,"selectedReason",void 0),h([i.Fl],w.prototype,"options",null),h([i.aD],w.prototype,"handleCommentsChange",void 0),h([i.aD],w.prototype,"handleReasonChange",void 0),h([i.aD],w.prototype,"handleSubmit",void 0),w=h([n.Pi],w)},2325:(e,t,s)=>{s.d(t,{c:()=>o});var r=s(7294),a=s(1270),i=s(3518),n=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]])}return s};class o extends r.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"onShowFormButtonClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{0===e.button&&(this.props.onFormOpen(),(0,i.Y1)({reportableId:this.props.reportableId,reportableType:this.props.reportableType,username:this.props.user.username}))}})}render(){const e=this.props,{icon:t,onFormOpen:s,reportableId:o,reportableType:l,user:c}=e,u=n(e,["icon","onFormOpen","reportableId","reportableType","user"]),d=i.Hd[this.props.reportableType],p=(0,a.dW)(`report.${d}.button`);return r.createElement("button",Object.assign({onClick:this.onShowFormButtonClick,type:"button"},u),t?r.createElement("span",{className:"textual-button textual-button--inline"},r.createElement("i",{className:"textual-button__icon fas fa-exclamation-triangle"})," ",p):p)}}Object.defineProperty(o,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{icon:!1,onFormOpen:()=>{}}})},6625:(e,t,s)=>{s.d(t,{Z:()=>E});var r=s(3890),a=s(8949),i=s(9323),n=s(7294),o=s(1270),l=s(7292),c=s(6793),u=s(4403),d=s(6871),p=s(5119),m=s(381),h=s(7629),b=s(3336),f=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let v=class extends n.Component{get playlistItemCount(){return this.props.room.active?this.props.room.playlist_item_stats.count_active:this.props.room.playlist_item_stats.count_total}get status(){if(!this.props.room.active)return"ended";if(null==this.props.room.ends_at)return"active";return new Date(this.props.room.ends_at).getTime()-(new Date).getTime()<36e5?"soon":"active"}constructor(e){super(e),(0,a.rC)(this)}render(){const e=this.props.room.ends_at;return n.createElement("div",{className:"multiplayer-room"},this.renderCover(),n.createElement("div",{className:"multiplayer-room__content"},n.createElement("div",{className:"multiplayer-room__badge-container"},n.createElement("div",{className:(0,b.sb)("multiplayer-room__badge",[this.status])},(0,o.dW)(`multiplayer.room.status.${this.status}`)),null!=e&&n.createElement("time",{className:"js-tooltip-time u-hover",title:e},"ended"===this.status?m(e).fromNow():(0,o.dW)("multiplayer.room.time_left",{time:m(e).fromNow(!0)}))),n.createElement("div",{className:"multiplayer-room__details"},n.createElement("div",{className:"multiplayer-room__name"},this.props.room.name),this.renderMembers()),n.createElement("div",{className:"multiplayer-room__badge-container multiplayer-room__badge-container--bottom"},n.createElement("div",{className:(0,b.sb)("multiplayer-room__badge",["map-count"])},(0,o.jn)("multiplayer.room.map_count",this.playlistItemCount)),n.createElement("div",{className:"multiplayer-room__difficulty",style:{"--max-difficulty":(0,h.yh)(this.props.room.difficulty_range.max),"--min-difficulty":(0,h.yh)(this.props.room.difficulty_range.min)}},n.createElement(c.Z,{rating:this.props.room.difficulty_range.min}),this.props.room.difficulty_range.max!==this.props.room.difficulty_range.min&&n.createElement(c.Z,{rating:this.props.room.difficulty_range.max})))))}renderCover(){var e,t;return n.createElement("a",{className:"multiplayer-room__cover-container",href:(0,p.B)("multiplayer.rooms.show",{room:this.props.room.id})},n.createElement(l.Z,{beatmapset:null===(t=null===(e=this.props.room.current_playlist_item)||void 0===e?void 0:e.beatmap)||void 0===t?void 0:t.beatmapset,modifiers:"full",size:"cover"}))}renderHost(){return n.createElement("div",{className:"multiplayer-room__host"},n.createElement(u.Z,{mappings:{user:n.createElement(d.Z,{className:"u-hover",user:this.props.room.host})},pattern:(0,o.dW)("multiplayer.room.hosted_by")}))}renderMembers(){return n.createElement("div",{className:"multiplayer-room__members"},this.renderHost(),this.renderParticipants())}renderParticipants(){return n.createElement("div",{className:"multiplayer-room__participants"},(0,o.jn)("multiplayer.room.player_count",this.props.room.participant_count))}};f([a.Fl],v.prototype,"status",null),v=f([i.Pi],v);const g=v;var y=s(9755),w=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let _=class extends n.Component{get hasMore(){return null!=this.props.store.cursorString}constructor(e){super(e),Object.defineProperty(this,"loading",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"handleShowMore",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(this.loading)return;this.loading=!0;const e=this.props.showMoreUrl;y.getJSON(e,{cursor_string:this.props.store.cursorString}).done((0,a.aD)((e=>{this.props.store.updateWithJson(e)}))).always((0,a.aD)((()=>{this.loading=!1})))}}),(0,a.rC)(this)}render(){const e=null!=this.props.typeGroup?(0,o.dW)("multiplayer.empty._",{type_group:(0,o.dW)(`multiplayer.empty.${this.props.typeGroup}`)}):(0,o.dW)("rankings.seasons.empty");return 0===this.props.store.rooms.length?n.createElement("div",{className:"room-list"},e):n.createElement("div",{className:"room-list"},this.props.store.rooms.map((e=>n.createElement(g,{key:e.id,room:e}))),n.createElement(r.Z,{callback:this.handleShowMore,hasMore:this.hasMore,loading:this.loading}))}};w([a.LO],_.prototype,"loading",void 0),w([a.Fl],_.prototype,"hasMore",null),w([a.aD],_.prototype,"handleShowMore",void 0),_=w([i.Pi],_);const E=_},1956:(e,t,s)=>{s.d(t,{Z:()=>p});var r=s(8949),a=s(9323),i=s(5078),n=s(7294),o=s(9703),l=s(1270),c=s(3599),u=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let d=class extends n.Component{get isPinned(){return i.Z.scorePins.isPinned(this.props.score)}get label(){const e=this.isPinned?"0":"1";return(0,l.dW)(`users.show.extra.top_ranks.pin.to_${e}`)}constructor(e){super(e),Object.defineProperty(this,"onUpdateCallbacks",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.isPinned?"0":"1";this.onUpdateCallbacks={done:this.props.onUpdate,fail:(0,o.Gi)(this.onClick)},i.Z.scorePins.apiPin(this.props.score,!this.isPinned).done((()=>{var t,s;(0,c.g)((0,l.dW)(`users.show.extra.top_ranks.pin.to_${e}_done`),"info"),null===(s=null===(t=this.onUpdateCallbacks)||void 0===t?void 0:t.done)||void 0===s||s.call(t)})).fail(((e,t)=>{var s;return null===(s=this.onUpdateCallbacks)||void 0===s?void 0:s.fail(e,t)}))}}),(0,r.rC)(this)}componentWillUnmount(){this.onUpdateCallbacks=null}render(){return n.createElement("button",{className:this.props.className,onClick:this.onClick,type:"button"},this.label)}};u([r.Fl],d.prototype,"isPinned",null),u([r.Fl],d.prototype,"label",null),d=u([a.Pi],d);const p=d},7018:(e,t,s)=>{s.d(t,{Z:()=>d});var r=s(8949),a=s(9323),i=s(7294),n=s(3857),o=s(3336),l=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};const c="select-options";let u=class extends i.Component{constructor(e){super(e),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:i.createRef()}),Object.defineProperty(this,"showingSelector",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"hideSelector",{enumerable:!0,configurable:!0,writable:!0,value:e=>{0!==e.button||null==this.ref.current||e.composedPath().includes(this.ref.current)||(this.showingSelector=!1)}}),Object.defineProperty(this,"optionSelected",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{var s,r;0===e.button&&(e.preventDefault(),this.showingSelector=!1,null===(r=(s=this.props).onChange)||void 0===r||r.call(s,t))}}),Object.defineProperty(this,"toggleSelector",{enumerable:!0,configurable:!0,writable:!0,value:e=>{0===e.button&&(e.preventDefault(),this.showingSelector=!this.showingSelector)}}),(0,r.rC)(this),(0,a.b4)(this,(0,r.EH)((()=>{(0,n.z)(this,this.props.blackout&&this.showingSelector)})))}componentDidMount(){document.addEventListener("click",this.hideSelector)}componentWillUnmount(){document.removeEventListener("click",this.hideSelector),(0,n.z)(this,!1)}render(){var e;const t=(0,o.sb)(c,{selecting:this.showingSelector},this.props.modifiers);return i.createElement("div",{ref:this.ref,className:t},i.createElement("div",{className:`${c}__select`},this.renderOption({children:i.createElement(i.Fragment,null,i.createElement("div",{className:"u-ellipsis-overflow"},null===(e=this.props.selected)||void 0===e?void 0:e.text),i.createElement("div",{className:`${c}__decoration`},i.createElement("span",{className:"fas fa-chevron-down"}))),onClick:this.toggleSelector,option:this.props.selected})),i.createElement("div",{className:`${c}__selector`},this.renderOptions()))}renderOption({children:e,onClick:t,option:s,selected:r=!1}){const a=(0,o.sb)(`${c}__option`,{selected:r});return null!=this.props.renderOption?this.props.renderOption({children:e,cssClasses:a,onClick:t,option:s}):i.createElement("a",{key:s.id,className:a,href:"#",onClick:t},e)}renderOptions(){return this.props.options.map((e=>{var t;return this.renderOption({children:i.createElement("div",{className:"u-ellipsis-overflow"},e.text),onClick:t=>{this.optionSelected(t,e)},option:e,selected:(null===(t=this.props.selected)||void 0===t?void 0:t.id)===e.id})}))}};Object.defineProperty(u,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{blackout:!0}}),l([r.LO],u.prototype,"showingSelector",void 0),l([r.aD],u.prototype,"hideSelector",void 0),l([r.aD],u.prototype,"optionSelected",void 0),l([r.aD],u.prototype,"toggleSelector",void 0),u=l([a.Pi],u);const d=u},3890:(e,t,s)=>{s.d(t,{Z:()=>u});var r=s(7294),a=s(3336),i=s(1270),n=s(6741),o=s(9755);const l="show-more-link";class c extends r.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"onClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null==this.props.callback?null==this.props.url&&null!=this.props.event&&o.publish(this.props.event,this.props.data):this.props.callback(this.props.data)}})}render(){if(!this.props.hasMore&&!this.props.loading)return null;const e={children:this.children(),className:(0,a.sb)(l,this.props.modifiers)};return this.props.loading?r.createElement("span",Object.assign({"data-disabled":"1"},e)):null==this.props.url?r.createElement("button",Object.assign({onClick:this.onClick,type:"button"},e)):r.createElement("a",Object.assign({href:this.props.url,onClick:this.onClick},e))}children(){var e,t;const s=r.createElement("span",{className:`fas fa-angle-${null!==(e=this.props.direction)&&void 0!==e?e:"down"}`});return r.createElement(r.Fragment,null,r.createElement("span",{className:`${l}__spinner`},r.createElement(n.$,null)),r.createElement("span",{className:`${l}__label`},r.createElement("span",{className:`${l}__label-icon ${l}__label-icon--left`},s),r.createElement("span",{className:`${l}__label-text`},null!==(t=this.props.label)&&void 0!==t?t:(0,i.dW)("common.buttons.show_more"),null!=this.props.remaining&&` (${this.props.remaining})`),r.createElement("span",{className:`${l}__label-icon ${l}__label-icon--right`},s)))}}Object.defineProperty(c,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{hasMore:!1,loading:!1}});const u=c},2873:(e,t,s)=>{s.d(t,{P:()=>o});var r=s(5078),a=s(7294),i=s(3336),n=s(1270);class o extends a.PureComponent{render(){var e;const t=this.props.values.map((e=>{var t,s;let i="sort__item sort__item--button";return this.props.currentValue===e&&(i+=" sort__item--active"),a.createElement("button",{key:e,className:i,"data-value":e,onClick:this.props.onChange},"rank"===e?a.createElement("span",null,a.createElement("i",{className:`fas fa-extra-mode-${null!==(s=null===(t=r.Z.currentUser)||void 0===t?void 0:t.playmode)&&void 0!==s?s:"osu"}`})," ",(0,n.dW)("sort.rank")):(0,n.dW)(`${this.props.transPrefix}${e}`))}));return a.createElement("div",{className:(0,i.sb)("sort",this.props.modifiers)},a.createElement("div",{className:"sort__items"},this.props.showTitle&&a.createElement("span",{className:"sort__item sort__item--title"},null!==(e=this.props.title)&&void 0!==e?e:(0,n.dW)("sort._")),t))}}Object.defineProperty(o,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{showTitle:!0,transPrefix:"sort."}})},6741:(e,t,s)=>{s.d(t,{$:()=>i});var r=s(7294),a=s(3336);function i(e){return r.createElement("span",{className:(0,a.sb)("la-ball-clip-rotate",e.modifiers)})}},4403:(e,t,s)=>{s.d(t,{Z:()=>a});var r=s(7294);function a(e){const t=Object.keys(e.mappings).sort(((e,t)=>e<t?1:-1));if(0===t.length)return r.createElement(r.Fragment,null,e.pattern);const s=new RegExp(`(:${t.join("|:")})`),a=e.pattern.split(s);return r.createElement(r.Fragment,null,a.map((t=>{const s=":"===t[0]?t.slice(1):null,a=null==s||null==e.mappings[s]?t:e.mappings[s];return"string"==typeof a?a:r.createElement(r.Fragment,{key:t},a)})))}},6568:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(6486),a=s(7294),i=s(3336),n=s(1270);function o(e){var t;return a.createElement("span",{className:(0,i.sb)("supporter-icon",e.modifiers),title:(0,n.dW)("users.show.is_supporter")},(0,r.times)(null!==(t=e.level)&&void 0!==t?t:1,(e=>a.createElement("span",{key:e,className:"fas fa-heart"}))))}},2163:(e,t,s)=>{s.d(t,{Z:()=>l});var r=s(3682),a=s(7294),i=s(3924),n=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]])}return s};class o extends a.PureComponent{get maxHeight(){return null!=this.props.maxRows&&Number.isFinite(this.state.lineHeight)?this.state.lineHeight*(this.props.maxRows+1):null}constructor(e){var t;super(e),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:null!==(t=this.props.innerRef)&&void 0!==t?t:a.createRef()}),Object.defineProperty(this,"shouldUpdate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"handleInput",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;this.shouldUpdate=!1,null===(s=(t=this.props).onInput)||void 0===s||s.call(t,e)}}),this.state={lineHeight:NaN}}componentDidMount(){var e;null!=this.ref.current&&(null!=this.props.maxRows||(0,i.W)(null===(e=this.props.value)||void 0===e?void 0:e.toString())?window.setTimeout((()=>{if(null!=this.ref.current){if(null!=this.props.maxRows){const e=Math.ceil(parseFloat(window.getComputedStyle(this.ref.current).getPropertyValue("line-height")));this.setState({lineHeight:e})}(0,r.Z)(this.ref.current)}}),0):(0,r.Z)(this.ref.current))}componentDidUpdate(){null!=this.ref.current&&("hidden"!==this.ref.current.style.overflowX&&(this.ref.current.style.overflowX="hidden"),this.shouldUpdate?r.Z.update(this.ref.current):this.shouldUpdate=!0)}componentWillUnmount(){null!=this.ref.current&&r.Z.destroy(this.ref.current)}render(){const e=this.props,{innerRef:t,onInput:s,maxRows:r,style:i}=e,o=n(e,["innerRef","onInput","maxRows","style"]),l=this.maxHeight;return a.createElement("textarea",Object.assign({ref:this.ref,onInput:this.handleInput,style:null!=l?Object.assign(Object.assign({},i),{maxHeight:l}):i},o))}}Object.defineProperty(o,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{async:!1,rows:1}});const l=o},12:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(381),a=s(7294),i=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]])}return s};function n(e){const{dateTime:t,format:s="ll",relative:n=!1}=e,o=i(e,["dateTime","format","relative"]),l="string"==typeof t?t:t.format();let c,u=l;if(n)c="js-timeago";else{c="js-tooltip-time";u=("string"==typeof t?r(t):t).format(s)}return a.createElement("time",Object.assign({className:c,dateTime:l,title:l},o),u)}},9270:(e,t,s)=>{s.d(t,{Z:()=>u});var r=s(5119),a=s(7294),i=s(3336),n=s(3775),o=s(1270),l=s(3924);class c extends a.PureComponent{get artist(){var e;return"artist"in this.props?null!==(e=this.props.track.artist)&&void 0!==e?e:this.props.artist:this.props.track.artist}render(){let e=(0,i.sb)("artist-track",{original:this.props.track.exclusive},this.props.modifiers);return e+=" js-audio--player",a.createElement("div",{className:e,"data-audio-url":this.props.track.preview},a.createElement("div",{className:"artist-track__col artist-track__col--preview",style:{backgroundImage:(0,i.eF)(this.props.track.cover_url)}},a.createElement("button",{className:"artist-track__button artist-track__button--play js-audio--play"},a.createElement("span",{className:"fa-fw play-button"}))),a.createElement("div",{className:"artist-track__col artist-track__col--names"},a.createElement("div",{className:"artist-track__title u-ellipsis-overflow"},this.props.track.title,(0,l.W)(this.props.track.version)&&a.createElement(a.Fragment,null," ",a.createElement("span",{className:"artist-track__version"},this.props.track.version))),a.createElement("div",{className:"artist-track__info"},a.createElement("a",{href:(0,r.B)("artists.show",{artist:this.artist.id})},this.artist.name)),this.props.showAlbum&&null!=this.props.track.album&&a.createElement("div",{className:"artist-track__info"},a.createElement("a",{href:`${(0,r.B)("artists.show",{artist:this.artist.id})}#album-${this.props.track.album_id}`},this.props.track.album.title))),a.createElement("div",{className:"artist-track__col artist-track__col--badges"},this.props.track.exclusive&&a.createElement("span",{className:"pill-badge pill-badge--pink pill-badge--with-shadow",title:(0,o.dW)("artist.songs.original")},(0,o.dW)("artist.songs.original_badge")),this.props.track.is_new&&a.createElement("span",{className:"pill-badge pill-badge--yellow pill-badge--with-shadow"},(0,o.dW)("common.badges.new"))),a.createElement("div",{className:"artist-track__col artist-track__col--details"},a.createElement("div",{className:"u-ellipsis-overflow artist-track__detail artist-track__detail--genre"},this.props.track.genre),a.createElement("div",{className:"artist-track__detail artist-track__detail--bpm"},(0,n.uf)(this.props.track.bpm),"bpm"),a.createElement("div",{className:"artist-track__detail artist-track__detail--length"},this.props.track.length)),a.createElement("div",{className:"artist-track__col artist-track__col--buttons"},a.createElement("a",{className:"artist-track__button",href:this.props.track.osz,title:(0,o.dW)("artist.beatmaps.download")},a.createElement("span",{className:"fas fa-fw fa-download"}))))}}Object.defineProperty(c,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{showAlbum:!1}});const u=c},4929:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(7294),a=s(3336);function i(e){var t;return r.createElement("span",{className:(0,a.sb)("avatar","guest",e.modifiers),style:{backgroundImage:(0,a.eF)(null===(t=e.user)||void 0===t?void 0:t.avatar_url)}})}},9815:(e,t,s)=>{s.d(t,{Z:()=>m});var r=s(5119),a=s(8949),i=s(9323),n=s(5078),o=s(7294),l=s(5225),c=s(3336),u=s(9755),d=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let p=class extends o.Component{get friendModifier(){var e;if(null==(null===(e=n.Z.currentUser)||void 0===e?void 0:e.friends))return;const t=n.Z.currentUser.friends.find((e=>e.target_id===this.props.user.id));if(null!=t){if(t.mutual)return"mutual";if(!this.context.isFriendsPage)return"friend"}}constructor(e){super(e),Object.defineProperty(this,"ref",{enumerable:!0,configurable:!0,writable:!0,value:o.createRef()}),Object.defineProperty(this,"handleRemoveClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t;null===(t=(e=this.props).onRemoveClick)||void 0===t||t.call(e,this.props.user)}}),(0,a.rC)(this)}componentWillUnmount(){u.publish("user-card:remove",this.ref.current)}render(){const e=(0,c.sb)("user-card-brick",this.props.modifiers,this.friendModifier),t=null!=this.props.user.groups&&this.props.user.groups.length>0?this.props.user.groups[0]:void 0;return o.createElement("div",{ref:this.ref,className:`js-usercard ${e}`,"data-user-id":this.props.user.id},o.createElement("a",{className:"user-card-brick__link",href:(0,r.B)("users.show",{user:this.props.user.id})},o.createElement("div",{className:"user-card-brick__group-bar",style:(0,c.$$)(t),title:null==t?void 0:t.name}),o.createElement("div",{className:"user-card-brick__username u-ellipsis-overflow"},this.props.user.username)),null!=this.props.onRemoveClick&&o.createElement("button",{className:"user-card-brick__remove",onClick:this.handleRemoveClick},o.createElement("span",{className:"fas fa-times"})))}};Object.defineProperty(p,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:l.Z}),d([a.Fl],p.prototype,"friendModifier",null),p=d([i.Pi],p);const m=p},4888:(e,t,s)=>{s.d(t,{O:()=>O,o:()=>P});var r=s(5069),a=s(1759),i=s(5119),n=s(6486),o=s(5078),l=s(7294),c=s(3336),u=s(1270),d=s(3924),p=s(5076),m=s(5523),h=s(7454),b=s(596),f=s(2325),v=s(6741),g=s(4403),y=s(6568),w=s(12),_=s(9815),E=s(6407);const P=["card","list","brick"];class O extends l.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{avatarLoaded:!1,backgroundLoaded:!1}}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onAvatarLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({avatarLoaded:!0})}}),Object.defineProperty(this,"onBackgroundLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({backgroundLoaded:!0})}})}get canMessage(){var e,t;return!this.isSelf&&null==n.find(null!==(t=null===(e=o.Z.currentUser)||void 0===e?void 0:e.blocks)&&void 0!==t?t:[],{target_id:this.user.id})}get isOnline(){return this.user.is_online}get isSelf(){return null!=o.Z.currentUser&&o.Z.currentUser.id===this.user.id}get isUserLoaded(){return Number.isFinite(this.user.id)&&this.user.id>0}get isUserNotFound(){return-1===this.user.id}get isUserVisible(){return this.isUserLoaded&&!this.user.is_deleted}get user(){return this.props.user||O.userLoading}render(){if("brick"===this.props.mode)return null==this.props.user?null:l.createElement(_.Z,Object.assign({},this.props,{user:this.props.user}));const e=(0,c.sb)("user-card",this.props.modifiers,this.props.mode,this.props.activated?"active":"highlightable");return this.url=this.isUserVisible?(0,i.B)("users.show",{user:this.user.id}):void 0,l.createElement("div",{className:e},this.renderBackground(),l.createElement("div",{className:"user-card__card"},l.createElement("div",{className:"user-card__content user-card__content--details"},l.createElement("div",{className:"user-card__user"},this.renderAvatar()),l.createElement("div",{className:"user-card__details"},this.renderIcons(),l.createElement("div",{className:"user-card__username-row"},this.renderUsername(),l.createElement("div",{className:"user-card__group-badges"},l.createElement(E.Z,{groups:this.user.groups,short:!0,wrapper:"user-card__group-badge"}))),this.renderListModeIcons())),this.renderStatusBar()))}renderAvatar(){const e={loaded:this.state.avatarLoaded},t=(0,d.W)(this.user.avatar_url)&&!this.isUserNotFound;return l.createElement("div",{className:"user-card__avatar-space"},l.createElement("div",{className:(0,c.sb)("user-card__avatar-spinner",e)},t&&l.createElement(v.$,{modifiers:e})),this.isUserLoaded&&t&&l.createElement("img",{className:(0,c.sb)("user-card__avatar",e),onError:this.onAvatarLoad,onLoad:this.onAvatarLoad,src:this.user.avatar_url}))}renderBackground(){var e;let t,s;const r=(0,c.sb)("user-card__background-overlay",this.isOnline?["online"]:[]);if(null!=(null===(e=this.user.cover)||void 0===e?void 0:e.url)){let e="user-card__background";this.state.backgroundLoaded||(e+=" user-card__background--loading"),t=l.createElement(l.Fragment,null,l.createElement("img",{className:e,onLoad:this.onBackgroundLoad,src:this.user.cover.url}),l.createElement("div",{className:r}))}else t=l.createElement("div",{className:r});return s=this.isUserVisible?l.createElement("a",{className:"user-card__background-container",href:this.url},t):t,s}renderIcons(){return this.isUserVisible?l.createElement("div",{className:"user-card__icons user-card__icons--card"},l.createElement("a",{className:"user-card__icon user-card__icon--flag",href:(0,i.B)("rankings",{country:this.user.country_code,mode:"osu",type:"performance"})},l.createElement(m.Z,{country:this.user.country})),"card"===this.props.mode&&l.createElement(l.Fragment,null,this.user.is_supporter&&l.createElement("a",{className:"user-card__icon",href:(0,i.B)("support-the-game")},l.createElement(y.Z,{modifiers:"user-card"})),l.createElement("div",{className:"user-card__icon"},l.createElement(a.Z,{modifiers:"user-card",userId:this.user.id})),!this.user.is_bot&&l.createElement("div",{className:"user-card__icon"},l.createElement(h.Z,{modifiers:["user-card"],userId:this.user.id})))):null}renderListModeIcons(){return"list"===this.props.mode&&this.isUserVisible?l.createElement("div",{className:"user-card__icons"},this.user.is_supporter&&l.createElement("a",{className:"user-card__icon",href:(0,i.B)("support-the-game")},l.createElement(y.Z,{level:this.user.support_level,modifiers:"user-list"})),l.createElement("div",{className:"user-card__icon"},l.createElement(a.Z,{modifiers:"user-list",userId:this.user.id})),!this.user.is_bot&&l.createElement("div",{className:"user-card__icon"},l.createElement(h.Z,{modifiers:["user-list"],userId:this.user.id}))):null}renderMenuButton(){if(this.isSelf)return null;return l.createElement("div",{className:"user-card__icon user-card__icon--menu"},l.createElement(b.Y,null,(e=>l.createElement("div",{className:"simple-menu"},this.canMessage&&l.createElement("a",{className:"simple-menu__item js-login-required--click",href:(0,i.B)("messages.users.show",{user:this.user.id}),onClick:e},l.createElement("span",{className:"fas fa-envelope"}),` ${(0,u.dW)("users.card.send_message")}`),l.createElement("a",{className:"simple-menu__item",href:(0,p.tB)(this.user),onClick:e},l.createElement("span",{className:"fas fa-gift"}),` ${(0,u.dW)("users.card.gift_supporter")}`),l.createElement(r.Z,{modifiers:"inline",onClick:e,userId:this.user.id,wrapperClass:"simple-menu__item"}),l.createElement(f.c,{className:"simple-menu__item",icon:!0,onFormOpen:e,reportableId:this.user.id.toString(),reportableType:"user",user:this.user})))))}renderStatusBar(){if(!this.isUserVisible)return null;const e=this.isOnline?(0,u.dW)("users.status.online"):(0,u.dW)("users.status.offline");return l.createElement("div",{className:"user-card__content user-card__content--status"},l.createElement("div",{className:"user-card__status"},this.renderStatusIcon(),l.createElement("div",{className:"user-card__status-messages"},l.createElement("span",{className:"user-card__status-message user-card__status-message--sub u-ellipsis-overflow"},!this.isOnline&&null!=this.user.last_visit&&l.createElement(g.Z,{mappings:{date:l.createElement(w.Z,{dateTime:this.user.last_visit,relative:!0})},pattern:(0,u.dW)("users.show.lastvisit")})),l.createElement("span",{className:"user-card__status-message u-ellipsis-overflow"},e))),l.createElement("div",{className:"user-card__icons user-card__icons--menu"},this.renderMenuButton()))}renderStatusIcon(){return this.isUserVisible?l.createElement("div",{className:"user-card__status-icon-container"},l.createElement("div",{className:"user-card__status-icon user-card__status-icon--"+(this.isOnline?"online":"offline")})):null}renderUsername(){const e=this.user.is_deleted?(0,u.dW)("users.deleted"):this.user.username;return null==this.url?l.createElement("div",{className:"user-card__username u-ellipsis-pre-overflow"},e):l.createElement("a",{className:"user-card__username u-ellipsis-pre-overflow",href:this.url},e)}}Object.defineProperty(O,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{activated:!1,mode:"card"}}),Object.defineProperty(O,"userLoading",{enumerable:!0,configurable:!0,writable:!0,value:{avatar_url:"",country_code:"",cover:{custom_url:null,id:null,url:null},default_group:"",id:0,is_active:!1,is_bot:!1,is_deleted:!1,is_online:!1,is_supporter:!1,last_visit:"",pm_friends_only:!0,profile_colour:"",username:(0,u.dW)("users.card.loading")}})},8293:(e,t,s)=>{s.d(t,{G:()=>o});var r=s(7294),a=s(8259),i=s(3336),n=s(4888);class o extends r.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"activeKeyDidChange",{enumerable:!0,configurable:!0,writable:!0,value:a.Gw.bind(this)}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{}})}render(){const e={"menu-active":null!=this.state.activeKey,[this.props.viewMode]:!0};return r.createElement(a.Xl.Provider,{value:{activeKeyDidChange:this.activeKeyDidChange}},r.createElement("div",{className:(0,i.sb)("user-cards",e)},this.props.users.map((e=>{const t=this.state.activeKey===e.id;return r.createElement(a.XI.Provider,{key:e.id,value:e.id},r.createElement(n.O,{activated:t,mode:this.props.viewMode,modifiers:(0,i.sw)("has-outline",this.props.modifiers),user:e}))}))))}}},4318:(e,t,s)=>{s.d(t,{Z:()=>o});var r=s(5119),a=s(7294),i=s(3336),n=s(1270);function o({group:e,modifiers:t}){if(null==e)return null;let s,o=e.name;if(null!=e.playmodes&&e.playmodes.length>0){s=a.createElement("div",{className:"user-group-badge__modes"},e.playmodes.map((e=>a.createElement("i",{key:e,className:`fal fa-extra-mode-${e}`}))));o+=` (${e.playmodes.map((e=>(0,n.dW)(`beatmaps.mode.${e}`))).join(", ")})`}const l={children:s,className:(0,i.sb)("user-group-badge",{probationary:e.is_probationary},e.identifier,t),"data-label":e.short_name,style:(0,i.$$)(e),title:o};return e.has_listing?a.createElement("a",Object.assign({},l,{href:(0,r.B)("groups.show",{group:e.id})})):a.createElement("div",Object.assign({},l))}},6407:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(7294),a=s(4318);function i(e){const{groups:t=[],modifiers:s,short:i=!1,wrapper:n}=e;let o=!1;return r.createElement(r.Fragment,null,t.map((e=>{const t=i&&o?`${n} u-hidden-narrow`:n;return o=!0,r.createElement("span",{key:e.identifier,className:t},r.createElement(a.Z,{group:e,modifiers:s}))})))}},6871:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(5119),a=s(7294);class i extends a.PureComponent{render(){var e,t;let s="js-usercard";null!=this.props.className&&(s+=` ${this.props.className}`);const i=(null!==(e=this.props.user.id)&&void 0!==e?e:-1)>0?(0,r.B)("users.show",{mode:this.props.mode,user:this.props.user.id}):void 0;return a.createElement("a",{className:s,"data-tooltip-position":this.props.tooltipPosition,"data-user-id":this.props.user.id,href:i},null!==(t=this.props.children)&&void 0!==t?t:this.props.user.username)}}},2009:(e,t,s)=>{s.d(t,{N:()=>c,Z:()=>u});var r=s(4929),a=s(6871),i=s(7294),n=s(1270),o=s(9755);const l={"right center":"left center","top center":"bottom center"};function c(e,t,s){if("1"!==e._tooltip)return e._tooltip="1",o(e).qtip({content:{text:s},hide:{delay:500,effect(){o(this).fadeTo(250,0)},fixed:!0},position:{at:t,my:l[t],viewport:o(window)},show:{delay:100,effect(){o(this).fadeTo(110,1)},ready:!0},style:{classes:"qtip qtip--user-list",def:!1,tip:!1}})}function u(e){return i.createElement("div",{className:"user-list-popup"},e.title,e.users.length>0&&i.createElement("div",{className:"user-list-popup__users"},e.users.map((e=>i.createElement(a.Z,{key:e.id,className:"user-list-popup__user",tooltipPosition:"top right",user:e},i.createElement(r.Z,{modifiers:"full",user:e}))))),e.count>e.users.length&&i.createElement("div",{className:"user-list-popup__remainder-count"},(0,n.jn)("common.count.plus_others",e.count-e.users.length)))}},5629:(e,t,s)=>{s.d(t,{Z:()=>y});var r=s(8125),a=s(381),i=s(5078),n=s(7294),o=s(3336),l=s(1270),c=s(9014),u=s(5076),d=s(2873),p=s(4888),m=s(8293),h=s(2918);const b=["all","online","offline"],f=["all","osu","taiko","fruits","mania"],v=["last_visit","rank","username"];function g(e,t){var s,r,a,i;return(null!==(r=null===(s=e.statistics)||void 0===s?void 0:s.global_rank)&&void 0!==r?r:Number.MAX_VALUE)-(null!==(i=null===(a=t.statistics)||void 0===a?void 0:a.global_rank)&&void 0!==i?i:Number.MAX_VALUE)}class y extends n.PureComponent{constructor(){super(...arguments),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{filter:this.filterFromUrl,playMode:this.playmodeFromUrl,sortMode:this.sortFromUrl,viewMode:this.viewFromUrl}}),Object.defineProperty(this,"handleSortChange",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget.dataset.value,s=(0,u.bj)(null,{sort:t});h.controller.advanceHistory(s),this.setState({sortMode:t},(()=>{i.Z.userPreferences.set("user_list_sort",this.state.sortMode)}))}}),Object.defineProperty(this,"onViewSelected",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget.dataset.value,s=(0,u.bj)(null,{view:t});h.controller.advanceHistory(s),this.setState({viewMode:t},(()=>{i.Z.userPreferences.set("user_list_view",this.state.viewMode)}))}}),Object.defineProperty(this,"optionSelected",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault();const t=e.currentTarget.dataset.key,s=(0,u.bj)(null,{filter:t});h.controller.advanceHistory(s),this.setState({filter:t},(()=>{i.Z.userPreferences.set("user_list_filter",this.state.filter)}))}}),Object.defineProperty(this,"playmodeSelected",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget.dataset.value,s=(0,u.bj)(null,{mode:t});h.controller.advanceHistory(s),this.setState({playMode:t})}})}get filterFromUrl(){return this.getAllowedQueryStringValue(b,(0,c.Kn)().get("filter"),i.Z.userPreferences.get("user_list_filter"))}get playmodeFromUrl(){return this.getAllowedQueryStringValue(f,(0,c.Kn)().get("mode"),"all")}get sortedUsers(){const e=this.getFilteredUsers(this.state.filter).slice();switch(this.state.sortMode){case"rank":return e.sort(g);case"username":return e.sort(r.gm);default:return e.sort(((e,t)=>{var s,i;return e.is_online&&t.is_online?(0,r.gm)(e,t):e.is_online||t.is_online?e.is_online?-1:1:a(null!==(s=t.last_visit)&&void 0!==s?s:0).diff(a(null!==(i=e.last_visit)&&void 0!==i?i:0))}))}}get sortFromUrl(){return this.getAllowedQueryStringValue(v,(0,c.Kn)().get("sort"),i.Z.userPreferences.get("user_list_sort"))}get viewFromUrl(){return this.getAllowedQueryStringValue(p.o,(0,c.Kn)().get("view"),i.Z.userPreferences.get("user_list_view"))}render(){var e,t;return n.createElement(n.Fragment,null,this.renderSelections(),n.createElement("div",{className:"user-list"},null!=this.props.group&&n.createElement("h1",{className:"user-list__title"},this.props.group.name),null!=(null===(e=this.props.group)||void 0===e?void 0:e.description)&&n.createElement("div",{dangerouslySetInnerHTML:{__html:this.props.group.description.html},className:"user-list__description"}),n.createElement("div",{className:"user-list__toolbar"},(null===(t=this.props.group)||void 0===t?void 0:t.has_playmodes)&&n.createElement("div",{className:"user-list__toolbar-row"},n.createElement("div",{className:"user-list__toolbar-item"},this.renderPlaymodeFilter())),n.createElement("div",{className:"user-list__toolbar-row"},n.createElement("div",{className:"user-list__toolbar-item"},this.renderSorter()),n.createElement("div",{className:"user-list__toolbar-item"},this.renderViewMode()))),n.createElement("div",{className:"user-list__items"},n.createElement(m.G,{users:this.sortedUsers,viewMode:this.state.viewMode}))))}renderOption(e,t,s=!1){const r=s?["active"]:[];let a=(0,o.sb)("update-streams-v2__item",r);return a+=` t-changelog-stream--${e}`,n.createElement("a",{key:e,className:a,"data-key":e,href:(0,u.bj)(null,{filter:e}),onClick:this.optionSelected},n.createElement("div",{className:"update-streams-v2__bar u-changelog-stream--bg"}),n.createElement("p",{className:"update-streams-v2__row update-streams-v2__row--name"},(0,l.dW)(`users.status.${e}`)),n.createElement("p",{className:"update-streams-v2__row update-streams-v2__row--version"},t))}renderSelections(){return n.createElement("div",{className:"update-streams-v2 update-streams-v2--with-active update-streams-v2--user-list"},n.createElement("div",{className:"update-streams-v2__container"},b.map((e=>this.renderOption(e,this.getFilteredUsers(e).length,e===this.state.filter)))))}renderSorter(){return n.createElement(d.P,{currentValue:this.state.sortMode,modifiers:["user-list"],onChange:this.handleSortChange,values:v})}renderViewMode(){return n.createElement("div",{className:"user-list__view-modes"},n.createElement("button",{className:(0,o.sb)("user-list__view-mode","card"===this.state.viewMode?["active"]:[]),"data-value":"card",onClick:this.onViewSelected,title:(0,l.dW)("users.view_mode.card")},n.createElement("span",{className:"fas fa-square"})),n.createElement("button",{className:(0,o.sb)("user-list__view-mode","list"===this.state.viewMode?["active"]:[]),"data-value":"list",onClick:this.onViewSelected,title:(0,l.dW)("users.view_mode.list")},n.createElement("span",{className:"fas fa-bars"})),n.createElement("button",{className:(0,o.sb)("user-list__view-mode","brick"===this.state.viewMode?["active"]:[]),"data-value":"brick",onClick:this.onViewSelected,title:(0,l.dW)("users.view_mode.brick")},n.createElement("span",{className:"fas fa-th"})))}getAllowedQueryStringValue(e,t,s){const r=t;if(e.indexOf(r)>-1)return r;const a=s;return e.indexOf(a)>-1?a:e[0]}getFilteredUsers(e){var t;let s=this.props.users.slice();const r=this.state.playMode;if("all"!==r&&(null===(t=this.props.group)||void 0===t?void 0:t.has_playmodes)){const e=this.props.group.id;s=s.filter((t=>{var s,a,i;return null===(i=null===(a=null===(s=t.groups)||void 0===s?void 0:s.find((t=>t.id===e)))||void 0===a?void 0:a.playmodes)||void 0===i?void 0:i.includes(r)}))}switch(e){case"online":return s.filter((e=>e.is_online));case"offline":return s.filter((e=>!e.is_online));default:return s}}renderPlaymodeFilter(){const e=f.map((e=>n.createElement("button",{key:e,className:(0,o.sb)("user-list__view-mode",this.state.playMode===e?["active"]:[]),"data-value":e,onClick:this.playmodeSelected,title:(0,l.dW)(`beatmaps.mode.${e}`)},"all"===e?n.createElement("span",null,(0,l.dW)("beatmaps.mode.all")):n.createElement("span",{className:`fal fa-extra-mode-${e}`}))));return n.createElement("div",{className:"user-list__view-modes"},n.createElement("span",{className:"user-list__view-mode-title"},(0,l.dW)("users.filtering.by_game_mode"))," ",e)}}},4737:(e,t,s)=>{s.d(t,{Z:()=>m});var r=s(5069),a=s(3430),i=s(8949),n=s(9323),o=s(5078),l=s(7294),c=s(3336),u=s(1270),d=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let p=class extends l.Component{get isBlocked(){return o.Z.currentUserModel.blocks.has(this.props.user.id)}constructor(e){super(e),Object.defineProperty(this,"forceShow",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"handleClick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.forceShow=!this.forceShow}}),(0,i.rC)(this)}render(){const e=this.isBlocked&&!this.forceShow;return l.createElement("div",{className:e?"osu-layout__no-scroll":void 0},this.isBlocked&&this.renderBanner(),l.createElement("div",{className:(0,c.sb)("osu-layout","full",{masked:e})},this.props.children))}renderBanner(){const e=l.createElement("div",{className:"grid-items grid-items--notification-banner-buttons"},l.createElement("div",null,l.createElement(r.Z,{userId:this.props.user.id})),l.createElement("div",null,l.createElement("button",{className:"textual-button",onClick:this.handleClick,type:"button"},l.createElement("span",null,l.createElement("i",{className:"textual-button__icon fas fa-low-vision"})," ",this.forceShow?(0,u.dW)("users.blocks.hide_profile"):(0,u.dW)("users.blocks.show_profile")))));return l.createElement("div",{className:"osu-page"},l.createElement(a.Z,{message:e,title:(0,u.dW)("users.blocks.banner_text"),type:"info"}))}};d([i.LO],p.prototype,"forceShow",void 0),d([i.Fl],p.prototype,"isBlocked",null),d([i.aD],p.prototype,"handleClick",void 0),p=d([n.Pi],p);const m=p},7048:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(7294),a=s(3336);const i="value-display";function n({description:e,label:t,modifiers:s,value:n}){return r.createElement("div",{className:(0,a.sb)(i,s)},r.createElement("div",{className:`${i}__label`},t),r.createElement("div",{className:`${i}__value`},n),null!=e&&r.createElement("div",{className:`${i}__description`},e))}},1689:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(5119),a=s(1270);function i(e){return[{active:"home"===e,title:(0,a.dW)("home.user.title"),url:(0,r.B)("home")},{active:"friends.index"===e,title:(0,a.dW)("friends.title_compact"),url:(0,r.B)("friends.index")},{active:"follows.index"===e,title:(0,a.dW)("follows.index.title_compact"),url:(0,r.B)("follows.index",{subtype:"forum_topic"})},{active:"account.edit"===e,title:(0,a.dW)("accounts.edit.title_compact"),url:(0,r.B)("account.edit")}]}},6192:(e,t,s)=>{s.d(t,{N:()=>i,R9:()=>r,Uj:()=>a});const r=["ANNOUNCE","PUBLIC","GROUP","PM"],a=new Set(r);function i(e){return e.filter((e=>a.has(e.type)))}},8152:(e,t,s)=>{s.d(t,{U:()=>a,z:()=>r});const r=["osu","taiko","fruits","mania"];function a(e){if(r.includes(e))return e}},5119:(e,t,s)=>{s.d(t,{B:()=>l});var r=s(9014);const a={url:"https://osu.ppy.sh",port:null,defaults:{},routes:{"oauth.passport.token":{uri:"oauth/token",methods:["POST"]},"oauth.authorizations.authorize":{uri:"oauth/authorize",methods:["GET","HEAD"]},"oauth.":{uri:"oauth/authorize",methods:["DELETE"]},"wiki.image":{uri:"wiki/images/{path}",methods:["GET","HEAD"],wheres:{path:".+"},parameters:["path"]},"beatmapsets.discussions.media-url":{uri:"beatmapsets/discussions/media-url",methods:["GET","HEAD"]},"admin.beatmapsets.covers":{uri:"admin/beatmapsets/{beatmapset}/covers",methods:["GET","HEAD"],parameters:["beatmapset"]},"admin.beatmapsets.covers.regenerate":{uri:"admin/beatmapsets/{beatmapset}/covers/regenerate",methods:["POST"],parameters:["beatmapset"]},"admin.beatmapsets.covers.remove":{uri:"admin/beatmapsets/{beatmapset}/covers/remove",methods:["POST"],parameters:["beatmapset"]},"admin.beatmapsets.show":{uri:"admin/beatmapsets/{beatmapset}",methods:["GET","HEAD"],parameters:["beatmapset"]},"admin.beatmapsets.update":{uri:"admin/beatmapsets/{beatmapset}",methods:["PUT","PATCH"],parameters:["beatmapset"]},"admin.contests.get-zip":{uri:"admin/contests/{contest}/zip",methods:["POST"],parameters:["contest"]},"admin.contests.index":{uri:"admin/contests",methods:["GET","HEAD"]},"admin.contests.show":{uri:"admin/contests/{contest}",methods:["GET","HEAD"],parameters:["contest"]},"admin.user-contest-entries.destroy":{uri:"admin/user-contest-entries/{user_contest_entry}",methods:["DELETE"],parameters:["user_contest_entry"]},"admin.user-contest-entries.restore":{uri:"admin/user-contest-entries/{user_contest_entry}/restore",methods:["POST"],parameters:["user_contest_entry"]},"admin.logs.index":{uri:"admin/logs",methods:["GET","HEAD"]},"admin.root":{uri:"admin",methods:["GET","HEAD"]},"admin.forum.forum-covers.index":{uri:"admin/forum/forum-covers",methods:["GET","HEAD"]},"admin.forum.forum-covers.store":{uri:"admin/forum/forum-covers",methods:["POST"]},"admin.forum.forum-covers.update":{uri:"admin/forum/forum-covers/{forum_cover}",methods:["PUT","PATCH"],parameters:["forum_cover"]},"artists.tracks.index":{uri:"beatmaps/artists/tracks",methods:["GET","HEAD"]},"artists.index":{uri:"beatmaps/artists",methods:["GET","HEAD"]},"artists.show":{uri:"beatmaps/artists/{artist}",methods:["GET","HEAD"],parameters:["artist"]},"tracks.show":{uri:"beatmaps/artists/tracks/{track}",methods:["GET","HEAD"],parameters:["track"]},"packs.index":{uri:"beatmaps/packs",methods:["GET","HEAD"]},"packs.show":{uri:"beatmaps/packs/{pack}",methods:["GET","HEAD"],parameters:["pack"]},"beatmaps.":{uri:"beatmaps/{beatmap}/scores/users/{user}",methods:["GET","HEAD"],parameters:["beatmap","user"]},"beatmaps.scores":{uri:"beatmaps/{beatmap}/scores",methods:["GET","HEAD"],parameters:["beatmap"]},"beatmaps.solo-scores":{uri:"beatmaps/{beatmap}/solo-scores",methods:["GET","HEAD"],parameters:["beatmap"]},"beatmaps.update-owner":{uri:"beatmaps/{beatmap}/update-owner",methods:["PUT"],parameters:["beatmap"]},"beatmaps.show":{uri:"beatmaps/{beatmap}",methods:["GET","HEAD"],parameters:["beatmap"]},"redirect:beatmapsets.discussions.index":{uri:"beatmapsets/beatmap-discussions",methods:["GET","HEAD"]},"redirect:beatmapsets.discussions.destroy":{uri:"beatmapsets/beatmap-discussions/{beatmap_discussion}",methods:["DELETE"],parameters:["beatmap_discussion"]},"redirect:beatmapsets.discussions.show":{uri:"beatmapsets/beatmap-discussions/{beatmap_discussion}",methods:["GET","HEAD"],parameters:["beatmap_discussion"]},"redirect:beatmapsets.discussions.vote":{uri:"beatmapsets/beatmap-discussions/{beatmap_discussion}/vote",methods:["PUT"],parameters:["beatmap_discussion"]},"redirect:beatmapsets.discussions.restore":{uri:"beatmapsets/beatmap-discussions/{beatmap_discussion}/restore",methods:["POST"],parameters:["beatmap_discussion"]},"redirect:beatmapsets.discussions.deny-kudosu":{uri:"beatmapsets/beatmap-discussions/{beatmap_discussion}/deny-kudosu",methods:["POST"],parameters:["beatmap_discussion"]},"redirect:beatmapsets.discussions.allow-kudosu":{uri:"beatmapsets/beatmap-discussions/{beatmap_discussion}/allow-kudosu",methods:["POST"],parameters:["beatmap_discussion"]},"redirect:beatmapsets.discussions.posts.destroy":{uri:"beatmapsets/beatmap-discussion-posts/{beatmap_discussion_post}",methods:["DELETE"],parameters:["beatmap_discussion_post"]},"redirect:beatmapsets.discussions.posts.store":{uri:"beatmapsets/beatmap-discussion-posts/{beatmap_discussion_post}",methods:["POST"],parameters:["beatmap_discussion_post"]},"redirect:beatmapsets.discussions.posts.update":{uri:"beatmapsets/beatmap-discussion-posts/{beatmap_discussion_post}",methods:["PUT"],parameters:["beatmap_discussion_post"]},"redirect:beatmapsets.discussions.posts.restore":{uri:"beatmapsets/beatmap-discussion-posts/{beatmap_discussion_post}/restore",methods:["POST"],parameters:["beatmap_discussion_post"]},"redirect:beatmapsets.discussions.posts.index":{uri:"beatmapsets/beatmap-discussion-posts",methods:["GET","HEAD"]},"beatmapsets.events.index":{uri:"beatmapsets/events",methods:["GET","HEAD"]},"beatmapsets.redirect:follows.index":{uri:"beatmapsets/watches",methods:["GET","HEAD"]},"beatmapsets.watches.update":{uri:"beatmapsets/watches/{watch}",methods:["PUT","PATCH"],parameters:["watch"]},"beatmapsets.watches.destroy":{uri:"beatmapsets/watches/{watch}",methods:["DELETE"],parameters:["watch"]},"beatmapsets.discussions.vote":{uri:"beatmapsets/discussions/{discussion}/vote",methods:["PUT"],parameters:["discussion"]},"beatmapsets.discussions.restore":{uri:"beatmapsets/discussions/{discussion}/restore",methods:["POST"],parameters:["discussion"]},"beatmapsets.discussions.deny-kudosu":{uri:"beatmapsets/discussions/{discussion}/deny-kudosu",methods:["POST"],parameters:["discussion"]},"beatmapsets.discussions.allow-kudosu":{uri:"beatmapsets/discussions/{discussion}/allow-kudosu",methods:["POST"],parameters:["discussion"]},"beatmapsets.discussions.posts.restore":{uri:"beatmapsets/discussions/posts/{post}/restore",methods:["POST"],parameters:["post"]},"beatmapsets.discussions.posts.index":{uri:"beatmapsets/discussions/posts",methods:["GET","HEAD"]},"beatmapsets.discussions.posts.store":{uri:"beatmapsets/discussions/posts",methods:["POST"]},"beatmapsets.discussions.posts.show":{uri:"beatmapsets/discussions/posts/{post}",methods:["GET","HEAD"],parameters:["post"]},"beatmapsets.discussions.posts.update":{uri:"beatmapsets/discussions/posts/{post}",methods:["PUT","PATCH"],parameters:["post"]},"beatmapsets.discussions.posts.destroy":{uri:"beatmapsets/discussions/posts/{post}",methods:["DELETE"],parameters:["post"]},"beatmapsets.discussions.votes.index":{uri:"beatmapsets/discussions/votes",methods:["GET","HEAD"]},"beatmapsets.discussions.index":{uri:"beatmapsets/discussions",methods:["GET","HEAD"]},"beatmapsets.discussions.show":{uri:"beatmapsets/discussions/{discussion}",methods:["GET","HEAD"],parameters:["discussion"]},"beatmapsets.discussions.destroy":{uri:"beatmapsets/discussions/{discussion}",methods:["DELETE"],parameters:["discussion"]},"beatmapsets.favourites.store":{uri:"beatmapsets/{beatmapset}/favourites",methods:["POST"],parameters:["beatmapset"]},"beatmapsets.search":{uri:"beatmapsets/search",methods:["GET","HEAD"]},"beatmapsets.discussion":{uri:"beatmapsets/{beatmapset}/discussion/{beatmap?}/{mode?}/{filter?}",methods:["GET","HEAD"],parameters:["beatmapset","beatmap","mode","filter"]},"beatmapsets.discussion.review":{uri:"beatmapsets/{beatmapset}/discussion/review",methods:["POST"],parameters:["beatmapset"]},"beatmapsets.discussion-lock":{uri:"beatmapsets/{beatmapset}/discussion-lock",methods:["POST"],parameters:["beatmapset"]},"beatmapsets.discussion-unlock":{uri:"beatmapsets/{beatmapset}/discussion-unlock",methods:["POST"],parameters:["beatmapset"]},"beatmapsets.download":{uri:"beatmapsets/{beatmapset}/download",methods:["GET","HEAD"],parameters:["beatmapset"]},"beatmapsets.love":{uri:"beatmapsets/{beatmapset}/love",methods:["PUT"],parameters:["beatmapset"]},"beatmapsets.remove-from-loved":{uri:"beatmapsets/{beatmapset}/love",methods:["DELETE"],parameters:["beatmapset"]},"beatmapsets.nominate":{uri:"beatmapsets/{beatmapset}/nominate",methods:["PUT"],parameters:["beatmapset"]},"beatmapsets.index":{uri:"beatmapsets",methods:["GET","HEAD"]},"beatmapsets.show":{uri:"beatmapsets/{beatmapset}",methods:["GET","HEAD"],parameters:["beatmapset"]},"beatmapsets.update":{uri:"beatmapsets/{beatmapset}",methods:["PUT","PATCH"],parameters:["beatmapset"]},"beatmapsets.destroy":{uri:"beatmapsets/{beatmapset}",methods:["DELETE"],parameters:["beatmapset"]},"scores.download":{uri:"scores/{score}/download",methods:["GET","HEAD"],parameters:["score"]},"scores.download-legacy":{uri:"scores/{rulesetOrScore}/{score}/download",methods:["GET","HEAD"],parameters:["rulesetOrScore","score"]},"scores.show":{uri:"scores/{rulesetOrScore}/{score?}",methods:["GET","HEAD"],parameters:["rulesetOrScore","score"]},"score-pins.destroy":{uri:"score-pins",methods:["DELETE"]},"score-pins.reorder":{uri:"score-pins",methods:["PUT"]},"score-pins.store":{uri:"score-pins",methods:["POST"]},"client-verifications.create":{uri:"client-verifications/create",methods:["GET","HEAD"]},"client-verifications.store":{uri:"client-verifications",methods:["POST"]},"comments.index":{uri:"comments",methods:["GET","HEAD"]},"comments.store":{uri:"comments",methods:["POST"]},"comments.show":{uri:"comments/{comment}",methods:["GET","HEAD"],parameters:["comment"]},"comments.update":{uri:"comments/{comment}",methods:["PUT","PATCH"],parameters:["comment"]},"comments.destroy":{uri:"comments/{comment}",methods:["DELETE"],parameters:["comment"]},"comments.pin":{uri:"comments/{comment}/pin",methods:["POST"],parameters:["comment"]},"comments.restore":{uri:"comments/{comment}/restore",methods:["POST"],parameters:["comment"]},"comments.vote":{uri:"comments/{comment}/vote",methods:["POST"],parameters:["comment"]},"contests.index":{uri:"community/contests",methods:["GET","HEAD"]},"contests.show":{uri:"community/contests/{contest}",methods:["GET","HEAD"],parameters:["contest"]},"contests.judge":{uri:"community/contests/{contest}/judge",methods:["GET","HEAD"],parameters:["contest"]},"contest-entries.judge-results":{uri:"community/contest-entries/{contest_entry}/results",methods:["GET","HEAD"],parameters:["contest_entry"]},"contest-entries.judge-vote":{uri:"community/contest-entries/{contest_entry}/judge-vote",methods:["PUT"],parameters:["contest_entry"]},"contest-entries.vote":{uri:"community/contest-entries/{contest_entry}/vote",methods:["PUT"],parameters:["contest_entry"]},"contest-entries.store":{uri:"community/contest-entries",methods:["POST"]},"contest-entries.destroy":{uri:"community/contest-entries/{contest_entry}",methods:["DELETE"],parameters:["contest_entry"]},"livestreams.promote":{uri:"community/livestreams/promote",methods:["POST"]},"livestreams.index":{uri:"community/livestreams",methods:["GET","HEAD"]},"matches.show":{uri:"community/matches/{match}",methods:["GET","HEAD"],parameters:["match"]},"tournaments.unregister":{uri:"community/tournaments/{tournament}/unregister",methods:["POST"],parameters:["tournament"]},"tournaments.register":{uri:"community/tournaments/{tournament}/register",methods:["POST"],parameters:["tournament"]},"tournaments.index":{uri:"community/tournaments",methods:["GET","HEAD"]},"tournaments.show":{uri:"community/tournaments/{tournament}",methods:["GET","HEAD"],parameters:["tournament"]},"forum.forum-covers.store":{uri:"community/forums/forum-covers",methods:["POST"]},"forum.forum-covers.update":{uri:"community/forums/forum-covers/{forum_cover}",methods:["PUT","PATCH"],parameters:["forum_cover"]},"forum.forum-covers.destroy":{uri:"community/forums/forum-covers/{forum_cover}",methods:["DELETE"],parameters:["forum_cover"]},"forum.posts.raw":{uri:"community/forums/posts/{post}/raw",methods:["GET","HEAD"],parameters:["post"]},"forum.posts.restore":{uri:"community/forums/posts/{post}/restore",methods:["POST"],parameters:["post"]},"forum.posts.show":{uri:"community/forums/posts/{post}",methods:["GET","HEAD"],parameters:["post"]},"forum.posts.edit":{uri:"community/forums/posts/{post}/edit",methods:["GET","HEAD"],parameters:["post"]},"forum.posts.update":{uri:"community/forums/posts/{post}",methods:["PUT","PATCH"],parameters:["post"]},"forum.posts.destroy":{uri:"community/forums/posts/{post}",methods:["DELETE"],parameters:["post"]},"forum.topics.logs.index":{uri:"community/forums/topics/{topic}/logs",methods:["GET","HEAD"],parameters:["topic"]},"forum.topics.edit-poll.store":{uri:"community/forums/topics/{topic}/edit-poll",methods:["POST"],parameters:["topic"]},"forum.topics.edit-poll":{uri:"community/forums/topics/{topic}/edit-poll",methods:["GET","HEAD"],parameters:["topic"]},"forum.topics.issue-tag":{uri:"community/forums/topics/{topic}/issue-tag",methods:["POST"],parameters:["topic"]},"forum.topics.lock":{uri:"community/forums/topics/{topic}/lock",methods:["POST"],parameters:["topic"]},"forum.topics.move":{uri:"community/forums/topics/{topic}/move",methods:["POST"],parameters:["topic"]},"forum.topics.pin":{uri:"community/forums/topics/{topic}/pin",methods:["POST"],parameters:["topic"]},"forum.topics.reply":{uri:"community/forums/topics/{topic}/reply",methods:["POST"],parameters:["topic"]},"forum.topics.restore":{uri:"community/forums/topics/{topic}/restore",methods:["POST"],parameters:["topic"]},"forum.topics.vote":{uri:"community/forums/topics/{topic}/vote",methods:["POST"],parameters:["topic"]},"forum.topics.vote-feature":{uri:"community/forums/topics/{topic}/vote-feature",methods:["POST"],parameters:["topic"]},"forum.preview":{uri:"community/forums/topics/preview",methods:["POST"]},"forum.topics.create":{uri:"community/forums/topics/create",methods:["GET","HEAD"]},"forum.topics.store":{uri:"community/forums/topics",methods:["POST"]},"forum.topics.show":{uri:"community/forums/topics/{topic}",methods:["GET","HEAD"],parameters:["topic"]},"forum.topics.update":{uri:"community/forums/topics/{topic}",methods:["PUT","PATCH"],parameters:["topic"]},"forum.topics.destroy":{uri:"community/forums/topics/{topic}",methods:["DELETE"],parameters:["topic"]},"forum.topic-covers.store":{uri:"community/forums/topic-covers",methods:["POST"]},"forum.topic-covers.update":{uri:"community/forums/topic-covers/{topic_cover}",methods:["PUT","PATCH"],parameters:["topic_cover"]},"forum.topic-covers.destroy":{uri:"community/forums/topic-covers/{topic_cover}",methods:["DELETE"],parameters:["topic_cover"]},"forum.redirect:follows.index":{uri:"community/forums/topic-watches",methods:["GET","HEAD"]},"forum.topic-watches.update":{uri:"community/forums/topic-watches/{topic_watch}",methods:["PUT","PATCH"],parameters:["topic_watch"]},"forum.forums.mark-as-read":{uri:"community/forums/mark-as-read",methods:["POST"]},"forum.forums.index":{uri:"community/forums",methods:["GET","HEAD"]},"forum.forums.show":{uri:"community/forums/{forum}",methods:["GET","HEAD"],parameters:["forum"]},"chat.ack":{uri:"community/chat/ack",methods:["POST"]},"chat.new":{uri:"community/chat/new",methods:["POST"]},"chat.presence":{uri:"community/chat/presence",methods:["GET","HEAD"]},"chat.updates":{uri:"community/chat/updates",methods:["GET","HEAD"]},"chat.channels.messages.index":{uri:"community/chat/channels/{channel}/messages",methods:["GET","HEAD"],parameters:["channel"]},"chat.channels.messages.store":{uri:"community/chat/channels/{channel}/messages",methods:["POST"],parameters:["channel"]},"chat.channels.join":{uri:"community/chat/channels/{channel}/users/{user}",methods:["PUT"],parameters:["channel","user"]},"chat.channels.part":{uri:"community/chat/channels/{channel}/users/{user}",methods:["DELETE"],parameters:["channel","user"]},"chat.channels.mark-as-read":{uri:"community/chat/channels/{channel}/mark-as-read/{message}",methods:["PUT"],parameters:["channel","message"]},"chat.channels.index":{uri:"community/chat/channels",methods:["GET","HEAD"]},"chat.channels.store":{uri:"community/chat/channels",methods:["POST"]},"chat.channels.show":{uri:"community/chat/channels/{channel}",methods:["GET","HEAD"],parameters:["channel"]},"chat.users.index":{uri:"community/chat/users",methods:["GET","HEAD"]},"chat.index":{uri:"community/chat",methods:["GET","HEAD"]},"group-history.index":{uri:"groups/history",methods:["GET","HEAD"]},"groups.show":{uri:"groups/{group}",methods:["GET","HEAD"],parameters:["group"]},"account.edit":{uri:"home/account/edit",methods:["GET","HEAD"]},"account.avatar":{uri:"home/account/avatar",methods:["POST"]},"account.country":{uri:"home/account/country",methods:["PUT"]},"account.cover":{uri:"home/account/cover",methods:["POST"]},"account.email":{uri:"home/account/email",methods:["PUT"]},"account.notification-options":{uri:"home/account/notification-options",methods:["PUT"]},"account.options":{uri:"home/account/options",methods:["PUT"]},"account.password":{uri:"home/account/password",methods:["PUT"]},"account.reissue-code":{uri:"home/account/reissue-code",methods:["POST"]},"account.sessions.destroy":{uri:"home/account/sessions/{session}",methods:["DELETE"],parameters:["session"]},"account.":{uri:"home/account/verify",methods:["GET","HEAD"]},"account.verify":{uri:"home/account/verify",methods:["POST"]},"account.update":{uri:"home/account",methods:["PUT"]},"account.github-users.callback":{uri:"home/account/github-users/callback",methods:["GET","HEAD"]},"account.github-users.create":{uri:"home/account/github-users/create",methods:["GET","HEAD"]},"account.github-users.destroy":{uri:"home/account/github-users",methods:["DELETE"]},"quick-search":{uri:"home/quick-search",methods:["GET","HEAD"]},search:{uri:"home/search",methods:["GET","HEAD"]},"bbcode-preview":{uri:"home/bbcode-preview",methods:["POST"]},"changelog.build":{uri:"home/changelog/{stream}/{build}",methods:["GET","HEAD"],parameters:["stream","build"]},"changelog.index":{uri:"home/changelog",methods:["GET","HEAD"]},"changelog.show":{uri:"home/changelog/{changelog}",methods:["GET","HEAD"],parameters:["changelog"]},download:{uri:"home/download",methods:["GET","HEAD"]},"set-locale":{uri:"home/set-locale",methods:["POST"]},"support-the-game":{uri:"home/support",methods:["GET","HEAD"]},testflight:{uri:"home/testflight",methods:["GET","HEAD"]},"password-reset":{uri:"home/password-reset",methods:["GET","HEAD"]},"password-reset.reset":{uri:"home/password-reset/reset",methods:["GET","HEAD"]},"password-reset.resend-mail":{uri:"home/password-reset/resend-mail",methods:["POST"]},"download-quota-check":{uri:"home/download-quota-check",methods:["GET","HEAD"]},"blocks.store":{uri:"home/blocks",methods:["POST"]},"blocks.destroy":{uri:"home/blocks/{block}",methods:["DELETE"],parameters:["block"]},"friends.index":{uri:"home/friends",methods:["GET","HEAD"]},"friends.store":{uri:"home/friends",methods:["POST"]},"friends.destroy":{uri:"home/friends/{friend}",methods:["DELETE"],parameters:["friend"]},"news.index":{uri:"home/news",methods:["GET","HEAD"]},"news.store":{uri:"home/news",methods:["POST"]},"news.show":{uri:"home/news/{news}",methods:["GET","HEAD"],parameters:["news"]},"news.update":{uri:"home/news/{news}",methods:["PUT","PATCH"],parameters:["news"]},"messages.users.show":{uri:"home/messages/users/{user}",methods:["GET","HEAD"],parameters:["user"]},"follows.store":{uri:"home/follows",methods:["POST"]},"follows.index":{uri:"home/follows/{subtype?}",methods:["GET","HEAD"],parameters:["subtype"]},"follows.destroy":{uri:"home/follows",methods:["DELETE"]},"legacy-api-key.store":{uri:"legacy-api-key",methods:["POST"]},"legacy-api-key.destroy":{uri:"legacy-api-key",methods:["DELETE"]},"legacy-irc-key.store":{uri:"legacy-irc-key",methods:["POST"]},"legacy-irc-key.destroy":{uri:"legacy-irc-key",methods:["DELETE"]},"notifications.index":{uri:"notifications",methods:["GET","HEAD"]},"notifications.endpoint":{uri:"notifications/endpoint",methods:["GET","HEAD"]},"notifications.mark-read":{uri:"notifications/mark-read",methods:["POST"]},legal:{uri:"legal/{locale?}/{path?}",methods:["GET","HEAD"],parameters:["locale","path"]},"multiplayer.rooms.show":{uri:"multiplayer/rooms/{room}",methods:["GET","HEAD"],parameters:["room"]},"oauth.authorized-clients.destroy":{uri:"oauth/authorized-clients/{authorized_client}",methods:["DELETE"],parameters:["authorized_client"]},"oauth.clients.index":{uri:"oauth/clients",methods:["GET","HEAD"]},"oauth.clients.store":{uri:"oauth/clients",methods:["POST"]},"oauth.clients.update":{uri:"oauth/clients/{client}",methods:["PUT","PATCH"],parameters:["client"]},"oauth.clients.destroy":{uri:"oauth/clients/{client}",methods:["DELETE"],parameters:["client"]},"oauth.clients.reset-secret":{uri:"oauth/clients/{client}/reset-secret",methods:["POST"],parameters:["client"]},"rankings.kudosu":{uri:"rankings/kudosu",methods:["GET","HEAD"]},rankings:{uri:"rankings/{mode?}/{type?}",methods:["GET","HEAD"],parameters:["mode","type"]},"reports.store":{uri:"reports",methods:["POST"]},"seasons.show":{uri:"seasons/{season}",methods:["GET","HEAD"],parameters:["season"]},"seasons.rooms":{uri:"seasons/{season}/rooms",methods:["GET","HEAD"],parameters:["season"]},login:{uri:"session",methods:["POST"]},logout:{uri:"session",methods:["DELETE"]},"user-cover-presets.batch-activate":{uri:"user-cover-presets/batch-activate",methods:["POST"]},"user-cover-presets.index":{uri:"user-cover-presets",methods:["GET","HEAD"]},"user-cover-presets.store":{uri:"user-cover-presets",methods:["POST"]},"user-cover-presets.update":{uri:"user-cover-presets/{user_cover_preset}",methods:["PUT","PATCH"],parameters:["user_cover_preset"]},"users.check-username-availability":{uri:"users/check-username-availability",methods:["POST"]},"users.check-username-exists":{uri:"users/check-username-exists",methods:["POST"]},"users.disabled":{uri:"users/disabled",methods:["GET","HEAD"]},"users.create":{uri:"users/create",methods:["GET","HEAD"]},"users.store-web":{uri:"users/store-web",methods:["POST"]},"users.card":{uri:"users/{user}/card",methods:["GET","HEAD"],parameters:["user"]},"users.extra-page":{uri:"users/{user}/extra-pages/{page}",methods:["GET","HEAD"],parameters:["user","page"]},"users.page":{uri:"users/{user}/page",methods:["PUT"],parameters:["user"]},"users.multiplayer.index":{uri:"users/{user}/{typeGroup}",methods:["GET","HEAD"],wheres:{typeGroup:"multiplayer|playlists|realtime"},parameters:["user","typeGroup"]},"users.modding.index":{uri:"users/{user}/modding",methods:["GET","HEAD"],parameters:["user"]},"users.modding.posts":{uri:"users/{user}/modding/posts",methods:["GET","HEAD"],parameters:["user"]},"users.modding.votes-given":{uri:"users/{user}/modding/votes-given",methods:["GET","HEAD"],parameters:["user"]},"users.modding.votes-received":{uri:"users/{user}/modding/votes-received",methods:["GET","HEAD"],parameters:["user"]},"users.kudosu":{uri:"users/{user}/kudosu",methods:["GET","HEAD"],parameters:["user"]},"users.recent-activity":{uri:"users/{user}/recent_activity",methods:["GET","HEAD"],parameters:["user"]},"users.scores":{uri:"users/{user}/scores/{type}",methods:["GET","HEAD"],parameters:["user","type"]},"users.beatmapsets":{uri:"users/{user}/beatmapsets/{type}",methods:["GET","HEAD"],parameters:["user","type"]},"users.posts":{uri:"users/{user}/posts",methods:["GET","HEAD"],parameters:["user"]},"users.show":{uri:"users/{user}/{mode?}",methods:["GET","HEAD"],parameters:["user","mode"]},"users.store":{uri:"users",methods:["POST"]},"wiki.sitemap":{uri:"wiki/{locale}/Sitemap",methods:["GET","HEAD"],parameters:["locale"]},"wiki.show":{uri:"wiki/{locale?}/{path?}",methods:["GET","HEAD"],wheres:{path:".+"},parameters:["locale","path"]},"wiki-suggestions":{uri:"wiki-suggestions",methods:["GET","HEAD"]},"store.redirect:store.products.index":{uri:"store",methods:["GET","HEAD"]},"store.products.index":{uri:"store/listing",methods:["GET","HEAD"]},"store.invoice.show":{uri:"store/invoice/{invoice}",methods:["GET","HEAD"],parameters:["invoice"]},"store.notification-request":{uri:"store/products/{product}/notification-request",methods:["POST"],parameters:["product"]},"store.":{uri:"store/products/{product}/notification-request",methods:["DELETE"],parameters:["product"]},"store.cart.show":{uri:"store/cart",methods:["GET","HEAD"]},"store.cart.empty":{uri:"store/cart",methods:["DELETE"]},"store.cart.store":{uri:"store/cart",methods:["POST"]},"store.checkout.store":{uri:"store/checkout",methods:["POST"]},"store.checkout.show":{uri:"store/checkout/{checkout}",methods:["GET","HEAD"],parameters:["checkout"]},"store.orders.index":{uri:"store/orders",methods:["GET","HEAD"]},"store.orders.destroy":{uri:"store/orders/{order}",methods:["DELETE"],parameters:["order"]},"store.redirect:store.products.show":{uri:"store/product/{product}",methods:["GET","HEAD"],parameters:["product"]},"store.products.show":{uri:"store/products/{product}",methods:["GET","HEAD"],parameters:["product"]},"payments.paypal.approved":{uri:"payments/paypal/approved",methods:["GET","HEAD"]},"payments.paypal.declined":{uri:"payments/paypal/declined",methods:["GET","HEAD"]},"payments.paypal.create":{uri:"payments/paypal/create",methods:["POST"]},"payments.paypal.completed":{uri:"payments/paypal/completed",methods:["GET","HEAD"]},"payments.paypal.ipn":{uri:"payments/paypal/ipn",methods:["POST"]},"payments.xsolla.completed":{uri:"payments/xsolla/completed",methods:["GET","HEAD"]},"payments.xsolla.token":{uri:"payments/xsolla/token",methods:["POST"]},"payments.xsolla.callback":{uri:"payments/xsolla/callback",methods:["POST"]},"payments.centili.callback":{uri:"payments/centili/callback",methods:["POST","GET","HEAD"]},"payments.centili.completed":{uri:"payments/centili/completed",methods:["GET","HEAD"]},"payments.centili.failed":{uri:"payments/centili/failed",methods:["GET","HEAD"]},"payments.shopify.callback":{uri:"payments/shopify/callback",methods:["POST"]},home:{uri:"/",methods:["GET","HEAD"]},"redirect:forum.posts.show":{uri:"forum/p/{post}",methods:["GET","HEAD"],parameters:["post"]},"redirect:forum.posts.show:":{uri:"po/{post}",methods:["GET","HEAD"],parameters:["post"]},"redirect:forum.topics.show":{uri:"forum/t/{topic}",methods:["GET","HEAD"],parameters:["topic"]},"redirect:forum.forums.show":{uri:"forum/{forum}",methods:["GET","HEAD"],parameters:["forum"]},"redirect:beatmaps.show":{uri:"b/{beatmap}",methods:["GET","HEAD"],parameters:["beatmap"]},"redirect:groups.show":{uri:"g/{group}",methods:["GET","HEAD"],parameters:["group"]},"redirect:beatmapsets.show":{uri:"s/{beatmapset}",methods:["GET","HEAD"],parameters:["beatmapset"]},"redirect:users.show":{uri:"u/{user}",methods:["GET","HEAD"],parameters:["user"]},"redirect:forum.forums.index":{uri:"forum",methods:["GET","HEAD"]},"redirect:matches.show":{uri:"mp/{match}",methods:["GET","HEAD"],parameters:["match"]},"redirect:wiki.show":{uri:"help/wiki/{path?}",methods:["GET","HEAD"],wheres:{path:".+"},parameters:["path"]},"api.verify":{uri:"api/v2/session/verify",methods:["POST"]},"api.verify.reissue":{uri:"api/v2/session/verify/reissue",methods:["POST"]},"api.beatmaps.lookup":{uri:"api/v2/beatmaps/lookup",methods:["GET","HEAD"]},"api.beatmaps.packs.index":{uri:"api/v2/beatmaps/packs",methods:["GET","HEAD"]},"api.beatmaps.packs.show":{uri:"api/v2/beatmaps/packs/{pack}",methods:["GET","HEAD"],parameters:["pack"]},"api.beatmaps.user.score":{uri:"api/v2/beatmaps/{beatmap}/scores/users/{user}",methods:["GET","HEAD"],parameters:["beatmap","user"]},"api.beatmaps.user.scores":{uri:"api/v2/beatmaps/{beatmap}/scores/users/{user}/all",methods:["GET","HEAD"],parameters:["beatmap","user"]},"api.beatmaps.scores":{uri:"api/v2/beatmaps/{beatmap}/scores",methods:["GET","HEAD"],parameters:["beatmap"]},"api.beatmaps.solo-scores":{uri:"api/v2/beatmaps/{beatmap}/solo-scores",methods:["GET","HEAD"],parameters:["beatmap"]},"api.beatmaps.solo.score-tokens.store":{uri:"api/v2/beatmaps/{beatmap}/solo/scores",methods:["POST"],parameters:["beatmap"]},"api.beatmaps.solo.scores.store":{uri:"api/v2/beatmaps/{beatmap}/solo/scores/{token}",methods:["PUT"],parameters:["beatmap","token"]},"api.beatmaps.index":{uri:"api/v2/beatmaps",methods:["GET","HEAD"]},"api.beatmaps.show":{uri:"api/v2/beatmaps/{beatmap}",methods:["GET","HEAD"],parameters:["beatmap"]},"api.beatmaps.attributes":{uri:"api/v2/beatmaps/{beatmap}/attributes",methods:["POST"],parameters:["beatmap"]},"api.beatmapsets.events.index":{uri:"api/v2/beatmapsets/events",methods:["GET","HEAD"]},"api.beatmapsets.discussions.posts.index":{uri:"api/v2/beatmapsets/discussions/posts",methods:["GET","HEAD"]},"api.beatmapsets.discussions.votes.index":{uri:"api/v2/beatmapsets/discussions/votes",methods:["GET","HEAD"]},"api.beatmapsets.discussions.index":{uri:"api/v2/beatmapsets/discussions",methods:["GET","HEAD"]},"api.beatmapsets.favourites.store":{uri:"api/v2/beatmapsets/{beatmapset}/favourites",methods:["POST"],parameters:["beatmapset"]},"api.comments.index":{uri:"api/v2/comments",methods:["GET","HEAD"]},"api.comments.store":{uri:"api/v2/comments",methods:["POST"]},"api.comments.show":{uri:"api/v2/comments/{comment}",methods:["GET","HEAD"],parameters:["comment"]},"api.comments.update":{uri:"api/v2/comments/{comment}",methods:["PUT","PATCH"],parameters:["comment"]},"api.comments.destroy":{uri:"api/v2/comments/{comment}",methods:["DELETE"],parameters:["comment"]},"api.comments.vote":{uri:"api/v2/comments/{comment}/vote",methods:["POST"],parameters:["comment"]},"api.":{uri:"api/v2/beatmapsets/{beatmapset}/download",methods:["GET","HEAD"],parameters:["beatmapset"]},"api.chat.ack":{uri:"api/v2/chat/ack",methods:["POST"]},"api.chat.new":{uri:"api/v2/chat/new",methods:["POST"]},"api.chat.updates":{uri:"api/v2/chat/updates",methods:["GET","HEAD"]},"api.chat.presence":{uri:"api/v2/chat/presence",methods:["GET","HEAD"]},"api.chat.channels.messages.index":{uri:"api/v2/chat/channels/{channel}/messages",methods:["GET","HEAD"],parameters:["channel"]},"api.chat.channels.messages.store":{uri:"api/v2/chat/channels/{channel}/messages",methods:["POST"],parameters:["channel"]},"api.chat.channels.join":{uri:"api/v2/chat/channels/{channel}/users/{user}",methods:["PUT"],parameters:["channel","user"]},"api.chat.channels.part":{uri:"api/v2/chat/channels/{channel}/users/{user}",methods:["DELETE"],parameters:["channel","user"]},"api.chat.channels.mark-as-read":{uri:"api/v2/chat/channels/{channel}/mark-as-read/{message}",methods:["PUT"],parameters:["channel","message"]},"api.chat.channels.index":{uri:"api/v2/chat/channels",methods:["GET","HEAD"]},"api.chat.channels.store":{uri:"api/v2/chat/channels",methods:["POST"]},"api.chat.channels.show":{uri:"api/v2/chat/channels/{channel}",methods:["GET","HEAD"],parameters:["channel"]},"api.changelog.build":{uri:"api/v2/changelog/{stream}/{build}",methods:["GET","HEAD"],parameters:["stream","build"]},"api.changelog.index":{uri:"api/v2/changelog",methods:["GET","HEAD"]},"api.changelog.show":{uri:"api/v2/changelog/{changelog}",methods:["GET","HEAD"],parameters:["changelog"]},"api.events.index":{uri:"api/v2/events",methods:["GET","HEAD"]},"api.forum.topics.reply":{uri:"api/v2/forums/topics/{topic}/reply",methods:["POST"],parameters:["topic"]},"api.forum.topics.store":{uri:"api/v2/forums/topics",methods:["POST"]},"api.forum.topics.show":{uri:"api/v2/forums/topics/{topic}",methods:["GET","HEAD"],parameters:["topic"]},"api.forum.topics.update":{uri:"api/v2/forums/topics/{topic}",methods:["PUT","PATCH"],parameters:["topic"]},"api.forum.posts.update":{uri:"api/v2/forums/posts/{post}",methods:["PUT","PATCH"],parameters:["post"]},"api.matches.index":{uri:"api/v2/matches",methods:["GET","HEAD"]},"api.matches.show":{uri:"api/v2/matches/{match}",methods:["GET","HEAD"],parameters:["match"]},"api.reports.store":{uri:"api/v2/reports",methods:["POST"]},"api.rooms.join":{uri:"api/v2/rooms/{room}/users/{user}",methods:["PUT"],parameters:["room","user"]},"api.rooms.part":{uri:"api/v2/rooms/{room}/users/{user}",methods:["DELETE"],parameters:["room","user"]},"api.rooms.":{uri:"api/v2/rooms/{room}/leaderboard",methods:["GET","HEAD"],parameters:["room"]},"api.rooms.playlist.":{uri:"api/v2/rooms/{room}/playlist/{playlist}/scores/users/{user}",methods:["GET","HEAD"],parameters:["room","playlist","user"]},"api.rooms.playlist.scores.index":{uri:"api/v2/rooms/{room}/playlist/{playlist}/scores",methods:["GET","HEAD"],parameters:["room","playlist"]},"api.rooms.playlist.scores.store":{uri:"api/v2/rooms/{room}/playlist/{playlist}/scores",methods:["POST"],parameters:["room","playlist"]},"api.rooms.playlist.scores.show":{uri:"api/v2/rooms/{room}/playlist/{playlist}/scores/{score}",methods:["GET","HEAD"],parameters:["room","playlist","score"]},"api.rooms.playlist.scores.update":{uri:"api/v2/rooms/{room}/playlist/{playlist}/scores/{score}",methods:["PUT","PATCH"],parameters:["room","playlist","score"]},"api.rooms.index":{uri:"api/v2/rooms",methods:["GET","HEAD"]},"api.rooms.store":{uri:"api/v2/rooms",methods:["POST"]},"api.rooms.show":{uri:"api/v2/rooms/{room}",methods:["GET","HEAD"],parameters:["room"]},"api.seasonal-backgrounds.index":{uri:"api/v2/seasonal-backgrounds",methods:["GET","HEAD"]},"api.scores.download":{uri:"api/v2/scores/{score}/download",methods:["GET","HEAD"],parameters:["score"]},"api.scores.download-legacy":{uri:"api/v2/scores/{rulesetOrScore}/{score}/download",methods:["GET","HEAD"],parameters:["rulesetOrScore","score"]},"api.scores.show":{uri:"api/v2/scores/{rulesetOrScore}/{score?}",methods:["GET","HEAD"],parameters:["rulesetOrScore","score"]},"api.beatmapsets.show":{uri:"api/v2/beatmapsets/{beatmapset}",methods:["GET","HEAD"],parameters:["beatmapset"]},"api.friends.index":{uri:"api/v2/friends",methods:["GET","HEAD"]},"api.download-quota-check":{uri:"api/v2/me/download-quota-check",methods:["GET","HEAD"]},"api.me":{uri:"api/v2/me/{mode?}",methods:["GET","HEAD"],parameters:["mode"]},"api.oauth.tokens.current":{uri:"api/v2/oauth/tokens/current",methods:["DELETE"]},"api.news.index":{uri:"api/v2/news",methods:["GET","HEAD"]},"api.news.show":{uri:"api/v2/news/{news}",methods:["GET","HEAD"],parameters:["news"]},"api.notifications.index":{uri:"api/v2/notifications",methods:["GET","HEAD"]},"api.notifications.mark-read":{uri:"api/v2/notifications/mark-read",methods:["POST"]},"api.spotlights.index":{uri:"api/v2/spotlights",methods:["GET","HEAD"]},"api.users.show":{uri:"api/v2/users/{user}/{mode?}",methods:["GET","HEAD"],parameters:["user","mode"]},"api.users.index":{uri:"api/v2/users",methods:["GET","HEAD"]},"api.wiki.show":{uri:"api/v2/wiki/{locale}/{path}",methods:["GET","HEAD"],wheres:{path:".+"},parameters:["locale","path"]},"interop.":{uri:"_lio/artist-tracks/reindex-all",methods:["POST"]},"interop.beatmapsets.broadcast-new":{uri:"_lio/beatmapsets/{beatmapset}/broadcast-new",methods:["POST"],parameters:["beatmapset"]},"interop.beatmapsets.broadcast-revive":{uri:"_lio/beatmapsets/{beatmapset}/broadcast-revive",methods:["POST"],parameters:["beatmapset"]},"interop.beatmapsets.disqualify":{uri:"_lio/beatmapsets/{beatmapset}/disqualify",methods:["POST"],parameters:["beatmapset"]},"interop.beatmapsets.destroy":{uri:"_lio/beatmapsets/{beatmapset}",methods:["DELETE"],parameters:["beatmapset"]},"interop.indexing.bulk.store":{uri:"_lio/indexing/bulk",methods:["POST"]},"interop.users.achievement":{uri:"_lio/user-achievement/{user}/{achievement}/{beatmap?}",methods:["POST"],parameters:["user","achievement","beatmap"]},"interop.user-group.update":{uri:"_lio/users/{user}/groups/{group}",methods:["PUT"],parameters:["user","group"]},"interop.user-group.destroy":{uri:"_lio/users/{user}/groups/{group}",methods:["DELETE"],parameters:["user","group"]},"interop.user-group.set-default":{uri:"_lio/users/{user}/groups/{group}/default",methods:["POST"],parameters:["user","group"]},"interop.users.store":{uri:"_lio/users",methods:["POST"]}}};"undefined"!=typeof window&&void 0!==window.Ziggy&&Object.assign(a.routes,window.Ziggy.routes);var i=s(8129),n=s.n(i);const o=(0,r.JJ)();function l(e,t,s){return n()(e,t,s,a)}a.port=+o.port||null,a.url=o.origin},3974:(e,t,s)=>{s.d(t,{F8:()=>u,FU:()=>o,H:()=>d,Us:()=>l,fv:()=>c});var r=s(7294),a=s(9567),i=s(7012),n=s(5076);const o=r.createContext({inLink:!1});function l(e){return function(t){return r.createElement(e,null,u(t.children))}}function c(e){const t=(0,i.cO)(e.href),s=(0,n.pc)(t.href),a=null==t.children||e.children instanceof Array&&e.children.length>0&&e.children[0]!==e.href?e.children:t.children;return r.createElement(o.Consumer,null,(({inLink:e})=>r.createElement(o.Provider,{value:{inLink:!0}},e?a:r.createElement("a",Object.assign({},t,{href:s}),a))))}function u(e){var t;if("string"==typeof e){const s=[...e.matchAll(i.Qq)];if(s.length>0){let a=0;const i=[];for(const o of s){const s=null!==(t=o.index)&&void 0!==t?t:0,l=e.substring(a,s);i.push(l);const[,,,c,u,d,p]=o,m=`${c}:${u}:${d}${null!=p?p:""}`;i.push(r.createElement("a",{key:`timestamp-${s}`,className:"beatmap-discussion-timestamp-decoration",href:(0,n.ri)(m)},m)),a=s+o[0].length}return i.push(e.substring(a,e.length)),i}}else if(Array.isArray(e))return e.map(u);return e}function d(e){return e.startsWith("osu://edit/")?e:(0,a.A)(e)}},7595:(e,t,s)=>{s.d(t,{$:()=>m,Z:()=>b});var r=s(849),a=s(6192),i=s(6486),n=s(8949),o=s(8125),l=s(5078),c=s(9603),u=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n},d=function(e,t,s,r){return new(s||(s=Promise))((function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};const p=new Set(["ANNOUNCE","PM"]),m=1024;class h{get announcementUsers(){return this.usersLoaded?this.userIds.map((e=>l.Z.dataStore.userStore.get(e))).filter((e=>null!=e)).sort(o.gm):null}get canMessage(){return null==this.canMessageError}get firstMessage(){return this.messages.length>0?this.messages[0]:void 0}get hasEarlierMessages(){return this.firstMessageId!==this.minMessageId}get isDisplayable(){return this.name.length>0&&null!=this.icon}get isHideable(){return p.has(this.type)}get isUnread(){return null!=this.lastReadId?this.lastMessageId>this.lastReadId:this.lastMessageId>-1}get lastMessage(){return this.messages[this.messages.length-1]}get lastMessageId(){var e;for(let t=this.messages.length-1;t>=0;t--)if("number"==typeof this.messages[t].messageId)return this.messages[t].messageId;return null!==(e=this.serverLastMessageId)&&void 0!==e?e:-1}get messages(){return(0,i.sortBy)([...this.messagesMap.values()],["timestamp","channelId"])}get minMessageId(){const e=this.messages.length>0?this.messages[0].messageId:void 0;return"number"==typeof e?e:-1}get pmTarget(){if("PM"===this.type)return this.userIds.find((e=>e!==l.Z.currentUserOrFail.id))}get supportedType(){return a.Uj.has(this.type)?this.type:null}constructor(e){Object.defineProperty(this,"canMessageError",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"channelId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstMessageId",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"icon",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputText",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"lastReadId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loadingEarlierMessages",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"loadingMessages",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"messageLengthLimit",{enumerable:!0,configurable:!0,writable:!0,value:m}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"needsRefresh",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"newPmChannel",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"throttledSendMarkAsRead",{enumerable:!0,configurable:!0,writable:!0,value:(0,i.throttle)((()=>this.sendMarkAsRead()),1e3)}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:"TEMPORARY"}),Object.defineProperty(this,"uiState",{enumerable:!0,configurable:!0,writable:!0,value:{autoScroll:!0,scrollY:0}}),Object.defineProperty(this,"userIds",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"markAsReadLastSent",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"messagesMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"serverLastMessageId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usersLoaded",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.channelId=e,(0,n.rC)(this)}static newPM(e,t){const s=new h(null!=t?t:-1);return s.newPmChannel=null==t,s.type="PM",s.name=e.username,s.icon=e.avatarUrl,s.userIds=[l.Z.currentUserOrFail.id,e.id],s}addMessage(e){var t;if(null!=e.uuid&&e.sender_id===(null===(t=l.Z.currentUser)||void 0===t?void 0:t.id)){const t=this.messagesMap.get(e.uuid);if(null!=t)return this.persistMessage(t,e)}const s=c.Z.fromJson(e);this.messagesMap.set(s.messageId,s)}addMessages(e){e.forEach((e=>this.messagesMap.set(e.messageId,e)))}addSendingMessage(e){this.messagesMap.set(e.messageId,e),this.moveMarkAsReadMarker()}afterSendMesssage(e,t){null!=t?(this.persistMessage(e,t),this.setLastReadId(t.message_id)):e.errored=!0}load(){this.newPmChannel||("ANNOUNCE"!==this.type||this.usersLoaded||this.loadMetadata(),this.loadRecentMessages())}loadEarlierMessages(){return d(this,void 0,void 0,(function*(){if(!this.hasEarlierMessages||this.loadingEarlierMessages)return;let e;this.loadingEarlierMessages=!0,this.minMessageId>0&&(e=this.minMessageId);try{const t=yield(0,r._U)(this.channelId,{until:e});(0,n.z)((()=>{this.addMessages(t),0===t.length&&(this.firstMessageId=this.minMessageId)}))}finally{(0,n.z)((()=>{this.loadingEarlierMessages=!1}))}}))}loadMetadata(){(0,r.mr)(this.channelId).done((e=>{(0,n.z)((()=>{this.updateWithJson(e),this.usersLoaded=!0}))}))}moveMarkAsReadMarker(){this.setLastReadId(this.lastMessageId)}removeMessagesFromUserIds(e){for(const[,t]of this.messagesMap)e.has(t.senderId)&&this.messagesMap.delete(t.messageId)}setInputText(e){this.inputText=e}updateWithJson(e){var t,s,r;if(this.name=e.name,this.description=e.description,this.type=e.type,this.icon=null!==(t=e.icon)&&void 0!==t?t:h.defaultIcon,this.messageLengthLimit=e.message_length_limit,this.userIds=null!==(s=e.users)&&void 0!==s?s:this.userIds,this.serverLastMessageId=e.last_message_id,null!=e.current_user_attributes){this.canMessageError=e.current_user_attributes.can_message_error;const t=null!==(r=e.current_user_attributes.last_read_id)&&void 0!==r?r:0;this.setLastReadId(t),t>this.markAsReadLastSent&&(this.markAsReadLastSent=t)}}loadRecentMessages(){return d(this,void 0,void 0,(function*(){if(!this.needsRefresh||this.loadingMessages)return;let e;this.loadingMessages=!0,this.messages.length>0&&this.lastMessageId>0&&(e=this.lastMessageId);try{const t=yield(0,r._U)(this.channelId);(0,n.z)((()=>{const s=function(e){let t;for(const s of e)"number"==typeof s.messageId&&(null==t||s.messageId<t)&&(t=s.messageId);return null!=t?t:-1}(t);s>this.lastMessageId&&this.messagesMap.clear(),this.addMessages(t),this.needsRefresh=!1,this.loadingMessages=!1,0!==t.length||null!=e||(this.firstMessageId=this.minMessageId)}))}catch(t){(0,n.z)((()=>this.loadingMessages=!1))}}))}persistMessage(e,t){null!=t.uuid&&this.messagesMap.delete(t.uuid),e.persist(t),this.messagesMap.set(e.messageId,e)}sendMarkAsRead(){var e;const t=null!==(e=this.lastReadId)&&void 0!==e?e:0;this.markAsReadLastSent>=t||(this.markAsReadLastSent=t,(0,r.zJ)(this.channelId,t))}setLastReadId(e){var t;e>(null!==(t=this.lastReadId)&&void 0!==t?t:0)&&(this.lastReadId=e)}}Object.defineProperty(h,"defaultIcon",{enumerable:!0,configurable:!0,writable:!0,value:"/images/layout/chat/channel-default.png"});const b=h;u([n.LO],h.prototype,"canMessageError",void 0),u([n.LO],h.prototype,"channelId",void 0),u([n.LO],h.prototype,"description",void 0),u([n.LO],h.prototype,"firstMessageId",void 0),u([n.LO],h.prototype,"icon",void 0),u([n.LO],h.prototype,"inputText",void 0),u([n.LO],h.prototype,"lastReadId",void 0),u([n.LO],h.prototype,"loadingEarlierMessages",void 0),u([n.LO],h.prototype,"loadingMessages",void 0),u([n.LO],h.prototype,"messageLengthLimit",void 0),u([n.LO],h.prototype,"name",void 0),u([n.LO],h.prototype,"newPmChannel",void 0),u([n.LO],h.prototype,"type",void 0),u([n.LO],h.prototype,"uiState",void 0),u([n.LO],h.prototype,"userIds",void 0),u([n.LO],h.prototype,"messagesMap",void 0),u([n.LO],h.prototype,"usersLoaded",void 0),u([n.Fl],h.prototype,"announcementUsers",null),u([n.Fl],h.prototype,"canMessage",null),u([n.Fl],h.prototype,"firstMessage",null),u([n.Fl],h.prototype,"hasEarlierMessages",null),u([n.Fl],h.prototype,"isDisplayable",null),u([n.Fl],h.prototype,"isUnread",null),u([n.Fl],h.prototype,"lastMessage",null),u([n.Fl],h.prototype,"lastMessageId",null),u([n.Fl],h.prototype,"messages",null),u([n.Fl],h.prototype,"minMessageId",null),u([n.Fl],h.prototype,"pmTarget",null),u([n.Fl],h.prototype,"supportedType",null),u([n.aD],h.prototype,"addMessage",null),u([n.aD],h.prototype,"addMessages",null),u([n.aD],h.prototype,"addSendingMessage",null),u([n.aD],h.prototype,"afterSendMesssage",null),u([n.aD],h.prototype,"load",null),u([n.aD],h.prototype,"loadEarlierMessages",null),u([n.aD],h.prototype,"loadMetadata",null),u([n.aD],h.prototype,"moveMarkAsReadMarker",null),u([n.aD],h.prototype,"removeMessagesFromUserIds",null),u([n.aD],h.prototype,"setInputText",null),u([n.aD],h.prototype,"updateWithJson",null),u([n.aD],h.prototype,"loadRecentMessages",null),u([n.aD],h.prototype,"persistMessage",null),u([n.aD],h.prototype,"sendMarkAsRead",null),u([n.aD],h.prototype,"setLastReadId",null)},8256:(e,t,s)=>{s.d(t,{CI:()=>f,Gw:()=>v,ZP:()=>g});var r=s(5119),a=s(6486),i=s(8949),n=s(5078),o=s(9703),l=s(9139),c=s(3924),u=s(7595),d=s(9755),p=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n},m=function(e,t,s,r){return new(s||(s=Promise))((function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};const h=["description","message","name","users"],b="createAnnouncement",f=Object.freeze({description:255,message:u.$,name:50});function v(e){return h.includes(e)}class g{get errors(){return{description:!this.isValidLength("description",!0),message:!this.isValidLength("message"),name:!this.isValidLength("name"),users:0===this.validUsers.size||(0,c.W)(this.inputs.users.trim())}}get isValid(){return!Object.values(this.errors).some(Boolean)}constructor(){Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lookingUpUsers",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"showError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validUsers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"debouncedLookupUsers",{enumerable:!0,configurable:!0,writable:!0,value:(0,a.debounce)((()=>this.lookupUsers()),1e3)}),Object.defineProperty(this,"initialized",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"uuid",{enumerable:!0,configurable:!0,writable:!0,value:(0,l.V)()}),Object.defineProperty(this,"xhrLookupUsers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.inputs=this.resetInputs(),this.showError=this.resetErrors(),(0,i.rC)(this)}clear(){var e;null===(e=this.xhrLookupUsers)||void 0===e||e.abort(),this.lookingUpUsers=!1,this.resetErrors(),this.resetInputs(),this.validUsers.clear()}initialize(){if(this.initialized)return;const e=localStorage.getItem(b);if(null!=e)try{const t=JSON.parse(e),s=[];t.validUsers.length>0&&s.push(...t.validUsers),(0,c.W)(t.users.trim())&&s.push(...t.users.split(",")),this.inputs.description=t.description,this.inputs.message=t.message,this.inputs.name=t.name,s.length>0&&this.updateUsers(s.join(","),!0)}catch(t){console.error("invalid json in localStorage"),localStorage.removeItem(b)}(0,i.EH)((()=>{const e=Object.assign(Object.assign({},this.inputs),{validUsers:[...this.validUsers.keys()]});localStorage.setItem(b,JSON.stringify(e))})),this.initialized=!0}toJson(){const{description:e,message:t,name:s}=this.inputs;return{channel:{description:e,name:s},message:t,target_ids:[...this.validUsers.keys()],type:"ANNOUNCE",uuid:this.uuid}}updateUsers(e,t){var s;if(this.debouncedLookupUsers.cancel(),this.inputs.users=e,0===e.trim().length)return null===(s=this.xhrLookupUsers)||void 0===s||s.abort(),void(this.lookingUpUsers=!1);this.lookingUpUsers=!0,this.debouncedLookupUsers(),t&&this.debouncedLookupUsers.flush()}extractValidUsers(e){const t=this.inputs.users.split(",");for(const r of e)this.validUsers.set(r.id,r);const s=[];for(const r of t){const e=(0,c.G)(r.trim());this.validUsersContains(e)||s.push(r)}this.inputs.users=s.join(","),this.validUsers.delete(n.Z.currentUserOrFail.id)}isValidLength(e,t=!1){return(t||(0,c.W)(this.inputs[e]))&&this.inputs[e].length<=f[e]}lookupUsers(){var e;return m(this,void 0,void 0,(function*(){null===(e=this.xhrLookupUsers)||void 0===e||e.abort(),this.debouncedLookupUsers.cancel();const t=this.inputs.users.split(",").map((e=>(0,c.G)(e.trim()))).filter(Boolean);if(0!==t.length)try{this.xhrLookupUsers=d.getJSON((0,r.B)("chat.users.index"),{ids:t});const e=yield this.xhrLookupUsers;this.extractValidUsers(e.users)}catch(s){(0,o.qQ)(s)}finally{(0,i.z)((()=>this.lookingUpUsers=!1))}else this.lookingUpUsers=!1}))}resetErrors(){return this.showError={description:!1,message:!1,name:!1,users:!1}}resetInputs(){return this.inputs={description:"",message:"",name:"",users:""}}validUsersContains(e){return null!=e&&(this.validUsers.has(Number(e))||[...this.validUsers.values()].some((t=>t.username.toLowerCase()===e.toLowerCase())))}}p([i.LO],g.prototype,"inputs",void 0),p([i.LO],g.prototype,"lookingUpUsers",void 0),p([i.LO],g.prototype,"showError",void 0),p([i.LO],g.prototype,"validUsers",void 0),p([i.Fl],g.prototype,"errors",null),p([i.Fl],g.prototype,"isValid",null),p([i.aD],g.prototype,"clear",null),p([i.aD],g.prototype,"initialize",null),p([i.aD],g.prototype,"updateUsers",null),p([i.aD],g.prototype,"extractValidUsers",null),p([i.aD],g.prototype,"lookupUsers",null),p([i.aD],g.prototype,"resetErrors",null),p([i.aD],g.prototype,"resetInputs",null)},9603:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(8949),a=s(8125),i=s(381),n=s(5078),o=s(9139),l=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class c{get sender(){var e;return null!==(e=n.Z.dataStore.userStore.get(this.senderId))&&void 0!==e?e:new a.ZP(-1)}constructor(){Object.defineProperty(this,"channelId",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"errored",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isAction",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"messageId",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.V)()}),Object.defineProperty(this,"persisted",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"senderId",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"timestamp",{enumerable:!0,configurable:!0,writable:!0,value:i().toISOString()}),Object.defineProperty(this,"type",{enumerable:!0,configurable:!0,writable:!0,value:"plain"}),Object.defineProperty(this,"uuid",{enumerable:!0,configurable:!0,writable:!0,value:this.messageId}),(0,r.rC)(this)}static fromJson(e){var t;const s=new c;return s.channelId=e.channel_id,s.content=e.content,s.isAction=e.is_action,s.messageId=e.message_id,s.persisted=!0,s.senderId=e.sender_id,s.timestamp=e.timestamp,s.type=e.type,s.uuid=null!==(t=e.uuid)&&void 0!==t?t:s.uuid,s}persist(e){this.persisted||(this.content=e.content,this.messageId=e.message_id,this.timestamp=e.timestamp,this.persisted=!0)}}l([r.LO],c.prototype,"channelId",void 0),l([r.LO],c.prototype,"content",void 0),l([r.LO],c.prototype,"errored",void 0),l([r.LO],c.prototype,"isAction",void 0),l([r.LO],c.prototype,"messageId",void 0),l([r.LO],c.prototype,"persisted",void 0),l([r.LO],c.prototype,"senderId",void 0),l([r.LO],c.prototype,"timestamp",void 0),l([r.LO],c.prototype,"type",void 0),l([r.LO],c.prototype,"uuid",void 0),l([r.Fl],c.prototype,"sender",null),l([r.aD],c.prototype,"persist",null)},7581:(e,t,s)=>{s.d(t,{O3:()=>i,ZP:()=>o,kK:()=>n});var r=s(8949),a=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};const i=[null,"user","beatmapset","forum_topic","news_post","build","channel"];function n(e){const t=e;return i.indexOf(t)>-1?t:i[0]}class o{get hasMore(){return null!==this.cursor&&this.stackNotificationCount<this.total}get hasVisibleNotifications(){return this.total>0&&this.stacks.size>0}get identity(){return{objectType:this.name}}get isEmpty(){return this.total<=0}get stackNotificationCount(){return[...this.stacks.values()].reduce(((e,t)=>e+t.total),0)}constructor(e,t){Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"resolver",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"cursor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isDeleting",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isLoading",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isMarkingAsRead",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"stacks",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"total",{enumerable:!0,configurable:!0,writable:!0,value:0}),(0,r.rC)(this)}static fromJson(e,t){const s=new o(e.name,t);return s.updateWithJson(e),s}delete(){this.resolver.delete(this)}loadMore(e){null!==this.cursor&&(this.isLoading=!0,this.resolver.loadMore(this.identity,e,this.cursor).always((0,r.aD)((()=>{this.isLoading=!1}))))}markTypeAsRead(){this.resolver.queueMarkAsRead(this)}removeStack(e){const t=this.stacks.delete(e.id);return t&&(this.total-=e.total),t}updateWithJson(e){this.cursor=e.cursor,this.total=e.total}}a([r.LO],o.prototype,"cursor",void 0),a([r.LO],o.prototype,"isDeleting",void 0),a([r.LO],o.prototype,"isLoading",void 0),a([r.LO],o.prototype,"isMarkingAsRead",void 0),a([r.LO],o.prototype,"stacks",void 0),a([r.LO],o.prototype,"total",void 0),a([r.Fl],o.prototype,"hasMore",null),a([r.Fl],o.prototype,"hasVisibleNotifications",null),a([r.Fl],o.prototype,"isEmpty",null),a([r.Fl],o.prototype,"stackNotificationCount",null),a([r.aD],o.prototype,"delete",null),a([r.aD],o.prototype,"loadMore",null),a([r.aD],o.prototype,"markTypeAsRead",null),a([r.aD],o.prototype,"removeStack",null),a([r.aD],o.prototype,"updateWithJson",null)},1882:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(6486),a=s(8949);var i=s(4927);var n=s(5078),o=s(3924),l=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class c{get canMarkRead(){return this.id>0&&!this.isRead}get category(){var e;return(0,i.Yg)(null!==(e=this.name)&&void 0!==e?e:"")}get categoryGroupKey(){return(0,i.wl)(this)}get displayType(){return function(e){if(null!=e.objectType&&null!=e.objectId)return"user_achievement_unlock"===e.name?"user_achievement":e.objectType}(this)}get identity(){return{category:this.category,id:this.id,objectId:this.objectId,objectType:this.objectType}}get stackId(){return`${this.objectType}-${this.objectId}-${this.category}`}get title(){var e;return n.Z.userPreferences.get("beatmapset_title_show_original")&&null!==(e=(0,o.G)(this.details.titleUnicode))&&void 0!==e?e:this.details.title}constructor(e,t){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"objectType",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"createdAtJson",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:{coverUrl:null,title:""}}),Object.defineProperty(this,"isDeleting",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isMarkingAsRead",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isRead",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"objectId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sourceUserId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updateFromJson",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;return this.createdAtJson=e.created_at,this.isRead=e.is_read,this.name=e.name,this.objectId=e.object_id,this.sourceUserId=e.source_user_id,this.details={coverUrl:null,title:""},"object"==typeof e.details&&((0,r.forEach)(e.details,((e,t)=>{this.details[(0,r.camelCase)(t)]=e})),"comment_new"===e.name&&(null===(t=e.details.reply_to)||void 0===t?void 0:t.user_id)===(null===(s=n.Z.currentUser)||void 0===s?void 0:s.id)&&(this.name="comment_reply")),this}}),(0,a.rC)(this)}static fromJson(e){return new c(e.id,e.object_type).updateFromJson(e)}}l([a.LO],c.prototype,"isDeleting",void 0),l([a.LO],c.prototype,"isMarkingAsRead",void 0),l([a.LO],c.prototype,"isRead",void 0),l([a.Fl],c.prototype,"canMarkRead",null),l([a.Fl],c.prototype,"category",null),l([a.Fl],c.prototype,"categoryGroupKey",null),l([a.Fl],c.prototype,"displayType",null),l([a.Fl],c.prototype,"stackId",null),l([a.Fl],c.prototype,"title",null)},8125:(e,t,s)=>{s.d(t,{Mm:()=>n,ZP:()=>l,ei:()=>c,gm:()=>o,z7:()=>u});var r=s(8949),a=s(1270),i=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};function n(e){return e.trim().toLowerCase()}function o(e,t){return e.username.localeCompare(t.username)}class l{constructor(e){Object.defineProperty(this,"avatarUrl",{enumerable:!0,configurable:!0,writable:!0,value:"/images/layout/avatar-guest@2x.png"}),Object.defineProperty(this,"countryCode",{enumerable:!0,configurable:!0,writable:!0,value:"XX"}),Object.defineProperty(this,"defaultGroup",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"groups",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isActive",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isBot",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isDeleted",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isOnline",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isSupporter",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lastVisit",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"pmFriendsOnly",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"profileColour",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"username",{enumerable:!0,configurable:!0,writable:!0,value:""}),this.id=e,(0,r.rC)(this)}is(e){return null!=e&&e.id===this.id}toJson(){return{avatar_url:this.avatarUrl,country_code:this.countryCode,default_group:this.defaultGroup,groups:this.groups,id:this.id,is_active:this.isActive,is_bot:this.isBot,is_deleted:this.isDeleted,is_online:this.isOnline,is_supporter:this.isSupporter,last_visit:this.lastVisit,pm_friends_only:this.pmFriendsOnly,profile_colour:this.profileColour,username:this.username}}updateWithJson(e){var t,s;this.avatarUrl=e.avatar_url,this.countryCode=e.country_code,this.defaultGroup=null!==(t=e.default_group)&&void 0!==t?t:"",this.isActive=e.is_active,this.isBot=e.is_bot,this.isOnline=e.is_online,this.isSupporter=e.is_supporter,this.pmFriendsOnly=e.pm_friends_only,this.profileColour=null!==(s=e.profile_colour)&&void 0!==s?s:"",this.username=e.username,null!=e.groups&&(this.groups=e.groups)}}i([r.LO],l.prototype,"avatarUrl",void 0),i([r.LO],l.prototype,"countryCode",void 0),i([r.LO],l.prototype,"defaultGroup",void 0),i([r.LO],l.prototype,"groups",void 0),i([r.LO],l.prototype,"id",void 0),i([r.LO],l.prototype,"isActive",void 0),i([r.LO],l.prototype,"isBot",void 0),i([r.LO],l.prototype,"isDeleted",void 0),i([r.LO],l.prototype,"isOnline",void 0),i([r.LO],l.prototype,"isSupporter",void 0),i([r.LO],l.prototype,"lastVisit",void 0),i([r.LO],l.prototype,"pmFriendsOnly",void 0),i([r.LO],l.prototype,"profileColour",void 0),i([r.LO],l.prototype,"username",void 0),i([r.aD],l.prototype,"updateWithJson",null);const c=new l(-1);c.isDeleted=!0,c.username=(0,a.dW)("users.deleted");const u=c.toJson()},6244:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(4403),a=s(5119),i=s(381),n=s(7294),o=s(3336),l=s(1270);function c({modifiers:e,post:t}){let s;null!=t.first_image&&(s=n.createElement("img",{className:"news-card__cover",src:t.first_image}));let c=t.preview;return null==c&&(c=""),n.createElement("a",{className:(0,o.sb)("news-card",null!=e?e:["index","hover"]),href:(0,a.B)("news.show",{news:t.slug})},n.createElement("div",{className:"news-card__cover-container"},s,n.createElement("div",{className:"news-card__time js-tooltip-time",title:t.published_at},i.utc(t.published_at).format("ll"))),n.createElement("div",{className:"news-card__main"},n.createElement("div",{className:"news-card__row news-card__row--title"},t.title),n.createElement("div",{dangerouslySetInnerHTML:{__html:c},className:"news-card__row news-card__row--preview"}),n.createElement("div",{className:"news-card__row news-card__row--author"},n.createElement(r.Z,{mappings:{user:n.createElement("strong",null,t.author)},pattern:(0,l.dW)("news.show.by")}))))}},3858:(e,t,s)=>{s.d(t,{Z:()=>u});var r=s(381),a=s(7294),i=s(1270),n=s(5119),o=s(5078);class l extends a.Component{get stateRecordKey(){return this.props.date.format("YYYYMM")}get stateRecordValue(){return this.stateRecord instanceof HTMLElement&&null!=this.stateRecord.dataset[this.stateRecordKey]?"1"===this.stateRecord.dataset[this.stateRecordKey]:null}constructor(e){if(super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{expanded:!1}}),Object.defineProperty(this,"stateRecord",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"recordState",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null!=this.stateRecord&&(this.stateRecord.dataset[this.stateRecordKey]=this.state.expanded?"1":"")}}),Object.defineProperty(this,"renderPost",{enumerable:!0,configurable:!0,writable:!0,value:e=>{let t="news-sidebar-month__item";return null!=this.props.currentPost&&this.props.currentPost.id===e.id&&(t+=" news-sidebar-month__item--active"),a.createElement("li",{key:e.id},a.createElement("a",{className:t,href:(0,n.B)("news.show",{news:e.slug})},e.title))}}),Object.defineProperty(this,"toggleExpand",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({expanded:!this.state.expanded},this.recordState)}}),o.Z.windowSize.isMobile)this.state.expanded=!1;else if(null==e.currentPost)this.state.expanded=e.initialExpand;else{const t=r.utc(e.currentPost.published_at);this.state.expanded=t.year()===e.date.year()&&t.month()===e.date.month()}const t=document.querySelector(".js-news-sidebar-record");t instanceof HTMLElement&&(this.stateRecord=t),null==this.stateRecordValue?this.recordState():this.state.expanded=this.stateRecordValue}render(){return a.createElement("div",{className:"news-sidebar-month"},a.createElement("button",{className:"news-sidebar-month__toggle",onClick:this.toggleExpand,type:"button"},this.props.date.format((0,i.dW)("common.datetime.year_month_short.moment")),a.createElement("span",{className:"news-sidebar-month__toggle-icon"},a.createElement("i",{className:this.state.expanded?"fas fa-chevron-up":"fas fa-chevron-down"}))),a.createElement("ul",{className:"news-sidebar-month__items "+(this.state.expanded?"":"hidden")},this.props.posts.map(this.renderPost)))}}function c(e){return a.createElement("div",{className:"news-sidebar-years"},e.years.map((t=>a.createElement("a",{key:t,className:"news-sidebar-years__item "+(t===e.currentYear?"news-sidebar-years__item--active":""),href:(0,n.B)("news.index",{year:t})},t))))}function u(e){var t;const s={},n={},o=new Set;for(const a of e.data.news_posts){const e=r.utc(a.published_at),i=e.format("YYYY-MM");(s[i]=null!==(t=s[i])&&void 0!==t?t:[]).push(a),n[i]=e,o.add(i)}const u=[...o].sort().reverse();let d=!0;return a.createElement("div",{className:"sidebar"},a.createElement("button",{className:"sidebar__mobile-toggle sidebar__mobile-toggle--mobile-only js-mobile-toggle","data-mobile-toggle-target":"news-archive",type:"button"},a.createElement("h2",{className:"sidebar__title"},(0,i.dW)("news.sidebar.archive")),a.createElement("div",{className:"sidebar__mobile-toggle-icon"},a.createElement("i",{className:"fas fa-chevron-down"}))),a.createElement("div",{className:"sidebar__content hidden-xs js-mobile-toggle","data-mobile-toggle-id":"news-archive"},a.createElement(c,{currentYear:e.data.current_year,years:e.data.years}),u.map((t=>{const r=n[t],i=s[t];if(null==i||null==r)return;const o=d;return d=!1,a.createElement(l,{key:t,currentPost:e.currentPost,date:r,initialExpand:o,posts:i})}))))}},4927:(e,t,s)=>{function r(e){return null==e.objectId||null==e.name||null==e.category?null:"user_achievement_unlock"===e.name?`achievement:${e.id}`:`${e.category}:${e.objectId}`}function a(e){var t;return null!==(t=i[e])&&void 0!==t?t:e}s.d(t,{Yg:()=>a,wl:()=>r});const i={beatmap_owner_change:"beatmap_owner_change",beatmapset_discussion_lock:"beatmapset_discussion",beatmapset_discussion_post_new:"beatmapset_discussion",beatmapset_discussion_qualified_problem:"beatmapset_problem",beatmapset_discussion_review_new:"beatmapset_discussion",beatmapset_discussion_unlock:"beatmapset_discussion",beatmapset_disqualify:"beatmapset_state",beatmapset_love:"beatmapset_state",beatmapset_nominate:"beatmapset_state",beatmapset_qualify:"beatmapset_state",beatmapset_rank:"beatmapset_state",beatmapset_remove_from_loved:"beatmapset_state",beatmapset_reset_nominations:"beatmapset_state",channel_announcement:"announcement",channel_message:"channel",comment_new:"comment",comment_reply:"comment",forum_topic_reply:"forum_topic_reply",user_achievement_unlock:"user_achievement_unlock",user_beatmapset_new:"user_beatmapset_new",user_beatmapset_revive:"user_beatmapset_new"}},8035:(e,t,s)=>{s.d(t,{Z:()=>A});var r=s(9323),a=s(7294),i=s(3890);const n={announcement:["fas fa-bullhorn"],beatmap_owner_change:["fas fa-drafting-compass","fas fa-user-friends"],beatmapset_discussion:["fas fa-drafting-compass","fas fa-comment"],beatmapset_problem:["fas fa-drafting-compass","fas fa-exclamation-circle"],beatmapset_state:["fas fa-drafting-compass"],channel:["fas fa-comments"],comment:["fas fa-comment"],forum_topic_reply:["fas fa-comment-medical"],user_achievement_unlock:["fas fa-medal"],user_beatmapset_new:["fas fa-music"]},o={beatmap_owner_change:["fas fa-drafting-compass","fas fa-user-friends"],beatmapset_discussion_lock:["fas fa-drafting-compass","fas fa-lock"],beatmapset_discussion_post_new:["fas fa-drafting-compass","fas fa-comment-medical"],beatmapset_discussion_qualified_problem:["fas fa-drafting-compass","fas fa-exclamation-circle"],beatmapset_discussion_unlock:["fas fa-drafting-compass","fas fa-unlock"],beatmapset_disqualify:["fas fa-drafting-compass","far fa-times-circle"],beatmapset_love:["fas fa-drafting-compass","fas fa-heart"],beatmapset_nominate:["fas fa-drafting-compass","fas fa-vote-yea"],beatmapset_qualify:["fas fa-drafting-compass","fas fa-check"],beatmapset_rank:["fas fa-drafting-compass","fas fa-check-double"],beatmapset_remove_from_loved:["fas fa-drafting-compass","fas fa-heart-broken"],beatmapset_reset_nominations:["fas fa-drafting-compass","fas fa-undo"],channel_announcement:["fas fa-bullhorn"],channel_message:["fas fa-comments"],comment_new:["fas fa-comment"],comment_reply:["fas fa-reply"],forum_topic_reply:["fas fa-comment-medical"],user_achievement_unlock:["fas fa-trophy"],user_beatmapset_new:["fas fa-music"],user_beatmapset_revive:["fas fa-trash-restore"]},l={beatmap_owner_change:["fas fa-user-edit"],beatmapset_discussion_lock:["fas fa-lock"],beatmapset_discussion_post_new:["fas fa-comment-medical"],beatmapset_discussion_qualified_problem:["fas fa-exclamation-circle"],beatmapset_discussion_unlock:["fas fa-unlock"],beatmapset_disqualify:["far fa-times-circle"],beatmapset_love:["fas fa-heart"],beatmapset_nominate:["fas fa-vote-yea"],beatmapset_qualify:["fas fa-check"],beatmapset_rank:["fas fa-check-double"],beatmapset_remove_from_loved:["fas fa-heart-broken"],beatmapset_reset_nominations:["fas fa-undo"],channel_announcement:["fas fa-bullhorn"],channel_message:["fas fa-comments"],comment_new:["fas fa-comment"],comment_reply:["fas fa-reply"],forum_topic_reply:["fas fa-comment-medical"],user_beatmapset_new:["fas fa-music"],user_beatmapset_revive:["fas fa-trash-restore"]};s(1882);function c(e){return"beatmap_owner_change"===e.name}var u=s(1270);function d(e,t=!1){const s={content:e.details.content,title:e.title,username:e.details.username};c(e)&&(s.beatmap=e.details.version),"beatmapset_discussion_review_new"===e.name&&null!=e.details.embeds&&function(e,t){const s=[];for(const r of["praises","problems","suggestions"]){const a=e[r];a>0&&s.push((0,u.jn)(`notifications.item.beatmapset.beatmapset_discussion.review_count.${r}`,a)),t[r]=a}0===s.length&&s.push((0,u.jn)("notifications.item.beatmapset.beatmapset_discussion.review_count.problems",0)),t.review_counts=(0,u.m2)(s)}(e.details.embeds,s);let r=`notifications.item.${e.displayType}.${e.category}`;"channel"===e.objectType&&(r+=`.${e.details.type}`),r+=`.${e.name}`,t&&(r+="_compact");const a=`${r}_empty`;return null==e.details.content&&(0,u.Xl)(a,window.fallbackLocale)&&(r=a),(0,u.dW)(r,s)}function p(e){if("channel"===e.objectType){const t={title:e.title,username:e.details.username},s=`notifications.item.${e.objectType}.${e.category}.${e.details.type}.${e.name}_group`;return(0,u.dW)(s,t)}if("user_achievement_unlock"===e.name){const t={username:e.details.username};return(0,u.dW)(`notifications.item.${e.displayType}.${e.category}.${e.name}_group`,t)}if("user_beatmapset_new"===e.category){const t={username:e.details.username};return(0,u.dW)(`notifications.item.${e.displayType}.${e.category}.${e.category}_group`,t)}return e.title}var m=s(5119),h=s(7012);function b(e){if(c(e))return(0,m.B)("beatmapsets.discussion",{beatmap:"-",beatmapset:e.objectId,mode:"events"});if("comment_new"===e.name||"comment_reply"===e.name)switch(e.objectType){case"beatmapset":return(0,m.B)("beatmapsets.show",{beatmapset:e.objectId});case"build":return(0,m.B)("changelog.show",{changelog:e.objectId,key:"id"});case"news_post":return(0,m.B)("news.show",{key:"id",news:e.objectId})}else{if("user_achievement_unlock"===e.name)return v(e);if("user_beatmapset_new"===e.category)return`${(0,m.B)("users.show",{user:e.objectId})}#beatmaps`}switch(e.objectType){case"beatmapset":return(0,m.B)("beatmapsets.discussion",{beatmapset:e.objectId});case"channel":return null!=e.details.channelId?(0,m.B)("chat.index",{channel_id:e.details.channelId}):(0,m.B)("chat.index",{sendto:e.sourceUserId});case"forum_topic":return(0,m.B)("forum.topics.show",{start:"unread",topic:e.objectId})}}function f(e){if(c(e))return(0,m.B)("beatmapsets.discussion",{beatmap:e.details.beatmapId,beatmapset:e.objectId});switch(e.name){case"beatmapset_discussion_lock":case"beatmapset_discussion_unlock":case"beatmapset_disqualify":case"beatmapset_love":case"beatmapset_nominate":case"beatmapset_qualify":case"beatmapset_remove_from_loved":case"beatmapset_reset_nominations":return(0,m.B)("beatmapsets.discussion",{beatmapset:e.objectId});case"beatmapset_discussion_post_new":case"beatmapset_discussion_qualified_problem":case"beatmapset_discussion_review_new":return(0,h.bf)({beatmapId:e.details.beatmapId,beatmapsetId:e.objectId,discussionId:e.details.discussionId,postId:e.details.postId});case"beatmapset_rank":return(0,m.B)("beatmapsets.show",{beatmapset:e.objectId});case"channel_announcement":return(0,m.B)("chat.index",{channel_id:e.details.channelId});case"channel_message":return(0,m.B)("chat.index",{sendto:e.sourceUserId});case"comment_new":case"comment_reply":return(0,m.B)("comments.show",{comment:e.details.commentId});case"forum_topic_reply":return(0,m.B)("forum.posts.show",{post:e.details.postId});case"user_achievement_unlock":return v(e);case"user_beatmapset_new":case"user_beatmapset_revive":return(0,m.B)("beatmapsets.show",{beatmapset:e.details.beatmapsetId})}}function v(e){var t;const s={mode:null!==(t=e.details.achievementMode)&&void 0!==t?t:void 0,user:e.details.userId};return`${(0,m.B)("users.show",s)}#medals`}var g=s(8050),y=s(9380),w=s(2903),_=s(12),E=s(3336),P=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let O=class extends a.Component{constructor(){super(...arguments),Object.defineProperty(this,"onLinkClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;0!==e.button&&1!==e.button||null===(s=(t=this.props).markRead)||void 0===s||s.call(t)}})}get canMarkAsRead(){var e;return null!==(e=this.props.canMarkAsRead)&&void 0!==e?e:this.props.item.canMarkRead}render(){const e=(0,E.sw)(this.props.modifiers,this.props.item.category,{read:this.props.item.isRead&&!this.props.canMarkAsRead});return a.createElement("div",{className:(0,E.sb)("notification-popup-item",e)},a.createElement("a",{className:"notification-popup-item__link",href:this.props.url,onAuxClick:this.onLinkClick,onClick:this.onLinkClick}),this.renderCover(),a.createElement("div",{className:"notification-popup-item__main"},a.createElement("div",{className:"notification-popup-item__content"},this.renderCategory(),this.renderMessage(),this.renderTime(),this.renderExpandButton()),this.renderMarkAsReadButton(),this.renderDeleteButton()),this.renderUnreadStripe())}renderCategory(){if(!this.props.withCategory)return null;const e=(0,u.dW)(`notifications.item.${this.props.item.displayType}.${this.props.item.category}._`);return""===e?null:a.createElement("div",{className:"notification-popup-item__row notification-popup-item__row--category"},e)}renderCover(){const e=this.props.withCoverImage?this.props.item.details.coverUrl:null;return a.createElement("div",{className:"notification-popup-item__cover",style:{backgroundImage:(0,E.eF)(e)}},a.createElement("div",{className:"notification-popup-item__cover-overlay"},this.renderCoverIcons()))}renderCoverIcons(){return null==this.props.icons?null:this.props.icons.map((e=>a.createElement("div",{key:e,className:"notification-popup-item__cover-icon"},a.createElement("span",{className:e}))))}renderDeleteButton(){var e;return this.context.isWidget?null:a.createElement(y.Z,{isDeleting:null!==(e=this.props.isDeleting)&&void 0!==e?e:this.props.item.isDeleting,modifiers:["fancy"],onDelete:this.props.delete})}renderExpandButton(){return null==this.props.expandButton?null:a.createElement("div",{className:"notification-popup-item__row notification-popup-item__row--expand"},this.props.expandButton)}renderMarkAsReadButton(){var e;return this.canMarkAsRead?a.createElement(w.Z,{isMarkingAsRead:null!==(e=this.props.isMarkingAsRead)&&void 0!==e?e:this.props.item.isMarkingAsRead,modifiers:["fancy"],onMarkAsRead:this.props.markRead}):null}renderMessage(){return a.createElement("div",{className:"notification-popup-item__row notification-popup-item__row--message"},this.props.message)}renderTime(){if(null!=this.props.item.createdAtJson)return a.createElement("a",{className:"notification-popup-item__row notification-popup-item__row--time u-hover",href:this.props.url,onAuxClick:this.onLinkClick,onClick:this.onLinkClick},a.createElement(_.Z,{dateTime:this.props.item.createdAtJson,relative:!0}))}renderUnreadStripe(){return this.context.isWidget||!this.canMarkAsRead?null:a.createElement("span",{className:"notification-popup-item__unread-stripe"})}};Object.defineProperty(O,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:g.u}),O=P([r.Pi],O);const j=O;var k=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let N=class extends a.Component{constructor(){super(...arguments),Object.defineProperty(this,"handleDelete",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.deleteItem(this.props.item)}}),Object.defineProperty(this,"handleMarkAsRead",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.markAsRead(this.props.item)}})}render(){var e;return a.createElement(j,{delete:this.handleDelete,icons:l[null!==(e=this.props.item.name)&&void 0!==e?e:""],item:this.props.item,markRead:this.handleMarkAsRead,message:d(this.props.item,!0),modifiers:["compact"],url:f(this.props.item),withCategory:!1,withCoverImage:"user_achievement_unlock"===this.props.item.name||"user_beatmapset_new"===this.props.item.category})}};N=k([r.Pi],N);const S=N;var C=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let T=class extends a.Component{constructor(){super(...arguments),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:{expanded:!1}}),Object.defineProperty(this,"handleDelete",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.delete()}}),Object.defineProperty(this,"handleMarkAsRead",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.markStackAsRead()}}),Object.defineProperty(this,"handleShowLess",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({expanded:!1})}}),Object.defineProperty(this,"handleShowMore",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.loadMore(this.context)}}),Object.defineProperty(this,"renderItem",{enumerable:!0,configurable:!0,writable:!0,value:e=>a.createElement("div",{key:e.id,className:"notification-popup-item-group__item"},a.createElement(S,{item:e,stack:this.props.stack}))}),Object.defineProperty(this,"toggleExpand",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState({expanded:!this.state.expanded})}})}render(){const e=this.props.stack.first;return null==e?null:a.createElement("div",{className:"notification-popup-item-group"},a.createElement(j,{canMarkAsRead:this.props.stack.canMarkAsRead,delete:this.handleDelete,expandButton:this.renderExpandButton(),icons:n[e.category],isDeleting:this.props.stack.isDeleting,isMarkingAsRead:this.props.stack.isMarkingAsRead,item:e,markRead:this.handleMarkAsRead,message:p(e),modifiers:["group"],url:b(e),withCategory:!0,withCoverImage:!0}),this.renderItems())}renderExpandButton(){const e=this.props.stack.total,t=this.context.isWidget?"common.count.update":"common.count.notifications";return a.createElement("button",{className:"show-more-link show-more-link--notification-group u-hover",onClick:this.toggleExpand,type:"button"},a.createElement("span",{className:"show-more-link__label"},a.createElement("span",{className:"show-more-link__label-text"},(0,u.jn)(t,e)),a.createElement("span",{className:"show-more-link__label-icon"},a.createElement("span",{className:"fas fa-angle-"+(this.state.expanded?"up":"down")}))))}renderItems(){return this.state.expanded?a.createElement("div",{className:"notification-popup-item-group__items"},this.props.stack.orderedNotifications.map(this.renderItem),a.createElement("div",{className:"notification-popup-item-group__show-more"},a.createElement("div",{className:"notification-popup-item-group__expand"},this.renderShowMore()),a.createElement("div",{className:"notification-popup-item-group__collapse"},this.renderShowLess(),this.props.stack.canMarkAsRead&&a.createElement(w.Z,{isMarkingAsRead:this.props.stack.isMarkingAsRead,onMarkAsRead:this.handleMarkAsRead}),!this.context.isWidget&&a.createElement(y.Z,{isDeleting:this.props.stack.isDeleting,onDelete:this.handleDelete})))):null}renderShowLess(){return a.createElement(i.Z,{callback:this.handleShowLess,direction:"up",hasMore:!0,label:(0,u.dW)("common.buttons.show_less"),modifiers:["notification-group"]})}renderShowMore(){const e=this.props.stack;return e.hasMore?a.createElement(i.Z,{callback:this.handleShowMore,hasMore:null!=e.cursor,loading:e.isLoading,modifiers:["notification-group"]}):null}};Object.defineProperty(T,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:g.u}),T=C([r.Pi],T);const x=T;var D=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let R=class extends a.Component{constructor(){super(...arguments),Object.defineProperty(this,"handleDelete",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.deleteItem(this.props.stack.first)}}),Object.defineProperty(this,"handleMarkAsRead",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.props.stack.markAsRead(this.props.stack.first)}})}render(){var e;const t=this.props.stack.first;return null==t?null:a.createElement(j,{delete:this.handleDelete,icons:o[null!==(e=t.name)&&void 0!==e?e:""],isDeleting:t.isDeleting,isMarkingAsRead:t.isMarkingAsRead,item:t,markRead:this.handleMarkAsRead,message:d(t),modifiers:["one"],url:f(t),withCategory:!0,withCoverImage:!0})}};R=D([r.Pi],R);const M=R;var I=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let L=class extends a.Component{render(){if(!this.props.stack.hasVisibleNotifications)return null;const e=this.props.stack.isSingle?M:x;return a.createElement(e,{key:this.props.stack.id,stack:this.props.stack})}};L=I([r.Pi],L);const A=L},8050:(e,t,s)=>{s.d(t,{u:()=>r});const r=(0,s(7294).createContext)({excludes:[],isWidget:!1})},6160:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(8949),a=s(7581),i=s(9014),n=s(5076),o=s(2918),l=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class c{get isMarkingCurrentTypeAsRead(){return this.getNonNullTypes(this.type).some((e=>e.isMarkingAsRead))}get stacks(){return this.store.orderedStacksOfType(this.currentFilter).filter((e=>e.hasVisibleNotifications&&!this.isExcluded(e.objectType)))}get type(){return this.getType(this.currentFilter)}get typeNameFromUrl(){return(0,a.kK)((0,i.Kn)().get("type"))}constructor(e,t,s){Object.defineProperty(this,"notificationStore",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"contextType",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"currentFilter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"typeNamesWithoutNull",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getType",{enumerable:!0,configurable:!0,writable:!0,value:e=>this.store.getOrCreateType({objectType:e})}),this.typeNamesWithoutNull=a.O3.filter((e=>!(null==e||this.isExcluded(e)))),this.currentFilter=void 0!==s?s:this.typeNameFromUrl,this.store=t.isWidget?e.unreadStacks:e.stacks,(0,r.rC)(this)}getTotal(e){return this.getNonNullTypes(e).reduce(((e,t)=>e+t.total),0)}loadMore(){var e;null===(e=this.type)||void 0===e||e.loadMore(this.contextType)}markCurrentTypeAsRead(){this.getNonNullTypes(this.type).forEach((e=>{e.markTypeAsRead()}))}navigateTo(e){if(this.currentFilter=e,0===[...this.stacks].length&&this.loadMore(),!this.contextType.isWidget){let t;if(null==e){const e=new URL((0,i.JJ)().href);e.searchParams.delete("type"),t=e.href}else t=(0,n.bj)(null,{type:e});o.controller.advanceHistory(t)}}getNonNullTypes(e){return null!=e.name?[e]:this.typeNamesWithoutNull.map(this.getType)}isExcluded(e){return this.contextType.excludes.includes(e)}}l([r.LO],c.prototype,"currentFilter",void 0),l([r.Fl],c.prototype,"isMarkingCurrentTypeAsRead",null),l([r.Fl],c.prototype,"stacks",null),l([r.Fl],c.prototype,"type",null),l([r.aD],c.prototype,"loadMore",null),l([r.aD],c.prototype,"markCurrentTypeAsRead",null),l([r.aD],c.prototype,"navigateTo",null)},9380:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(6741),a=s(9323),i=s(7294),n=s(3336),o=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let l=class extends i.Component{render(){return this.props.isDeleting?i.createElement("div",{className:(0,n.sb)("notification-action-button",this.props.modifiers)},i.createElement("span",{className:"notification-action-button__text"},this.props.text),i.createElement("div",{className:"notification-action-button__icon"},i.createElement(r.$,null))):i.createElement("button",{className:(0,n.sb)("notification-action-button",this.props.modifiers),onClick:this.props.onDelete,type:"button"},i.createElement("span",{className:"notification-action-button__text"},this.props.text),i.createElement("div",{className:"notification-action-button__icon"},i.createElement("span",{className:"fas fa-trash"})))}};Object.defineProperty(l,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{modifiers:[]}}),l=o([a.Pi],l);const c=l},2468:(e,t,s)=>{s.d(t,{Ko:()=>o,d7:()=>n,lE:()=>l,u9:()=>i});var r=s(8701),a=s(7417);class i extends r.Z{constructor(e,t){super(),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"context",{enumerable:!0,configurable:!0,writable:!0,value:t})}}class n extends r.Z{constructor(e){super(),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class o extends r.Z{constructor(e,t){super(),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"readCount",{enumerable:!0,configurable:!0,writable:!0,value:t})}static fromJson(e){const t=e.data.notifications.map((e=>(0,a.xZ)(e)));return new o(t,e.data.read_count)}}class l extends r.Z{constructor(e,t){super(),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"readCount",{enumerable:!0,configurable:!0,writable:!0,value:t})}static fromJson(e){const t=e.data.notifications.map((e=>(0,a.xZ)(e)));return new l(t,e.data.read_count)}}},7417:(e,t,s)=>{function r(e){return`${e.objectType}-${e.objectId}-${e.category}`}function a(e){return null!=e.objectId&&null!=e.category?null!=e.id?"notification":"stack":"type"}function i(e){return{category:e.category,id:e.id,objectId:e.object_id,objectType:e.object_type}}function n(e){return{category:e.category,id:e.id,object_id:e.objectId,object_type:e.objectType}}function o(e){return`${e.objectType}-${e.objectId}-${e.category}-${e.id}`}s.d(t,{$w:()=>r,BB:()=>o,Qs:()=>n,_n:()=>a,xZ:()=>i})},2903:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(6741),a=s(9323),i=s(7294),n=s(3336),o=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let l=class extends i.Component{render(){return this.props.isMarkingAsRead?i.createElement("div",{className:(0,n.sb)("notification-action-button",this.props.modifiers)},i.createElement("span",{className:"notification-action-button__text"},this.props.text),i.createElement("div",{className:"notification-action-button__icon"},i.createElement(r.$,null))):i.createElement("button",{className:(0,n.sb)("notification-action-button",this.props.modifiers),onClick:this.props.onMarkAsRead,type:"button"},i.createElement("span",{className:"notification-action-button__text"},this.props.text),i.createElement("div",{className:"notification-action-button__icon"},i.createElement("span",{className:"fas fa-check"})))}};Object.defineProperty(l,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{modifiers:[]}}),l=o([a.Pi],l);const c=l},5078:(e,t,s)=>{s.d(t,{Z:()=>Ks});var r=s(8949),a=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class i{get hasMoreForPager(){return this.hasMore&&this.beatmapsetIds.size<this.total}get isExpired(){return null==this.fetchedAt||(new Date).getTime()-this.fetchedAt.getTime()>i.CACHE_DURATION_MS}constructor(){Object.defineProperty(this,"beatmapsetIds",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"cursorString",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchedAt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hasMore",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"total",{enumerable:!0,configurable:!0,writable:!0,value:0}),(0,r.rC)(this)}append(e){for(const t of e.beatmapsets)this.beatmapsetIds.add(t.id);this.cursorString=e.cursor_string,this.fetchedAt=new Date,this.hasMore=null!==e.cursor_string,this.total=e.total}reset(){this.beatmapsetIds.clear(),this.fetchedAt=void 0,this.cursorString=void 0,this.hasMore=!1,this.total=0}}Object.defineProperty(i,"CACHE_DURATION_MS",{enumerable:!0,configurable:!0,writable:!0,value:6e4});const n=i;a([r.LO],i.prototype,"beatmapsetIds",void 0),a([r.LO],i.prototype,"hasMore",void 0),a([r.LO],i.prototype,"total",void 0),a([r.Fl],i.prototype,"hasMoreForPager",null),a([r.Fl],i.prototype,"isExpired",null),a([r.aD],i.prototype,"append",null),a([r.aD],i.prototype,"reset",null);var o=s(6486),l=s(3924),c=s(5076),u=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};const d={c:"general",e:"extra",g:"genre",l:"language",m:"mode",nsfw:"nsfw",played:"played",q:"query",r:"rank",s:"status",sort:"sort"},p=(0,o.invert)(d),m=["extra","general","genre","language","mode","nsfw","played","query","rank","sort","status"],h=["query","status"],b=["played","rank"];function f(e){const t=new URL(e).searchParams,s={};for(const[r,a]of Object.entries(d)){const e=t.get(r);null!=e&&0!==e.length&&(s[a]=e)}return s}class v{get displaySort(){return this.selectedValue("sort")}get queryParams(){const e={};for(const t of m){const s=this[t];e[p[t]]=s===this.getDefault(t)?null:s}return e}get searchSort(){var e;const[t,s]=(null!==(e=this.displaySort)&&void 0!==e?e:"").split("_");return{field:t,order:s}}get supporterRequired(){return m.filter((e=>null!=this[e]&&b.includes(e)))}constructor(e){var t;Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"general",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"genre",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"language",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"mode",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"nsfw",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"played",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"query",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"rank",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"sort",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:null});const s=f(e);for(const r of m)this[r]=null!==(t=s[r])&&void 0!==t?t:null;(0,r.rC)(this),(0,r.Su)(this,"query",(e=>{var t;return e.newValue=(0,l.G)(null===(t=e.newValue)||void 0===t?void 0:t.trim()),e}))}getDefault(e){var t;switch(e){case"nsfw":return String(Ks.userPreferences.get("beatmapset_show_nsfw"));case"played":return"any";case"status":return"leaderboard";case"sort":return(0,l.W)(this.query)?"relevance_desc":["pending","wip","graveyard","mine"].includes(null!==(t=this.status)&&void 0!==t?t:"")?"updated_desc":"ranked_desc"}return null}href(e,t){const s=t===this.getDefault(e)?null:t;return(0,c.bj)(null,Object.assign(Object.assign({},this.queryParams),{[p[e]]:s}))}selectedValue(e){var t;return null!==(t=this[e])&&void 0!==t?t:this.getDefault(e)}toKeyString(){return m.map((e=>`${e}=${this.selectedValue(e)}`)).join("&")}update(e,t){t!==this[e]&&(h.includes(e)&&(this.sort=null),this[e]=t)}}u([r.LO],v.prototype,"extra",void 0),u([r.LO],v.prototype,"general",void 0),u([r.LO],v.prototype,"genre",void 0),u([r.LO],v.prototype,"language",void 0),u([r.LO],v.prototype,"mode",void 0),u([r.LO],v.prototype,"nsfw",void 0),u([r.LO],v.prototype,"played",void 0),u([r.LO],v.prototype,"query",void 0),u([r.LO],v.prototype,"rank",void 0),u([r.LO],v.prototype,"sort",void 0),u([r.LO],v.prototype,"status",void 0),u([r.Fl],v.prototype,"displaySort",null),u([r.Fl],v.prototype,"queryParams",null),u([r.Fl],v.prototype,"searchSort",null),u([r.Fl],v.prototype,"supporterRequired",null),u([r.aD],v.prototype,"update",null);var g=s(5119),y=s(1270),w=s(3599),_=s(9014),E=s(2918),P=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n},O=function(e,t,s,r){return new(s||(s=Promise))((function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};const j=["genre","language","extra","rank","played"];class k{constructor(e){Object.defineProperty(this,"beatmapsetSearch",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"advancedSearch",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"currentResultSet",{enumerable:!0,configurable:!0,writable:!0,value:new n}),Object.defineProperty(this,"filters",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isExpanded",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"searchStatus",{enumerable:!0,configurable:!0,writable:!0,value:{error:null,from:0,state:"completed"}}),Object.defineProperty(this,"debouncedFilterChangedSearch",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.debounce)((()=>this.filterChangedSearch()),500)}),Object.defineProperty(this,"filtersObserver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"initialErrorMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filterChangedHandler",{enumerable:!0,configurable:!0,writable:!0,value:e=>{"update"===e.type&&e.oldValue===e.newValue||"remove"!==e.type&&"sort"===e.name&&null==e.newValue||(this.searchStatus.state="input",this.debouncedFilterChangedSearch(),"query"!==e.name&&this.debouncedFilterChangedSearch.flush())}}),(0,r.rC)(this)}get currentBeatmapsetIds(){return[...this.currentResultSet.beatmapsetIds]}get error(){return this.searchStatus.error}get hasMore(){return this.currentResultSet.hasMoreForPager}get isBusy(){return"searching"===this.searchStatus.state||"input"===this.searchStatus.state}get isPaging(){return"paging"===this.searchStatus.state}get isSupporterMissing(){var e,t;return!(null!==(t=null===(e=Ks.currentUser)||void 0===e?void 0:e.is_supporter)&&void 0!==t&&t)&&this.filters.supporterRequired.length>0}get recommendedDifficulty(){return this.beatmapsetSearch.recommendedDifficulties.get(this.filters.mode)}get supporterRequiredFilterText(){const e=this.filters.supporterRequired.map((e=>(0,y.dW)(`beatmaps.listing.search.filters.${e}`)));return(0,y.m2)(e)}cancel(){this.debouncedFilterChangedSearch.cancel(),this.beatmapsetSearch.cancel()}getFilters(e){const t=this.filters.selectedValue(e);return null!=t?t.split("."):t}initialize(e){this.restoreStateFromUrl(),this.beatmapsetSearch.initialize(this.filters,e),this.initialErrorMessage=e.error}loadMore(){!this.isBusy&&this.hasMore&&this.search(this.currentResultSet.beatmapsetIds.size)}restoreTurbolinks(){this.restoreStateFromUrl(),this.search(0,!0),null!=this.initialErrorMessage&&((0,w.g)(this.initialErrorMessage,"danger"),delete this.initialErrorMessage)}search(e=0,t=!1){return O(this,void 0,void 0,(function*(){if(this.isSupporterMissing||e<0)return void(this.searchStatus={error:null,from:e,restore:t,state:"completed"});let s;this.searchStatus={from:0,restore:t,state:0===e?"searching":"paging"};try{yield this.beatmapsetSearch.get(this.filters,e)}catch(a){s=0!==a.readyState?a:null}(0,r.z)((()=>{this.searchStatus={error:s,from:e,restore:t,state:"completed"},this.currentResultSet=this.beatmapsetSearch.getResultSet(this.filters)}))}))}filterChangedSearch(){const e=(0,g.B)("beatmapsets.index",this.filters.queryParams);E.controller.advanceHistory(e),this.search()}restoreStateFromUrl(){const e=(0,_.JJ)().href;null!=this.filtersObserver&&this.filtersObserver(),this.filters=new v(e),this.filtersObserver=(0,r.N7)(this.filters,this.filterChangedHandler),this.isExpanded=(0,o.intersection)(Object.keys(f(e)),j).length>0}}P([r.LO],k.prototype,"advancedSearch",void 0),P([r.LO],k.prototype,"currentResultSet",void 0),P([r.LO],k.prototype,"filters",void 0),P([r.LO],k.prototype,"isExpanded",void 0),P([r.LO],k.prototype,"searchStatus",void 0),P([r.Fl],k.prototype,"currentBeatmapsetIds",null),P([r.Fl],k.prototype,"hasMore",null),P([r.Fl],k.prototype,"isBusy",null),P([r.Fl],k.prototype,"isPaging",null),P([r.Fl],k.prototype,"isSupporterMissing",null),P([r.Fl],k.prototype,"recommendedDifficulty",null),P([r.Fl],k.prototype,"supporterRequiredFilterText",null),P([r.aD],k.prototype,"cancel",null),P([r.aD],k.prototype,"loadMore",null),P([r.aD],k.prototype,"restoreTurbolinks",null),P([r.aD],k.prototype,"search",null),P([r.aD],k.prototype,"restoreStateFromUrl",null);var N=s(1723);const S=["chat.channel.join","chat.channel.part"];var C=s(8701);class T extends C.Z{constructor(e){super(),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class x extends C.Z{constructor(e){super(),Object.defineProperty(this,"json",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class D extends C.Z{constructor(e){super(),Object.defineProperty(this,"channelId",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class R extends C.Z{constructor(e){super(),Object.defineProperty(this,"json",{enumerable:!0,configurable:!0,writable:!0,value:e})}}var M=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};function I(e){if("chat.message.new"===e.event)return new R(e.data);if(function(e){return null!=e.event&&S.includes(e.event)}(e))switch(e.event){case"chat.channel.join":return new x(e.data);case"chat.channel.part":return new D(e.data.channel_id)}}let L=class{handleDispatchAction(e){if(!(e instanceof T))return;const t=I(e.message);null!=t&&(0,N.WI)(t)}};L=M([N.yz],L);const A=L;var $=s(9755);const B=".js-account-edit-blocklist-content",U=".js-account-edit-blocklist";class F{constructor(e){Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"toggle",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault(),$(B).toggleClass("hidden");const t=$(B).hasClass("hidden")?(0,y.dW)("common.buttons.show"):(0,y.dW)("common.buttons.hide");$(U).text(t)}}),Object.defineProperty(this,"updateBlockCount",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;null!=this.core.currentUser&&$(".js-account-edit-blocklist-count").text((0,y.dW)("users.blocks.blocked_count",{count:null!==(e=this.core.currentUser.blocks.length)&&void 0!==e?e:0}))}}),$(document).on("click",U,this.toggle),$((()=>(0,r.U5)((()=>{var e;return null===(e=this.core.currentUser)||void 0===e?void 0:e.blocks}),this.updateBlockCount)))}}var W=s(3775),H=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class Z{set title(e){(0,r.z)((()=>{this.customTitle=null!=e?`${e} | osu!`:e}))}constructor(e){Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"customTitle",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"disposer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"origTitle",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"resetTitle",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;document.title=this.origTitle,null===(e=this.disposer)||void 0===e||e.call(this)}}),Object.defineProperty(this,"setTitle",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.origTitle=document.title,this.disposer=(0,r.EH)((()=>{var e;const t=this.core.dataStore.notificationStore.unreadStacks.total,s=0===t?"":`(${(0,W.uf)(t)}) `;document.title=`${s}${null!==(e=this.customTitle)&&void 0!==e?e:this.origTitle}`}))}}),(0,r.rC)(this),document.addEventListener("turbolinks:load",this.setTitle),document.addEventListener("turbolinks:before-cache",this.resetTitle)}}H([r.LO],Z.prototype,"customTitle",void 0),H([r.LO],Z.prototype,"origTitle",void 0),H([r.aD],Z.prototype,"resetTitle",void 0),H([r.aD],Z.prototype,"setTitle",void 0);var G=s(9755);class V{constructor(){Object.defineProperty(this,"sitekey",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"containers",{enumerable:!0,configurable:!0,writable:!0,value:()=>document.querySelectorAll(".js-captcha--container")}),Object.defineProperty(this,"disableSubmit",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=this.submitButton(e);null!=t&&(t.disabled=!0)}}),Object.defineProperty(this,"enableSubmit",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=this.submitButton(e);null!=t&&(t.disabled=!1)}}),Object.defineProperty(this,"findContainer",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;return null===(s=(0,W.h3)(null===(t=(0,W.h3)(e))||void 0===t?void 0:t.closest("form")))||void 0===s?void 0:s.querySelector(".js-captcha--container")}}),Object.defineProperty(this,"init",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.sitekey=e,this.renderAll()}}),Object.defineProperty(this,"isEnabled",{enumerable:!0,configurable:!0,writable:!0,value:e=>this.isTriggered(e)&&"object"==typeof grecaptcha&&"function"==typeof grecaptcha.render&&""!==this.sitekey}),Object.defineProperty(this,"isLoaded",{enumerable:!0,configurable:!0,writable:!0,value:e=>""!==e.innerHTML}),Object.defineProperty(this,"isTriggered",{enumerable:!0,configurable:!0,writable:!0,value:e=>"1"===e.dataset.captchaTriggered}),Object.defineProperty(this,"render",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(this.isEnabled(e)&&!this.isLoaded(e)){const t=()=>this.disableSubmit(e),s=grecaptcha.render(e,{callback:()=>this.enableSubmit(e),"error-callback":t,"expired-callback":t,sitekey:this.sitekey,theme:"dark"});e.dataset.captchaId=s.toString(),t()}}}),Object.defineProperty(this,"reset",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;this.isEnabled(e)&&(grecaptcha.reset(+(null!==(t=e.dataset.captchaId)&&void 0!==t?t:"")),this.disableSubmit(e))}}),Object.defineProperty(this,"submitButton",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;return null===(t=e.closest("form"))||void 0===t?void 0:t.querySelector(".js-captcha--submit-button")}}),Object.defineProperty(this,"trigger",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.isTriggered(e)||(e.dataset.captchaTriggered="1",this.render(e))}}),Object.defineProperty(this,"renderAll",{enumerable:!0,configurable:!0,writable:!0,value:()=>{for(const e of this.containers())this.render(e)}}),Object.defineProperty(this,"resetOnError",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=this.findContainer((0,W.h3)(e.target));null!=t&&this.reset(t)}}),G(document).on("turbolinks:load",this.renderAll),G(document).on("ajax:error",".js-captcha--reset-on-error",this.resetOnError)}}var z=s(9162),q=s(6122),K=s(9755);class J{constructor(){Object.defineProperty(this,"current",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"documentMouseEventTarget",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"close",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.show()}}),Object.defineProperty(this,"restoreSaved",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.show(document.body.dataset.clickMenuCurrent)}}),Object.defineProperty(this,"saveCurrent",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null==this.current?delete document.body.dataset.clickMenuCurrent:document.body.dataset.clickMenuCurrent=this.current}}),Object.defineProperty(this,"show",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;const r=this.tree();this.current=e;const a=this.tree(),i=document.querySelectorAll(".js-click-menu[data-click-menu-id]");let n=null,o=!1;for(const c of i){if(!(c instanceof HTMLElement))continue;const e=c.dataset.clickMenuId;null==e||-1===a.indexOf(e)?((0,z.U6)(c),c.classList.remove("js-click-menu--active"),null===(t=this.menuLink(e))||void 0===t||t.classList.remove("js-click-menu--active")):((0,z.Ji)(c),c.classList.add("js-click-menu--active"),null===(s=this.menuLink(e))||void 0===s||s.classList.add("js-click-menu--active"),o=!0,e===this.current&&(n=c))}o||(this.current=null),K.publish("click-menu:current",{previousTree:r,target:this.current,tree:a});const l=null==n?void 0:n.querySelector(".js-click-menu--autofocus");l instanceof HTMLElement&&l.focus()}}),Object.defineProperty(this,"toggle",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget,s=this.tree();e.preventDefault();const r=t.dataset.clickMenuTarget;let a=r;if(null!=r){const e=s.indexOf(r);-1!==e&&(a=s[e+1])}this.show(a)}}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(null==this.current)return[];let e=this.current;const t=[e];for(;e=this.closestMenuId(this.menuLink(e)),null!=e;)t.push(e);return t}}),Object.defineProperty(this,"onDocumentMousedown",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.documentMouseEventTarget=0===e.button?e.target:null}}),Object.defineProperty(this,"onDocumentMouseup",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.documentMouseEventTarget===e.target&&0===e.button&&((0,q.u)()||null!=this.current&&(K(e.target).closest(".js-click-menu").length>0||this.show()))}}),K(document).on("click",".js-click-menu--close",this.close),K(document).on("click",".js-click-menu[data-click-menu-target]",this.toggle),K(document).on("mousedown",this.onDocumentMousedown),K(document).on("mouseup",this.onDocumentMouseup),document.addEventListener("turbolinks:load",this.restoreSaved),document.addEventListener("turbolinks:before-cache",this.saveCurrent)}closestMenuId(e){if(null!=e)return K(e).parents("[data-click-menu-id]").attr("data-click-menu-id")}menu(e){return document.querySelector(`.js-click-menu[data-click-menu-id${null==e?"":`='${e}'`}]`)}menuLink(e){return document.querySelector(`.js-click-menu[data-click-menu-target${null==e?"":`='${e}'`}]`)}}var X=s(3336),Q=s(9755);class Y{constructor(e){Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"avatars",{enumerable:!0,configurable:!0,writable:!0,value:document.getElementsByClassName("js-current-user-avatar")}),Object.defineProperty(this,"covers",{enumerable:!0,configurable:!0,writable:!0,value:document.getElementsByClassName("js-current-user-cover")}),Object.defineProperty(this,"setAvatars",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t;const s=null!==(t=(0,X.eF)(null===(e=this.core.currentUser)||void 0===e?void 0:e.avatar_url))&&void 0!==t?t:"";for(const r of this.avatars)r instanceof HTMLElement&&(r.style.backgroundImage=s)}}),Object.defineProperty(this,"setCovers",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t;const s=null!==(t=(0,X.eF)(null===(e=this.core.currentUser)||void 0===e?void 0:e.cover.url))&&void 0!==t?t:"";for(const r of this.covers)r instanceof HTMLElement&&(r.style.backgroundImage=s)}}),Q(document).on("turbolinks:load",this.setAvatars),Q((()=>(0,r.U5)((()=>{var e;return null===(e=this.core.currentUser)||void 0===e?void 0:e.avatar_url}),this.setAvatars))),Q((()=>(0,r.U5)((()=>{var e;return null===(e=this.core.currentUser)||void 0===e?void 0:e.cover.url}),this.setCovers)))}}var ee=s(9755);const te="//platform.enchant.com";class se{constructor(e){Object.defineProperty(this,"turbolinksReload",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"load",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null!=document.querySelector(".enchant-help-center")&&(window.enchant=[],this.turbolinksReload.load(te))}}),Object.defineProperty(this,"showMessageWindow",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault(),null!=window.enchant&&null!=window.enchant.messenger&&"function"==typeof window.enchant.messenger.open&&window.enchant.messenger.open()}}),Object.defineProperty(this,"unload",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.turbolinksReload.forget(te),ee('#enchant-messenger-main, #enchant-messenger-launcher, iframe[src^="https://enchantwidgets-"]').remove(),document.querySelectorAll("style").forEach((e=>{const t=e.textContent;null!=t&&/#enchant-/.exec(t)&&ee(e).remove()}))}}),ee(document).on("turbolinks:load",this.load),ee(document).on("turbolinks:before-cache",this.unload),ee(document).on("click",".js-enchant--show",this.showMessageWindow)}}function re(e){var t;if(!(e.target instanceof Element))return;const s=e.target.closest("a");s instanceof HTMLAnchorElement&&(null===(t=s.getAttribute("href"))||void 0===t?void 0:t.startsWith("./"))&&s.setAttribute("href",s.href)}class ae{constructor(){document.addEventListener("click",re)}}var ie=s(9755);class ne{constructor(){Object.defineProperty(this,"switchEdit",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=ie(e.target).parents(".js-forum-poll--container");if("1"===t.attr("data-edit")){t.attr("data-edit","0");const s=ie(e.target).closest("form")[0];null!=s&&s.reset()}else t.attr("data-edit","1")}}),Object.defineProperty(this,"switchPage",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget;if(!(t instanceof HTMLElement))return;const s=t.dataset.targetPage;"string"==typeof s&&ie(e.target).parents(".js-forum-poll--container").attr("data-page",s)}}),ie(document).on("click",".js-forum-poll--switch-page",this.switchPage).on("click",".js-forum-poll--switch-edit",this.switchEdit)}}var oe=s(9755);class le{constructor(){Object.defineProperty(this,"handleCancel",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;e.preventDefault(),oe.publish("forum-post-input:clear",[e.target]);const s=oe(e.target).parents(".js-forum-post-edit--container");s.html(null!==(t=s.attr("data-original-post"))&&void 0!==t?t:"").attr("data-original-post",null)}}),Object.defineProperty(this,"handleEditSaved",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{const s=e.target;setTimeout((()=>{this.saved(s,t)}))}}),Object.defineProperty(this,"handleEditStart",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{const s=e.target;setTimeout((()=>{this.start(s,t)}))}}),Object.defineProperty(this,"saved",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{if(!(e instanceof HTMLElement))throw new Error("target must be instance of HTMLElement");oe(e).parents(".js-forum-post").replaceWith(t)}}),Object.defineProperty(this,"start",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{if(!(e instanceof HTMLElement))throw new Error("target must be instance of HTMLElement");const s=oe(e).parents(".js-forum-post-edit--container");s.attr("data-original-post",s.html()).html(t).find("[name=body]").focus(),oe.publish("forum-post-input:restore",[s[0]])}}),oe(document).on("ajax:success",".js-edit-post-start",this.handleEditStart).on("click",".js-edit-post-cancel",this.handleCancel).on("ajax:success",".js-forum-post-edit",this.handleEditSaved)}}var ce=s(9755);function ue(e){var t;if(!(e instanceof HTMLElement))return;const s=null!==(t=e.closest(".js-forum-post"))&&void 0!==t?t:e.closest("form");if(!(s instanceof HTMLElement))return;const r=s.querySelector("[name=body]");return r instanceof HTMLTextAreaElement?r:void 0}class de{constructor(){Object.defineProperty(this,"handleClear",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{this.clearInput(ue(t))}}),Object.defineProperty(this,"handlePageLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{for(const e of document.querySelectorAll(".js-forum-post-input"))this.handleRestore(null,e)}}),Object.defineProperty(this,"handlePostSaved",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.clearInput(ue(e.target))}}),Object.defineProperty(this,"handleRestore",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{const s=ue(t);if(null==s)return;const r=this.getKeyFromInput(s);if(null==r)return;const a=localStorage.getItem(r);if(null!=a&&(s.value=a),r.startsWith("forum-post-input:topic:")){const e=`forum-topic-reply--${(0,_.JJ)().pathname}--text`,t=localStorage.getItem(e);null!=t&&(localStorage.removeItem(e),localStorage.setItem(r,t),s.value=t)}}}),Object.defineProperty(this,"onInput",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget;if(!(t instanceof HTMLTextAreaElement))return;const s=this.getKeyFromInput(t);if(null==s)return;""===t.value?localStorage.removeItem(s):localStorage.setItem(s,t.value)}}),ce(document).on("input change",".js-forum-post-input",this.onInput).on("turbolinks:load",this.handlePageLoad).on("ajax:success",".js-forum-post-input--form",this.handlePostSaved),ce.subscribe("forum-post-input:restore",this.handleRestore),ce.subscribe("forum-post-input:clear",this.handleClear)}clearInput(e){if(null==e)return;const t=this.getKeyFromInput(e);null!=t&&localStorage.removeItem(t)}getKeyFromInput(e){return this.prefixKey(e.dataset.forumPostInputId)}prefixKey(e){if(null!=e&&""!==e)return`forum-post-input:${e}`}}var pe=s(3518),me=s(9755);class he{constructor(){Object.defineProperty(this,"onClickReportButton",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(0!==e.button)return;const t=e.currentTarget.closest(".js-forum-post");if(null==t)return;const s=t.dataset.postId,r=t.dataset.postUsername;null!=s&&null!=r&&(0,pe.Y1)({reportableId:s,reportableType:"forum_post",username:r})}}),me(document).on("click",".js-forum-post-report",this.onClickReportButton)}}var be=s(381);class fe{constructor(){Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"formatElem",{enumerable:!0,configurable:!0,writable:!0,value:e=>{"1"!==e.dataset.localtime&&(e.dataset.localtime="1",e.classList.add("js-tooltip-time"),e.title=e.dateTime,e.innerText=be(e.dateTime).format("LLL"))}}),Object.defineProperty(this,"formatElems",{enumerable:!0,configurable:!0,writable:!0,value:e=>(null==e&&(e=this.getElems(document.body)),e.map(this.formatElem))}),Object.defineProperty(this,"getElems",{enumerable:!0,configurable:!0,writable:!0,value:e=>e instanceof HTMLElement?e instanceof HTMLTimeElement&&e.classList.contains("js-localtime")?[e]:[...e.querySelectorAll("time.js-localtime")]:[]}),Object.defineProperty(this,"mutationHandler",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=[];e.forEach((e=>{e.addedNodes.forEach((e=>{t.push(...this.getElems(e))}))})),this.formatElems(t)}}),this.observer=new MutationObserver(this.mutationHandler),this.observer.observe(document,{childList:!0,subtree:!0})}}var ve=s(9755);const ge="js-mobile-toggle--active";class ye{constructor(){Object.defineProperty(this,"toggle",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget;if(!(t instanceof HTMLElement))return;const s=t.dataset.mobileToggleTarget;if(null==s)return;const r=document.querySelector(`.js-mobile-toggle[data-mobile-toggle-id=${s}]`);if(!(r instanceof HTMLElement))return;const a=!t.classList.contains(ge);t.classList.toggle(ge,a),r.classList.toggle("hidden-xs",!a)}}),ve(document).on("click",".js-mobile-toggle",this.toggle)}}var we=s(9755);const _e=e=>{var t;return null!==(t=e.clientX)&&void 0!==t?t:e.touches[0].clientX};let Ee=null;class Pe{constructor(e){Object.defineProperty(this,"active",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bar",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"endCallback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"moveCallback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"percentage",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"end",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.active=!1,we(document).off("mousemove touchmove",this.onMove),we(document).off("mouseup touchend",this.end),we(window).off("blur",this.end),we(document).off("turbolinks:before-cache",this.end),null!=this.endCallback&&this.endCallback(this),this.bar.style.removeProperty("--bar"),this.bar.dataset.audioDragging="0",Ee=null}}),Object.defineProperty(this,"getPercentage",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.percentage}),Object.defineProperty(this,"move",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(!this.active)return;const t=this.bar.getBoundingClientRect(),s=e-t.left,r=t.width;this.percentage=(0,o.clamp)(s/r,0,1),null!=this.moveCallback&&this.moveCallback(this),this.bar.style.setProperty("--bar",this.percentage.toString())}}),Object.defineProperty(this,"onMove",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=_e(e);requestAnimationFrame((()=>{this.move(t)}))}}),this.endCallback=e.endCallback,this.moveCallback=e.moveCallback,this.bar=e.bar,this.bar.dataset.audioDragging="1",this.move(_e(e.initialEvent)),we(document).on("mousemove touchmove",this.onMove),we(document).on("mouseup touchend",this.end),we(window).on("blur",this.end),we(document).on("turbolinks:before-cache",this.end)}static start(e){if(0===e.initialEvent.which||1===e.initialEvent.which)return null!=Ee&&Ee.end(),Ee=new Pe(e),Ee}}Object.defineProperty(Pe,"startEvents",{enumerable:!0,configurable:!0,writable:!0,value:"mousedown touchstart"});const Oe=Pe,je=e=>e.toString().padStart(2,"0"),ke={},Ne=(e,t)=>{var s;const r=Math.floor(e);if(ke.time!==r||ke.format!==t){ke.format=t,ke.time=r;const e=r%60,s=Math.floor(r/60);if("minute_minimal"===t)ke.formatted=`'${s}:${je(e)}'`;else if("minute"===t)ke.formatted=`'${je(s)}:${je(e)}'`;else{const r=s%60,a=Math.floor(s/60);ke.formatted="hour_minimal"===t?`'${a}:${je(r)}:${je(e)}'`:`'${je(a)}:${je(r)}:${je(e)}'`}}return null!==(s=ke.formatted)&&void 0!==s?s:""};var Se=s(9755),Ce=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class Te{constructor(e){Object.defineProperty(this,"userPreferences",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:new Audio}),Object.defineProperty(this,"currentSlider",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"durationFormatted",{enumerable:!0,configurable:!0,writable:!0,value:"'0:00'"}),Object.defineProperty(this,"hasWorkingVolumeControl",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"hideMainPlayerTimeout",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"mainPlayer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pagePlayer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"playerNext",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"playerPrev",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settingNavigation",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:"paused"}),Object.defineProperty(this,"timeFormat",{enumerable:!0,configurable:!0,writable:!0,value:"minute_minimal"}),Object.defineProperty(this,"url",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkVolumeSettings",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.audio.volume,t=.1===e?.2:.1;this.audio.volume=t,setTimeout((()=>{this.hasWorkingVolumeControl=this.audio.volume===t,this.audio.volume=e,this.syncVolumeDisplay()}),0)}}),Object.defineProperty(this,"ensurePagePlayerIsAttached",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null==this.pagePlayer||document.body.contains(this.pagePlayer)||(this.pagePlayer=void 0)}}),Object.defineProperty(this,"load",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.dataset.audioUrl;if(null==t)throw new Error("Player is missing url");this.audio.paused||this.stop(),this.setTime(0),this.pagePlayer=e,this.url=t,this.audio.setAttribute("src",t),this.audio.currentTime=0,this.setState("loading");const s=this.audio.play();null==s||s.catch((e=>{if(Te.ignoredErrors.includes(e.name))return console.error("playback failed:",e.name),void this.stop();throw e})),this.setNavigation()}}),Object.defineProperty(this,"nav",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget;t instanceof HTMLElement&&("prev"===t.dataset.audioNav&&null!=this.playerPrev?this.load(this.playerPrev):"next"===t.dataset.audioNav&&null!=this.playerNext&&this.load(this.playerNext))}}),Object.defineProperty(this,"observePage",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.ensurePagePlayerIsAttached();const t=[],s=[],r=null==this.pagePlayer;e.forEach((e=>{e.addedNodes.forEach((e=>{if(e instanceof HTMLElement&&(e instanceof HTMLAudioElement?t.push(e):t.push(...e.querySelectorAll("audio")),r))if(e.classList.contains("js-audio--player"))s.push(e);else for(const t of[...e.querySelectorAll(".js-audio--player")])t instanceof HTMLElement&&s.push(t)}))})),s.push(...this.replaceAudioElems(t)),this.reattachPagePlayer(s)}}),Object.defineProperty(this,"onClickPlay",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault();const t=this.findPlayer(e.currentTarget);if(null==t)throw new Error("couldn't find pagePlayer of the play button");t===this.pagePlayer?this.togglePlay():this.load(t)}}),Object.defineProperty(this,"onDocumentReady",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(null==this.mainPlayer){const e=document.querySelector(".js-audio--main");if(null==e)return void console.error("page is missing main player placeholder");this.mainPlayer=(()=>{const e=document.createElement("div");return e.className="audio-player audio-player--main",e.innerHTML=`\n    <button\n      type="button"\n      class="audio-player__button audio-player__button--prev js-audio--nav"\n      data-audio-nav="prev"\n    ><span class="fas fa-fw fa-step-backward"></span></button>\n\n    <button\n      type="button"\n      class="audio-player__button audio-player__button--play js-audio--main-play"\n    ><span class="fa-fw play-button"></span></button>\n\n    <button\n      type="button"\n      class="audio-player__button audio-player__button--next js-audio--nav"\n      data-audio-nav="next"\n    ><span class="fas fa-fw fa-step-forward"></span></button>\n\n    <div class="audio-player__bar audio-player__bar--progress js-audio--seek">\n      <div class="audio-player__bar-current"></div>\n    </div>\n\n    <div class="audio-player__timestamps">\n      <div class="audio-player__timestamp audio-player__timestamp--current"></div>\n      <div class="audio-player__timestamp-separator">/</div>\n      <div class="audio-player__timestamp audio-player__timestamp--total"></div>\n    </div>\n\n    <div class="audio-player__volume-control">\n      <button type="button" class="audio-player__volume-button js-audio--toggle-mute"></button>\n      <div class="audio-player__bar audio-player__bar--volume js-audio--volume">\n        <div class="audio-player__bar-current"></div>\n      </div>\n    </div>\n\n    <div class="audio-player__autoplay-control">\n      <button type="button" class="audio-player__autoplay-button js-audio--toggle-autoplay" title="${(0,y.dW)("layout.audio.autoplay")}"></button>\n    </div>\n  `,e})(),e.replaceWith(this.mainPlayer),(0,r.EH)((()=>{this.audio.muted=this.userPreferences.get("audio_muted"),this.audio.volume=this.userPreferences.get("audio_volume");const e=this.userPreferences.get("audio_autoplay")?"1":"0";null!=this.mainPlayer&&(this.mainPlayer.dataset.audioAutoplay=e)})),this.checkVolumeSettings(),this.syncState()}null==this.observer&&(this.observer=new MutationObserver(this.observePage),this.observer.observe(document,{childList:!0,subtree:!0})),this.replaceAudioElems(),this.reattachPagePlayer()}}),Object.defineProperty(this,"onEnded",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.stop(),null!=this.playerNext&&this.userPreferences.get("audio_autoplay")&&this.load(this.playerNext)}}),Object.defineProperty(this,"onPause",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setState("paused")}}),Object.defineProperty(this,"onPlaying",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.setTimeFormat(),this.durationFormatted=Ne(this.audio.duration,this.timeFormat),this.setState("playing")}}),Object.defineProperty(this,"onSeekEnd",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.currentSlider=void 0;const t=1===e.getPercentage()?this.audio.duration-.01:this.audio.duration*e.getPercentage();this.setTime(t)}}),Object.defineProperty(this,"onSeekStart",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget;t instanceof HTMLElement&&(null!=this.pagePlayer&&this.pagePlayer.contains(t)||null!=this.mainPlayer&&this.mainPlayer.contains(t))&&Number.isFinite(this.audio.duration)&&0!==this.audio.duration&&(this.currentSlider=Oe.start({bar:t,endCallback:this.onSeekEnd,initialEvent:e}))}}),Object.defineProperty(this,"onTimeupdate",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.audio.paused&&this.syncProgress()}}),Object.defineProperty(this,"onVolumeChangeEnd",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.currentSlider=void 0,this.userPreferences.set("audio_volume",this.audio.volume)}}),Object.defineProperty(this,"onVolumeChangeMove",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.audio.volume=e.getPercentage()}}),Object.defineProperty(this,"onVolumeChangeStart",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=e.currentTarget;t instanceof HTMLElement&&(this.currentSlider=Oe.start({bar:t,endCallback:this.onVolumeChangeEnd,initialEvent:e,moveCallback:this.onVolumeChangeMove}))}}),Object.defineProperty(this,"reattachPagePlayer",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(this.ensurePagePlayerIsAttached(),null!=this.url&&null==this.pagePlayer){null==e&&(e=[...document.querySelectorAll(".js-audio--player")]);for(const t of e)if(t instanceof HTMLElement&&t.dataset.audioUrl===this.url){this.pagePlayer=t,this.syncState();break}}this.setNavigation()}}),Object.defineProperty(this,"replaceAudioElem",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;const r=null!==(t=(0,l.G)(e.src))&&void 0!==t?t:(0,l.G)(null===(s=e.querySelector("source"))||void 0===s?void 0:s.src);if(null==r)throw new Error("audio element is missing src");const a=(()=>{const e=document.createElement("div");return e.className="audio-player js-audio--player",e.innerHTML='\n    <button\n    type="button"\n    class="audio-player__button audio-player__button--play js-audio--play"\n    ><span class="fa-fw play-button"></span></button>\n\n    <div class="audio-player__bar audio-player__bar--progress js-audio--seek">\n      <div class="audio-player__bar-current"></div>\n    </div>\n\n    <div class="audio-player__timestamps">\n      <div class="audio-player__timestamp audio-player__timestamp--current"></div>\n      <div class="audio-player__timestamp-separator">/</div>\n      <div class="audio-player__timestamp audio-player__timestamp--total"></div>\n    </div>\n  ',e})();return a.dataset.audioUrl=r,a.dataset.audioState="paused",e.replaceWith(a),a}}),Object.defineProperty(this,"replaceAudioElems",{enumerable:!0,configurable:!0,writable:!0,value:e=>(null==e&&(e=[...document.querySelectorAll("audio")]),e.map(this.replaceAudioElem))}),Object.defineProperty(this,"setNavigation",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.settingNavigation||(this.settingNavigation=!0,window.setTimeout((()=>{var e;this.playerNext=void 0,this.playerPrev=void 0;const t=null===(e=this.pagePlayer)||void 0===e?void 0:e.closest(".js-audio--group");if(t instanceof HTMLElement){const e=t.querySelectorAll(".js-audio--player");for(let t=0;t<e.length;t++)if(e[t]===this.pagePlayer){if(t>0){const s=e[t-1];s instanceof HTMLElement&&(this.playerPrev=s)}const s=e[t+1];s instanceof HTMLElement&&(this.playerNext=s);break}}null!=this.mainPlayer&&(this.mainPlayer.dataset.audioHasPrev=null==this.playerPrev?"0":"1",this.mainPlayer.dataset.audioHasNext=null==this.playerNext?"0":"1"),this.settingNavigation=!1})))}}),Object.defineProperty(this,"setState",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.state=e,this.syncState(),window.clearTimeout(this.hideMainPlayerTimeout),"playing"===this.state||"loading"===this.state?null!=this.mainPlayer&&(this.mainPlayer.dataset.audioVisible="1"):this.hideMainPlayerTimeout=window.setTimeout((()=>{null!=this.mainPlayer&&(this.mainPlayer.dataset.audioVisible="0")}),4e3)}}),Object.defineProperty(this,"setTime",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.audio.currentTime=e,this.syncProgress()}}),Object.defineProperty(this,"setTimeFormat",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.audio.duration<600?this.timeFormat="minute_minimal":this.audio.duration<3600?this.timeFormat="minute":this.audio.duration<36e3?this.timeFormat="hour_minimal":this.timeFormat="hour"}}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;this.audio.pause(),null===(e=this.currentSlider)||void 0===e||e.end(),this.audio.currentTime=0,this.onPause()}}),Object.defineProperty(this,"syncProgress",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(this.audio.duration>0){const e=this.audio.currentTime/this.audio.duration,t=e>=.5?"1":"0",s=e.toString(),r=Ne(this.audio.currentTime,this.timeFormat);this.updatePlayers((e=>{e.style.setProperty("--current-time",r),e.style.setProperty("--progress",s),e.dataset.audioOver50=t}))}this.audio.paused||requestAnimationFrame(this.syncProgress)}}),Object.defineProperty(this,"syncState",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.updatePlayers((e=>{e.dataset.audioHasDuration=Number.isFinite(this.audio.duration)?"1":"0",e.dataset.audioState=this.state,e.dataset.audioTimeFormat=this.timeFormat,e.style.setProperty("--duration",this.durationFormatted)})),this.syncProgress(),this.syncVolumeDisplay()}}),Object.defineProperty(this,"syncVolumeDisplay",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null!=this.mainPlayer&&(this.mainPlayer.dataset.audioVolumeBarVisible=this.hasWorkingVolumeControl?"1":"0",this.mainPlayer.dataset.audioVolume=this.volumeIcon(),this.mainPlayer.style.setProperty("--volume",this.audio.volume.toString()))}}),Object.defineProperty(this,"toggleAutoplay",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.userPreferences.set("audio_autoplay",!this.userPreferences.get("audio_autoplay"))}}),Object.defineProperty(this,"toggleMute",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.userPreferences.set("audio_muted",!this.userPreferences.get("audio_muted"))}}),Object.defineProperty(this,"togglePlay",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null!=this.url&&(this.audio.paused?this.audio.play():this.audio.pause())}}),Object.defineProperty(this,"updatePlayers",{enumerable:!0,configurable:!0,writable:!0,value:e=>{[this.mainPlayer,this.pagePlayer].forEach((t=>{null!=t&&e(t)}))}}),Object.defineProperty(this,"volumeIcon",{enumerable:!0,configurable:!0,writable:!0,value:()=>this.audio.muted?"muted":0===this.audio.volume?"silent":this.audio.volume<.4?"quiet":"normal"}),(0,r.rC)(this),this.audio.volume=0,this.audio.addEventListener("pause",this.onPause),this.audio.addEventListener("playing",this.onPlaying),this.audio.addEventListener("ended",this.onEnded),this.audio.addEventListener("timeupdate",this.onTimeupdate),this.audio.addEventListener("volumechange",this.syncVolumeDisplay),Se(document).on("click",".js-audio--play",this.onClickPlay).on("click",".js-audio--main-play",this.togglePlay).on(Oe.startEvents,".js-audio--seek",this.onSeekStart).on(Oe.startEvents,".js-audio--volume",this.onVolumeChangeStart).on("click",".js-audio--toggle-mute",this.toggleMute).on("click",".js-audio--toggle-autoplay",this.toggleAutoplay).on("click",".js-audio--nav",this.nav),document.addEventListener("turbolinks:load",this.onDocumentReady)}findPlayer(e){var t,s;const r=null!==(s=null===(t=this.mainPlayer)||void 0===t?void 0:t.contains(e))&&void 0!==s&&s?this.pagePlayer:e.closest(".js-audio--player");if(r instanceof HTMLElement)return r}}Object.defineProperty(Te,"ignoredErrors",{enumerable:!0,configurable:!0,writable:!0,value:["AbortError","NotAllowedError","NotSupportedError"]});const xe=Te;Ce([r.aD],Te.prototype,"onEnded",void 0),Ce([r.aD],Te.prototype,"onVolumeChangeEnd",void 0),Ce([r.aD],Te.prototype,"toggleAutoplay",void 0),Ce([r.aD],Te.prototype,"toggleMute",void 0);var De=s(5863),Re=s(3935),Me=s(9755),Ie=s(2918);class Le{constructor(e,t){Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"turbolinksReload",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"components",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"newVisit",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"pageReady",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"renderedContainers",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"scrolled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"timeoutScroll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"boot",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(this.pageReady&&null!=window.newBody)for(const[e,t]of this.components.entries()){const s=window.newBody.querySelectorAll(`.js-react--${e}`);for(const e of s)e instanceof HTMLElement&&!this.renderedContainers.has(e)&&(this.renderedContainers.add(e),(0,r.z)((()=>{Re.render(t(e),e)})))}}}),Object.defineProperty(this,"destroy",{enumerable:!0,configurable:!0,writable:!0,value:()=>{for(const e of this.renderedContainers.values())document.body.contains(e)||(Re.unmountComponentAtNode(e),this.renderedContainers.delete(e))}}),Object.defineProperty(this,"handleBeforeCache",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.pageReady=!1,window.clearTimeout(this.timeoutScroll)}}),Object.defineProperty(this,"handleBeforeRender",{enumerable:!0,configurable:!0,writable:!0,value:e=>{window.newBody=e.originalEvent.data.newBody,this.setNewUrl(),this.pageReady=!0,(0,De.w)(),this.core.updateCurrentUser(),this.loadScripts(!1),this.boot()}}),Object.defineProperty(this,"handleBeforeVisit",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.newVisit=!0}}),Object.defineProperty(this,"handleLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;null!==(e=window.newBody)&&void 0!==e||(window.newBody=document.body),window.newUrl=null,this.pageReady=!0,this.scrolled=!1,Me(window).off("scroll",this.handleWindowScroll),Me(window).on("scroll",this.handleWindowScroll),window.setTimeout((()=>{this.destroy(),this.loadScripts(),this.boot(),this.timeoutScroll=window.setTimeout(this.scrollOnNewVisit,100)}),1)}}),Object.defineProperty(this,"handleWindowScroll",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.scrolled=this.scrolled||0!==window.scrollX||0!==window.scrollY}}),Object.defineProperty(this,"scrollOnNewVisit",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;Me(window).off("scroll",this.handleWindowScroll);const t=this.newVisit;if(this.newVisit=!1,!t||this.scrolled)return;const s=decodeURIComponent((0,_.JJ)().hash.substr(1));""!==s&&(null===(e=document.getElementById(s))||void 0===e||e.scrollIntoView())}}),Me(document).on("turbolinks:before-cache",this.handleBeforeCache),Me(document).on("turbolinks:before-visit",this.handleBeforeVisit),Me(document).on("turbolinks:load",this.handleLoad),Me(document).on("turbolinks:before-render",this.handleBeforeRender)}register(e,t){this.components.has(e)||(this.components.set(e,t),this.boot())}runAfterPageLoad(e){if(document.body!==window.newBody)return Me(document).one("turbolinks:load",e),()=>{Me(document).off("turbolinks:load",e)};e()}loadScripts(e=!0){if(null==window.newBody)return;const t=e?"load":"loadSync";window.newBody.querySelectorAll(".js-react-turbolinks--script").forEach((e=>{if(e instanceof HTMLDivElement){const s=e.dataset.src;null!=s&&this.turbolinksReload[t](s)}}))}setNewUrl(){var e,t,s,r;const a=null!==(s=null===(t=null===(e=Ie.controller.currentVisit)||void 0===e?void 0:e.redirectedToLocation)||void 0===t?void 0:t.absoluteURL)&&void 0!==s?s:null===(r=Ie.controller.currentVisit)||void 0===r?void 0:r.location.absoluteURL;window.newUrl=null==a?document.location:new URL(a)}}var Ae=s(9755);class $e{constructor(){Object.defineProperty(this,"permanentFixedFooter",{enumerable:!0,configurable:!0,writable:!0,value:document.getElementsByClassName("js-permanent-fixed-footer")}),Object.defineProperty(this,"stickMarker",{enumerable:!0,configurable:!0,writable:!0,value:document.getElementsByClassName("js-sticky-footer")}),Object.defineProperty(this,"throttledStickOrUnstick",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stickOrUnstick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(0===this.stickMarker.length)return;const e=this.permanentFixedFooter[0];if(!(e instanceof HTMLElement))return;const t=window.innerHeight-e.offsetHeight;for(const s of this.stickMarker)if(s instanceof HTMLElement){if("1"===s.dataset.stickyFooterDisabled)continue;if(s.getBoundingClientRect().top>=t)return void Ae.publish("stickyFooter",s.dataset.stickyFooterTarget)}Ae.publish("stickyFooter")}}),this.throttledStickOrUnstick=(0,o.throttle)(this.stickOrUnstick,100),Ae(window).on("scroll resize",this.stickOrUnstick),Ae.subscribe("stickyFooter:check",this.throttledStickOrUnstick),Ae(document).on("turbolinks:load",this.throttledStickOrUnstick)}markerDisable(e){e.dataset.stickyFooterDisabled="1"}markerEnable(e){e.dataset.stickyFooterDisabled=""}}var Be=s(9755);class Ue{get breadcrumbsElement(){var e;return null===(e=window.newBody)||void 0===e?void 0:e.querySelector(".js-sticky-header-breadcrumbs")}get contentElement(){var e;return null===(e=window.newBody)||void 0===e?void 0:e.querySelector(".js-sticky-header-content")}get headerHeight(){const e=window._styles.header;return Ks.windowSize.isMobile?e.heightMobile:e.heightSticky}get header(){return document.querySelector(".js-pinned-header")}get marker(){return document.querySelector(".js-sticky-header")}get pinnedSticky(){return document.querySelector(".js-pinned-header-sticky")}get scrollOffsetValue(){const e=this.pinnedSticky,t=null==e?0:e.getBoundingClientRect().height;return this.headerHeight+t}get shouldStick(){const e=this.marker,t=this.pinnedSticky;if(null==e||null==t)return;return e.getBoundingClientRect().top<this.headerHeight+t.getBoundingClientRect().height}constructor(){Object.defineProperty(this,"debouncedOnScroll",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.debounce)((()=>this.onScroll()),20)}),Object.defineProperty(this,"onScroll",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.pin(),this.stickOrUnstick()}}),Object.defineProperty(this,"stickOrUnstick",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=this.shouldStick;null!=e&&this.setVisible(e)}}),Be(window).on("scroll",this.onScroll),Be(document).on("turbolinks:load",this.debouncedOnScroll),Be(window).on("resize",this.stickOrUnstick)}scrollOffset(e){return Math.max(0,e-this.scrollOffsetValue)}pin(){null!=this.header&&(this.shouldPin()?document.body.classList.add("js-header-is-pinned"):document.body.classList.remove("js-header-is-pinned"))}setVisible(e){(0,z.Eo)((0,W.h3)(this.pinnedSticky),e),Be(document).trigger("sticky-header:sticking",[e])}shouldPin(e){return(null!=e?e:window.pageYOffset)>30||this.shouldStick}}var Fe=s(9755);class We{constructor(){Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"references",{enumerable:!0,configurable:!0,writable:!0,value:document.getElementsByClassName("js-sync-height--reference")}),Object.defineProperty(this,"targets",{enumerable:!0,configurable:!0,writable:!0,value:document.getElementsByClassName("js-sync-height--target")}),Object.defineProperty(this,"onResize",{enumerable:!0,configurable:!0,writable:!0,value:e=>{for(const t of e)if(t.target instanceof HTMLTextAreaElement)return void this.sync()}}),Object.defineProperty(this,"sync",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e={};for(const t of this.references){if(!(t instanceof HTMLElement))continue;const s=t.dataset.syncHeightTarget;null!=s&&(e[s]=t.offsetHeight)}for(const t of this.targets){if(!(t instanceof HTMLElement))continue;const s=t.dataset.syncHeightId;if(null!=s){const r=e[s];null!=r&&(t.style.minHeight=`${r}px`)}}}}),Fe(document).on("turbolinks:load",this.sync),Fe.subscribe("sync-height:force",this.sync),Fe(window).on("resize",this.sync),this.observer=new MutationObserver(this.onResize),this.observer.observe(document,{attributes:!0,subtree:!0})}}var He=s(9755);class Ze{constructor(){Object.defineProperty(this,"observer",{enumerable:!0,configurable:!0,writable:!0,value:new MutationObserver(Ze.handleMutations)}),this.observer.observe(document,{attributeFilter:["datetime"],attributeOldValue:!0,childList:!0,subtree:!0})}static handleMutation(e){switch(e.type){case"childList":He(e.addedNodes).find(Ze.searchQuery).addBack(Ze.searchQuery).timeago();break;case"attributes":e.target instanceof HTMLTimeElement&&e.target.dateTime!==e.oldValue&&e.target.classList.contains(Ze.className)&&He(e.target).timeago("updateFromDOM")}}static handleMutations(e){null!=He.fn.timeago&&e.forEach(Ze.handleMutation)}}Object.defineProperty(Ze,"className",{enumerable:!0,configurable:!0,writable:!0,value:"js-timeago"}),Object.defineProperty(Ze,"searchQuery",{enumerable:!0,configurable:!0,writable:!0,value:`.${Ze.className}`});const Ge=Ze;var Ve=s(9755);class ze{constructor(){Object.defineProperty(this,"loaded",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"loading",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"abortLoading",{enumerable:!0,configurable:!0,writable:!0,value:()=>{for(const e of this.loading.values())e.abort()}}),Object.defineProperty(this,"forget",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;this.loaded.delete(e),null===(t=this.loading.get(e))||void 0===t||t.abort()}}),Ve(document).on("turbolinks:before-cache",this.abortLoading)}load(e){if(this.loaded.has(e)||this.loading.has(e))return this.loading.get(e);const t=Ve.ajax(e,{cache:!0,dataType:"script"});return this.loading.set(e,t),t.done((()=>this.loaded.add(e))).always((()=>this.loading.delete(e))),t}loadSync(e){this.loaded.has(e)||(this.loading.has(e)&&this.forget(e),Ve.ajax(e,{async:!1,cache:!0,dataType:"script"}),this.loaded.add(e))}}class qe{constructor(e){Object.defineProperty(this,"turbolinksReload",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"playerDivs",{enumerable:!0,configurable:!0,writable:!0,value:document.getElementsByClassName("js-twitch-player")}),Object.defineProperty(this,"startAll",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(0!==this.playerDivs.length)if(null==window.Twitch)this.initializeEmbed();else for(const e of this.playerDivs)e instanceof HTMLElement&&this.start(e)}}),document.addEventListener("turbolinks:load",this.startAll)}initializeEmbed(){var e;null===(e=this.turbolinksReload.load("https://player.twitch.tv/js/embed/v1.js"))||void 0===e||e.then(this.startAll)}noCookieDiv(e){return document.querySelector(`.js-twitch-player--no-cookie[data-player-id='${e}']`)}openPlayer(e){e.classList.contains("hidden")&&(e.classList.remove("hidden"),(0,z.U6)(this.noCookieDiv(e.id)))}start(e){if(null==window.Twitch||"true"===e.dataset.twitchPlayerStarted)return;e.dataset.twitchPlayerStarted="true";const t={channel:e.dataset.channel,height:"100%",width:"100%"};new window.Twitch.Player(e.id,t).addEventListener(window.Twitch.Player.PLAY,(()=>this.openPlayer(e)))}}var Ke=s(9755),Je=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class Xe{constructor(){Object.defineProperty(this,"pins",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),(0,r.rC)(this)}apiPin(e,t){const s=e.current_user_attributes.pin;if(null==s)throw new Error("can't pin score without current user attributes");return Ke.ajax((0,g.B)("score-pins.store"),{data:s,dataType:"json",method:t?"POST":"DELETE"}).done((0,r.aD)((()=>{this.markPinned(e,t),Ke.publish("score:pin",[t,e])})))}canBePinned(e){return null!=e.current_user_attributes.pin&&e.passed}isPinned(e){const t=e.current_user_attributes.pin;return null!=t&&(this.pins.has(t.score_id)||(0,r.z)((()=>{this.pins.set(t.score_id,t.is_pinned)})),this.pins.get(t.score_id))}markPinned(e,t){const s=e.current_user_attributes.pin;null!=s&&this.pins.set(s.score_id,t)}}Je([r.LO],Xe.prototype,"pins",void 0),Je([r.aD],Xe.prototype,"markPinned",null);var Qe=s(6808),Ye=s(9703),et=s(9755);class tt{constructor(e){Object.defineProperty(this,"captcha",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"callback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"show",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.callback=e,window.setTimeout((()=>{var e;et(document).trigger("gallery:close"),null===(e=et(".js-user-login--menu")[0])||void 0===e||e.click()}),0)}}),Object.defineProperty(this,"showIfGuest",{enumerable:!0,configurable:!0,writable:!0,value:e=>null==Ks.currentUser&&(this.show(e),!0)}),Object.defineProperty(this,"showOnError",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{var s;return 401===e.status&&"basic"===(null===(s=e.responseJSON)||void 0===s?void 0:s.authentication)&&(null!=Ks.currentUser?(0,_.sl)():this.show(t),!0)}}),Object.defineProperty(this,"clearError",{enumerable:!0,configurable:!0,writable:!0,value:()=>{et(".js-login-form--error").text("")}}),Object.defineProperty(this,"loginError",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{e.preventDefault(),e.stopPropagation(),et(".js-login-form--error").text((0,Ye.l5)(t));const s=this.captcha.findContainer(e.currentTarget);null!=s&&window.setTimeout((()=>{const e=t.responseJSON;var r;"object"==typeof(r=e)&&null!=r&&"captcha_triggered"in r&&e.captcha_triggered&&this.captcha.trigger(s),this.captcha.reset(s)}),0)}}),Object.defineProperty(this,"loginSuccess",{enumerable:!0,configurable:!0,writable:!0,value:(e,t,s,r)=>{if("application/javascript"===r.getResponseHeader("content-type"))return;const a=this.callback;null!=a?(this.reset(),this.refreshToken(),et.publish("user:update",t.user),window.setTimeout((()=>{var e;null===(e=et(".js-user-login--menu")[0])||void 0===e||e.click(),et(".js-user-header").replaceWith(t.header),et(".js-user-header-popup").html(t.header_popup),a()}),0)):(0,_.sl)()}}),Object.defineProperty(this,"onError",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{this.showOnError(t,(0,W.A$)(e.target))}}),Object.defineProperty(this,"refreshToken",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;const t=null!==(e=Qe.get("XSRF-TOKEN"))&&void 0!==e?e:null;et('[name="_token"]').attr("value",t),et('[name="csrf-token"]').attr("content",t)}}),Object.defineProperty(this,"reset",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.callback=void 0}}),Object.defineProperty(this,"showOnClick",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault(),this.show()}}),Object.defineProperty(this,"showOnLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{window.showLoginModal&&(window.showLoginModal=void 0,this.show())}}),Object.defineProperty(this,"showToContinue",{enumerable:!0,configurable:!0,writable:!0,value:e=>{if(null!=Ks.currentUser)return;e.preventDefault();const t=(0,W.A$)(e.target);window.setTimeout((()=>{this.show(t)}),0)}}),et(document).on("ajax:success",".js-login-form",this.loginSuccess).on("ajax:error",".js-login-form",this.loginError).on("submit",".js-login-form",this.clearError).on("input",".js-login-form-input",this.clearError).on("click",".js-user-link",this.showOnClick).on("click",".js-login-required--click",this.showToContinue).on("ajax:before",".js-login-required--click",(()=>null!=Ks.currentUser)).on("ajax:error",this.onError).on("turbolinks:load",this.showOnLoad),et.subscribe("nav:popup:hidden",this.reset)}}class st{}var rt=s(9755);class at{constructor(){Object.defineProperty(this,"handleUserLogin",{enumerable:!0,configurable:!0,writable:!0,value:()=>{(0,N.WI)(new st)}}),Object.defineProperty(this,"handleUserLogout",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=(0,l.W)(e.currentTarget.dataset.redirectHome);this.logout(t)}}),rt(document).on("ajax:success",".js-logout-link",this.handleUserLogout).on("ajax:success",".js-login-form",this.handleUserLogin)}logout(e=!1){localStorage.clear(),e?location.href=(0,g.B)("home"):location.reload()}}var it=s(9755),nt=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class ot{get blocks(){return null==this.core.currentUser?new Set:new Set(this.core.currentUser.blocks.map((e=>e.target_id)))}get following(){return null==this.core.currentUser?new Set:new Set(this.core.currentUser.follow_user_mapping)}get friends(){return null==this.core.currentUser?new Map:new Map(this.core.currentUser.friends.map((e=>[e.target_id,e])))}constructor(e){Object.defineProperty(this,"core",{enumerable:!0,configurable:!0,writable:!0,value:e}),(0,r.rC)(this)}isFriendWith(e){return null!=this.friends.get(e)}updateFollowUserMapping(e,t){const s=this.core.currentUser;null!=s&&(e?s.follow_user_mapping.push(t):(0,o.pull)(s.follow_user_mapping,t),it.publish("user:followUserMapping:refresh"))}}nt([r.Fl],ot.prototype,"blocks",null),nt([r.Fl],ot.prototype,"following",null),nt([r.Fl],ot.prototype,"friends",null),nt([r.aD],ot.prototype,"updateFollowUserMapping",null);const lt={audio_autoplay:!1,audio_muted:!1,audio_volume:.45,beatmapset_card_size:"normal",beatmapset_download:"all",beatmapset_show_nsfw:!1,beatmapset_title_show_original:!1,comments_show_deleted:!1,comments_sort:"new",forum_posts_show_deleted:!0,legacy_score_only:!0,profile_cover_expanded:!0,user_list_filter:"all",user_list_sort:"last_visit",user_list_view:"card"};var ct=s(9755),ut=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class dt{constructor(){Object.defineProperty(this,"current",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updatingOptions",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.current=Object.assign({},lt,this.fromStorage()),(0,r.rC)(this)}get(e){return this.current[e]}set(e,t){if(this.current[e]!==t&&(this.current[e]=t,localStorage.userPreferences=JSON.stringify(this.current),null!=this.user))return this.updatingOptions=!0,ct.ajax((0,g.B)("account.options"),{data:{user_profile_customization:{[e]:t}},dataType:"JSON",method:"PUT"}).done((e=>{ct.publish("user:update",e)})).fail((0,Ye.Gi)()).always((()=>{this.updatingOptions=!1}))}setUser(e){this.user=e,null==e||this.updatingOptions||(this.current=null==e?void 0:e.user_preferences)}fromStorage(){try{const e=localStorage.getItem("userPreferences");if(null!=e){const t=JSON.parse(e);if(null!=t&&"object"==typeof t)return t}}catch(e){}return{}}}ut([r.LO],dt.prototype,"current",void 0),ut([r.aD],dt.prototype,"set",null),ut([r.aD],dt.prototype,"setUser",null);var pt=s(9755);class mt{get inputBox(){return document.querySelector(".js-user-verification--input")}get message(){return document.querySelector(".js-user-verification--message")}get messageSpinner(){return document.querySelector(".js-user-verification--message-spinner")}get messageText(){return document.querySelector(".js-user-verification--message-text")}get reference(){return document.querySelector(".js-user-verification--reference")}constructor(){Object.defineProperty(this,"callback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"delayShow",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"delayShowCallback",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"request",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"showOnError",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{return 401===(s=e).status&&"verify"===(null===(r=s.responseJSON)||void 0===r?void 0:r.authentication)&&(this.show(e.responseJSON.box,t),!0);var s,r}}),Object.defineProperty(this,"autoSubmit",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;const t=this.inputBox;if(null==t)return;const s=t.value.replace(/\s/g,""),r=t.dataset.lastKey,a=parseInt(null!==(e=t.dataset.verificationKeyLength)&&void 0!==e?e:"",10);0===s.length&&this.setMessage(),a===s.length&&s!==r&&(t.dataset.lastKey=s,this.prepareForRequest("verifying"),this.request=pt.post((0,g.B)("account.verify"),{verification_key:s}).done(this.success).fail(this.error))}}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:e=>{this.setMessage((0,Ye.l5)(e))}}),Object.defineProperty(this,"float",{enumerable:!0,configurable:!0,writable:!0,value:(e,t,s)=>{e?(t.classList.add("js-user-verification--center"),t.style.paddingTop=""):(t.classList.remove("js-user-verification--center"),t.style.paddingTop=`${null!=s?s:0}px`)}}),Object.defineProperty(this,"isActive",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e;return null===(e=this.modal)||void 0===e?void 0:e.classList.contains("js-user-verification--active")}}),Object.defineProperty(this,"onError",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>this.showOnError(t,(0,W.A$)(e.target))}),Object.defineProperty(this,"prepareForRequest",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;null===(t=this.request)||void 0===t||t.abort(),this.setMessage((0,y.dW)(`user_verification.box.${e}`),!0)}}),Object.defineProperty(this,"reissue",{enumerable:!0,configurable:!0,writable:!0,value:e=>{e.preventDefault(),this.prepareForRequest("issuing"),this.request=pt.post((0,g.B)("account.reissue-code")).done((e=>{this.setMessage(e.message)})).fail(this.error)}}),Object.defineProperty(this,"reposition",{enumerable:!0,configurable:!0,writable:!0,value:()=>{var e,t;if(this.isActive()&&null!=this.modal)if(Ks.windowSize.isMobile)this.float(!0,this.modal);else{const s=null!==(t=null===(e=this.reference)||void 0===e?void 0:e.getBoundingClientRect().bottom)&&void 0!==t?t:0;this.float(s<0,this.modal,s)}}}),Object.defineProperty(this,"setDelayShow",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.delayShow=!0}}),Object.defineProperty(this,"setMessage",{enumerable:!0,configurable:!0,writable:!0,value:(e,t=!1)=>{const s=this.message;if(null==s)return;if(null==e||0===e.length)return void(0,z.U6)(s);const r=this.messageText,a=this.messageSpinner;null!=r&&null!=a&&(r.textContent=e,(0,z.Eo)(a,t),(0,z.Ji)(s))}}),Object.defineProperty(this,"setModal",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=document.querySelector(".js-user-verification");this.modal=e instanceof HTMLElement?e:void 0}}),Object.defineProperty(this,"show",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{this.delayShow?this.delayShowCallback=()=>this.show(e,t):(this.callback=t,null!=e&&pt(".js-user-verification--box").html(e),this.$modal().modal({backdrop:"static",keyboard:!1,show:!0}).addClass("js-user-verification--active"),this.reposition())}}),Object.defineProperty(this,"showOnLoad",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.delayShow=!1,null!=this.delayShowCallback?(this.delayShowCallback(),this.delayShowCallback=void 0):this.isVerificationPage()&&this.show()}}),Object.defineProperty(this,"success",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(!this.isActive()||null==this.modal)return;const e=this.inputBox;if(null==e)return;this.$modal().modal("hide"),this.modal.classList.remove("js-user-verification--active");const t=this.callback;if(this.callback=void 0,this.setMessage(),e.value="",e.dataset.lastKey="",this.isVerificationPage())return(0,_.sl)();null==t||t()}}),pt(document).on("ajax:error",this.onError).on("turbolinks:load",this.setModal).on("turbolinks:load",this.showOnLoad).on("turbolinks:visit",this.setDelayShow).on("input",".js-user-verification--input",this.autoSubmit).on("click",".js-user-verification--reissue",this.reissue),pt.subscribe("user-verification:success",this.success),pt(window).on("resize scroll",this.reposition)}$modal(){return pt(".js-user-verification")}isVerificationPage(){return null!=document.querySelector(".js-user-verification--on-load")}}var ht=s(9755);class bt{constructor(){Object.defineProperty(this,"createTooltip",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{ht(e).qtip({content:{text:t},hide:{delay:200,effect(){ht(this).fadeTo(110,0)},fixed:!0},position:{at:"top center",my:"bottom center",viewport:ht(window)},show:{delay:200,effect(){ht(this).fadeTo(110,1)},ready:!0},style:{classes:"tooltip-default tooltip-default--interactable"}})}}),Object.defineProperty(this,"showTooltip",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;if(!(e.currentTarget instanceof HTMLAnchorElement))return;const r=e.currentTarget,a=r.getAttribute("href");if(null==a)return;const i=null===(s=null===(t=document.querySelector(a))||void 0===t?void 0:t.firstElementChild)||void 0===s?void 0:s.cloneNode(!0);if(i instanceof HTMLParagraphElement){i.querySelectorAll("*").forEach((e=>{"doc-backlink"===e.getAttribute("role")?e.remove():e.removeAttribute("class")}));for(let e=i.childNodes.length-1;e>=0;e--){const t=i.childNodes[e];if(" "!==t.textContent)break;t.remove()}this.createTooltip(r,i)}}}),ht(document).on("mouseover",".js-reference-link",this.showTooltip)}}var ft=s(9755),vt=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class gt{constructor(){Object.defineProperty(this,"hasFocus",{enumerable:!0,configurable:!0,writable:!0,value:document.hasFocus()}),(0,r.rC)(this),ft(window).on("blur focus",(0,r.aD)((()=>this.hasFocus=document.hasFocus())))}}vt([r.LO],gt.prototype,"hasFocus",void 0);var yt=s(9755),wt=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class _t{get isDesktop(){return this.privateIsDesktop}get isMobile(){return!this.privateIsDesktop}constructor(){Object.defineProperty(this,"privateIsDesktop",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"handleResize",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.privateIsDesktop=window.matchMedia("(min-width: 900px)").matches;const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)}}),this.handleResize(),(0,r.rC)(this),yt(window).on("resize",this.handleResize)}}wt([r.LO],_t.prototype,"privateIsDesktop",void 0),wt([r.aD],_t.prototype,"handleResize",void 0);class Et{constructor(e=7500,t=18e5){Object.defineProperty(this,"initialDelay",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"maxDelay",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"current",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.current=Math.max(e,1)}get(){const e=this.current+(0,o.random)(5e3,2e4);return this.current=Math.min(2*this.current,this.maxDelay),e}reset(){this.current=this.initialDelay}}var Pt=s(2468),Ot=s(9755),jt=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let kt=class{get hasData(){return null!=this.firstLoadedAt}constructor(e){Object.defineProperty(this,"socketWorker",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"waitingVerification",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"firstLoadedAt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"retryDelay",{enumerable:!0,configurable:!0,writable:!0,value:new Et}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"loadMore",{enumerable:!0,configurable:!0,writable:!0,value:()=>{null==this.xhr&&(window.clearTimeout(this.timeout),this.xhr=Ot.ajax({dataType:"json",url:(0,g.B)("notifications.index",{unread:1})}),this.xhr.always((()=>{this.xhr=null})).done((e=>(0,r.z)((()=>{this.waitingVerification=!1,this.loadBundle(e),this.retryDelay.reset()})))).fail((e=>(0,r.z)((()=>{var t;"object"==typeof(t=e.responseJSON)&&null!=t&&"error"in t&&"string"==typeof t.error&&"verification"===e.responseJSON.error?this.waitingVerification=!0:401!==e.status&&this.delayedRetryInitialLoadMore()})))))}}),(0,r.N7)(this.socketWorker,"connectionStatus",(e=>{"connected"===e.newValue&&this.loadMore()}),!0),Ot.subscribe("user-verification:success.notifications-worker",(()=>{this.loadMore()})),(0,r.rC)(this)}handleDispatchAction(e){if(!(e instanceof T))return;const t=e.message;if("delete"===t.event){const e=new Date(t.data.timestamp);null!=this.firstLoadedAt&&e>this.firstLoadedAt&&(0,N.WI)(Pt.Ko.fromJson(t))}else if((e=>"new"===e.event)(t))(0,N.WI)(new Pt.d7(t.data));else if((e=>"read"===e.event)(t)){const e=new Date(t.data.timestamp);null!=this.firstLoadedAt&&e>this.firstLoadedAt&&(0,N.WI)(Pt.lE.fromJson(t))}}delayedRetryInitialLoadMore(){this.timeout=window.setTimeout(this.loadMore,this.retryDelay.get())}loadBundle(e){(0,N.WI)(new Pt.u9(e,{isWidget:!0})),null==this.firstLoadedAt&&(this.firstLoadedAt=new Date(e.timestamp))}};jt([r.LO],kt.prototype,"waitingVerification",void 0),jt([r.LO],kt.prototype,"firstLoadedAt",void 0),jt([r.Fl],kt.prototype,"hasData",null),jt([r.aD],kt.prototype,"loadBundle",null),kt=jt([N.yz],kt);const Nt=kt;class St{constructor(e){Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class Ct{constructor(e){Object.defineProperty(this,"connected",{enumerable:!0,configurable:!0,writable:!0,value:e})}}var Tt=s(9755),xt=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let Dt=class{get isConnected(){return"connected"===this.connectionStatus}constructor(){Object.defineProperty(this,"connectionStatus",{enumerable:!0,configurable:!0,writable:!0,value:"disconnected"}),Object.defineProperty(this,"hasConnectedOnce",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"userId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"active",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"retryDelay",{enumerable:!0,configurable:!0,writable:!0,value:new Et}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"ws",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"handleNewEvent",{enumerable:!0,configurable:!0,writable:!0,value:e=>{const t=this.parseMessageEvent(e);null!=t&&("logout"===t.event?(this.destroy(),Ks.userLoginObserver.logout()):(e=>"verified"===e.event)(t)?Tt.publish("user-verification:success"):(0,N.WI)(new T(t)))}}),Object.defineProperty(this,"reconnectWebSocket",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.connectionStatus="disconnected",this.active&&(this.timeout.connectWebSocket=window.setTimeout((0,r.aD)((()=>{this.ws=null,this.connectWebSocket()})),this.retryDelay.get()))}}),Object.defineProperty(this,"startWebSocket",{enumerable:!0,configurable:!0,writable:!0,value:()=>{if(null!=this.endpoint)return this.connectWebSocket();null==this.xhr&&(window.clearTimeout(this.timeout.startWebSocket),this.xhr=Tt.get((0,g.B)("notifications.endpoint")),this.xhr.always((()=>{this.xhr=null})).done((e=>{this.retryDelay.reset(),this.endpoint=e.url,this.connectWebSocket()})).fail((e=>{401!==e.status?this.timeout.startWebSocket=window.setTimeout(this.startWebSocket,this.retryDelay.get()):this.destroy()})))}}),(0,r.rC)(this),(0,r.U5)((()=>this.isConnected),(e=>(0,N.WI)(new Ct(e))),{fireImmediately:!0})}boot(){this.active=null!=this.userId,this.active&&this.startWebSocket()}handleDispatchAction(e){var t,s;(null===(t=this.ws)||void 0===t?void 0:t.readyState)===WebSocket.OPEN&&e instanceof St&&(null===(s=this.ws)||void 0===s||s.send(JSON.stringify(e.message)))}setUserId(e){e!==this.userId&&(this.active&&this.destroy(),this.userId=e,this.boot())}connectWebSocket(){if(!this.active||null==this.endpoint||null!=this.ws)return;this.connectionStatus="connecting",window.clearTimeout(this.timeout.connectWebSocket);const e=document.querySelector("meta[name=csrf-token]");if(null==e)return;const t=e.getAttribute("content");this.ws=new WebSocket(`${this.endpoint}?csrf=${t}`),this.ws.addEventListener("open",(0,r.aD)((()=>{this.retryDelay.reset(),this.connectionStatus="connected",this.hasConnectedOnce=!0}))),this.ws.addEventListener("close",this.reconnectWebSocket),this.ws.addEventListener("message",this.handleNewEvent)}destroy(){var e;this.connectionStatus="disconnecting",this.userId=null,this.active=!1,null===(e=this.xhr)||void 0===e||e.abort(),(0,o.forEach)(this.timeout,(e=>window.clearTimeout(e))),null!=this.ws&&(this.ws.close(),this.ws=null),this.connectionStatus="disconnected"}parseMessageEvent(e){try{const s=JSON.parse(e.data);if("object"==typeof(t=s)&&null!=t&&"event"in t)return s;console.error("message missing event type.")}catch(s){console.error("Failed parsing data:",e.data)}var t}};xt([r.LO],Dt.prototype,"connectionStatus",void 0),xt([r.LO],Dt.prototype,"hasConnectedOnce",void 0),xt([r.LO],Dt.prototype,"active",void 0),xt([r.Fl],Dt.prototype,"isConnected",null),xt([r.aD],Dt.prototype,"connectWebSocket",null),xt([r.aD],Dt.prototype,"destroy",null),xt([r.aD],Dt.prototype,"reconnectWebSocket",void 0),Dt=xt([N.yz],Dt);const Rt=Dt;var Mt=s(9755),It=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let Lt=class{constructor(e){Object.defineProperty(this,"beatmapsetStore",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"recommendedDifficulties",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"resultSets",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),(0,r.rC)(this)}cancel(){this.xhr&&this.xhr.abort()}get(e,t=0){if(t<0)throw Error("from must be > 0");const s=e.toKeyString(),a=this.getOrCreate(s);return t>0&&t<a.beatmapsetIds.size||0===t&&!a.isExpired?Promise.resolve(a):this.fetch(e,t).then((s=>(null!=s&&(0,r.z)((()=>{0===t&&a.reset(),this.updateBeatmapsetStore(s),a.append(s),this.recommendedDifficulties.set(e.mode,s.recommended_difficulty)})),a)))}getResultSet(e){const t=e.toKeyString();return this.getOrCreate(t)}handleDispatchAction(e){e instanceof st&&this.clear()}initialize(e,t){this.updateBeatmapsetStore(t);const s=e.toKeyString(),r=this.getOrCreate(s);null==r.fetchedAt&&(r.append(t),this.recommendedDifficulties.set(e.mode,t.recommended_difficulty))}clear(){this.resultSets.clear(),this.recommendedDifficulties.clear()}fetch(e,t){this.cancel();const s=e.queryParams,r=e.toKeyString(),a=this.getOrCreate(r).cursorString;if(t>0)if(null!=a)s.cursor_string=a;else if(null===a)return Promise.resolve(null);const i=(0,g.B)("beatmapsets.search");return this.xhr=Mt.ajax(i,{data:s,dataType:"json",method:"get"}),this.xhr}getOrCreate(e){let t=this.resultSets.get(e);return null==t&&(t=new n,this.resultSets.set(e,t)),t}updateBeatmapsetStore(e){for(const t of e.beatmapsets)this.beatmapsetStore.update(t)}};It([r.LO],Lt.prototype,"recommendedDifficulties",void 0),It([r.LO],Lt.prototype,"resultSets",void 0),It([r.aD],Lt.prototype,"get",null),It([r.aD],Lt.prototype,"initialize",null),It([r.aD],Lt.prototype,"clear",null),Lt=It([N.yz],Lt);class At{constructor(e){Object.defineProperty(this,"channelId",{enumerable:!0,configurable:!0,writable:!0,value:e})}}var $t=s(789),Bt=s(6192),Ut=s(8256),Ft=s(9711),Wt=s(849);class Ht{constructor(e){Object.defineProperty(this,"json",{enumerable:!0,configurable:!0,writable:!0,value:e})}}class Zt{constructor(e){Object.defineProperty(this,"channelStore",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lastHistoryId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"retryDelay",{enumerable:!0,configurable:!0,writable:!0,value:new Et(0,45e3)}),Object.defineProperty(this,"timerId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ping",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.xhr=(0,Wt.In)(this.channelStore.lastReceivedMessageId,this.lastHistoryId).done((e=>{var t;const s=null===(t=(0,o.maxBy)(e.silences,"id"))||void 0===t?void 0:t.id;null!=s&&(this.lastHistoryId=s),(0,N.WI)(new Ht(e.silences)),this.retryDelay.reset(),this.scheduleNextPing()})).fail((e=>{401!==e.status&&this.scheduleNextPing()}))}})}start(){null==this.timerId&&this.scheduleNextPing()}stop(){var e;null===(e=this.xhr)||void 0===e||e.abort(),this.retryDelay.reset(),null!=this.timerId&&(window.clearTimeout(this.timerId),this.timerId=void 0)}scheduleNextPing(){this.timerId=window.setTimeout(this.ping,this.retryDelay.get())}}var Gt=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class Vt{constructor(){Object.defineProperty(this,"channels",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"xhr",{enumerable:!0,configurable:!0,writable:!0,value:null}),(0,r.rC)(this)}load(){null==this.xhr&&(this.xhr=(0,Wt.vE)().done((e=>(0,r.z)((()=>{this.channels=e})))).fail((0,r.aD)((()=>{this.error=!0}))).always((0,r.aD)((()=>{this.xhr=null}))))}}Gt([r.LO],Vt.prototype,"channels",void 0),Gt([r.LO],Vt.prototype,"error",void 0),Gt([r.LO],Vt.prototype,"xhr",void 0),Gt([r.aD],Vt.prototype,"load",null);var zt=s(2918),qt=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n},Kt=function(e,t,s,r){return new(s||(s=Promise))((function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};let Jt=class{get isChatMounted(){return this.viewsMounted.size>0}get isAddingChannel(){return null!=this.waitAddChannelId}get joiningChannelId(){return"number"==typeof this.waitAddChannelId?this.waitAddChannelId:null}get joinedPublicChannelIds(){return new Set(this.channelStore.groupedChannels.PUBLIC.map((e=>e.channelId)))}get selectedChannel(){return"number"==typeof this.selected?this.channelStore.get(this.selected):null}get selectedChannelOrType(){return"number"==typeof this.selected?this.channelStore.get(this.selected):this.selected}get channelList(){return Bt.R9.flatMap((e=>this.channelStore.groupedChannels[e]))}constructor(e){Object.defineProperty(this,"channelStore",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"canChatAnnounce",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"createAnnouncement",{enumerable:!0,configurable:!0,writable:!0,value:new Ut.ZP}),Object.defineProperty(this,"isReady",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"publicChannels",{enumerable:!0,configurable:!0,writable:!0,value:new Vt}),Object.defineProperty(this,"skipRefresh",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"viewsMounted",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"isConnected",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lastHistoryId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"pingService",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"refocusToIndex",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"selected",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"waitAddChannelId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"handleBeforeCache",{enumerable:!0,configurable:!0,writable:!0,value:()=>{this.waitAddChannelId=null}}),this.pingService=new Zt(e),(0,r.rC)(this),document.addEventListener("turbolinks:before-cache",this.handleBeforeCache),(0,r.N7)(e.channels,(e=>{"delete"===e.type&&this.refocusSelectedChannel()})),(0,r.EH)((()=>{this.isReady&&this.isChatMounted?(this.pingService.start(),(0,N.WI)(new St({event:"chat.start"}))):(this.pingService.stop(),(0,N.WI)(new St({event:"chat.end"})))})),(0,r.EH)((()=>Kt(this,void 0,void 0,(function*(){this.isConnected&&this.isChatMounted&&(this.skipRefresh?this.skipRefresh=!1:yield this.updateChannelList(),(0,r.z)((()=>{var e;null===(e=this.selectedChannel)||void 0===e||e.load(),this.isReady=!0})))})))),(0,r.EH)((()=>{"join"!==this.selected||null!=this.publicChannels.channels||this.publicChannels.error||this.publicChannels.load()}))}addChannel(e){return Kt(this,void 0,void 0,(function*(){if(!this.isAddingChannel)try{if(null!=e){if(this.channelStore.channels.has(e))return void this.selectChannel(e);this.waitAddChannelId=e,yield(0,Wt.JJ)(e,Ks.currentUserOrFail.id)}else{if(!this.createAnnouncement.isValid)return;const e=this.createAnnouncement.toJson();this.waitAddChannelId=e.uuid,yield(0,Wt.C8)(e)}}catch(t){if((0,r.z)((()=>{this.waitAddChannelId=null})),!(0,Ye.bE)(t))throw t;(0,Ye.qQ)(t)}}))}handleDispatchAction(e){e instanceof x?this.handleChatChannelJoinEvent(e):e instanceof D?this.handleChatChannelPartEvent(e):e instanceof At?this.handleChatNewConversationAdded(e):e instanceof $t.Z?this.handleFriendUpdated(e):e instanceof Ct&&this.handleSocketStateChanged(e)}selectChannel(e,t="advanceHistory"){var s;if(this.waitAddChannelId=null,null===(s=this.selectedChannel)||void 0===s||s.throttledSendMarkAsRead(),this.selected=e,"string"==typeof e)return void this.updateUrl(e,t);if(null==e)return;const r=this.channelStore.get(e);null!=r&&(this.refocusToIndex=this.channelList.indexOf(r),r.load(),this.updateUrl(r,t))}selectFirst(){0!==this.channelList.length&&(this.selectChannel(this.channelList[0].channelId,null),zt.controller.replaceHistory((0,c.bj)(null,{channel_id:null,sendto:null})))}focusChannelAtIndex(e){if(0===this.channelList.length)return;const t=(0,o.clamp)(e,0,this.channelList.length-1),s=this.channelList[t];this.selectChannel(s.channelId)}handleChatChannelJoinEvent(e){const t=e.json;this.channelStore.update(t),("string"==typeof this.waitAddChannelId&&this.waitAddChannelId===t.uuid||"number"==typeof this.waitAddChannelId&&this.waitAddChannelId===t.channel_id)&&((0,Ft.Lt)(),this.selectChannel(t.channel_id),this.waitAddChannelId=null,"ANNOUNCE"===t.type&&this.createAnnouncement.clear())}handleChatChannelPartEvent(e){this.channelStore.partChannel(e.channelId,!1)}handleChatNewConversationAdded(e){this.selectChannel(e.channelId)}handleFriendUpdated(e){if(!this.isChatMounted)return;const t=this.channelStore.groupedChannels.PM.find((t=>t.pmTarget===e.userId));null==t||t.loadMetadata()}handleSocketStateChanged(e){this.isConnected=e.connected,e.connected||(this.channelStore.channels.forEach((e=>e.needsRefresh=!0)),this.isReady=!1)}refocusSelectedChannel(){"string"!=typeof this.selectedChannelOrType&&(null!=this.selectedChannelOrType?this.selectChannel(this.selectedChannelOrType.channelId):this.focusChannelAtIndex(this.refocusToIndex))}updateChannelList(){return Kt(this,void 0,void 0,(function*(){const e=yield(0,Wt.C4)(this.channelStore.lastReceivedMessageId,this.lastHistoryId);e&&(0,r.z)((()=>{var t;const s=null===(t=(0,o.maxBy)(e.silences,"id"))||void 0===t?void 0:t.id;null!=s&&(this.lastHistoryId=s),this.channelStore.updateWithChatUpdates(e)}))}))}updateUrl(e,t){var s;if(null==t)return;let r="";const a={channel_id:null,sendto:null};"string"==typeof e?r=e:e.newPmChannel?a.sendto=null===(s=e.pmTarget)||void 0===s?void 0:s.toString():a.channel_id=e.channelId.toString(),zt.controller[t]((0,c.bj)(null,a,r))}};qt([r.LO],Jt.prototype,"canChatAnnounce",void 0),qt([r.LO],Jt.prototype,"createAnnouncement",void 0),qt([r.LO],Jt.prototype,"isReady",void 0),qt([r.LO],Jt.prototype,"viewsMounted",void 0),qt([r.LO],Jt.prototype,"isConnected",void 0),qt([r.LO],Jt.prototype,"selected",void 0),qt([r.LO],Jt.prototype,"waitAddChannelId",void 0),qt([r.Fl],Jt.prototype,"joinedPublicChannelIds",null),qt([r.Fl],Jt.prototype,"channelList",null),qt([r.aD],Jt.prototype,"addChannel",null),qt([r.aD],Jt.prototype,"selectChannel",null),qt([r.aD],Jt.prototype,"selectFirst",null),qt([r.aD],Jt.prototype,"focusChannelAtIndex",null),qt([r.aD],Jt.prototype,"handleBeforeCache",void 0),qt([r.aD],Jt.prototype,"handleChatChannelJoinEvent",null),qt([r.aD],Jt.prototype,"handleChatChannelPartEvent",null),qt([r.aD],Jt.prototype,"handleChatNewConversationAdded",null),qt([r.aD],Jt.prototype,"handleFriendUpdated",null),qt([r.aD],Jt.prototype,"handleSocketStateChanged",null),qt([r.aD],Jt.prototype,"refocusSelectedChannel",null),qt([r.aD],Jt.prototype,"updateChannelList",null),Jt=qt([N.yz],Jt);const Xt=Jt;var Qt=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class Yt{constructor(){Object.defineProperty(this,"beatmapsets",{enumerable:!0,configurable:!0,writable:!0,value:r.LO.map()}),(0,r.rC)(this)}get(e){return this.beatmapsets.get(e)}handleDispatchAction(e){e instanceof st&&this.flushStore()}update(e){this.beatmapsets.set(e.id,e)}flushStore(){this.beatmapsets.clear()}}Qt([r.LO],Yt.prototype,"beatmapsets",void 0),Qt([r.aD],Yt.prototype,"update",null),Qt([r.aD],Yt.prototype,"flushStore",null);var es=s(8457),ts=s(7595),ss=s(9603),rs=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n},as=function(e,t,s,r){return new(s||(s=Promise))((function(a,i){function n(e){try{l(r.next(e))}catch(t){i(t)}}function o(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(n,o)}l((r=r.apply(e,t||[])).next())}))};function is(e,t){return e.name.localeCompare(t.name)}const ns={ANNOUNCE:is,GROUP:is,PM:(e,t)=>e.newPmChannel?-1:t.newPmChannel?1:e.lastMessageId===t.lastMessageId?0:e.lastMessageId>t.lastMessageId?-1:1,PUBLIC:is};let os=class{get groupedChannels(){const e=function(){const e={};for(const t of Bt.R9)e[t]=[];return e}();for(const t of this.channels.values())null!=t.supportedType&&e[t.supportedType].push(t);for(const t of Bt.R9)e[t]=e[t].sort(ns[t]);return e}constructor(){Object.defineProperty(this,"channels",{enumerable:!0,configurable:!0,writable:!0,value:r.LO.map()}),Object.defineProperty(this,"lastReceivedMessageId",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"ignoredChannels",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),(0,r.rC)(this)}addNewConversation(e,t){const s=this.update(e);return s.addMessages([ss.Z.fromJson(t)]),s}findPM(e){var t;if(e===(null===(t=Ks.currentUser)||void 0===t?void 0:t.id))return null;for(const[,s]of this.channels)if("PM"===s.type&&s.userIds.includes(e))return s;return null}flushStore(){this.channels.clear()}get(e){return this.channels.get(e)}handleDispatchAction(e){e instanceof R?this.handleChatMessageNewEvent(e):e instanceof es.O?this.handleChatMessageSendAction(e):e instanceof Ht&&this.handleChatUpdateSilences(e)}loadChannelEarlierMessages(e){var t;null===(t=this.get(e))||void 0===t||t.loadEarlierMessages()}partChannel(e,t=!0){const s=this.get(e);null!=s&&(e>0&&t&&(s.isHideable||this.ignoredChannels.add(e),(0,Wt.IQ)(e,Ks.currentUserOrFail.id).always((()=>this.ignoredChannels.delete(e)))),this.channels.delete(e))}update(e){const t=e.channel_id;let s=this.channels.get(t);return s||(s=new ts.Z(t),this.channels.set(t,s)),s.updateWithJson(e),this.ignoredChannels.delete(t),s}updateMany(e){this.ignoredChannels.clear(),(0,Bt.N)(e).forEach((e=>{this.update(e)})),this.channels.forEach((t=>{t.newPmChannel||e.find((e=>e.channel_id===t.channelId))||this.channels.delete(t.channelId)}))}updateWithChatUpdates(e){var t;if(null!=e.presence&&this.updateMany(e.presence),null!=e.messages){this.updateLastReceivedMessageId(e.messages);const s=(0,o.groupBy)(e.messages,"channel_id");for(const e of Object.keys(s)){const r=parseInt(e,10),a=s[r].map(ss.Z.fromJson);null===(t=this.channels.get(r))||void 0===t||t.addMessages(a)}}null!=e.silences&&(0,N.WI)(new Ht(e.silences))}handleChatMessageNewEvent(e){return as(this,void 0,void 0,(function*(){for(const s of e.json.messages){const e=this.channels.get(s.channel_id);if(null!=e)e.addMessage(s);else if(!this.ignoredChannels.has(s.channel_id))try{const e=yield(0,Wt.mr)(s.channel_id);this.update(e)}catch(t){if(!(0,Ye.bE)(t))throw t;404!==t.status&&(0,Ye.qQ)(t)}}this.updateLastReceivedMessageId(e.json.messages)}))}handleChatMessageSendAction(e){return as(this,void 0,void 0,(function*(){const t=e.message,s=this.get(t.channelId);if(null!=s){s.addSendingMessage(t);try{if(s.newPmChannel){const e=s.pmTarget;if(null==e)return void console.error("sendMessage:: userId not found?? this shouldn't happen");const a=yield(0,Wt.Ki)(e,t);(0,r.z)((()=>{this.channels.delete(t.channelId);const e=this.addNewConversation(a.channel,a.message);(0,N.WI)(new At(e.channelId))}))}else{const e=yield(0,Wt.bG)(t);s.afterSendMesssage(t,e)}}catch(a){if(s.afterSendMesssage(t,null),!(0,Ye.bE)(a))throw a;(0,Ye.qQ)(a)}}else console.error("channel missing")}))}handleChatUpdateSilences(e){const t=new Set(e.json.map((e=>e.user_id)));this.removePublicMessagesFromUserIds(t)}removePublicMessagesFromUserIds(e){this.groupedChannels.PUBLIC.forEach((t=>{t.removeMessagesFromUserIds(e)}))}updateLastReceivedMessageId(e){var t,s;null!=e&&(this.lastReceivedMessageId=null!==(s=null===(t=(0,o.maxBy)(e,"message_id"))||void 0===t?void 0:t.message_id)&&void 0!==s?s:this.lastReceivedMessageId)}};rs([r.LO],os.prototype,"channels",void 0),rs([r.Fl],os.prototype,"groupedChannels",null),rs([r.aD],os.prototype,"addNewConversation",null),rs([r.aD],os.prototype,"flushStore",null),rs([r.aD],os.prototype,"loadChannelEarlierMessages",null),rs([r.aD],os.prototype,"partChannel",null),rs([r.aD],os.prototype,"update",null),rs([r.aD],os.prototype,"updateMany",null),rs([r.aD],os.prototype,"updateWithChatUpdates",null),rs([r.aD],os.prototype,"handleChatMessageNewEvent",null),rs([r.aD],os.prototype,"handleChatMessageSendAction",null),rs([r.aD],os.prototype,"handleChatUpdateSilences",null),rs([r.aD],os.prototype,"removePublicMessagesFromUserIds",null),rs([r.aD],os.prototype,"updateLastReceivedMessageId",null),os=rs([N.yz],os);const ls=os;var cs=s(9755),us=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class ds{constructor(e){Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isRevoking",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"revoked",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"scopes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=e.id,this.name=e.name,this.scopes=new Set(e.scopes),this.userId=e.user_id,this.user=e.user,(0,r.rC)(this)}revoke(){this.isRevoking=!0;const e=cs.ajax({method:"DELETE",url:(0,g.B)("oauth.authorized-clients.destroy",{authorized_client:this.id})});return e.done((0,r.aD)((()=>{this.revoked=!0}))).always((0,r.aD)((()=>{this.isRevoking=!1}))),e}}us([r.LO],ds.prototype,"isRevoking",void 0),us([r.LO],ds.prototype,"revoked",void 0),us([r.LO],ds.prototype,"scopes",void 0),us([r.aD],ds.prototype,"revoke",null);var ps=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class ms{constructor(){Object.defineProperty(this,"clients",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),(0,r.rC)(this)}handleDispatchAction(e){e instanceof st&&this.flushStore()}initialize(e){for(const t of e){const e=new ds(t);this.clients.set(e.id,e)}}flushStore(){this.clients.clear()}}ps([r.LO],ms.prototype,"clients",void 0),ps([r.aD],ms.prototype,"flushStore",null);var hs=s(7417),bs=s(1882),fs=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class vs{get canMarkAsRead(){for(const[,e]of this.notifications)if(e.canMarkRead)return!0;return!1}get first(){var e;return null!==(e=this.orderedNotifications[0])&&void 0!==e?e:this.lastNotification}get hasMore(){return!(this.notifications.size>=this.total||null==this.cursor)}get hasVisibleNotifications(){return this.notifications.size>0}get id(){return`${this.objectType}-${this.objectId}-${this.category}`}get identity(){return{category:this.category,objectId:this.objectId,objectType:this.objectType}}get isSingle(){return 1===this.total}get orderedNotifications(){return[...this.notifications.values()].sort(((e,t)=>t.id-e.id))}get type(){return this.objectType}constructor(e,t,s,a){Object.defineProperty(this,"objectId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"objectType",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"category",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"resolver",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"cursor",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"displayOrder",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"isDeleting",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isLoading",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isMarkingAsRead",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"notifications",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"total",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"lastNotification",{enumerable:!0,configurable:!0,writable:!0,value:null}),(0,r.rC)(this)}static fromJson(e,t){const s=new vs(e.object_id,e.object_type,e.category,t);return s.updateWithJson(e),s}add(e){this.notifications.set(e.id,e),this.displayOrder=Math.max(e.id,this.displayOrder)}delete(){this.resolver.delete(this)}deleteItem(e){null!=e&&this.notifications.has(e.id)&&this.resolver.delete(e)}loadMore(e){null!=this.cursor&&(this.isLoading=!0,this.resolver.loadMore(this.identity,e,this.cursor).always((0,r.aD)((()=>{this.isLoading=!1}))))}markAsRead(e){null!=e&&this.notifications.has(e.id)&&this.resolver.queueMarkAsRead(e)}markStackAsRead(){this.resolver.queueMarkAsRead(this)}remove(e){1===this.notifications.size&&(this.lastNotification=this.notifications.values().next().value);const t=this.notifications.delete(e.id);return t&&this.total--,t}updateWithJson(e){this.cursor=e.cursor,this.total=e.total}}fs([r.LO],vs.prototype,"cursor",void 0),fs([r.LO],vs.prototype,"displayOrder",void 0),fs([r.LO],vs.prototype,"isDeleting",void 0),fs([r.LO],vs.prototype,"isLoading",void 0),fs([r.LO],vs.prototype,"isMarkingAsRead",void 0),fs([r.LO],vs.prototype,"notifications",void 0),fs([r.LO],vs.prototype,"total",void 0),fs([r.LO],vs.prototype,"lastNotification",void 0),fs([r.Fl],vs.prototype,"canMarkAsRead",null),fs([r.Fl],vs.prototype,"first",null),fs([r.Fl],vs.prototype,"hasMore",null),fs([r.Fl],vs.prototype,"hasVisibleNotifications",null),fs([r.Fl],vs.prototype,"id",null),fs([r.Fl],vs.prototype,"isSingle",null),fs([r.Fl],vs.prototype,"orderedNotifications",null),fs([r.aD],vs.prototype,"add",null),fs([r.aD],vs.prototype,"delete",null),fs([r.aD],vs.prototype,"deleteItem",null),fs([r.aD],vs.prototype,"loadMore",null),fs([r.aD],vs.prototype,"markAsRead",null),fs([r.aD],vs.prototype,"markStackAsRead",null),fs([r.aD],vs.prototype,"remove",null),fs([r.aD],vs.prototype,"updateWithJson",null);var gs=s(7581),ys=s(4927),ws=s(9755),_s=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class Es{constructor(){Object.defineProperty(this,"debouncedDeleteByIds",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.debounce)((()=>this.deleteByIds()),500)}),Object.defineProperty(this,"debouncedSendQueuedMarkedAsRead",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.debounce)((()=>this.sendQueuedMarkedAsRead()),500)}),Object.defineProperty(this,"deleteByIdsQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"queuedMarkedAsRead",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"queuedMarkedAsReadIdentities",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),(0,r.rC)(this)}delete(e){if(e.isDeleting=!0,e instanceof bs.Z)return this.deleteByIdsQueue.set(e.id,e),void this.debouncedDeleteByIds();ws.ajax({data:{identities:[(0,hs.Qs)(e.identity)]},dataType:"json",method:"DELETE",url:(0,g.B)("notifications.index")}).done((0,r.aD)((()=>{(0,N.WI)(new Pt.Ko([e.identity],0))}))).fail(Ye.qQ).always((0,r.aD)((()=>e.isDeleting=!1)))}loadMore(e,t,s){const r=(0,hs.Qs)(e);delete r.id;const a=(0,g.B)("notifications.index",r),i={data:{cursor:s,unread:t.isWidget},dataType:"json",url:a};return ws.ajax(i).then((e=>{(0,N.WI)(new Pt.u9(e,t))}))}queueMarkAsRead(e){e.isMarkingAsRead=!0;const t=e.identity;"stack"!==(0,hs._n)(t)?(e instanceof bs.Z&&e.canMarkRead?this.queuedMarkedAsRead.set(e.id,e):this.queuedMarkedAsReadIdentities.set((0,hs.BB)(t),e),this.debouncedSendQueuedMarkedAsRead()):this.sendMarkAsReadRequest({identities:[(0,hs.Qs)(e.identity)]}).then((0,r.aD)((()=>{(0,N.WI)(new Pt.lE([t],0))}))).always((0,r.aD)((()=>e.isMarkingAsRead=!1)))}deleteByIds(){if(0===this.deleteByIdsQueue.size)return;const e=[...this.deleteByIdsQueue.values()],t=e.map((e=>e.identity));this.deleteByIdsQueue.clear(),ws.ajax({data:{notifications:t.map(hs.Qs)},dataType:"json",method:"DELETE",url:(0,g.B)("notifications.index")}).then((0,r.aD)((()=>{(0,N.WI)(new Pt.Ko(t,0))}))).always((0,r.aD)((()=>e.forEach((e=>e.isDeleting=!1)))))}sendMarkAsReadRequest(e){const t=ws.ajax({data:e,dataType:"json",method:"POST",url:(0,g.B)("notifications.mark-read")});return t.fail(Ye.qQ),t}sendQueuedMarkedAsRead(){if(this.queuedMarkedAsRead.size>0){const e=[...this.queuedMarkedAsRead.values()],t=e.map((e=>e.identity));this.queuedMarkedAsRead.clear(),this.sendMarkAsReadRequest({notifications:t.map(hs.Qs)}).then((0,r.aD)((()=>{(0,N.WI)(new Pt.lE(t,0))}))).always((0,r.aD)((()=>e.forEach((e=>e.isMarkingAsRead=!1)))))}if(this.queuedMarkedAsReadIdentities.size>0){const e=[...this.queuedMarkedAsReadIdentities.values()],t=e.map((e=>e.identity));this.queuedMarkedAsReadIdentities.clear(),this.sendMarkAsReadRequest({identities:t.map(hs.Qs)}).then((0,r.aD)((()=>{(0,N.WI)(new Pt.lE(t,0))}))).always((0,r.aD)((()=>e.forEach((e=>e.isMarkingAsRead=!1)))))}}}_s([r.aD],Es.prototype,"delete",null),_s([r.aD],Es.prototype,"loadMore",null),_s([r.aD],Es.prototype,"queueMarkAsRead",null);var Ps=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let Os=class{get allStacks(){return this.allType.stacks}get allType(){return this.getOrCreateType({objectType:null})}get isEmpty(){return 1===this.types.size&&0===this.allStacks.size}get total(){return this.allType.total}set total(e){this.allType.total=e}constructor(e){Object.defineProperty(this,"notificationStore",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"types",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"deletedStacks",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"resolver",{enumerable:!0,configurable:!0,writable:!0,value:new Es}),Object.defineProperty(this,"removeByNotification",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t,s;if(null==e.id)return;const r=this.getStack(e),a=this.getOrCreateType(e),i=null==r?void 0:r.notifications.get(e.id);null==i?null!=r&&e.id<(null!==(s=null===(t=r.cursor)||void 0===t?void 0:t.id)&&void 0!==s?s:0)&&(this.total--,r.total--,a.total--):(null==r||r.remove(i),a.total--,this.total--)}}),this.getOrCreateType({objectType:null}),(0,r.rC)(this)}flushStore(){this.types.clear()}getOrCreateType(e){let t=this.types.get(e.objectType);return null==t&&(t=new gs.ZP(e.objectType,this.resolver),this.types.set(t.name,t)),t}getStack(e){var t;return null===(t=this.types.get(e.objectType))||void 0===t?void 0:t.stacks.get((0,hs.$w)(e))}handleDispatchAction(e){e instanceof Pt.Ko?this.handleNotificationEventDelete(e):e instanceof Pt.d7?this.handleNotificationEventNew(e):e instanceof Pt.u9?this.handleNotificationEventMoreLoaded(e):e instanceof Pt.lE?this.handleNotificationEventRead(e):e instanceof st&&this.flushStore()}handleNotificationEventDelete(e){this.removeByEvent(e)}handleNotificationEventMoreLoaded(e){e.context.isWidget||this.updateWithBundle(e.data)}handleNotificationEventNew(e){const t=e.data;let s=this.notificationStore.get(t.id);null==s?(s=bs.Z.fromJson(t),this.notificationStore.add(s)):s.updateFromJson(t);const r=s.identity,a=this.getOrCreateType(r);let i=this.getStack(r);null==i&&(i=new vs(t.object_id,t.object_type,(0,ys.Yg)(t.name),this.resolver)),i.notifications.has(s.id)||(i.total++,a.total++,this.total++),i.add(s),a.stacks.set(i.id,i),this.allStacks.set(i.id,i)}handleNotificationEventRead(e){}orderedStacksOfType(e){return this.stacksOfType(e).sort(((e,t)=>t.displayOrder-e.displayOrder))}removeByEvent(e){for(const t of e.data){switch((0,hs._n)(t)){case"type":this.removeByType(t);break;case"stack":this.removeByStack(t,e.readCount);break;case"notification":this.removeByNotification(t)}}}stacksOfType(e){var t,s;const r=this.types.get(e),a=[];if(null==r)return a;const i=null!==(s=null===(t=r.cursor)||void 0===t?void 0:t.id)&&void 0!==s?s:0;for(const[,n]of r.stacks)void 0!==(null==r?void 0:r.cursor)&&n.displayOrder>=i&&a.push(n);return a}updateWithBundle(e){var t,s,r;null===(t=e.types)||void 0===t||t.forEach((e=>this.updateWithTypeJson(e))),null===(s=e.stacks)||void 0===s||s.forEach((e=>this.updateWithStackJson(e))),null===(r=e.notifications)||void 0===r||r.forEach((e=>this.updateWithNotificationJson(e)))}removeByStack(e,t){const s=this.getStack(e),r=(0,hs.$w)(e);if(null==s)return void(this.deletedStacks.has(r)||(this.deletedStacks.add(r),this.total-=t));this.deletedStacks.add(r),this.allStacks.delete(r),this.total-=s.total;this.getOrCreateType(e).removeStack(s)}removeByType(e){const t=this.getOrCreateType(e);if(null===t.name){for(const[e,t]of this.types)null!==e&&this.removeType(t);t.total=0}else this.removeType(t)}removeType(e){e.stacks.forEach((e=>{this.allType.removeStack(e)})),e.total=0,this.types.delete(e.name)}updateWithNotificationJson(e){var t;let s=this.notificationStore.get(e.id);null==s?(s=bs.Z.fromJson(e),this.notificationStore.add(s)):s.updateFromJson(e);null===(t=this.getOrCreateType(s.identity).stacks.get(s.stackId))||void 0===t||t.add(s)}updateWithStackJson(e){const t=this.getOrCreateType((0,hs.xZ)(e));let s=t.stacks.get(function(e){return`${e.object_type}-${e.object_id}-${e.category}`}(e));null==s?(s=vs.fromJson(e,this.resolver),t.stacks.set(s.id,s),this.allType.stacks.set(s.id,s)):s.updateWithJson(e)}updateWithTypeJson(e){this.getOrCreateType({objectType:e.name}).updateWithJson(e)}};Ps([r.LO],Os.prototype,"types",void 0),Ps([r.Fl],Os.prototype,"total",null),Ps([r.aD],Os.prototype,"flushStore",null),Ps([r.aD],Os.prototype,"getOrCreateType",null),Ps([r.aD],Os.prototype,"handleDispatchAction",null),Ps([r.aD],Os.prototype,"handleNotificationEventDelete",null),Ps([r.aD],Os.prototype,"handleNotificationEventMoreLoaded",null),Ps([r.aD],Os.prototype,"handleNotificationEventNew",null),Ps([r.aD],Os.prototype,"handleNotificationEventRead",null),Ps([r.aD],Os.prototype,"removeByEvent",null),Ps([r.aD],Os.prototype,"updateWithBundle",null),Os=Ps([N.yz],Os);const js=Os;var ks=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let Ns=class extends js{handleNotificationEventMoreLoaded(e){e.context.isWidget&&this.updateWithBundle(e.data)}handleNotificationEventNew(e){e.data.is_read||super.handleNotificationEventNew(e)}handleNotificationEventRead(e){this.removeByEvent(e)}updateWithBundle(e){super.updateWithBundle(e),null!=e.unread_count&&(this.total=e.unread_count)}};ks([r.KG],Ns.prototype,"handleNotificationEventMoreLoaded",null),ks([r.KG],Ns.prototype,"handleNotificationEventNew",null),ks([r.KG],Ns.prototype,"handleNotificationEventRead",null),ks([r.KG],Ns.prototype,"updateWithBundle",null),Ns=ks([N.yz],Ns);const Ss=Ns;var Cs=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let Ts=class{constructor(){Object.defineProperty(this,"notifications",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"stacks",{enumerable:!0,configurable:!0,writable:!0,value:new js(this)}),Object.defineProperty(this,"unreadStacks",{enumerable:!0,configurable:!0,writable:!0,value:new Ss(this)}),(0,r.rC)(this)}add(e){this.notifications.set(e.id,e)}flushStore(){this.notifications.clear()}get(e){return this.notifications.get(e)}handleDispatchAction(e){e instanceof Pt.Ko?this.handleNotificationEventDelete(e):e instanceof Pt.lE?this.handleNotificationEventRead(e):e instanceof st&&this.flushStore()}handleNotificationEventDelete(e){this.eachByEvent(e,(e=>{this.notifications.delete(e.id)}))}handleNotificationEventRead(e){this.eachByEvent(e,(e=>{e.isRead=!0}))}eachByEvent(e,t){for(const s of e.data){switch((0,hs._n)(s)){case"type":this.eachByType(s,t);break;case"stack":this.eachByStack(s,t);break;case"notification":{if(null==s.id)return;const e=this.get(s.id);null!=e&&t(e);break}}}}eachByStack(e,t){const s=(0,hs.$w)(e);this.notifications.forEach((e=>{e.stackId===s&&t(e)}))}eachByType(e,t){this.notifications.forEach((s=>{null!=e.objectType&&s.objectType!==e.objectType||t(s)}))}};Cs([r.LO],Ts.prototype,"notifications",void 0),Cs([r.aD],Ts.prototype,"add",null),Cs([r.aD],Ts.prototype,"flushStore",null),Cs([r.aD],Ts.prototype,"handleDispatchAction",null),Cs([r.aD],Ts.prototype,"handleNotificationEventDelete",null),Cs([r.aD],Ts.prototype,"handleNotificationEventRead",null),Ts=Cs([N.yz],Ts);const xs=Ts;var Ds=s(9755),Rs=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class Ms extends ds{get redirect(){return this.redirectOrig.replace(/,/g,"\r\n")}constructor(e){super(e),Object.defineProperty(this,"isResetting",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"isUpdating",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"secret",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"redirectOrig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.redirectOrig=e.redirect,this.secret=e.secret,(0,r.rC)(this)}delete(){this.isRevoking=!0;const e=Ds.ajax({method:"DELETE",url:(0,g.B)("oauth.clients.destroy",{client:this.id})});return e.done((0,r.aD)((()=>{this.revoked=!0}))).always((0,r.aD)((()=>{this.isRevoking=!1}))),e}resetSecret(){this.isResetting=!0;const e=Ds.ajax({method:"POST",url:(0,g.B)("oauth.clients.reset-secret",{client:this.id})});return e.done((e=>{this.updateFromJson(e)})).always((0,r.aD)((()=>{this.isResetting=!1}))),e}updateFromJson(e){this.id=e.id,this.name=e.name,this.scopes=new Set(e.scopes),this.userId=e.user_id,this.user=e.user,this.redirectOrig=e.redirect,this.secret=e.secret}updateWith(e){const{redirect:t}=e;this.isUpdating=!0;const s=Ds.ajax({data:{redirect:t},method:"PUT",url:(0,g.B)("oauth.clients.update",{client:this.id})});return s.done((e=>{this.updateFromJson(e)})).always((0,r.aD)((()=>{this.isUpdating=!1}))),s}}Rs([r.LO],Ms.prototype,"isResetting",void 0),Rs([r.LO],Ms.prototype,"isUpdating",void 0),Rs([r.LO],Ms.prototype,"redirectOrig",void 0),Rs([r.Fl],Ms.prototype,"redirect",null),Rs([r.aD],Ms.prototype,"delete",null),Rs([r.aD],Ms.prototype,"resetSecret",null),Rs([r.aD],Ms.prototype,"updateFromJson",null),Rs([r.aD],Ms.prototype,"updateWith",null);var Is=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class Ls{constructor(){Object.defineProperty(this,"clients",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),(0,r.rC)(this)}handleDispatchAction(e){e instanceof st&&this.flushStore()}initialize(e){for(const t of e)this.updateWithJson(t)}updateWithJson(e){const t=new Ms(e);return this.clients.set(t.id,t),t}flushStore(){this.clients.clear()}}Is([r.LO],Ls.prototype,"clients",void 0),Is([r.aD],Ls.prototype,"updateWithJson",null),Is([r.aD],Ls.prototype,"flushStore",null);var As=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class $s{constructor(){Object.defineProperty(this,"account",{enumerable:!0,configurable:!0,writable:!0,value:{client:null,isCreatingNewClient:!1,newClientVisible:!1}}),(0,r.rC)(this)}}As([r.LO],$s.prototype,"account",void 0);var Bs=s(8125),Us=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let Fs=class{constructor(){Object.defineProperty(this,"users",{enumerable:!0,configurable:!0,writable:!0,value:r.LO.map()}),(0,r.rC)(this)}flushStore(){this.users=r.LO.map()}get(e){return this.users.get(e)}handleDispatchAction(e){e instanceof R&&this.updateMany(e.json.users)}update(e){const t=e.id;let s=this.users.get(t);return null==s&&(s=new Bs.ZP(t),this.users.set(t,s)),s.updateWithJson(e),s}updateMany(e){if(null!=e)for(const t of e)this.update(t)}};Us([r.LO],Fs.prototype,"users",void 0),Us([r.aD],Fs.prototype,"flushStore",null),Us([r.aD],Fs.prototype,"update",null),Us([r.aD],Fs.prototype,"updateMany",null),Fs=Us([N.yz],Fs);const Ws=Fs;class Hs{constructor(){Object.defineProperty(this,"beatmapsetSearch",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"beatmapsetStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channelStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatState",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"notificationStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ownClientStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"uiState",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.beatmapsetStore=new Yt,this.beatmapsetSearch=new Lt(this.beatmapsetStore),this.clientStore=new ms,this.notificationStore=new xs,this.ownClientStore=new Ls,this.userStore=new Ws,this.channelStore=new ls,this.chatState=new Xt(this.channelStore),this.uiState=new $s}}var Zs=s(8278),Gs=s(9755),Vs=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class zs{get currentUserOrFail(){if(null==this.currentUser)throw new Error("current user is null");return this.currentUser}constructor(){Object.defineProperty(this,"accountEditBlocklist",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"beatmapsetSearchController",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"browserTitleWithNotificationCount",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"captcha",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatWorker",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clickMenu",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentUser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentUserModel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"currentUserObserver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dataStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"enchant",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fixRelativeLink",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"forumPoll",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"forumPostEdit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"forumPostInput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"forumPostReport",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"localtime",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mobileToggle",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"notificationsWorker",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"osuAudio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reactTurbolinks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"referenceLinkTooltip",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scorePins",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"socketWorker",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stickyFooter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stickyHeader",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"syncHeight",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeago",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"turbolinksReload",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"twitchPlayer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userLogin",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userLoginObserver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userPreferences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"userVerification",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"windowFocusObserver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"windowSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"updateCurrentUser",{enumerable:!0,configurable:!0,writable:!0,value:()=>{const e=(0,Zs.Um)("json-current-user",!0);null!=e&&this.setCurrentUser(e)}}),Object.defineProperty(this,"onCurrentUserUpdate",{enumerable:!0,configurable:!0,writable:!0,value:(e,t)=>{this.setCurrentUser(t)}}),Object.defineProperty(this,"setCurrentUser",{enumerable:!0,configurable:!0,writable:!0,value:e=>{var t;const s=null==e.id?void 0:e;null!=s&&this.dataStore.userStore.update(s),this.socketWorker.setUserId(null!==(t=null==s?void 0:s.id)&&void 0!==t?t:null),this.currentUser=s,window.currentUser=e,this.userPreferences.setUser(this.currentUser)}});const e="loading"===document.readyState;e&&document.addEventListener("DOMContentLoaded",this.updateCurrentUser),Gs.subscribe("user:update",this.onCurrentUserUpdate),this.captcha=new V,this.chatWorker=new A,this.clickMenu=new J,this.currentUserObserver=new Y(this),this.currentUserModel=new ot(this),this.fixRelativeLink=new ae,this.forumPoll=new ne,this.forumPostEdit=new le,this.forumPostInput=new de,this.forumPostReport=new he,this.localtime=new fe,this.mobileToggle=new ye,this.browserTitleWithNotificationCount=new Z(this),this.referenceLinkTooltip=new bt,this.scorePins=new Xe,this.stickyFooter=new $e,this.stickyHeader=new Ue,this.syncHeight=new We,this.timeago=new Ge,this.turbolinksReload=new ze,this.userPreferences=new dt,this.userVerification=new mt,this.windowSize=new _t,this.enchant=new se(this.turbolinksReload),this.osuAudio=new xe(this.userPreferences),this.reactTurbolinks=new Le(this,this.turbolinksReload),this.twitchPlayer=new qe(this.turbolinksReload),this.userLogin=new tt(this.captcha),this.dataStore=new Hs,this.accountEditBlocklist=new F(this),this.userLoginObserver=new at,this.windowFocusObserver=new gt,this.beatmapsetSearchController=new k(this.dataStore.beatmapsetSearch),this.socketWorker=new Rt,this.notificationsWorker=new Nt(this.socketWorker),(0,r.rC)(this),e||this.updateCurrentUser()}}Vs([r.LO],zs.prototype,"currentUser",void 0),Vs([r.Fl],zs.prototype,"currentUserOrFail",null),Vs([r.aD],zs.prototype,"setCurrentUser",void 0);const qs=new zs;window.osuCore=qs;const Ks=qs},6185:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(4001),a=s(381),i=s(7294),n=s(3336),o=s(3924);class l extends i.PureComponent{render(){return 0===this.props.badges.length?null:i.createElement("div",{className:(0,n.sb)("profile-badges",this.props.modifiers)},this.props.badges.map((e=>{const t=(0,o.W)(e.awarded_at)?`<div>${e.description}</div>\n            <div class='profile-badges__date'>${a(e.awarded_at).format("LL")}</div>`:null,s=i.createElement(r.Z,{className:"profile-badges__badge","data-html-title":t,src:e.image_url,title:e.description});return(0,o.W)(e.url)?i.createElement("a",{key:e.image_url,href:e.url},s):i.createElement("span",{key:e.image_url},s)})))}}Object.defineProperty(l,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{badges:[]}});const c=l},3685:(e,t,s)=>{s.d(t,{Z:()=>g});var r=s(5523),a=s(6741),i=s(4929),n=s(6407),o=s(5119),l=s(6486),c=s(8949),u=s(9323),d=s(5078),p=s(7294),m=s(3336),h=s(1270),b=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};function f(){}let v=class extends p.Component{get showCover(){return d.Z.userPreferences.get("profile_cover_expanded")}constructor(e){super(e),Object.defineProperty(this,"onCoverExpandedToggle",{enumerable:!0,configurable:!0,writable:!0,value:()=>{d.Z.userPreferences.set("profile_cover_expanded",!this.showCover)}}),(0,c.rC)(this)}render(){var e,t;return p.createElement("div",{className:(0,m.sb)("profile-info",this.props.modifiers,{cover:this.showCover})},this.showCover&&p.createElement("div",{className:"profile-info__bg",style:{backgroundImage:(0,m.eF)(this.props.coverUrl)}},this.props.isUpdatingCover&&p.createElement("div",{className:"profile-info__spinner"},p.createElement(a.$,null)),this.props.editor),p.createElement("div",{className:"profile-info__details"},this.props.user.id===(null===(e=d.Z.currentUser)||void 0===e?void 0:e.id)?p.createElement("a",{className:"profile-info__avatar",href:`${(0,o.B)("account.edit")}#avatar`,title:(0,h.dW)("users.show.change_avatar")},this.renderAvatar()):p.createElement("div",{className:"profile-info__avatar"},this.renderAvatar()),p.createElement("div",{className:"profile-info__info"},p.createElement("h1",{className:"profile-info__name"},p.createElement("span",{className:"u-ellipsis-pre-overflow"},this.props.user.username),p.createElement("div",{className:"profile-info__previous-usernames"},this.renderPreviousUsernames()),p.createElement("div",{className:"profile-info__icons profile-info__icons--name-inline"},this.renderIcons())),this.renderTitle(),p.createElement("div",{className:"profile-info__flags"},null!=(null===(t=this.props.user.country)||void 0===t?void 0:t.code)&&p.createElement("a",{className:"profile-info__flag",href:(0,o.B)("rankings",{country:this.props.user.country.code,mode:this.props.currentMode,type:"performance"})},p.createElement("span",{className:"profile-info__flag-flag"},p.createElement(r.Z,{country:this.props.user.country})),p.createElement("span",{className:"profile-info__flag-text"},this.props.user.country.name)),p.createElement("div",{className:"profile-info__icons profile-info__icons--flag-inline"},this.renderIcons()))),p.createElement("div",{className:"profile-info__cover-toggle"},p.createElement("button",{className:"btn-circle btn-circle--page-toggle",onClick:this.onCoverExpandedToggle,title:(0,h.dW)("users.show.cover.to_"+(this.showCover?"0":"1")),type:"button"},p.createElement("span",{className:this.showCover?"fas fa-chevron-up":"fas fa-chevron-down"})))))}renderAvatar(){return p.createElement(i.Z,{modifiers:"full",user:this.props.user})}renderIcons(){var e;return p.createElement(p.Fragment,null,this.props.user.is_supporter&&p.createElement("a",{className:"profile-info__icon profile-info__icon--supporter",href:(0,o.B)("support-the-game"),title:(0,h.dW)("users.show.is_supporter")},(0,l.times)(null!==(e=this.props.user.support_level)&&void 0!==e?e:0,(e=>p.createElement("span",{key:e,className:"fas fa-heart"})))),p.createElement(n.Z,{groups:this.props.user.groups,modifiers:"profile-page",wrapper:"profile-info__icon"}))}renderPreviousUsernames(){if(null==this.props.user.previous_usernames||0===this.props.user.previous_usernames.length)return null;const e=this.props.user.previous_usernames.join(", ");return p.createElement("div",{className:"profile-previous-usernames"},p.createElement("a",{className:"profile-previous-usernames__icon profile-previous-usernames__icon--with-title",onClick:f,title:`${(0,h.dW)("users.show.previous_usernames")}: ${e}`},p.createElement("span",{className:"fas fa-address-card"})),p.createElement("div",{className:"profile-previous-usernames__icon profile-previous-usernames__icon--plain"},p.createElement("span",{className:"fas fa-address-card"})),p.createElement("div",{className:"profile-previous-usernames__content"},p.createElement("div",{className:"profile-previous-usernames__title"},(0,h.dW)("users.show.previous_usernames")),p.createElement("div",{className:"profile-previous-usernames__names"},e)))}renderTitle(){var e;if(null==this.props.user.title)return null;const t={children:this.props.user.title,className:"profile-info__title",style:{color:null!==(e=this.props.user.profile_colour)&&void 0!==e?e:void 0}};return null!=this.props.user.title_url?p.createElement("a",Object.assign({href:this.props.user.title_url},t)):p.createElement("span",Object.assign({},t))}};b([c.Fl],v.prototype,"showCover",null),v=b([u.Pi],v);const g=v},8838:(e,t,s)=>{s.d(t,{Z:()=>w});var r=s(7868),a=s(7454),i=s(1759),n=s(7294),o=s(3336),l=s(1270);function c({level:e}){let t="iron";e>=110?t="lustrous":e>=105?t="radiant":e>=100?t="rhodium":e>=80?t="platinum":e>=60?t="gold":e>=40?t="silver":e>=20&&(t="bronze");const s=(0,o.sb)("user-level",`tier-${t}`);return n.createElement("div",{className:s,title:(0,l.dW)("users.show.stats.level",{level:e})},n.createElement("div",{className:"user-level__icon"}),n.createElement("span",{className:"user-level__level"},e))}var u=s(5119),d=s(9323),p=s(5078),m=s(5069),h=s(4498),b=s(2325),f=s(5076);function v(e){return n.createElement("div",{className:"btn-circle btn-circle--page-toggle btn-circle--page-toggle-detail",title:(0,l.dW)("common.buttons.show_more_options")},n.createElement(h.Z,null,(t=>n.createElement("div",{className:"simple-menu"},n.createElement("a",{className:"simple-menu__item",href:(0,f.tB)(e.user),onClick:t},n.createElement("span",{className:"fas fa-gift"}),` ${(0,l.dW)("users.card.gift_supporter")}`),n.createElement(m.Z,{modifiers:"inline",onClick:t,userId:e.user.id,wrapperClass:"simple-menu__item"}),n.createElement(b.c,{className:"simple-menu__item",icon:!0,onFormOpen:t,reportableId:e.user.id.toString(),reportableType:"user",user:e.user})))))}var g=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};let y=class extends n.Component{get showMessageButton(){return null==p.Z.currentUser||p.Z.currentUser.id!==this.props.user.id&&!p.Z.currentUserModel.blocks.has(this.props.user.id)}render(){return n.createElement("div",{className:"profile-detail-bar"},n.createElement(i.Z,{alwaysVisible:!0,followers:this.props.user.follower_count,modifiers:"profile-page",userId:this.props.user.id}),this.props.user.is_bot?this.renderMessageButton():this.renderNonBotButtons())}renderMessageButton(){return this.showMessageButton?n.createElement("div",null,n.createElement("a",{className:"user-action-button user-action-button--profile-page",href:(0,u.B)("messages.users.show",{user:this.props.user.id}),title:(0,l.dW)("users.card.send_message")},n.createElement("i",{className:"fas fa-envelope"}))):null}renderNonBotButtons(){return n.createElement(n.Fragment,null,n.createElement(a.Z,{alwaysVisible:!0,followers:this.props.user.mapping_follower_count,modifiers:"profile-page",showFollowerCounter:!0,userId:this.props.user.id}),this.renderMessageButton(),(e=this.props.user,null!=p.Z.currentUser&&p.Z.currentUser.id!==e.id&&n.createElement(v,{user:this.props.user})),null!=this.props.user.statistics&&n.createElement("div",{className:"profile-detail-bar__level"},n.createElement("div",{className:"profile-detail-bar__level-bar"},n.createElement(r.Z,{current:this.props.user.statistics.level.progress,modifiers:"user-profile",textPrecision:0,title:(0,l.dW)("users.show.stats.level_progress"),total:100})),n.createElement(c,{level:this.props.user.statistics.level.current})));var e}};y=g([d.Pi],y);const w=y},8082:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(7294),a=s(1270);function i(e){return r.createElement("div",{className:"u-relative"},r.createElement("h2",{className:"title title--page-extra"},(0,a.dW)(`users.show.extra.${e.name}.title`)),e.withEdit&&r.createElement("span",{className:"sortable-handle sortable-handle--profile-page-extra hidden-xs js-profile-page-extra--sortable-handle"},r.createElement("i",{className:"fas fa-bars"})))}},2992:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(5119),a=s(9755);function i(e,t,s){return a.ajax((0,r.B)("users.extra-page",{mode:s,page:t,user:e.id}))}},8715:(e,t,s)=>{s.d(t,{Z:()=>l});var r=s(5119),a=s(1270);const i=["modding","playlists","realtime"],n={modding:e=>(0,r.B)("users.modding.index",{user:e}),playlists:e=>(0,r.B)("users.multiplayer.index",{typeGroup:"playlists",user:e}),realtime:e=>(0,r.B)("users.multiplayer.index",{typeGroup:"realtime",user:e}),show:e=>(0,r.B)("users.show",{user:e})};function o(e,t,s){return{active:t,title:(0,a.dW)(`layout.header.users.${e}`),url:n[e](s)}}function l(e,t){const s=[o("show","show"===t,e.id)];return e.is_bot||i.forEach((r=>{s.push(o(r,t===r,e.id))})),s}},8788:(e,t,s)=>{function r(e,t,s){var r;const a=null!==(r=e.data(t))&&void 0!==r?r:[];e.data(t,[...a,...s])}s.d(t,{Z:()=>r})},3955:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(1982),a=s(7631),i=s(8788);function n(){(0,i.Z)(this,"micromarkExtensions",[a.E]),(0,i.Z)(this,"fromMarkdownExtensions",[r.t])}},5305:(e,t,s)=>{s.d(t,{Z:()=>c});var r=s(8788);const a=["attention","autolink","blankLine","blockQuote","characterReference","codeFenced","codeIndented","codeText","definition","hardBreakEscape","headingAtx","htmlFlow","htmlText","labelEnd","labelStartImage","labelStartLink","list","setextUnderline","thematicBreak"];const i=["autolink","definition","hardBreakEscape","headingAtx","htmlFlow","htmlText","setextUnderline","thematicBreak"],n=[...i,"blockQuote","codeFenced","codeIndented","codeText","list"],o={chat:["definition","htmlFlow","htmlText","labelStartImage","setextUnderline"],chatPlain:(l=["autolink","labelEnd","labelStartLink"],a.filter((e=>!l.includes(e)))),default:i,editor:[...n,"codeFenced","codeIndented","codeText","labelEnd","labelStartImage","labelStartLink"],reviews:n};var l;function c(e){var t;(0,r.Z)(this,"micromarkExtensions",[{disable:{null:o[null!==(t=null==e?void 0:e.type)&&void 0!==t?t:"default"]}}])}},7790:(e,t,s)=>{s.d(t,{Z:()=>n});var r=s(7294),a=s(3775),i=s(1270);function n(e){let t,s;const n=null!=e.score.best_id,o="solo_score"===e.score.type;return n||o?!1===e.score.ranked||!1===e.score.preserve?(t=(0,i.dW)("scores.status.no_pp"),s="-"):null==e.score.pp?o&&!0===e.score.processed?(t=(0,i.dW)("scores.status.no_pp"),s="-"):(t=(0,i.dW)("scores.status.processing"),s=r.createElement("span",{className:"fas fa-sync"})):(t=(0,a.uf)(e.score.pp),s=r.createElement(r.Fragment,null,(0,a.uf)(Math.round(e.score.pp)),e.suffix)):(t=(0,i.dW)("scores.status.non_best"),s="-"),r.createElement("span",{title:t},s)}},8259:(e,t,s)=>{s.d(t,{Gw:()=>a,XI:()=>n,Xl:()=>i});var r=s(7294);function a(e){this.setState({activeKey:e})}const i=(0,r.createContext)({activeKeyDidChange:e=>{}}),n=(0,r.createContext)(null)},556:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(8949),a=function(e,t,s,r){var a,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var o=e.length-1;o>=0;o--)(a=e[o])&&(n=(i<3?a(n):i>3?a(t,s,n):a(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n};class i{constructor(){Object.defineProperty(this,"cursorString",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"rooms",{enumerable:!0,configurable:!0,writable:!0,value:[]}),(0,r.rC)(this)}updateWithJson(e){for(const t of e.rooms)this.rooms.push(t);this.cursorString=e.cursor_string}}a([r.LO],i.prototype,"cursorString",void 0),a([r.LO],i.prototype,"rooms",void 0),a([r.aD],i.prototype,"updateWithJson",null)},2094:(e,t,s)=>{s.d(t,{d:()=>r});const r=(0,s(7294).createContext)(void 0)},5225:(e,t,s)=>{s.d(t,{Z:()=>r});const r=(0,s(7294).createContext)({isFriendsPage:!1})},9703:(e,t,s)=>{s.d(t,{Gi:()=>b,Jn:()=>p,bE:()=>m,f$:()=>f,hd:()=>u,l5:()=>v,qQ:()=>h,vU:()=>d});var r=s(5078),a=s(3775),i=s(1270),n=s(3599),o=s(3924),l=s(9755);const c=["status","statusText","readyState","responseText"];function u(e=document.body){return(t,s,r)=>l(e).trigger("ajax:error",[t,s,r])}const d=(e,t,s)=>{"abort"!==t&&(r.Z.userLogin.showOnError(e,s)||r.Z.userVerification.showOnError(e,s)||(0,n.g)(v(e),"danger"))},p=(e,t)=>{d(t.jqXHR,t.textStatus,(()=>{var e;null===(e=t.submit)||void 0===e||e.call(t)}))};function m(e){return"object"==typeof e&&null!=e&&c.every((t=>t in e))}const h=e=>d(e,e.statusText),b=e=>(t,s)=>{d(t,s,e)},f=e=>b((0,a.A$)(e));function v(e){var t,s;if(null==e||null==e.responseJSON)return(0,i.dW)("errors.unknown");const r=e.responseJSON;if(null!=r.validation_error)return`${Object.values(r.validation_error).flat().join(", ")}.`;let a=null!==(s=null!==(t=r.error)&&void 0!==t?t:r.message)&&void 0!==s?s:"";if(!(0,o.W)(a)){const t=`errors.codes.http-${e.status}`;a=(0,i.dW)(t),a===t&&(a=(0,i.dW)("errors.unknown"))}return a}},7629:(e,t,s)=>{s.d(t,{sE:()=>d,xU:()=>u,yh:()=>p,ru:()=>m,Dd:()=>h,yb:()=>b,UI:()=>f});var r=s(7543);var a=s(8152),i=s(6486),n=s(5078),o=s(8278),l=s(9755);const c=r.scaleLinear().domain([.1,1.25,2,2.5,3.3,4.2,4.9,5.8,6.7,7.7,9]).clamp(!0).range(["#4290FB","#4FC0FF","#4FFFD5","#7CFF4F","#F6F05C","#FF8068","#FF4E6F","#C645B8","#6563DE","#18158E","#000000"]).interpolate(r.interpolateRgb.gamma(2.2));function u(e){var t,s,r,n;if(null!=e.items){let r=null,c=null;const u=function(e){var t,s;null==g&&(g=null!==(t=(0,o.Um)("json-recommended-star-difficulty-all"))&&void 0!==t?t:{},l(document).one("turbolinks:before-cache",(()=>{g=null})));return null!==(s=g[e])&&void 0!==s?s:1}(null!==(t=e.mode)&&void 0!==t?t:a.z[0]);for(const t of e.items){const e=Math.abs(t.difficulty_rating-u);(null==(n=t).accuracy||null==n.deleted_at&&!n.convert)&&(null==r||e<r)&&(r=e,c=t)}return null!==(s=null!=c?c:i.last(e.items))&&void 0!==s?s:null}if(null==e.group)return null;const c=null==e.mode?v():[e.mode];for(const a of c){const t=u({items:null!==(r=e.group.get(a))&&void 0!==r?r:[],mode:a});if(null!=t)return t}return null}function d(e){var t;const s=null==e.mode?v():[e.mode];for(const r of s){const s=null===(t=e.group.get(r))||void 0===t?void 0:t.find((t=>t.id===e.id));if(null!=s)return s}return null}function p(e){return e<.1?"#AAAAAA":e>=9?"#000000":c(e)}function m(e){const t=i.groupBy(null!=e?e:[],"mode"),s=new Map;return a.z.forEach((e=>{var r;s.set(e,function(e){if(0===e.length)return[];if("mania"===e[0].mode)return i.orderBy(e,["convert","cs","difficulty_rating"],["desc","asc","asc"]);return i.orderBy(e,["convert","difficulty_rating"],["desc","asc"])}(null!==(r=t[e])&&void 0!==r?r:[]))})),s}function h(e){switch(e){case 0:return"osu";case 1:return"taiko";case 2:return"fruits";case 3:return"mania";default:throw new Error("invalid ruleset id passed")}}function b(e){return"ranked"===e.status||"approved"===e.status}function f(e){return[...m(e).values()].flat()}function v(){var e;const t=null===(e=n.Z.currentUser)||void 0===e?void 0:e.playmode;if(null==t||!a.z.includes(t))return a.z;const s=i.without(a.z,t);return s.unshift(t),s}let g=null},7012:(e,t,s)=>{s.d(t,{G2:()=>P,e7:()=>O,f9:()=>h,i$:()=>N,L9:()=>T,bf:()=>x,nc:()=>w,g8:()=>_,Uq:()=>D,ZB:()=>M,en:()=>I,cO:()=>L,of:()=>A,Qu:()=>$,Xe:()=>g,Qq:()=>y,Ks:()=>B});var r=s(382),a=s(1467);const i=Object.freeze({colour:"hsl(var(--hsl-l1))",has_listing:!1,has_playmodes:!1,id:-1,identifier:"guest",is_probationary:!1,name:"Difficulty Guest",short_name:"GUEST"});var n=s(78),o=s(8152),l=s(5119),c=s(6486),u=s(381),d=s(5078),p=s(9014),m=(s(5076),s(1327));const h="total",b=new Set(r.u),f=new Set(["events","generalAll","reviews"]),v="-",g=/\b(((\d{2,}):([0-5]\d)[:.](\d{3}))(\s\((?:\d+[,|])*\d+\))?)/,y=new RegExp(g,"g"),w=750,_=100,E=new Set(["suggestion","problem"]);function P({beatmapset:e,currentBeatmap:t,discussion:s,user:r}){return null==r?null:r.id===(null==e?void 0:e.user_id)?n.Z:null!=t&&s.beatmap_id===t.id&&r.id===t.user_id?i:null==r.groups||0===r.groups.length?null:r.groups[0]}function O(){const e=d.Z.currentUser;return null!=e&&(e.is_admin||e.is_moderator)}function j(e){return null!=e&&e!==v?"timeline":"generalAll"}function k(e){return"review"===e.message_type?"reviews":null!=e.beatmap_id?null!=e.timestamp?"timeline":"general":"generalAll"}function N(e){const t=e%1e3,s=Math.floor(e/1e3)%60,r=Math.floor(e/1e3/60);return`${(0,c.padStart)(r.toString(),2,"0")}:${(0,c.padStart)(s.toString(),2,"0")}:${(0,c.padStart)(t.toString(),3,"0")}`}function S(e){return null==e.deleted_at&&null!=e.timestamp&&E.has(e.message_type)&&(e.user_id!==d.Z.currentUserOrFail.id||u(e.updated_at).diff(u(),"hour")<=-24)}const C={nat:o.z};function T(e,t){return null!=e&&null!=e.groups&&e.groups.some((e=>{var s,r;if(null!=t){let a=null!==(s=e.playmodes)&&void 0!==s?s:[];return 0===a.length&&(a=null!==(r=C[e.identifier])&&void 0!==r?r:[]),("bng"===e.identifier||"nat"===e.identifier)&&a.includes(t)}return"bng"===e.identifier||"nat"===e.identifier}))}function x(e){var t,s;const{beatmap:r,discussion:a,filter:i,post:n,user:o}=e;let{beatmapId:c,beatmapsetId:u,discussionId:d,mode:p,postId:m}=e;if(null!=r&&(u=r.beatmapset_id,c=r.id),null!=a){d=a.id;const e=$(a);null!=e&&(u=e.beatmapsetId,c=null!==(t=e.beatmapId)&&void 0!==t?t:void 0,p=e.mode)}m=null!==(s=null==n?void 0:n.id)&&void 0!==s?s:m;const h={beatmap:null==c||f.has(p)?v:c,beatmapset:u,mode:null!=p?p:j(c)};null!=i&&"total"!==i&&"events"!==h.mode&&(h.filter=i);const b=new URL((0,l.B)("beatmapsets.discussion",h));return null!=d&&(b.hash=`/${d}`,null!=m&&(b.hash+=`/${m}`)),null!=o&&b.searchParams.set("user",o.toString()),b.toString()}function D(e,t){var s,r,a,i,n,o;const l={};for(const c of e)if(S(c)){const e=R(Math.abs(c.timestamp-t));null!=e&&(null!==(s=l[e])&&void 0!==s||(l[e]=[]),null===(r=l[e])||void 0===r||r.push(c))}const u=null!==(o=null!==(n=null!==(i=null!==(a=l.d0)&&void 0!==a?a:l.d100)&&void 0!==i?i:l.d1000)&&void 0!==n?n:l.other)&&void 0!==o?o:[];return(0,c.sortBy)(u,"timestamp")}function R(e){return e>5e3?null:0===e?"d0":e<100?"d100":e<1e3?"d1000":"other"}function M(e){if(null==e)return null;const t=e.match(g);if(null==t)return null;const s=t.slice(1).map((e=>{var t;return null!==(t=(0,m.w)(e))&&void 0!==t?t:0}));return 1e3*(60*s[2]+s[3])+s[4]}function I(e,t){const s=new URL(null!=e?e:(0,p.JJ)().href),[,r,i,n,o,l,u]=s.pathname.split(/\/+/),d=(0,m.w)(i);if("beatmapsets"!==r||"discussion"!==n||null==d)return null;const h=(0,m.w)(o),f={beatmapId:h,beatmapsetId:d,filter:(v=u,b.has(v)?u:"total"),mode:(0,a._)(l)?l:j(h),user:(0,m.w)(s.searchParams.get("user"))};var v;if("/"===s.hash[1]){const[e,r]=s.hash.split("/").slice(1,3).map(m.w);if(null!=e&&(f.discussionId=e,null!=r&&(f.postId=r),null!=t&&null!=e)){const s=t.find((t=>t.id===e));if(null!=s){if((0,c.assign)(f,$(s)),null!=s.posts){const e=s.posts.find((e=>e.id===r));null==e&&(f.postId=void 0)}}else f.discussionId=void 0,f.postId=void 0}}return f}function L(e=""){const t=I(),s={href:e,rel:"nofollow noreferrer",target:"_blank"};let r;try{r=new URL(e)}catch(a){}if(null!=r&&r.host===(0,p.JJ)().host){const e=I(r.href);if(null!=(null==e?void 0:e.discussionId)&&null!=e.beatmapsetId){const r=[e.discussionId,e.postId].filter(Number.isFinite).join("/");(null==t?void 0:t.beatmapsetId)===e.beatmapsetId?(s.children=`#${r}`,s.className="js-beatmap-discussion--jump",s.target=void 0):s.children=`${e.beatmapsetId}#${r}`}}return s}function A(e){return"posts"in e&&null!=e.posts?e.posts[0]:e.starting_post}function $(e){return{beatmapId:e.beatmap_id,beatmapsetId:e.beatmapset_id,discussionId:e.id,mode:k(e)}}function B(e,t=!1){return null!=e&&0!==e.length&&(!t||e.length<=w)}},6817:(e,t,s)=>{s.d(t,{F:()=>h,YQ:()=>d,aU:()=>u,c0:()=>p,uX:()=>m,wm:()=>c});var r=s(5119),a=s(6486),i=s(8949),n=s(5078),o=s(9703),l=s(9755);function c(e){return null==e.availability||e.availability.download_disabled||null!=e.availability.more_information}function u(e){return n.Z.userPreferences.get("beatmapset_title_show_original")?e.artist_unicode:e.artist}function d(e){return n.Z.userPreferences.get("beatmapset_title_show_original")?e.title_unicode:e.title}function p(e,t){return e.legacy_mode?e[t]:(0,a.sum)(Object.values(e[t]))}function m(e){return!e.nsfw||n.Z.userPreferences.get("beatmapset_show_nsfw")}const h=(0,i.aD)((e=>{const t=()=>{h(e)};if(n.Z.userLogin.showIfGuest(t))return;const s=!e.has_favourited;e.has_favourited=s,e.favourite_count+=s?1:-1;const a=l.ajax((0,r.B)("beatmapsets.favourites.store",{beatmapset:e.id}),{data:{action:s?"favourite":"unfavourite"},method:"POST"});return a.fail(((r,a)=>(0,i.z)((()=>{e.has_favourited=!s,e.favourite_count+=s?-1:1,(0,o.vU)(r,a,t)})))).done((t=>(0,i.z)((()=>{e.favourite_count=t.favourite_count})))),a}))},8612:(e,t,s)=>{s.d(t,{Qc:()=>n,R_:()=>o,gp:()=>l});var r=s(8152),a=s(1327),i=s(9014);function n(e){const[t,s]=e.slice(1).split("/");return{beatmapId:(0,a.w)(s),playmode:(0,r.U)(t)}}function o({beatmap:e,ruleset:t}){let s="";return null!=t||(t=null==e?void 0:e.mode),null!=t&&(s+=`#${t}`,null!=e&&(s+=`/${e.id}`)),s}function l(e){const t=(0,i.JJ)().href,s=`${t.replace(/#.*/,"")}${e}`;s!==t&&history.replaceState(history.state,"",s)}},3857:(e,t,s)=>{s.d(t,{_:()=>n,z:()=>i});var r=s(9162);const a=new Set;function i(e,t){var s;t?a.add(e):a.delete(e),(0,r.Eo)(null===(s=window.newBody)||void 0===s?void 0:s.querySelector(".js-blackout"),n())}function n(){return a.size>0}},3336:(e,t,s)=>{s.d(t,{$$:()=>o,eF:()=>c,sb:()=>n,sw:()=>l});var r=s(6486),a=s(3924);const i=(e,t)=>{e.forEach((e=>{Array.isArray(e)?e.forEach((e=>{null!=e&&t(e)})):"string"==typeof e?t(e):(0,r.forEach)(e,((e,s)=>{e&&t(s)}))}))};function n(e,...t){let s=e;return i(t,(t=>s+=` ${e}--${t}`)),s}function o(e){var t;return{"--group-colour":null!==(t=null==e?void 0:e.colour)&&void 0!==t?t:"initial"}}function l(...e){const t=[];return i(e,(e=>t.push(e))),t}function c(e){return(0,a.W)(e)?`url("${String(e).replace(/"/g,"%22")}")`:void 0}},9162:(e,t,s)=>{function r(e){null==e||e.setAttribute("data-visibility","visible")}function a(e){null==e||e.setAttribute("data-visibility","hidden")}function i(e,t){if(null==e)return;const s=(null!=t?t:!function(e){return"hidden"!==(null==e?void 0:e.getAttribute("data-visibility"))}(e))?r:a;s(e)}s.d(t,{Eo:()=>i,Ji:()=>r,U6:()=>a})},3775:(e,t,s)=>{s.d(t,{A$:()=>u,CP:()=>E,Eu:()=>g,LU:()=>h,Mu:()=>l,ZL:()=>c,bG:()=>P,cK:()=>_,h3:()=>y,ib:()=>d,oN:()=>O,ri:()=>w,td:()=>m,uf:()=>f});var r=s(6486),a=s(3336),i=s(9755);const n=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],o=1e3;function l(){return 0===c()}function c(){const e=document.documentElement;return e.scrollHeight-e.scrollTop-e.clientHeight}function u(e){if(e instanceof HTMLElement)return e instanceof HTMLFormElement?()=>i(e).submit():()=>e.click()}function d(e){if(null!=e)return{"--bg":(0,a.eF)(e),"--bg-2x":(0,a.eF)(P(e))}}function p(e){return(0,r.padStart)(e.toString(),2,"0")}function m(e,t=2){if(e<o)return`${e} B`;const s=Math.floor(Math.log(e)/Math.log(o));return`${f(e/Math.pow(o,s),t)} ${n[s]}`}function h(e){const t=e%60,s=Math.floor(e/60)%60,r=Math.floor(e/3600);return r>0?`${r}:${p(s)}:${p(t)}`:`${s}:${p(t)}`}const b=new Intl.NumberFormat(window.currentLocale);function f(e,t,s,r){return null==t&&null==s&&null==r?b.format(e):(null!=s||(s={}),null!=t&&(s.minimumFractionDigits=t,s.maximumFractionDigits=t),e.toLocaleString(null!=r?r:window.currentLocale,s))}const v=new Intl.NumberFormat(window.currentLocale,{maximumFractionDigits:1,minimumFractionDigits:0,notation:"compact"});function g(e){return null==e?void 0:v.format(e)}function y(e){return e instanceof HTMLElement?e:null}function w(e){const t=y(e);if(null==t)return!1;if(_(t)||["A","BUTTON"].includes(t.tagName))return!0;const s=y(t.parentNode);return null!=s&&w(s)}function _(e){return["INPUT","OPTION","SELECT","TEXTAREA"].includes(e.tagName)||e.isContentEditable}const E="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function P(e){if(null!=e)return e.replace(/(\.[^.]+)$/,"@2x$1")}function O(e){return e.replace(/<[^>]*>/g,"")}},7937:(e,t,s)=>{s.d(t,{k:()=>i,z:()=>r});var r,a=s(5078);function i(e){return t=>{let s=null;"Escape"===t.key?s=r.Cancel:"Enter"===t.key&&!t.shiftKey&&a.Z.windowSize.isDesktop&&(t.preventDefault(),s=r.Submit),e(s,t)}}!function(e){e.Cancel="cancel",e.Submit="submit"}(r||(r={}))},8278:(e,t,s)=>{function r(e,t){return 0===e.length?t:`${e}[${t}]`}function a(e,t){let s="";for(const a of t)s=r(s,a);return r(s,e)}function i(e,t=[]){const s=new Map;for(const r of Object.keys(e)){const n=e[r];if(null!=n)if(Array.isArray(n))s.set(a(r,t),n);else for(const[e,a]of i(n,t.concat(r)))s.set(e,a)}return s}function n(e){return null!=e?JSON.parse(JSON.stringify(e)):e}function o(e,t=!1){const s=l(e,t);if(null==s)throw new Error(`script element ${e} is missing or contains nullish value.`);return s}function l(e,t=!1,s){var r;const a=(null!==(r=window.newBody)&&void 0!==r?r:document.body).querySelector(`#${e}`);if(!(a instanceof HTMLScriptElement))return;const i=JSON.parse(a.text,s);return t&&a.remove(),i}function c(e,t){const s=JSON.stringify(t),r=document.getElementById(e);let a;if(null==r)a=document.createElement("script"),a.id=e,a.type="application/json",document.body.appendChild(a);else{if(!(r instanceof HTMLScriptElement))throw new Error(`existing ${e} is not a script element.`);a=r}a.text=s}s.d(t,{Cw:()=>c,Lm:()=>n,Mo:()=>o,Um:()=>l,lv:()=>i})},1270:(e,t,s)=>{s.d(t,{Pc:()=>n,Xl:()=>u,dW:()=>o,jn:()=>c,m2:()=>l});s(9705);var r=s(7294),a=s(3775),i=s(3924);function n(e,t="common.array_and"){const s=[];if(e.length>0&&(s.push(e[0]),e.length>1)){const a=e.length-1,i=o(1===a?`${t}.two_words_connector`:`${t}.last_word_connector`),n=o(`${t}.words_connector`);for(let t=1;t<a;t++)s.push(r.createElement(r.Fragment,{key:e[t].key},n,e[t]));s.push(r.createElement(r.Fragment,{key:e[a].key},i,e[a]))}return r.createElement(r.Fragment,null,s)}function o(e,t={},s){return u(e,s)||(s=fallbackLocale),window.Lang.get(e,t,s)}function l(e,t="common.array_and"){switch(e.length){case 0:return"";case 1:return`${e[0]}`;case 2:return e.join(o(`${t}.two_words_connector`));default:return`${e.slice(0,-1).join(o(`${t}.words_connector`))}${o(`${t}.last_word_connector`)}${e.slice(-1)[0]}`}}function c(e,t,s={},r){null!=r||(r=currentLocale);const i=r===fallbackLocale;if(!i&&!u(e,r))return c(e,t,s,fallbackLocale);s.count_delimited=(0,a.uf)(t,void 0,void 0,r);const n=window.Lang.choice(e,t,s,r);return i||null!=n?n:(delete s.count,c(e,t,s,fallbackLocale))}function u(e,t){null!=t||(t=window.currentLocale),window.Lang.setFallback(t);const s=window.Lang.get(e,void 0,t),r=(0,i.W)(s)&&s!==e;return window.Lang.setFallback(window.fallbackLocale),r}},9711:(e,t,s)=>{s.d(t,{Lt:()=>o,Uq:()=>n,ew:()=>i});var r=s(6486);function a(){const e=document.querySelector(".js-loading-overlay");if(e instanceof HTMLElement)return e}function i(){const e=a();null!=e&&e.classList.add("loading-overlay--visible")}const n=(0,r.debounce)(i,5e3,{maxWait:5e3});function o(){n.cancel();const e=a();null!=e&&e.classList.remove("loading-overlay--visible")}},3317:(e,t,s)=>{function r(e,t){const s=new Map;for(const r of e)s.set(r[t],r);return s}function a(e,t){const s=new Map;for(const r of e)s.set(r[t],r);return s}s.d(t,{e:()=>r,q:()=>a})},1327:(e,t,s)=>{function r(e){if(Number.isInteger(e))return e;if("string"==typeof e){const t=parseInt(e,10);if(Number.isInteger(t))return t}}s.d(t,{w:()=>r})},6122:(e,t,s)=>{s.d(t,{u:()=>i});var r=s(9003),a=s(9755);function i(){return(0,r.g)()||a("#overlay").is(":visible")||document.body.classList.contains("modal-open")}},7563:(e,t,s)=>{s.d(t,{Af:()=>l,mG:()=>u,t7:()=>o});var r=s(5119),a=s(8949),i=s(1327),n=s(9755);const o=(0,a.aD)(((e,t,s)=>{var o;e.pagination.loading=!0;const l=(null!==(o=(0,i.w)(s.limit))&&void 0!==o?o:50)+1,u=Object.assign(Object.assign({},s),{limit:l,offset:e.items.length});return n.ajax((0,r.B)(t,u)).done((t=>{c(e,t,l)})).always((0,a.aD)((()=>{e.pagination.loading=!1})))})),l=(e,t)=>o(e,"users.kudosu",{user:t}),c=(0,a.aD)(((e,t,s)=>{e.pagination.hasMore=u(s-1,t),e.items.push(...t)})),u=(0,a.aD)(((e,t)=>{const s=t.length>e;return s&&t.pop(),s}))},3599:(e,t,s)=>{s.d(t,{g:()=>n});var r=s(3775),a=s(9755);const i=["danger","warning"];function n(e,t="info"){var s;const n=a("#popup-container"),o=a(".popup-clone").clone(),l=()=>o.trigger("click");o.addClass(`alert-${t} popup-active`).removeClass("popup-clone"),o.find(".popup-text").html(e),i.includes(t)?a("#overlay").off("click.close-alert").one("click.close-alert",l).fadeIn():setTimeout(l,5e3),null===(s=(0,r.h3)(document.activeElement))||void 0===s||s.blur(),o.appendTo(n).fadeIn()}},8010:(e,t,s)=>{s.d(t,{aM:()=>u,PZ:()=>y,aG:()=>d,cr:()=>p,c1:()=>m,sQ:()=>h,O0:()=>b,Fi:()=>f,yT:()=>g,dZ:()=>w,M8:()=>_,JP:()=>E,wG:()=>O});var r=s(5119),a=s(5078),i=s(7629),n=s(1270);let o={};function l(e){return e.mods.some((e=>"FI"===e.acronym||"FL"===e.acronym||"HD"===e.acronym))}function c(e){var t,s,r,a,i,n,c,u,d,p,m,h;const b=`${e.type}:${e.id}`;let f=o[b];if(null==f){const v=null!==(t=e.statistics.miss)&&void 0!==t?t:0,g=null!==(s=e.statistics.great)&&void 0!==s?s:0;let y,w;switch(e.ruleset_id){case 0:{const t=null!==(r=e.statistics.meh)&&void 0!==r?r:0,s=null!==(a=e.statistics.ok)&&void 0!==a?a:0,i=t+s+g+v;y=i>0?(50*t+100*s+300*g)/(300*i):1;const n=i>0?g/i:1,o=i>0?t/i:1;w="F"===e.rank?"F":1===n?l(e)?"XH":"X":n>.9&&o<=.01&&0===v?l(e)?"SH":"S":n>.8&&0===v||n>.9?"A":n>.7&&0===v||n>.8?"B":n>.6?"C":"D";break}case 1:{const t=null!==(i=e.statistics.ok)&&void 0!==i?i:0,s=t+g+v;y=s>0?(150*t+300*g)/(300*s):1;const r=s>0?g/s:1;w="F"===e.rank?"F":1===r?l(e)?"XH":"X":r>.9&&0===v?l(e)?"SH":"S":r>.8&&0===v||r>.9?"A":r>.7&&0===v||r>.8?"B":r>.6?"C":"D";break}case 2:{const t=null!==(n=e.statistics.large_tick_hit)&&void 0!==n?n:0,s=null!==(c=e.statistics.small_tick_hit)&&void 0!==c?c:0,r=s+t+g+v+(null!==(u=e.statistics.small_tick_miss)&&void 0!==u?u:0);y=r>0?(s+t+g)/r:1,w="F"===e.rank?"F":1===y?l(e)?"XH":"X":y>.98?l(e)?"SH":"S":y>.94?"A":y>.9?"B":y>.85?"C":"D";break}case 3:{const t=null!==(d=e.statistics.perfect)&&void 0!==d?d:0,s=null!==(p=e.statistics.good)&&void 0!==p?p:0,r=null!==(m=e.statistics.ok)&&void 0!==m?m:0,a=null!==(h=e.statistics.meh)&&void 0!==h?h:0,i=t+s+r+a+g+v;y=i>0?(300*(g+t)+200*s+100*r+50*a)/(300*i):1,w="F"===e.rank?"F":1===y?l(e)?"XH":"X":y>.95?l(e)?"SH":"S":y>.9?"A":y>.8?"B":y>.7?"C":"D";break}default:throw new Error("unknown score ruleset")}f=o[b]={accuracy:y,rank:w}}return f}function u(e){return P(e)?c(e).accuracy:e.accuracy}function d(e){return(null!=e.best_id||"solo_score"===e.type)&&null!=a.Z.currentUser&&e.user_id!==a.Z.currentUser.id}function p(e){return P(e)?e.mods.filter((e=>"CL"!==e.acronym)):e.mods}function m(e){return d(e)||h(e)||b(e)||a.Z.scorePins.canBePinned(e)}function h(e){return e.has_replay}function b(e){return null!=e.best_id||"solo_score"===e.type}function f(e){return P(e)?e.legacy_perfect:e.is_perfect_combo}document.addEventListener("turbolinks:load",(()=>{o={}}));const v=(0,n.dW)("beatmapsets.show.scoreboard.headers.miss"),g={fruits:[{attributes:["great"],key:"great",label:"fruits"},{attributes:["large_tick_hit"],key:"ticks",label:"ticks"},{attributes:["small_tick_miss"],key:"drp_miss",label:"drp miss"},{attributes:["miss","large_tick_miss"],key:"miss",label:v}],mania:[{attributes:["perfect"],key:"perfect",label:"max"},{attributes:["great"],key:"great",label:"300"},{attributes:["good"],key:"good",label:"200"},{attributes:["ok"],key:"ok",label:"100"},{attributes:["meh"],key:"meh",label:"50"},{attributes:["miss"],key:"miss",label:v}],osu:[{attributes:["great"],key:"great",label:"300"},{attributes:["ok"],key:"ok",label:"100"},{attributes:["meh"],key:"meh",label:"50"},{attributes:["miss"],key:"miss",label:v}],taiko:[{attributes:["great"],key:"great",label:"great"},{attributes:["ok"],key:"ok",label:"good"},{attributes:["miss"],key:"miss",label:v}]};function y(e,t){return g[e].map((e=>({key:e.key,label:e.label,total:e.attributes.reduce(((e,s)=>{var r;return e+(null!==(r=t.statistics[s])&&void 0!==r?r:0)}),0)})))}function w(e){return P(e)?c(e).rank:e.rank}function _(e){if("solo_score"===e.type)return(0,r.B)("scores.download",{score:e.id});if(null!=e.best_id)return(0,r.B)("scores.download-legacy",{rulesetOrScore:(0,i.Dd)(e.ruleset_id),score:e.best_id});throw new Error("score json doesn't have download url")}function E(e){if("solo_score"===e.type)return(0,r.B)("scores.show",{rulesetOrScore:e.id});if(null!=e.best_id)return(0,r.B)("scores.show",{rulesetOrScore:(0,i.Dd)(e.ruleset_id),score:e.best_id});throw new Error("score json doesn't have url")}function P(e){return null!==e.legacy_score_id&&a.Z.userPreferences.get("legacy_score_only")}function O(e){return P(e)?e.legacy_total_score:e.total_score}},9139:(e,t,s)=>{s.d(t,{V:()=>n,d:()=>i});var r=s(2918);let a=0;function i(){return++a}function n(){return r.uuid()}},3924:(e,t,s)=>{function r(e){return a(e)?e:null}function a(e){return null!=e&&""!==e}s.d(t,{G:()=>r,W:()=>a})},9696:(e,t,s)=>{function r(e){}s.d(t,{Q:()=>r})},9014:(e,t,s)=>{s.d(t,{JJ:()=>i,Kn:()=>n,c4:()=>o,sl:()=>l});var r=s(9755),a=s(2918);function i(){var e;return null!==(e=window.newUrl)&&void 0!==e?e:document.location}function n(){const e=i();return e instanceof URL?e.searchParams:new URLSearchParams(e.search)}function o(e,t=!1,{action:s}={action:"advance"}){t&&function(){const{pageXOffset:e,pageYOffset:t}=window;r(document).one("turbolinks:load",(()=>window.scrollTo(e,t)))}(),a.visit(e,{action:s})}function l(e=!0){r(document).off(".ujsHideLoadingOverlay"),a.clearCache(),o(i().href,e,{action:"replace"})}},5076:(e,t,s)=>{s.d(t,{Au:()=>l,Dz:()=>b,FP:()=>m,TR:()=>d,_r:()=>y,bj:()=>v,dP:()=>g,pc:()=>f,rb:()=>u,ri:()=>h,tB:()=>p,vU:()=>c});var r=s(5119),a=s(6486),i=s(8612),n=s(9014),o=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(s[r[a]]=e[r[a]])}return s};function l(e){return`osu://b/${e}`}function c(e){return`osu://s/${e}`}function u(e,t){return(0,r.B)("beatmapsets.show",{beatmapset:e.beatmapset_id})+(0,i.R_)({beatmap:e,ruleset:t})}function d(e){return(0,r.B)("changelog.build",{build:e.version,stream:e.update_stream.name})}function p(e){return(0,r.B)("store.products.show",{product:"supporter-tag",target:e.username})}function m(e){return e.isHTML()||(0,a.startsWith)(e.getPath(),"/home/changelog/")}function h(e){return`osu://edit/${e}`}function b(e,t,s){(null==s?void 0:s.unescape)&&(e=(0,a.unescape)(e),t=(0,a.unescape)(t));const r=document.createElement("a");if(r.textContent=t,r.setAttribute("href",e),null!=s&&(s.isRemote&&r.setAttribute("data-remote","1"),null!=s.classNames&&(r.className=s.classNames.join(" ")),null!=s.props)){const e=s.props,{className:t}=e,a=o(e,["className"]);null!=t&&(r.className=t);for(const[s,i]of Object.entries(a))null!=i&&r.setAttribute(s,i)}return r.outerHTML}function f(e){if("javascript:void(0)"!==e)return e}function v(e,t,s){const r=(0,n.JJ)(),a=new URL(null!=e?e:r.href,r.origin);for(const[i,n]of Object.entries(t))null!=n?a.searchParams.set(i,n):a.searchParams.delete(i);return null!=s&&(a.hash=s),a.href}function g(e,t){return(0,r.B)("wiki.show",{locale:null!=t?t:currentLocale,path:"WIKI_PATH"}).replace("WIKI_PATH",encodeURI(e))}function y(e){return(0,r.B)("wiki.show",{path:"WIKI_PATH"}).replace("/WIKI_PATH",encodeURI(e))}}}]);
//# sourceMappingURL=commons.fb95a982.js.map